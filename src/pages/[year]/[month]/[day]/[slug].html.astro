---
import { type CollectionEntry, getCollection } from 'astro:content';
import BlogPost from '../../../../layouts/BlogPost.astro';
import { render } from 'astro:content';
import { EARLIEST_POST_DATE } from '../../../../consts';

export async function getStaticPaths() {
    const posts = await getCollection('blog');

    return posts.map((post) => {
        const date: Date = (post.data.date || EARLIEST_POST_DATE);

        const year = date.getFullYear();
        const month = (date.getMonth() <= 9 ? '0' : '') + (date.getMonth() + 1);
        const day = (date.getDate() <= 9 ? '0' : '') + date.getDate();

        return {
            params: { year, month, day, slug: post.id },
            props: post,
        };
    });
}

type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content } = await render(post);
---

<BlogPost {...post.data}>
    <Content />
</BlogPost>
