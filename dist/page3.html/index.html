<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/page3.html/"><!-- Primary Meta Tags --><title>moofoo blog</title><meta name="title" content="moofoo blog"><meta name="description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main> <section> <article> <h1> <a href="/2022/04/04/2022-04-04-distributed-erlang-example.html">Distributed Erlang example</a> </h1> <time datetime="2022-04-03T14:00:00.000Z"> Apr 4, 2022 </time> <div class="content"> <p>As promised in <a href="/2020/11/07/erlang-example-2.html">my previous blog about Erlang</a>, I continue
on a journey to more practical Erlang examples.</p>
<p>This might sound super ambitious, but let us build a distributed database.</p>
<p>For sake of simplicity, let’s make it a reduced version of Redis - a key-value distributed in-memory storage.
Essentially, an over-engineered hashmap.</p>
<p>To draw some boundaries around this, let’s focus on these key features:</p>
<ul>
<li>simple CRUD actions - get, set and delete a value; this should operate on REST-like API:
<ul>
<li><code>get(&#x3C;key>)</code> - get key value</li>
<li><code>set(&#x3C;key>)</code> - use request body for value and associate the value with the key</li>
<li><code>delete(&#x3C;key>)</code> - remove the key from the storage</li>
</ul>
</li>
<li>running on multiple nodes (machines)</li>
<li>synchronizing the data between the nodes; this should support:
<ul>
<li>ability to rotate the nodes in the cluster (switch off nodes and add new ones randomly) without the loss of data</li>
<li>distributing the operations across the nodes to keep the data in sync</li>
</ul>
</li>
</ul>
<p>Sounds unbelievable, but with Erlang this is actually pretty simple.
Erlang is actually a great choice for an application like this, since we do not have to worry about setting up the cluster
and deal with communication protocols (as in how to pass data over the network between the nodes).</p>
<p>We will need a “main” process, which will take the requests from the users and pass them to the nodes.
Each node will store its own copy of the data in memory. On startup, each new node will receive the copy of the data
from the first available node. If no nodes are available - that means the cluster is fresh and we can safely assume
the data is empty (or the cluster has died altogether and that state is unrecoverable).</p>
<h2 id="step-1-draw-a-circle">Step 1: draw a circle</h2>
<p>Start simple: let us have a simple application which starts a background process and responds to some commands.
It could be as simple as <code>ping - pong</code> application - the background process waits for a <code>ping</code> message and responds with <code>pong</code>
upon receiving one.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">db_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn_link</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    register</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        pong</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">pong</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>This is a relatively simple application, but it has few quirks:</p>
<ul>
<li><code>spawn_link/1</code> (<code>spawn_link(loop)</code>) - this function spawns a new background process and links it to the current one, so that once the current process stops, the linked process also stops</li>
<li><code>register/2</code> (<code>register(server, Pid)</code>) - registers a global (in the current module scope) symbol (<code>server</code> in this case) and associates it with the process PID passed as the second parameter (<code>Pid</code> in this case, the PID of the spawned process running the <code>loop</code> function)</li>
<li>the <code>ping/0</code> function sends a message (<code>{ ping, self() }</code> tuple) containing the atom <code>ping</code> and current process’ PID to the process registered as <code>server</code>; it then starts waiting for <em>any process</em> to send a <code>pong</code> message to the current process, effectively blocking the current process until that message is received</li>
<li>the <code>loop</code> function responds to two messages:
<ul>
<li><code>{ ping, Pid }</code> - by sending <code>pong</code> message to the process with PID set in the <code>Pid</code> constant and running itself recursively (turning the entire <code>loop/0</code> function into a <code>while</code> loop)</li>
<li><code>stop</code> - by simply returning the <code>ok</code> atom and exiting (thus terminating the loop)</li>
</ul>
</li>
</ul>
<p>To run this application, start the Erlang shell with <code>erl</code> and type in few prompts:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>1> c(db_server).</span></span>
<span class="line"><span>{ok,db_server}</span></span>
<span class="line"><span>2> db_server:start().</span></span>
<span class="line"><span>ok</span></span>
<span class="line"><span>3> db_server:ping().</span></span>
<span class="line"><span>pong</span></span>
<span class="line"><span></span></span></code></pre>
<p>The benefit of this architecture is that once we have an Erlang shell open and run the <code>start/0</code> function, it will start the background process and exit immediately. But the background process will keep running and we will have the other functions available to interact with that process, without loosing the access to the Erlang shell.</p>
<p>This protocol also highlights the concurrent aspect of the application - we send the current process’ PID to the callee and start listening for the messages from <em>anywhere</em>.
Once we receive the message - we pass it to the other process. So the entire application is predominantly non-blocking and asynchronous in nature.</p>
<h2 id="step-2-draw-a-second-circle">Step 2: draw a second circle</h2>
<p>The application is surely awesome, but let’s make it actually useful to any extent. We are designing a key-value storage, so why not to have one?
Instead of just reacting to the <code>ping</code> message, we can have a <code>map</code> and have a simple API to set value, get value and delete a value from the map while
keeping the map on the child process.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">db_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn_link</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    register</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Value) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value } -> Value</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">put</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Value, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">remove</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>As you can see, there’s nothing special going on here - all is quite simple. We start the background process with some initial data (<code>maps:new()</code>)
and in the <code>loop/1</code> function whenever we enter recursion, we pass the new version of the data to the recursive call.
The only function which actually is blocking its execution until it receives a response from a callee is <code>get/1</code> - we wait for the background process
to send the value to the current process.</p>
<div class="content-read-marker" data-fraction="25"></div>
<p>The interaction with this application could look like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>1> c(db_server).</span></span>
<span class="line"><span>{ok,db_server}</span></span>
<span class="line"><span>2> db_server:start().</span></span>
<span class="line"><span>ok</span></span>
<span class="line"><span>3> db_server:set(moo, -3.14).</span></span>
<span class="line"><span>ok</span></span>
<span class="line"><span>4> db_server:get(moo).</span></span>
<span class="line"><span>-3.14</span></span>
<span class="line"><span>5> db_server:delete(moo).</span></span>
<span class="line"><span>ok</span></span>
<span class="line"><span>6> db_server:get(moo).</span></span>
<span class="line"><span>none</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="step-3-draw-the-rest-of-the-owl">Step 3: draw the rest of the owl</h2>
<p>Now for the juicy bits: let us have a worker node, which will actually be a replica of the database.
It is as simple as extracting the logic from <code>loop/1</code> function to a separate module and having a new process being started
on a new node, once we decide to add it to the cluster:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">put</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Value, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">remove</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>The <code>db_server</code> module needs few changes:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">db_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn_link</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([]) </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    register</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Value) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value } -> Value</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    server</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [{ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid }|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Nodes,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value } -> Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Data ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            monitor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">process</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ { NodeAddr, NodePid } ], Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>The public API of the <code>db_server</code> module does not really change - there’s a new function <code>add_node/1</code> but that’s about it - these
exported (aka “public”) functions only send messages to the <code>server</code> process.</p>
<p>The <code>loop/1</code> function on the other hand has most changes - instead of sending message to a single process, it now distributes them
across the processes stored in the <code>Nodes</code> constant. This constant is a list of tuples <code>{ NodeAdd, NodePid }</code> where the <code>NodeAddr</code>
(the first element of the tuple) is just to keep track of nodes added to the list (for debug purposes predominantly) and <code>NodePid</code>
(the second element of the tuple) is what is actually used to communicate with the <code>db_server</code> process.</p>
<p>All the control messages (<code>get</code>, <code>set</code> and <code>delete</code>) are passed to <em>all</em> nodes from the <code>Nodes</code> list.
Exception being the <code>{ get, Key, Pid }</code> message - it only sends the message to the first node from the list.
And since all the <code>worker</code> nodes are (supposed to be) just replicas of each other, it is sufficient.</p>
<p>So far this should work. Start the <code>db_server</code> node with</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> erl</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -sname</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> supervisor</span></span>
<span class="line"></span></code></pre>
<p>followed by the call to</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>(supervisor@MACHINENAME)> c(db_server).</span></span>
<span class="line"><span>{ok,db_server}</span></span>
<span class="line"><span>(supervisor@MACHINENAME)> db_server:start().</span></span>
<span class="line"><span>ok</span></span>
<span class="line"><span></span></span></code></pre>
<p>Then, add few nodes to the cluster. For that, the node must be running and must use the same naming convention as the supervisor
(short name, set with <code>-sname</code> param to the <code>erl</code> or long name, set with the <code>-name</code> param to the <code>erl</code>) - otherwise they won’t see each other.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> erl</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -sname</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> subnode1</span></span>
<span class="line"></span></code></pre>
<p>followed by</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>(subnode1@MACHINENAME)> c(worker).</span></span>
<span class="line"><span>{ok,worker}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Note how you don’t need to do anything on the worker node except compile the module. The supervisor node will start processes on that node itself.</p>
<p>Lastly, on the server node call</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>(supervisor@MACHINENAME)> server:add_node(subnode1@MACHINENAME).</span></span>
<span class="line"><span>ok</span></span>
<span class="line"><span></span></span></code></pre>
<p>The node name is printed out to the Erlang shell once you start <code>erl</code> with <code>-sname</code> or <code>-name</code> param provided.
But you can also add <code>io:format("Started node at ~s~n", node())</code> as the first statement in the <code>loop/1</code> function in <code>worker</code> module -
it will print out the node name to the Erlang shell once the function is started. You can then use it as a raw atom parameter to <code>server:add_node/1</code>.</p>
<p>Now, the last piece to the system is keeping all the worker nodes in sync by copying the data from the first alive node to the new node once it is added
to the supervisor.</p>
<p>To do so, we will need to utilize the <code>net_adm</code> module, which conveniently has the <code>net_adm:ping/1</code> function, taking the node address and returning <code>pond</code>
atom if the node is alive and is visible from the current node or <code>pang</code> otherwise.
This way we can replace all the occurrences of the <code>Nodes</code> list in the <code>db_server:loop/1</code> function with the list of <em>alive</em> nodes:</p>
<div class="content-read-marker" data-fraction="50"></div>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% supervisor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sets</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value } -> Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Data ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            monitor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">process</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ { NodeAddr, NodePid } ], AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>Now to get the data from the node, we will need an extra message to be supported by the <code>worker</code> module:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% worker</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">put</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Value, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">remove</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Data },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>This way when we want to add a new node to the cluster, we will need to first get the data from the first available node
and then send it to the newly added node in the <code>db_server</code> module. But if there are no nodes alive, we want the <code>maps:new()</code> to be the new data:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% supervisor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, ReceivedValue } -> ReceivedValue</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NewData } -> NewData;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                        _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Data ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            monitor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">process</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ { NodeAddr, NodePid } ], AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>You may practice putting nodes on and off the running cluster, getting and setting the values at the same time.
But occasionally you might stumble upon a <code>db_server:get/1</code> function hanging.
This is what happens when there are no alive nodes on the cluster.
In order to fix this, we can simply add a check for that instead of blindly taking the <em>first</em> node from the <code>AliveNodes</code> list:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% supervisor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, ReceivedValue } -> ReceivedValue</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">no_nodes</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NewData } -> NewData;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                        _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Data ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            monitor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">process</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ { NodeAddr, NodePid } ], AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<div class="content-read-marker" data-fraction="75"></div>
<p>This will still not work however. The issue is that we only assign the value to the <code>AliveNodes</code> once we enter the <code>db_server:loop/1</code> function.
And that only happens <em>after</em> it processed a message. But the moment the value is actually needed is <em>right before processing a message</em>.
See the difference? There might be a delay between processing (as in “receiving”) a message and figuring the list of actually alive nodes because
the process is blocked waiting for new messages.</p>
<p>One way to fix this is to move the <code>AliveNodes</code> assignment to <em>each branch</em> of the <code>receive</code> block:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% supervisor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, ReceivedValue } -> ReceivedValue</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">no_nodes</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NewData } -> NewData;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                        _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Data ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            monitor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">process</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ { NodeAddr, NodePid } ], AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>Alternatively, we can utilize the <code>after</code> keyword which effectively implements a timeout mechanism:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% supervisor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Nodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -> FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, ReceivedValue } -> ReceivedValue,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                        _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">no_nodes</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Nodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NewData } -> NewData;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                        _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Data ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            monitor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">process</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ { NodeAddr, NodePid } ], Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    after</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>This will make the <code>receive</code> expression of the <code>db_server:loop/1</code> function check if there are any messages in the internal message inbox (aka message queue)
associated with the current function. And if there are no messages after <code>0</code> (as in this case) time since the check started - the code in the corresponding
matching expression will be executed. In our scenario, we figure the new list of alive nodes and restart the <code>loop</code> function. This way the time the process
is sitting blocked waiting for messages is bare minimal.</p>
<p>On the other hand, if you look carefully at all those <code>receive</code> statements within the <code>loop</code> function, you might just notice… that you don’t need them
in fact - the worker nodes might just communicate with each other! So instead of sending <code>self()</code> PID to each worker node (for ex. for <code>get</code> message or <code>get_all</code> message),
you can just send the received node PID (which is a part of the message) to the worker node. This will make the code highly asynchronous:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% supervisor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Nodes) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">net_adm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ping</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> pong</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Nodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -> FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">no_nodes</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foreach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid }) -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(AliveNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">add_node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodeAddr } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NodeAddr, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">worker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Data ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            monitor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">process</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ { NodeAddr, NodePid } ], AliveNodes),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AliveNodes </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FirstNodePid } | </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] -> FirstNodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NodePid };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> NodePid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">got_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewNodes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>This will need a tiny adjustment to the <code>worker</code> module (to support that <code>{ got_all, Data }</code> messages), but the benefits are more than worth it!</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">% worker</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Value } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">put</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Value, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Key } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            NewData </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">remove</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Key, Data),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid } -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">get_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Data },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">got_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, NewData } -></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NewData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<h2 id="wrap-up">Wrap-up</h2>
<p>The cherry on top of this cake would be to create an actual REST API (or any non-Erlang API for that matter) so that this database could be used
from the outside world without starting an Erlang shell. But I’d rather save it for a later blog.</p>
<p>For now you can actually plug and unplug nodes from the cluster, and while there is at least one node alive, the data integrity is guaranteed.</p>
<p>The highly asynchronous architecture of the solution allows for non-blocking calls all over the place.</p>
<p>For me, this is a great example on how to <em>actually</em> use Erlang!</p>
<p>The slightly built-up code is hosted <a href="https://github.com/shybovycha/distributed-key-value-db">on GitHub</a>.</p>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2021/07/02/2021-07-02-what-is-a-monad.html">What is a Monad?</a> </h1> <time datetime="2021-07-01T14:00:00.000Z"> Jul 2, 2021 </time> <div class="content"> <h2 id="what-is-a-monad">What is a monad?</h2>
<p>There is a talk by Gilad Bracha, <a href="https://www.infoq.com/presentations/functional-pros-cons/">“Deconstructing functional programming”</a>. This is a very good introduction to functional programming, monads included.</p>
<p>As per that talk, think about monad as a class like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">abstract</span><span style="color:#D73A49;--shiki-dark:#F97583"> class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> FlatMappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  @</span><span style="color:#D73A49;--shiki-dark:#F97583">Immutable</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  private</span><span style="color:#D73A49;--shiki-dark:#F97583"> final</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  FlatMappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(A </span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  FlatMappable&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> flatMap&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(Function&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FlatMappable&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>> fn) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fn.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Just rename <code>FlatMappable</code> to <code>Monad</code> and there you go.</p>
<p>Now, if you want more Haskell naming (gonna implement it in C++ for more correct syntax):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">template</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">typename</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">cass Monad {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  static</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Monad</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">A</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(A a) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Monad</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  template </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;typename</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Monad</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">B</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> operator</span><span style="color:#D73A49;--shiki-dark:#F97583">>>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::function</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">A, Monad</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">B</span><span style="color:#D73A49;--shiki-dark:#F97583">>></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fn) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fn.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Monad</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(A a) : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">m_a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a) {}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  immutable</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">A</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m_a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Essentially, renaming constructor to <code>return</code> and <code>flatMap</code> to <code>operator>>=</code></p>
<p>Also, in terms of <code>Mappable</code> vs <code>FlatMappable</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Mappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  private</span><span style="color:#D73A49;--shiki-dark:#F97583"> final</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Mappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(A </span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a; }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Mappable&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Function&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#E36209;--shiki-dark:#FFAB70">fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Mappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(fn.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Flattable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Mappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Flattable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(A </span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">super</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a); }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Flattable&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">flatten</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a instanceOf Flattable</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">A</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">flatten</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> FlatMappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Flattable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  FlatMappable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(A </span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">super</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a); }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  FlatMappable&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> flatMap&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(Function&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">A</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, FlatMappable&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>> fn) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(fn).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">flatten</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h2 id="why-do-we-need-monads">Why do we need monads?</h2>
<p>In order to preserve purity of programs in functional programming languages, you can not have side-effects in your program.</p>
<p>But if you need interaction with outside systems (IO, database, system clock, random number generator, etc.), you will need to somehow make these operations without side-effects.</p>
<p>So you write your entire program as a description of a workflow (e.g. how data will be processed). Basically your program becomes a chain of functions calling other functions. No waiting for events, nothing like that.</p>
<p>Then, when you run your program, “at the execution edge” (aka “event horizon”), just before your program finishes, the runtime will do all the “unsafe” (or rather “impure”) operations (interaction with IO, system clock, etc.) and will feed all the input to your functions, take the output and modify “the state of the world outside”.</p>
<p>Where are monads on this? Monads are basically just wrappers around other values, telling the runtime what to do. So that your code is still pure and all the impure side-effects will be eventually handled by runtime.</p>
<p>For example, reading from STDIN would be something like <code>IO&#x3C;String></code> - a monad, whose value will be provided eventually. So your program will be defined as a function something like</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IO</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] input)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IO</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  input.map { name </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> printLn(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, ${name}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }</span></span>
<span class="line"></span></code></pre>
<p>As you can see, <code>main</code> is a function which simply returns another <code>IO[String]</code> by mapping a monad parameter.</p>
<p>When you run it, the program will effectively stop until the <code>IO[String] input</code> parameter is filled with value. When the value will be provided, runtime will execute the rest of the code (the <code>map { ... }</code> part).</p> </div>  </article><article> <h1> <a href="/2021/05/04/2021-05-04-irr-paint-3d.html">irrPaint3d</a> </h1> <time datetime="2021-05-04T06:49:00.000Z"> May 4, 2021 </time> <div class="content"> <p>Recently I was reviving some of my old projects. And to my surprise, there were some people actually interested in those!
That was a good enough reason for me to revise the old pet projects of mine and exercise my skills (mostly in C++ though).</p>
<p>One really interesting project I had back in the day was irrPaint3d. It all started as an idea for my B.Sc. thesis and
the ultimate goal was to enable users paint 3D objects and immediately see the results in realtime, in 3D.</p>
<p>This is a no unique feature nowadays, but back in 2013, to my knowledge, the only way to texture 3D models was to either
unwrap them to UV maps and then paint the textures in graphics editor (such as Gimp or Paint.NET) or to use a proprietary
software, 3D Coat.</p>
<img src="/images/irr-paint-3d/blender_unwrapping.webp" loading="lazy" alt="Unwrapping 3D model texture in Blender in 2013">
<p>And a mere idea of implementing such tool myself was quite exciting. Darn, if I managed to implement it
back in 2013, my thesis would shine among best thesises in my uni!</p>
<p>Long story short, I have failed with that. And now, after spending just few days on this, I am happy to say I have achieved
something with yet another glorious pet project revival:</p>
<img src="/images/irr-paint-3d/final_version_screenshot.webp" loading="lazy" alt="Revised 3D model painting">
<p>And it actually allows to paint the model in 3D, displaying the results in real-time!</p>
<p>A bit of history on how I got there and maths behind the solution under the cut.</p>
<!--more-->
<div class="content-read-marker" data-fraction="25"></div>
<h2 id="a-brief-history">A brief history</h2>
<p>Back in the day I have put too little thought into the project so I ended up trying to implement LSCM algorithm to
unwrap 3D models. And after numerous failures I came up with my own, very simple algorithm to unwrap models and that made
my B.Sc. thesis.</p>
<p>The algorithm was a simple system of numerous circle equations following the logic of pinning down a vertex from a triangle
on 2D plane at point <code>(0, 0)</code> and figuring out the 2D coordinates of the other two vertices using the lengths of the triangle
edges in 3D, using two circles, with centres at the pinned point (<code>(0, 0)</code>) and radiuses equal to triangle edges’ lengths.
The circles would overlap in two points, and both are candidates for the other two triangle’ verices mapping:</p>
<img src="/images/irr-paint-3d/mapping_near.webp" loading="lazy" alt="The idea behind my unwrapping algorithm">
<p>The algorithm… worked… in some cases:</p>
<img src="/images/irr-paint-3d/cube_unwrapped.webp" loading="lazy" alt="Sample algorithm result, unwrapped cube">
<p>I did try to understand the concept of barycentric coordinates, but that is something completely different to what I imagined,
apparently:</p>
<img src="/images/irr-paint-3d/barycentric_coordinates.webp" loading="lazy" alt="My previous understanding of barycentric coordinates">
<div class="content-read-marker" data-fraction="50"></div>
<h2 id="the-maths-behind">The maths behind</h2>
<p>With my new approach, I took an idea from the enormously cool introduction to computer graphics and the math underneath
by <a href="https://www.youtube.com/watch?v=ih20l3pJoeU">One Lone Coder</a>. The idea itself is rather trivial: any vector could be represented
as a sum of two other (not necessarily orthogonal) vectors (plus a condition that the angle between the two should not be 180 degrees).</p>
<img src="/images/irr-paint-3d/vector_as_a_sum.webp" loading="lazy" alt="Vector as a sum of other vectors">
<p>In the example above, vector <code>p</code> could be represented as a sum of vectors <code>a</code> and <code>b</code>, each multiplied by certain coefficients:
<code>p = u*a + v*b</code>.</p>
<p>And the dimensions of the vectors do not matter - this logic will work just as well in 3D as in 2D.</p>
<p>Now, if we have a triangle in 3D, <code>ABC</code> and a point inside that triangle <code>P</code>, we can represent the vector <code>AP</code> as a sum of vectors
<code>AB</code> and <code>AC</code> multiplied by some coefficients, <code>u*AB + v*AC = AP</code>.</p>
<p>It is only the matter of finding those coefficients, <code>u</code> and <code>v</code>. Luckily, this could be done with a system of three linear equations
with just two variables:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>ax * u + bx * v = px</span></span>
<span class="line"><span>ay * u + by * v = py</span></span>
<span class="line"><span>az * u + bz * v = pz</span></span>
<span class="line"><span></span></span></code></pre>
<p>where</p>
<ul>
<li>vector <code>AB &#x3C;=> a(ax, ay, az)</code></li>
<li>vector <code>AC &#x3C;=> b(bx, by, bz)</code></li>
<li>vector <code>AP &#x3C;=> p(px, py, pz)</code></li>
</ul>
<p>Simply using the substitution, we can first express <code>u</code> as a function of <code>v</code> and then calculate <code>v</code> to then find <code>u</code>.
The only bit here is that the multiplier of <code>v</code> must not be zero.</p>
<div class="content-read-marker" data-fraction="75"></div>
<p>In C++ this looks like this (I am using Irrlicht for this application, so bare with <code>irr::</code> namespaces):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::S3DVertex A, B, C;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// find A, B and C from the selected triangle</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// also collisionPoint is the point in question, inside the selected triangle</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> B.Pos </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A.Pos;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df b </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> C.Pos </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A.Pos;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df p </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> collisionPoint </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A.Pos;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u, v;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// au + bv = p</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.X </span><span style="color:#D73A49;--shiki-dark:#F97583">!=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((a.X </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p.Y) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p.X)) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((a.X </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b.Y) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b.X));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    u </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (p.X </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (b.X </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v)) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a.X;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">!=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((a.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p.Z) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.Z </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p.Y)) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((a.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b.Z) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.Z </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b.Y));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    u </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (p.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (b.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v)) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a.Y;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.Z </span><span style="color:#D73A49;--shiki-dark:#F97583">!=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((a.Z </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p.X) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.X </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p.Z)) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((a.Z </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b.X) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a.X </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b.Z));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    u </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (p.Z </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (b.Z </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v)) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a.Z;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    throw</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Invalid input - zero basis vector"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Now the last bit of the maths: given the points of a selected triangle all have their texture coordinates (hence using <code>irr::video::S3DVertex</code>),
how do we find the texture coordinates of a given point <code>P</code>? Simple: by applying the same vector maths to the texture coordinates:
we can represent a given triangle in 2D space of texture coordinates and using the vectors <code>AB</code>, <code>AC</code> and <code>AP</code> and the multipliers <code>u</code> and <code>v</code>
which we have just obtained from 3D space, we can “interpolate” the texture coordinates of vector <code>AP</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector2df t2 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> B.TCoords </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A.TCoords;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector2df t1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> C.TCoords </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A.TCoords;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector2df uvCoords </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A.TCoords </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t1 </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t2 </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v;</span></span>
<span class="line"></span></code></pre>
<p>The rest is just rendering and drawing on a texture. The full version of the project is available <a href="https://github.com/shybovycha/irrPaint3D">on GitHub</a>.</p>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2021/05/02/2021-05-02-irrlicht-template.html">Irrlicht application template</a> </h1> <time datetime="2021-05-02T04:00:00.000Z"> May 2, 2021 </time> <div class="content"> <p>Often when I start revising my old applicaitons with Irrlicht engine, I do few things very similarly.
Especially when the application contains GUI and uses Irrlicht tools for it.</p>
<p>This is mostly due to the <strong>extremely</strong> outdated nature of Irrlicht itself.
There are all sorts of things in it like the lack of 4K monitors support, the use of a very obscure font,
sample applications being a simple yet messy single CPP files, etc.</p>
<p>The common things I do include:</p>
<ul>
<li>using new C++ standard features such as:
<ul>
<li>shared pointers</li>
<li>automatic type inference</li>
<li>standard containers</li>
<li>C++-style string operations</li>
</ul>
</li>
<li>setting the new font for GUI, adopted to higher screen resolutions</li>
<li>using CMake to build the project and vcpkg to manage dependencies</li>
<li>utilizing object-oriented approach</li>
<li>moving the classes to separate header and CPP files</li>
</ul>
<p>In this blog I describe in bloody detail what I do and why.</p>
<!--more-->
<h2 id="application-structure">Application structure</h2>
<p>First of all, applicaiton structure is:</p>
<ol>
<li><code>main.cpp</code> - only instantiates the <code>Application</code> class and calls its <code>run()</code> method (the only public API of the <code>Application</code> class)</li>
<li><code>Application</code> class - has two purposes:</li>
<li>initialize Irrlicht sub-systems (device, GUI, renderer, scene manager, etc.)</li>
<li>runs the main application loop, but delegate all the business logic to the <code>ApplicationDelegate</code> class</li>
<li><code>ApplicaitonDelegate</code> - does a bit more than <code>Application</code>:</li>
</ol>
<ul>
<li>loads resources</li>
<li>resets default GUI settings</li>
<li>creates the camera</li>
<li>defines (user) events callbacks (handling business logic of the application)</li>
<li>handles every frame update (rendering, third-party systems’ updates such as physics, AI, math, etc.)</li>
</ul>
<ol start="4">
<li><code>IrrlichtEventReceiver</code> - intercepts Irrlicht-specific events and delegates the execution to a corresponding event handler from <code>ApplicationDelegate</code></li>
</ol>
<p>For my <a href="https://github.com/shybovycha/shoot-them/">ShootThem! game</a> I have also defined game state in a somewhat interesting manner, uncommon for game development - utilizing the principles
of Redux from front-end, since it made sense to me back in the day - user and application trigger events, event receiver delegates them to the application delegate,
which returns a new state and passes the state back to the store, application uses the state to render things on the screen.</p>
<p>For a more complicated application it might be easier to use the state machine approach instead, which is a common approach in gamedev.</p>
<h2 id="build-system">Build system</h2>
<p>Back to the topic of the application template, it is, again, a common practice in a modern (C++) world to use some sort of a build system and dependency manager.
The reason being the simplicity of setup and deploy, abstraction from dependencies’ build process, ease of distribution.
Makefiles do not really play well with Windows-based systems, for example. Whilst vcproj / mssys build is hard to get right on Unix-based systems.
And handling dependencies is a pain in the neck when dependencies themselves have different build processes and transient dependencies.</p>
<p>Hence I stick with CMake for the overall application build process (although I honestly hate it, since it is so bloated and cumbersome)
and vcpkg to get dependencies for my applications.</p>
<h3 id="cmake-configuration">CMake configuration</h3>
<p>The main entry point of an application build process is the <code>CMakeLists.txt</code> file, which defines how the application is built.</p>
<p>Following the best practices collected all over the world (conference talks, <em>recent</em> blogs, etc. - the existing documentation for CMake is horrible in that regard it
shows off the <strong>bad practices</strong> and utilizes the outdated approaches), her is what I came up with:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3.16 FATAL_ERROR)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(myapplication </span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 1.0.1 LANGUAGES CXX)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(EXECUTABLE_NAME myapplication)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SOURCES</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/main.cpp"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/ApplicationDelegate.h"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/ApplicationDelegate.cpp"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/IrrlichtEventReceiver.h"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/IrrlichtEventReceiver.cpp"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/Application.h"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/Application.cpp"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<h2 id="vcpkg-configuration">VCPKG configuration</h2>
<p>VCPKG <em>can</em> use the configuration file when invoked with params swithing it to the <em>manifest mode</em>. I am unsure why this is not the default mode until now, but it is what it is.</p>
<p>Anyways, the <code>vcpkg.json</code> file looks like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "$schema"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"https://raw.githubusercontent.com/microsoft/vcpkg/master/scripts/vcpkg.schema.json"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "name"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"myapplication"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "version-string"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"0.1.0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "dependencies"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "irrlicht"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>When invoked from a command line, vcpkg will tell you what you should add to your <code>CMakeLists.txt</code> file to find the package you’ve just installed:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> vcpkg</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> irrlicht</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">Computing</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> installation</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> plan...</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">The</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> following</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> packages</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> are</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> already</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> installed:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irrlicht[core]:x86-windows</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 1.8.4-10</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">Package</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> irrlicht:x86-windows</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> is</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> already</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> installed</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">Total</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> elapsed</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> time:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 214.7</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> us</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">The</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> package</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> irrlicht:x86-windows</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> provides</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> CMake</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> targets:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    find_package(irrlicht</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> CONFIG</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> REQUIRED</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    target_link_libraries(main</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> PRIVATE</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> Irrlicht</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Just follow these instructions and add those lines to the <code>CMakeLists.txt</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3.16 FATAL_ERROR)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(myapplication </span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 1.0.1 LANGUAGES CXX)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(EXECUTABLE_NAME myapplication)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SOURCES</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/main.cpp"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/ApplicationDelegate.h"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/ApplicationDelegate.cpp"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/IrrlichtEventReceiver.h"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/IrrlichtEventReceiver.cpp"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/Application.h"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "src/Application.cpp"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(irrlicht CONFIG REQUIRED)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">target_link_libraries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> PRIVATE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Irrlicht)</span></span>
<span class="line"></span></code></pre>
<h3 id="building">Building</h3>
<p>The only trick to building the project with vcpkg is the invocation of CMake:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">cmake</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -B</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -S</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> .</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  -DCMAKE_TOOLCHAIN_FILE=C:\Users\myuser\vcpkg\vcpkg\scripts\buildsystems\vcpkg.cmake</span></span>
<span class="line"></span></code></pre>
<p>This will download all the dependencies specified in the <code>vcpkg.json</code> file and generate the project for the corresponding build system.</p>
<p>The build process then is straightforward:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">cmake</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --build</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span></span>
<span class="line"></span></code></pre>
<h2 id="source">Source</h2>
<p>The sources for the application units mentioned above are:</p>
<h3 id="maincpp"><code>main.cpp</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Application.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;memory></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::unique_ptr</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Application</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> app </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">make_unique</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    app-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h3 id="applicationh"><code>Application.h</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#pragma</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ApplicationDelegate.h"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "IrrlichtEventReceiver.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;irrlicht.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;iostream></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;string></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Application</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> initialize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IrrlichtDevice</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IVideoDriver</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> driver;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneManager</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIEnvironment</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> guienv;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::shared_ptr</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ApplicationDelegate</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> applicationDelegate;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::unique_ptr</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">IrrlichtEventReceiver</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> eventReceiver;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<h3 id="applicationcpp"><code>Application.cpp</code></h3>
<div class="content-read-marker" data-fraction="25"></div>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Application.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">Application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">initialize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createDevice</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EDT_OPENGL,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dimension2d</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">u32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1024</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">768</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">device) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::cerr </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Could not initialize video device</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setWindowCaption</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">L"irrPaint3D"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    driver </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getVideoDriver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    smgr </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSceneManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    guienv </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getGUIEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    applicationDelegate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">make_shared</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(device);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    applicationDelegate-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">initialize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    eventReceiver </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">make_unique</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IrrlichtEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(applicationDelegate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(eventReceiver.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    initialize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">isWindowActive</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">isWindowFocused</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">isWindowMinimized</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            continue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        applicationDelegate-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">update</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h3 id="applicationdelegateh"><code>ApplicationDelegate.h</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#pragma</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;fstream></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;iostream></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;memory></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;queue></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;sstream></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;string></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;irrlicht.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IrrlichtDevice</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> _device</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> initialize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> update</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // event callbacks</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> quit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> initGUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loadGUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> resetFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getElementByName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getElementByName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> parent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IrrlichtDevice</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IVideoDriver</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> driver;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneManager</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIEnvironment</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> guienv;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ICameraSceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> camera;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<h3 id="applicationdelegatecpp"><code>ApplicationDelegate.cpp</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ApplicationDelegate.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IrrlichtDevice</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _device) :</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    device</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(_device),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    smgr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSceneManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    guienv</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getGUIEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    driver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getVideoDriver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    camera</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">initialize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    camera </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addCameraSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    initGUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">initGUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    loadGUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    resetFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    createToolbar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">loadGUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    guienv-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">loadGUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/gui.xml"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getElementByName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getElementByName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(name, guienv-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRootGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getElementByName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> parent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::queue</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(parent);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">empty</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentElement </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">front</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentElementName </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(currentElement-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (name </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentElementName) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentElement;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> child : currentElement-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getChildren</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(child);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">resetFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIFont</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> font </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> guienv-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/calibri.xml"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    guienv-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSkin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(font);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">quit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">closeDevice</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">update</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">beginScene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drawAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    guienv-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drawAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">endScene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Worth mentioning the two helpers I have added to this class:</p>
<ul>
<li><code>getElementByName(std::string name)</code></li>
<li><code>getElementByName(std::string name, irr::gui::IGUIElement* parent)</code>,</li>
</ul>
<p>They are really a big help when working with GUI designed with out-of-the-box GUIEditor and has to do with Irrlicht specifics: any given
GUI element in Irrlicht can have both ID (integer) or name (string). In the GUI editor you <em>can</em> specify both, but what you will end up with
is trying to remember all those integers when both designing a GUI in the editor and later, when you write code for that GUI.</p>
<p>One way to do it properly would be to automatically generate a mapping between GUI elements’ IDs and names and then use it in the application,
but out-of-the-box GUI editor is not that sophisticated and you will have to do it by hand by analyzing the XML. That’s where the issue lies:
if your GUI element does not have a name - good luch figuring out a name for it - was it a button X or a button Z?</p>
<p>Hence I operate on elements’ names. They are nothing more than strings. This is a suboptimal solution, since recursively traversing the whole GUI
and comparing each element’s string name to a given string is somewhat expensive, when done on every GUI event (think MouseMove event or something)
or every frame (for whatever reason). But it gets the job done without the need to modify the GUIEditor itself.</p>
<p>One other tricky thing with the out-of-the-box GUIEditor is the texture for GUI elements - the default value for <code>texture</code> attribute in the editor is <code>-1</code>,
whatever that means so one must specify a relative path to a texture by hand and hope editor won’t crash
(since it will try to load the file, if it is not present in the working directory of editor - it will throw an unhandled exception and die).
Hence I manually edit the GUI XML file and specify the paths to the textures after I’m done designing the GUI.</p>
<p>Also, since there is no out-of-the-box <code>SaveFileDialog</code> component (which is weird, since there is a <code>IGUIFileOpenDialog</code>,
which could be easily extended to support opening files functionality), I often have to implement it by hand like
<a href="http://irrlicht.sourceforge.net/forum/viewtopic.php?p=166255#p166255">described</a> by someone on the forums years ago (<code>2008</code> to be exact).
See the details of its implementation <a href="#bonussavefiledialog">below</a>.</p>
<p>The other detail is that the default font provided by Irrlicht is extremely old and looks ugly on modern high-resolution screens.
Irrlicht does not work with TTF or other font types out-of-the-box, but uses a bitmap with all the supported characters instead.
I converted one of the fonts available in my Windows system, <a href="https://docs.microsoft.com/en-us/typography/font-list/calibri">Calibri</a>,
to a font map (PNG + XML file combo, consumable by Irrlicht) with the out-of-the-box <code>FontTool</code> provided by Irrlicht, by selecting
the maximum available file dimensions, reasonable font size (<code>18px</code> in my case) and <strong>enabling the alpha</strong> for the font map (otherwise
all the GUI elements will have ugly black background):</p>
<img src="/images/irrlicht-template/fonttool.png" loading="lazy" alt="FontTool configuration">
<p>Then the <code>resetFont</code> method of the <code>ApplicationDelegate</code> uses the new font for the whole application:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIFont</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> font </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> guienv-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/calibri.xml"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">guienv-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSkin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(font);</span></span>
<span class="line"></span></code></pre>
<p>Note that you must store <strong>both</strong> PNG and XML files under the same directory (or specify the relative path to the font map (PNG) in the XML file by hand).</p>
<p>It makes a significant difference in the looks of an application:</p>
<p>Before:</p>
<img src="/images/irrlicht-template/old-font-look.png" loading="lazy" alt="FontTool configuration">
<p>After:</p>
<img src="/images/irrlicht-template/new-font-look.png" loading="lazy" alt="FontTool configuration">
<h3 id="irrlichteventreceiverh"><code>IrrlichtEventReceiver.h</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#pragma</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ApplicationDelegate.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;memory></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;irrlicht.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IrrlichtEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IEventReceiver</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    IrrlichtEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">shared_ptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ApplicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#E36209;--shiki-dark:#FFAB70">applicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">override</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::shared_ptr</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ApplicationDelegate</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> applicationDelegate;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<h3 id="irrlichteventreceivercpp"><code>IrrlichtEventReceiver.cpp</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "IrrlichtEventReceiver.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">IrrlichtEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IrrlichtEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::shared_ptr</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ApplicationDelegate</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _applicationDelegate) : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">applicationDelegate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">move</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(_applicationDelegate))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IrrlichtEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_KEY_INPUT_EVENT)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // handling CTRL+S</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.KeyInput.Key </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::KEY_KEY_S </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event.KeyInput.Control)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">            // applicationDelegate->saveSomething();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_MOUSE_INPUT_EVENT)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // handling mouse movement</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.MouseInput.Event </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EMIE_MOUSE_MOVED)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">            // applicationDelegate->onMouseMoveSomething();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<div class="content-read-marker" data-fraction="50"></div>
<h2 id="copying-resources">Copying resources</h2>
<p>One more tricky thing with these applications is how to copy the resources (fonts, 3D assets, etc.) to the executable directory.
In CMake this could be done by using this trick (so that it copies files at <strong>build time</strong> as opposed to <strong>generation time</strong>):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_custom_command</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">TARGET</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${EXECUTABLE_NAME}</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> POST_BUILD </span><span style="color:#D73A49;--shiki-dark:#F97583">COMMAND</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${CMAKE_COMMAND}</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -E copy_directory  </span><span style="color:#D73A49;--shiki-dark:#F97583">${CMAKE_CURRENT_LIST_DIR}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/media $&#x3C;TARGET_FILE_DIR:</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>/media)</span></span>
<span class="line"></span></code></pre>
<h2 id="bonus-savefiledialog">Bonus: <code>SaveFileDialog</code></h2>
<p>This is something I implement in my own editors (like the <a href="https://github.com/shybovycha/shoot-them/tree/master/Editor">level editor for ShootThem!</a>).
As mentioned above, this implementation takes its roots at <a href="http://irrlicht.sourceforge.net/forum/viewtopic.php?p=166255#p166255">this forum post by @pera</a> from 2008, which,
is a fork itself of a <a href="http://irrlicht.sourceforge.net/forum/viewtopic.php?p=126280#p126280">code by @MolokoTheMole from 2007</a>, apparently.</p>
<h3 id="savefiledialogh"><code>SaveFileDialog.h</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#pragma</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;codecvt></span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for converting wstring to string</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;xlocbuf></span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for converting wstring to string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;memory></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;string></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;irrlicht.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32 SAVE_FILE_DIALOG_WIDTH </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 350</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32 SAVE_FILE_DIALOG_HEIGHT </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 250</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIFileOpenDialog</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! constructor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> wchar_t*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> title</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIEnvironment</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> environment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> parent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#E36209;--shiki-dark:#FFAB70"> id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            bool</span><span style="color:#E36209;--shiki-dark:#FFAB70"> restoreCWD</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">char_type</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> startDir</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! destructor</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ~SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! returns the filename of the selected file. Returns NULL, if no file was selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#D73A49;--shiki-dark:#F97583"> wchar_t*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> override</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! Returns the filename of the selected file. Is empty if no file was selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getFileNameP</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! Returns the directory of the selected file. Returns NULL, if no directory was selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! Returns the directory of the selected file converted to wide characters. Returns NULL if no directory was selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#D73A49;--shiki-dark:#F97583"> wchar_t*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getDirectoryNameW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! called if an event happened.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">override</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! draws the element and its children</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> draw</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">override</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">protected:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! Ensure filenames are converted correct depending on wide-char settings</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> pathToStringW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stringw</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> result</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> p</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! fills the listbox with files.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fillListBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! sends the event that the file has been selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sendSelectedEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGUI_EVENT_TYPE</span><span style="color:#E36209;--shiki-dark:#FFAB70"> type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //! sends the event that the file choose process has been canceled</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sendCancelEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::position2d</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DragStart;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::path FileName;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::stringw FileNameW;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::path FileDirectory;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::path FileDirectoryFlat;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::stringw FileDirectoryFlatW;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::path RestoreDirectory;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::path StartDirectory;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIButton</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CloseButton;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIButton</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> OKButton;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIButton</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CancelButton;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIListBox</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileBox;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIEditBox</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileNameText;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> EventParent;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IFileSystem</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileSystem;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IFileList</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileList;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    bool</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Dragging;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<h3 id="savefiledialogcpp"><code>SaveFileDialog.cpp</code></h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "SaveFileDialog.h"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! constructor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> wchar_t*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> title,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIEnvironment</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> environment,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIElement</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parent,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32 id,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        bool</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> restoreCWD,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::char_type</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> startDir)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">IGUIFileOpenDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        environment,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        parent,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        id,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ((parent </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parent </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRootGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 SAVE_FILE_DIALOG_WIDTH) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ((parent </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parent </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRootGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getHeight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 SAVE_FILE_DIALOG_HEIGHT) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ((parent </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parent </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRootGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 SAVE_FILE_DIALOG_WIDTH) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> SAVE_FILE_DIALOG_WIDTH,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ((parent </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parent </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRootGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getHeight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 SAVE_FILE_DIALOG_HEIGHT) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> SAVE_FILE_DIALOG_HEIGHT)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          FileNameText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          FileList</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          Dragging</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#ifdef</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _DEBUG</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    IGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setDebugName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"SaveFileDialog"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Text </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> title;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileSystem </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFileSystem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileSystem)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">grab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (restoreCWD)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            RestoreDirectory </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWorkingDirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (startDir)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            StartDirectory </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> startDir;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">changeWorkingDirectoryTo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(startDir);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    else</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUISpriteBank</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sprites </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SColor </span><span style="color:#6F42C1;--shiki-dark:#B392F0">color</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUISkin</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSkin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (skin)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        sprites </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSpriteBank</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        color </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDC_WINDOW_SYMBOL);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32 buttonw </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDS_WINDOW_BUTTON_WIDTH) </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32 posx </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RelativeRect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> buttonw </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CloseButton </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addButton</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(posx, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, posx </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> buttonw, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> buttonw),</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">            L""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            skin </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getDefaultText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDT_WINDOW_CLOSE) </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> L"Close"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSubElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setTabStop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (sprites)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSpriteBank</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(sprites);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSprite</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGBS_BUTTON_UP, skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getIcon</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDI_WINDOW_CLOSE), color);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSprite</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGBS_BUTTON_DOWN, skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getIcon</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDI_WINDOW_CLOSE), color);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAlignment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">grab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    OKButton </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addButton</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(RelativeRect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 80</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">30</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, RelativeRect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, skin </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getDefaultText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDT_MSG_BOX_OK) </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> L"OK"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    OKButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSubElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    OKButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAlignment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    OKButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">grab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CancelButton </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addButton</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(RelativeRect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 80</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">55</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, RelativeRect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">75</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, skin </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getDefaultText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDT_MSG_BOX_CANCEL) </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> L"Cancel"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CancelButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSubElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CancelButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAlignment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    CancelButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">grab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileBox </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addListBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">55</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, RelativeRect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 90</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">230</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSubElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAlignment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">grab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileNameText </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addEditBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">30</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, RelativeRect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 90</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setSubElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAlignment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_LOWERRIGHT, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGUIA_UPPERLEFT);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">grab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    setTabGroup</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    fillListBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! destructor</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#D73A49;--shiki-dark:#F97583">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (CloseButton)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        CloseButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (OKButton)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        OKButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (CancelButton)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        CancelButton-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileBox)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileNameText)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileSystem)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // revert to original CWD if path was set in constructor</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">RestoreDirectory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">empty</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">changeWorkingDirectoryTo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(RestoreDirectory);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileList)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! returns the filename of the selected file. Returns NULL, if no file was selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> wchar_t*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileNameW.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFileNameP</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileName;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! Returns the directory of the selected file. Returns NULL, if no directory was selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileDirectoryFlat;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> wchar_t*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getDirectoryNameW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileDirectoryFlatW.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileName </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> name;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    pathToStringW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileNameW, FileName);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileDirectory </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> name;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileDirectoryFlat </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> name;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">flattenFilename</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileDirectoryFlat);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    pathToStringW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileDirectoryFlatW, FileDirectoryFlat);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! called if an event happened.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isEnabled</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.EventType)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_GUI_EVENT:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.GUIEvent.EventType)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGET_ELEMENT_FOCUS_LOST</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                Dragging </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGET_BUTTON_CLICKED</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.GUIEvent.Caller </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CloseButton </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event.GUIEvent.Caller </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CancelButton)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    sendCancelEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    remove</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.GUIEvent.Caller </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> OKButton)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">FileName.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">empty</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        sendSelectedEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGET_FILE_SELECTED);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        remove</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">FileDirectory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">empty</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        sendSelectedEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGET_DIRECTORY_SELECTED);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGET_LISTBOX_CHANGED</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32 selected </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSelected</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileList </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileSystem)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">isDirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(selected))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFullFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(selected));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    else</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFullFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(selected));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGET_LISTBOX_SELECTED_AGAIN</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32 selected </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSelected</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileList </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileSystem)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">isDirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(selected))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFullFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(selected));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">changeWorkingDirectoryTo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileDirectory);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        fillListBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    else</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFullFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(selected));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGET_EDITBOX_CHANGED</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.GUIEvent.Caller </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileNameText)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGET_EDITBOX_ENTER</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.GUIEvent.Caller </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileNameText)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::path </span><span style="color:#6F42C1;--shiki-dark:#B392F0">dir</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">changeWorkingDirectoryTo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(dir))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        fillListBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    else</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                        setFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            default</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_MOUSE_INPUT_EVENT:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.MouseInput.Event)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EMIE_MOUSE_WHEEL</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(event);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EMIE_LMOUSE_PRESSED_DOWN</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                DragStart.X </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event.MouseInput.X;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                DragStart.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event.MouseInput.Y;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                Dragging </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EMIE_LMOUSE_LEFT_UP</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                Dragging </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EMIE_MOUSE_MOVED</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">event.MouseInput.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isLeftPressed</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    Dragging </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (Dragging)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                    // gui window should not be dragged outside its parent</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (Parent)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.MouseInput.X </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().UpperLeftCorner.X </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                            event.MouseInput.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().UpperLeftCorner.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                            event.MouseInput.X </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().LowerRightCorner.X </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> ||</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                            event.MouseInput.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().LowerRightCorner.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                            return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    move</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">position2d</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(event.MouseInput.X </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DragStart.X,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                            event.MouseInput.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DragStart.Y));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    DragStart.X </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event.MouseInput.X;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    DragStart.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event.MouseInput.Y;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            default</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                break</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(event);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! draws the element and its children</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">draw</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">IsVisible)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUISkin</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSkin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::rect</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::s32</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rect </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AbsoluteRect;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    rect </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">draw3DWindowBackground</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDC_ACTIVE_BORDER),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            rect, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">AbsoluteClippingRect);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">empty</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        rect.UpperLeftCorner.X </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        rect.LowerRightCorner.X </span><span style="color:#D73A49;--shiki-dark:#F97583">-=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDS_WINDOW_BUTTON_WIDTH) </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIFont</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> font </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFont</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDF_WINDOW);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (font)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            font-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">draw</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(), rect,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDC_ACTIVE_CAPTION),</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                    false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">AbsoluteClippingRect);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    IGUIElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">draw</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pathToStringW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stringw</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> result</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> p</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#ifndef</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _IRR_WCHAR_FILESYSTEM</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::wstring_convert</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::codecvt_utf8_utf16</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;wchar_t>></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> wstringConverter;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> wstringConverter.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from_bytes</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(p.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#else</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#endif</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! fills the listbox with files.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fillListBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUISkin</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> skin </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Environment-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSkin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">FileSystem </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">FileBox </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">skin)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileList)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">clear</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    FileList </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">createFileList</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::stringw s;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileList)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::u32 i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFileCount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(); </span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">i)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            pathToStringW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(s, FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(i));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            FileBox-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(s.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    skin-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getIcon</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileList-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">isDirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(i) </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDI_DIRECTORY </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGDI_FILE));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (FileNameText)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        setDirectoryName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(FileSystem-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWorkingDirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        pathToStringW</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(s, FileDirectory);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        FileNameText-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(s.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! sends the event that the file has been selected.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sendSelectedEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EGUI_EVENT_TYPE</span><span style="color:#E36209;--shiki-dark:#FFAB70"> type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SEvent event;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_GUI_EVENT;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.GUIEvent.Caller </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.GUIEvent.Element </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.GUIEvent.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> type;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Parent-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(event);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//! sends the event that the file choose process has been cancelled</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SaveFileDialog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sendCancelEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SEvent event;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_GUI_EVENT;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.GUIEvent.Caller </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.GUIEvent.Element </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nullptr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    event.GUIEvent.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EGET_FILE_CHOOSE_DIALOG_CANCELLED;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Parent-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(event);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h2 id="outro">Outro</h2>
<p>This is about everything I wanted to share. This template should set you up in few-ish minutes so that you can start implementing the actual application logic
instead of wondering why there are some missing references for linker or some nuisance like those.</p>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2021/04/19/2021-04-19-strongly-typed-front-end.html">Strongly-typed front-end</a> </h1> <time datetime="2021-04-19T01:35:15.000Z"> Apr 19, 2021 </time> <div class="content"> <img src="/images/strongly-typed-front-end/serial_experiments_lain.gif" loading="lazy" alt="Serial experiments Lain">
<p>In this little research project I describe my journey through a series of experiments trying out a number of technologies and clashing them against each other.</p>
<ul>
<li><a href="/strongly-typed-front-end/2021/04/19/introduction.html">Introduction</a></li>
<li><a href="/strongly-typed-front-end/experiment-1/2021/04/19/experiment-1.html">Experiment 1 - type safety</a></li>
<li>Experiment 2 - simple application
<ul>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-elm.html">Elm</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-fsharp.html">F#</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-purescript.html">PureScript</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-reasonml.html">ReasonML</a></li>
</ul>
</li>
</ul> </div>  </article><article> <h1> <a href="/2021/04/19/2021-04-19-experiment-2-purescript.html">Strongly-typed front-end: experiment 2, simple application, in PureScript</a> </h1> <time datetime="2021-04-19T00:47:48.000Z"> Apr 19, 2021 </time> <div class="content"> <h3 id="contents">Contents</h3>
<ol>
<li><a href="/strongly-typed-front-end/2021/04/19/introduction.html">Introduction</a></li>
<li><a href="/strongly-typed-front-end/experiment-1/2021/04/19/experiment-1.html">Experiment 1, darken_color</a></li>
<li>Experiment 2, simple application
<ul>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-elm.html">Elm</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-fsharp.html">F#</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-purescript.html"><strong>PureScript &#x26; purescript-react-dom (you are here)</strong></a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2024/05/17/experiment-2-purescript-halogen.html">PureScript &#x26; Halogen</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-reasonml.html">ReasonML</a></li>
</ul>
</li>
</ol>
<p>In PureScript world there are quite a few libraries for React. And all of them have terrible (or rather non-existent) documentation, so I had to use as much intuition as outdated and barely working code samples. In this case I have picked <a href="https://pursuit.purescript.org/packages/purescript-react-dom/8.0.0">purescript-react-dom</a>.</p>
<p>Initial application structure:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Control.Monad.Eff</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe.Unsafe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fromJust</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Nullable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toMaybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect.Console</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">DOM</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM.HTML</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">window</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM.HTML.Document</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM.HTML.Types</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">htmlElementToElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM.HTML.Window</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">document</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM.Node.Types</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React.DOM</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React.DOM.Props</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Props</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Float</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Float</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pi </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">getShape</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged ctx evt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  writeState ctx { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> getShape ((unsafeCoerce evt)</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">target</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value) }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onCalculateAreaClicked ctx evt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { shape, value } </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> readState ctx</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  writeState ctx { area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape value }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">areaCalculator </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> createClass </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> spec { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ctx </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { shape, value, area } </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> readState ctx</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  return </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onChange (onShapeChanged ctx) ] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Circle"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Square"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show value) ] [],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onClick (onCalculateAreaClicked ctx) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Calculate area"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Area: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> ++</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show area))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> container </span><span style="color:#D73A49;--shiki-dark:#F97583">>>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> render ui</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  ui</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ReactElement</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ui </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> createFactory areaCalculator {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  container</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> eff. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Eff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (dom </span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DOM</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | eff) </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  container </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    win </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> window</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    doc </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> document win</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    elt </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fromJust </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;$></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> toMaybe </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;$></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> body doc</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    return </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> htmlElementToElement elt</span></span>
<span class="line"></span></code></pre>
<!--more-->
<p>Immediately the flaws of the infrastructure come out:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ spago build                                                                                                                                                                                                                                           1 ↵</span></span>
<span class="line"><span>Error 1 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:5:1 - 5:25 (line 5, column 1 - line 5, column 25)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module Control.Monad.Eff was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 2 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:8:1 - 8:36 (line 8, column 1 - line 8, column 36)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module Data.Maybe.Unsafe was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 3 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:14:1 - 14:19 (line 14, column 1 - line 14, column 19)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module DOM was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 4 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:15:1 - 15:25 (line 15, column 1 - line 15, column 25)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module DOM.HTML was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 5 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:16:1 - 16:32 (line 16, column 1 - line 16, column 32)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module DOM.HTML.Document was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 6 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:17:1 - 17:45 (line 17, column 1 - line 17, column 45)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module DOM.HTML.Types was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 7 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:18:1 - 18:34 (line 18, column 1 - line 18, column 34)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module DOM.HTML.Window was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 8 of 8:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:20:1 - 20:34 (line 20, column 1 - line 20, column 34)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module DOM.Node.Types was not found.</span></span>
<span class="line"><span>    Make sure the source file exists, and that it has been provided as an input to the compiler.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ModuleNotFound.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this error.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>[error] Failed to build.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Well, the error messages kind of point you to the source of error - the modules have not been provided to the compiler.</p>
<p>Had to use documentation for each of the packages to match the types and fix the imports (since the <a href="https://github.com/ethul/purescript-react#example">example</a> I have relied upon is way out of date):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> spago</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> purescript-web-dom</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> purescript-web-html</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> react-dom</span></span>
<span class="line"></span></code></pre>
<p>And adjust the code itself:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">window</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML.HTMLDocument</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML.HTMLElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML.Window</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">document</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.DOM.Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ReactDOM</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ReactDOM</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React.DOM</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React.DOM.Props</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Props</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Float</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Float</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pi </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">getShape</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged ctx evt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  writeState ctx { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> getShape ((unsafeCoerce evt)</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">target</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value) }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onCalculateAreaClicked ctx evt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { shape, value } </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">readState ctx</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  writeState ctx { area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape value }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">areaCalculator</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> React.ReactClass</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">areaCalculator </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">component </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"AreaCalculator"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> component</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  component ctx </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pure { state</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, render</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> renderFn ctx }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    renderFn ctx </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { shape, value, area } </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">readState ctx</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      return </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onChange (onShapeChanged ctx) ] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">              DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">              DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Circle"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">              DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Square"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show value) ] [],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onClick (onCalculateAreaClicked ctx) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Calculate area"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Area: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> ++</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show area))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> container </span><span style="color:#D73A49;--shiki-dark:#F97583">>>=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ReactDOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">render componentInstance</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  componentInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">createLeafElement areaCalculator {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  container</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> eff. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (dom </span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DOM</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | eff) </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  container </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    win </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> window</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    doc </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> document win</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    elt </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> body doc</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    return </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> toElement elt</span></span>
<span class="line"></span></code></pre>
<p>To get yet another error:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>at src/Main.purs:22:21 - 22:22 (line 22, column 21 - line 22, column 22)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Unable to parse module:</span></span>
<span class="line"><span>  Unexpected token '|'</span></span>
<span class="line"><span></span></span></code></pre>
<p>That’s my bad, it is more Haskell than Elm or F#:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#B31D28;--shiki-dark:#FDAEB7"><span style="user-select: none;">-</span> type Shape = Circle | Square</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> data Shape = Circle | Square</span></span>
<span class="line"></span></code></pre>
<p>And yet another one:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>at src/Main.purs:45:3 - 45:8 (line 45, column 3 - line 45, column 8)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Unable to parse module:</span></span>
<span class="line"><span>  Unexpected token 'where'</span></span>
<span class="line"><span></span></span></code></pre>
<p>Because I did not indent my code enough.</p>
<p>And yet another one:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>at src/Main.purs:47:32 - 47:34 (line 47, column 32 - line 47, column 34)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Unable to parse module:</span></span>
<span class="line"><span>  Unexpected "&#x3C;-" in expression, perhaps due to a missing 'do' or 'ado' keyword</span></span>
<span class="line"><span></span></span></code></pre>
<p>Because <code>React.readState</code> does not return effect, but rather the value itself, so no need to unpack it:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#B31D28;--shiki-dark:#FDAEB7"><span style="user-select: none;">-</span> { shape, value, area } &#x3C;- React.readState ctx</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> let { shape, value, area } = React.readState ctx</span></span>
<span class="line"></span></code></pre>
<p>And yet another one:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>at src/Main.purs:48:9 - 48:15 (line 48, column 9 - line 48, column 15)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Unable to parse module:</span></span>
<span class="line"><span>  Unexpected token 'return'</span></span>
<span class="line"><span></span></span></code></pre>
<p>Because I have forgot the <code>do</code> keyword:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#B31D28;--shiki-dark:#FDAEB7"><span style="user-select: none;">-</span> renderFn ctx =</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> renderFn ctx = do</span></span>
<span class="line"></span></code></pre>
<p>Few small errors resolved:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Compiling Main</span></span>
<span class="line"><span>Error 1 of 2:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:26:33 - 26:38 (line 26, column 33 - line 26, column 38)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Unknown type Float</span></span>
<span class="line"><span></span></span>
<span class="line"><span># replace Float with Number, as Float is not really a type in PureScript</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error 2 of 2:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:61:32 - 61:34 (line 61, column 32 - line 61, column 34)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Unknown operator (++)</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span># replace ++ with + as ++ is not really an operator in PureScript</span></span>
<span class="line"><span></span></span></code></pre>
<p>To end up with type errors hell:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>in module Main</span></span>
<span class="line"><span>at src/Main.purs:60:13 - 60:54 (line 60, column 13 - line 60, column 54)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Could not match type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ReactElement</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  with type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Array t0 -> t1</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>while applying a function input [ value ((...) value)</span></span>
<span class="line"><span>                                ]</span></span>
<span class="line"><span>  of type ReactElement</span></span>
<span class="line"><span>  to argument []</span></span>
<span class="line"><span>while checking that expression (input [ value (...)</span></span>
<span class="line"><span>                                      ]</span></span>
<span class="line"><span>                               )</span></span>
<span class="line"><span>                               []</span></span>
<span class="line"><span>  has type ReactElement</span></span>
<span class="line"><span>in value declaration areaCalculator</span></span>
<span class="line"><span></span></span>
<span class="line"><span>where t0 is an unknown type</span></span>
<span class="line"><span>      t1 is an unknown type</span></span>
<span class="line"><span></span></span></code></pre>
<p>What this tells you is that input function <a href="https://pursuit.purescript.org/packages/purescript-react/8.0.0/docs/React.DOM#v:input">does not take</a> a second argument (which would normally be similar to <code>React.DOM.div [ attributes ] [ children ]</code>).</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#B31D28;--shiki-dark:#FDAEB7"><span style="user-select: none;">-</span> DOM.input [ Props.value (show value) ] []</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> DOM.input [ Props.value (show value) ]</span></span>
<span class="line"></span></code></pre>
<p>Earlier I have mentioned type hell. Well, that was just the small example. Here’s the next error in the code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>in module Main</span></span>
<span class="line"><span>at src/Main.purs:46:18 - 46:50 (line 46, column 18 - line 46, column 50)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Could not match type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Int</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  with type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Number</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>while trying to match type</span></span>
<span class="line"><span>                             ( area :: Int</span></span>
<span class="line"><span>                             , shape :: Maybe t3</span></span>
<span class="line"><span>                             , value :: Int</span></span>
<span class="line"><span>                             ...</span></span>
<span class="line"><span>                             )</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  with type</span></span>
<span class="line"><span>              ( area :: Number</span></span>
<span class="line"><span>              , shape :: Maybe Shape</span></span>
<span class="line"><span>              , value :: Number</span></span>
<span class="line"><span>              ...</span></span>
<span class="line"><span>              | t1</span></span>
<span class="line"><span>              )</span></span>
<span class="line"><span></span></span>
<span class="line"><span>while solving type class constraint</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Prim.Row.Nub t0</span></span>
<span class="line"><span>               ( componentDidCatch :: Error</span></span>
<span class="line"><span>                                      -> { componentStack :: String</span></span>
<span class="line"><span>                                         }</span></span>
<span class="line"><span>                                         -> Effect Unit</span></span>
<span class="line"><span>               , componentDidMount :: Effect Unit</span></span>
<span class="line"><span>               , componentDidUpdate :: Record ()</span></span>
<span class="line"><span>                                       -> { area :: Number</span></span>
<span class="line"><span>                                          , shape :: ...</span></span>
<span class="line"><span>                                          , value :: Number</span></span>
<span class="line"><span>                                          | t1</span></span>
<span class="line"><span>                                          }</span></span>
<span class="line"><span>                                          -> t2 -> ...</span></span>
<span class="line"><span>               , componentWillUnmount :: Effect Unit</span></span>
<span class="line"><span>               , getSnapshotBeforeUpdate :: Record ()</span></span>
<span class="line"><span>                                            -> { area :: Number</span></span>
<span class="line"><span>                                               , shape :: ...</span></span>
<span class="line"><span>                                               , value :: Number</span></span>
<span class="line"><span>                                               | t1</span></span>
<span class="line"><span>                                               }</span></span>
<span class="line"><span>                                               -> Effect t2</span></span>
<span class="line"><span>               , render :: Effect ReactElement</span></span>
<span class="line"><span>               , shouldComponentUpdate :: Record ()</span></span>
<span class="line"><span>                                          -> { area :: Number</span></span>
<span class="line"><span>                                             , shape :: ...</span></span>
<span class="line"><span>                                             , value :: Number</span></span>
<span class="line"><span>                                             | t1</span></span>
<span class="line"><span>                                             }</span></span>
<span class="line"><span>                                             -> Effect Boolean</span></span>
<span class="line"><span>               , state :: { area :: Number</span></span>
<span class="line"><span>                          , shape :: Maybe Shape</span></span>
<span class="line"><span>                          , value :: Number</span></span>
<span class="line"><span>                          | t1</span></span>
<span class="line"><span>                          }</span></span>
<span class="line"><span>               , unsafeComponentWillMount :: Effect Unit</span></span>
<span class="line"><span>               , unsafeComponentWillReceiveProps :: Record () -> Effect Unit</span></span>
<span class="line"><span>               , unsafeComponentWillUpdate :: Record ()</span></span>
<span class="line"><span>                                              -> { area :: Number</span></span>
<span class="line"><span>                                                 , shape :: ...</span></span>
<span class="line"><span>                                                 , value :: Number</span></span>
<span class="line"><span>                                                 | t1</span></span>
<span class="line"><span>                                                 }</span></span>
<span class="line"><span>                                                 -> Effect Unit</span></span>
<span class="line"><span>               )</span></span>
<span class="line"><span></span></span>
<span class="line"><span>while inferring the type of component "AreaCalculator"</span></span>
<span class="line"><span>in value declaration areaCalculator</span></span>
<span class="line"><span></span></span>
<span class="line"><span>where t1 is an unknown type</span></span>
<span class="line"><span>      t3 is an unknown type</span></span>
<span class="line"><span>      t0 is an unknown type</span></span>
<span class="line"><span>      t2 is an unknown type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>See https://github.com/purescript/documentation/blob/master/errors/TypesDoNotUnify.md for more information,</span></span>
<span class="line"><span>or to contribute content related to this error.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Basically compiler is trying to say the initial state provided has a type <code>( area :: Int, value :: Int, shape :: Maybe t3 )</code> but what is expected (down in the code) is <code>( area :: Number, value :: Number, shape :: Maybe Shape )</code>. Quite an explanation.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> initialState :: AreaCalculatorState</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> initialState = { shape: Nothing, value: 0.0, area: 0.0 }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B31D28;--shiki-dark:#FDAEB7"><span style="user-select: none;">-</span> componentImpl ctx = pure { state: { shape: Nothing, value: 0.0, area: 0.0 }, render: renderFn ctx }</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> componentImpl ctx = pure { state: initialState, render: renderFn ctx }</span></span>
<span class="line"></span></code></pre>
<p>And back to a new error:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>in module Main</span></span>
<span class="line"><span>at src/Main.purs:70:23 - 70:45 (line 70, column 23 - line 70, column 45)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  No type class instance was found for</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Data.Semiring.Semiring String</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>while applying a function add</span></span>
<span class="line"><span>  of type Semiring t0 => t0 -> t0 -> t0</span></span>
<span class="line"><span>  to argument "Area: "</span></span>
<span class="line"><span>while inferring the type of add "Area: "</span></span>
<span class="line"><span>in value declaration areaCalculator</span></span>
<span class="line"><span></span></span>
<span class="line"><span>where t0 is an unknown type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>See https://github.com/purescript/documentation/blob/master/errors/NoInstanceFound.md for more information,</span></span>
<span class="line"><span>or to contribute content related to this error.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Which means the <code>+</code> operator (function) does not apply to strings. The <code>&#x3C;></code> is the string concatenation operator in this case. Although very hectic, it is described in <a href="https://pursuit.purescript.org/packages/purescript-prelude/4.1.1/docs/Data.Semigroup#v:(%3C%3E)">the docs</a>.</p>
<p>And yet another error:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Error found:</span></span>
<span class="line"><span>in module Main</span></span>
<span class="line"><span>at src/Main.purs:78:21 - 78:29 (line 78, column 21 - line 78, column 29)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  Could not match type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Effect</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  with type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Maybe</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>while trying to match type Effect (Maybe HTMLElement)</span></span>
<span class="line"><span>  with type Maybe t0</span></span>
<span class="line"><span>while checking that expression body doc</span></span>
<span class="line"><span>  has type Maybe t0</span></span>
<span class="line"><span>in value declaration main</span></span>
<span class="line"><span></span></span>
<span class="line"><span>where t0 is an unknown type</span></span>
<span class="line"><span></span></span>
<span class="line"><span>See https://github.com/purescript/documentation/blob/master/errors/TypesDoNotUnify.md for more information,</span></span>
<span class="line"><span>or to contribute content related to this error.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Which is all about matching the return types and handling them properly:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="diff"><code><span class="line"><span style="color:#B31D28;--shiki-dark:#FDAEB7"><span style="user-select: none;">-</span> elt &#x3C;- toElement elt</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> let elt = fromJust eltMaybe</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D"><span style="user-select: none;">+</span> let container = toElement elt</span></span>
<span class="line"></span></code></pre>
<p>And finally, the version that <em>compiles</em>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Math</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">window</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML.HTMLDocument</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML.HTMLElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.HTML.Window</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">document</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.DOM.Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Unsafe.Coerce</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">unsafeCoerce</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ReactDOM</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ReactDOM</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React.DOM</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DOM</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React.DOM.Props</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Props</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pi </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">getShape</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged ctx evt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">setState ctx { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> getShape ((unsafeCoerce evt)</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">target</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value) }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onCalculateAreaClicked ctx evt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { shape, value } </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">getState ctx</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">setState ctx { area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape value }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> AreaCalculatorState</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> {</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">area</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span><span style="color:#D73A49;--shiki-dark:#F97583"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">initialState</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> AreaCalculatorState</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">initialState </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">areaCalculator</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> React.ReactClass</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">areaCalculator </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">component </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"AreaCalculator"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> componentImpl</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  componentImpl ctx </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pure { state</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> initialState, render</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> renderFn ctx }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      renderFn ctx' </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { shape, value, area } </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">getState ctx'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        pure </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onChange (onShapeChanged ctx') ] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Circle"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Square"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show value) ],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button [ </span><span style="color:#22863A;--shiki-dark:#85E89D">Props</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onClick (onCalculateAreaClicked ctx') ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Calculate area"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            DOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Area: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show area))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> componentInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">createLeafElement areaCalculator {}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  win </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> window</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  doc </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> document win</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  eltMaybe </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> body doc</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> elt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fromJust eltMaybe</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> container </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> toElement elt</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  ReactDOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">render componentInstance container</span></span>
<span class="line"></span></code></pre>
<p>Of course, there are few warnings and few sloppy solutions worth fixing:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Warning 1 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:7:1 - 7:18 (line 7, column 1 - line 7, column 18)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module Data.Maybe has unspecified imports, consider using the explicit form:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      import Data.Maybe (Maybe(..), fromJust)</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ImplicitImport.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Warning 2 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:5:1 - 5:23 (line 5, column 1 - line 5, column 23)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    The import of Effect is redundant</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/UnusedImport.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Warning 3 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:3:1 - 3:15 (line 3, column 1 - line 3, column 15)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Module Prelude has unspecified imports, consider using the explicit form:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      import Prelude (bind, pure, show, ($), (*), (&#x3C;>))</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/ImplicitImport.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Warning 4 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:16:1 - 16:35 (line 16, column 1 - line 16, column 35)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    The import of Web.DOM.Element is redundant</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/UnusedImport.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Warning 5 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:38:1 - 39:75 (line 38, column 1 - line 39, column 75)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    No type declaration was provided for the top-level declaration of onShapeChanged.</span></span>
<span class="line"><span>    It is good practice to provide type declarations as a form of documentation.</span></span>
<span class="line"><span>    The inferred type of onShapeChanged was:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      forall t10 t14 t8.</span></span>
<span class="line"><span>        ReactThis t10</span></span>
<span class="line"><span>          { shape :: ...</span></span>
<span class="line"><span>          | t8</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        -> t14 -> Effect Unit</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in value declaration onShapeChanged</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/MissingTypeDeclaration.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Warning 6 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:41:1 - 43:57 (line 41, column 1 - line 43, column 57)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    No type declaration was provided for the top-level declaration of onCalculateAreaClicked.</span></span>
<span class="line"><span>    It is good practice to provide type declarations as a form of documentation.</span></span>
<span class="line"><span>    The inferred type of onCalculateAreaClicked was:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      forall t24 t37 t39.</span></span>
<span class="line"><span>        ReactThis t37</span></span>
<span class="line"><span>          { area :: Number</span></span>
<span class="line"><span>          , shape :: ...</span></span>
<span class="line"><span>          , value :: Number</span></span>
<span class="line"><span>          | t39</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        -> t24 -> Effect Unit</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in value declaration onCalculateAreaClicked</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/MissingTypeDeclaration.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Warning 7 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:74:1 - 81:46 (line 74, column 1 - line 81, column 46)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    No type declaration was provided for the top-level declaration of main.</span></span>
<span class="line"><span>    It is good practice to provide type declarations as a form of documentation.</span></span>
<span class="line"><span>    The inferred type of main was:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      Partial => Effect (Maybe ReactComponent)</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in value declaration main</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/MissingTypeDeclaration.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Essentially,</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Module Data.Maybe has unspecified imports, consider using the explicit form:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      import Data.Maybe (Maybe(..), fromJust)</span></span>
<span class="line"><span></span></span></code></pre>
<p>is fixed with the suggested code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>import Data.Maybe (Maybe(..), fromJust)</span></span>
<span class="line"><span></span></span></code></pre>
<p>Same with the unnecessary imports.</p>
<p>This one looks neat:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Warning 5 of 7:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in module Main</span></span>
<span class="line"><span>  at src/Main.purs:38:1 - 39:75 (line 38, column 1 - line 39, column 75)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    No type declaration was provided for the top-level declaration of onShapeChanged.</span></span>
<span class="line"><span>    It is good practice to provide type declarations as a form of documentation.</span></span>
<span class="line"><span>    The inferred type of onShapeChanged was:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      forall t10 t14 t8.</span></span>
<span class="line"><span>        ReactThis t10</span></span>
<span class="line"><span>          { shape :: ...</span></span>
<span class="line"><span>          | t8</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        -> t14 -> Effect Unit</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>  in value declaration onShapeChanged</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  See https://github.com/purescript/documentation/blob/master/errors/MissingTypeDeclaration.md for more information,</span></span>
<span class="line"><span>  or to contribute content related to this warning.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Compiler asks you to explicitly type the function declaration. But I don’t care about that for now.</p>
<p>In order to run the app, few actions are still needed:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> yarn</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -D</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> spago</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> purescript</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> parcel</span></span>
<span class="line"></span></code></pre>
<p>Then, one will need an entry point:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;!</span><span style="color:#22863A;--shiki-dark:#85E89D">DOCTYPE</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lang</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"en"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">head</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">meta</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> charset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"UTF-8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">meta</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"viewport"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> content</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"width=device-width, initial-scale=1.0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">title</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Document&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">title</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">head</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"index.js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>with a script:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'./output/Main'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Main.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span></code></pre>
<p>To build that whole thing now:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> yarn</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> spago</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x26;&#x26; </span><span style="color:#6F42C1;--shiki-dark:#B392F0">yarn</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> parcel</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> index.html</span></span>
<span class="line"></span></code></pre>
<p>And finally, if you run this, nothing will work.</p>
<p>All because the return type of the <code>main</code> function is not really <code>Effect Unit</code>, but rather a function. To fix this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">mountMain</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> HTMLElement</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">mountMain elt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> container </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> toElement elt</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> componentInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">createLeafElement areaCalculator {}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> componentMaybe </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ReactDOM</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">render componentInstance container</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  void componentMaybe</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  win </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> window</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  doc </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> document win</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  eltMaybe </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> body doc</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  maybe (pure unit) mount eltMaybe</span></span>
<span class="line"></span></code></pre>
<p>And the thing still won’t completely work, since we do not modify the state on input value change:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Float.Parse</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">parseFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChanged ctx evt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newValue </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fromMaybe </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (parseFloat ((unsafeCoerce evt)</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">target</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value))</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">setState ctx { value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newValue }</span></span>
<span class="line"></span></code></pre>
<p>Final solution is available on <a href="https://codesandbox.io/s/purescript-test1-02wf4">sandbox</a>.</p> </div>  </article><article> <h1> <a href="/2021/04/19/2021-04-19-experiment-2-elm.html">Strongly-typed front-end: experiment 2, simple application, in Elm</a> </h1> <time datetime="2021-04-19T00:23:02.000Z"> Apr 19, 2021 </time> <div class="content"> <h3 id="contents">Contents</h3>
<ol>
<li><a href="/strongly-typed-front-end/2021/04/19/introduction.html">Introduction</a></li>
<li><a href="/strongly-typed-front-end/experiment-1/2021/04/19/experiment-1.html">Experiment 1, darken_color</a></li>
<li>Experiment 2, simple application
<ul>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-elm.html"><strong>Elm (you are here)</strong></a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-fsharp.html">F#</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-purescript.html">PureScript &#x26; purescript-react-dom</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2024/05/17/experiment-2-purescript-halogen.html">PureScript &#x26; Halogen</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-reasonml.html">ReasonML</a></li>
</ul>
</li>
</ol>
<p>(Heavily over-opinionated statement) Elm forces you to handle error scenarios when writing the code.</p>
<p><a href="https://codesandbox.io/s/inspiring-diffie-lq0u2">Sandbox</a></p>
<p>This is pretty much a translation of a TypeScript code from above:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exposing (..)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Browser</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Html</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exposing (</span><span style="color:#D73A49;--shiki-dark:#F97583">Html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">text</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">input</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">option</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Html.Attributes</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exposing (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Html.Events</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exposing (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">onClick</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">onInput</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- util</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">type </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculate</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Area</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Float</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculate</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Area</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape value =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  case shape of</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> pi * value * value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> value * value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- MAIN</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main =</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  Browser</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sandbox { init = init, update = update, view = view }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- MODEL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">type alias </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Model</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = { shape: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, area: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">init : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Model</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">init = { shape = "", value = 0, area = 0 }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- UPDATE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">type </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Msg</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  = </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ShapeChanged</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  | </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ValueChanged</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Float</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  | </span><span style="color:#6F42C1;--shiki-dark:#B392F0">CalculateArea</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">update : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Msg</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Model</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Model</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">update msg model =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  case msg of</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { model | shape = shape }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    ValueChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { model | value = value }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    CalculateArea</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { model | area = (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">shape</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- VIEW</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Msg</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape = </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  case shape of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    "circle" -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ShapeChanged</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    "square" -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ShapeChanged</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ValueChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Msg</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ValueChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value = </span><span style="color:#6F42C1;--shiki-dark:#B392F0">ValueChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">withDefault</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 0 (</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toFloat</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">view : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Model</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Html</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Msg</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">view model =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  div []</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ select [ on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      option [ value "" ] [ text "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Choose</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape" ], </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      option [ value "circle" ] [ text "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" ],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      option [ value "square" ] [ text "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" ] ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , input [ value (</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fromFloat</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ValueChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] []</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , button [ on</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Click</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CalculateArea</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ text "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Calculate</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area" ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , div [] [ text ("</span><span style="color:#D73A49;--shiki-dark:#F97583">Area:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> " ++ (</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fromFloat</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span></code></pre>
<p>Note that it won’t compile:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-- TYPE MISMATCH ----------------------------------------------- Jump To Problem</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Something is off with the body of the `init` definition:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>29| init = { shape = "", value = 0, area = 0 }</span></span>
<span class="line"><span>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span>The body is a record of type:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    { area : Float, shape : String, value : Float }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>But the type annotation on `init` says it should be:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Model</span></span>
<span class="line"><span></span></span></code></pre>
<!--more-->
<p>You can’t have a default value for a type (the way enums are implemented in Elm / Haskell / ML-like languages) that is outside of the type values’ range. You have to either use a valid value or stick to something like <code>Maybe</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> alias </span><span style="color:#D73A49;--shiki-dark:#F97583">Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#D73A49;--shiki-dark:#F97583"> Maybe</span><span style="color:#D73A49;--shiki-dark:#F97583"> Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#D73A49;--shiki-dark:#F97583"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#D73A49;--shiki-dark:#F97583"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">init </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Model</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">init </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- UPDATE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  =</span><span style="color:#D73A49;--shiki-dark:#F97583"> ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Maybe</span><span style="color:#D73A49;--shiki-dark:#F97583"> Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583"> ValueChanged</span><span style="color:#D73A49;--shiki-dark:#F97583"> Float</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#D73A49;--shiki-dark:#F97583"> CalculateArea</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">update </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Model</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">update msg model </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> msg </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { model </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ValueChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { model </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    CalculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { model </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">withDefault </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map (</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape model</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value) model</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape)) }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- VIEW</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Msg</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Just</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Just</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    _ </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ShapeChanged</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Msg</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChanged value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ValueChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">withDefault </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">toFloat value))</span></span>
<span class="line"></span></code></pre>
<p>See how this simple fact changes the whole implementation. Not sure if that is a good news, though.</p>
<p>Now even with these changes the code won’t compile, since there is one code path uncovered - user selecting a value other than <code>circle</code> or <code>square</code> (the default one):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>-- MISSING PATTERNS -------------------------------------------- Jump To Problem</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This `case` does not have branches for all possibilities:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>54|>  case shape of</span></span>
<span class="line"><span>55|>    "circle" -> ShapeChanged (Just Circle)</span></span>
<span class="line"><span>56|>    "square" -> ShapeChanged (Just Square)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Missing possibilities include:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    _</span></span>
<span class="line"><span></span></span>
<span class="line"><span>I would have to crash if I saw one of those. Add branches for them!</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Hint: If you want to write the code for each branch later, use `Debug.todo` as a</span></span>
<span class="line"><span>placeholder. Read &#x3C;https://elm-lang.org/0.19.1/missing-patterns> for more</span></span>
<span class="line"><span>guidance on this workflow.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Elm <em>forces</em> you to cover that path.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Msg</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Just</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ShapeChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Just</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    _ </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ShapeChanged</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Nothing</span></span>
<span class="line"></span></code></pre>
<p>See how awesome error messages from Elm are and how they really help you figure out what the issues are and fix errors.</p> </div>  </article><article> <h1> <a href="/2021/04/19/2021-04-19-experiment-2-fsharp.html">Strongly-typed front-end: experiment 2, simple application, in F#</a> </h1> <time datetime="2021-04-19T00:23:02.000Z"> Apr 19, 2021 </time> <div class="content"> <h3 id="contents">Contents</h3>
<ol>
<li><a href="/strongly-typed-front-end/2021/04/19/introduction.html">Introduction</a></li>
<li><a href="/strongly-typed-front-end/experiment-1/2021/04/19/experiment-1.html">Experiment 1, darken_color</a></li>
<li>Experiment 2, simple application
<ul>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-elm.html">Elm</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-fsharp.html"><strong>F# (you are here)</strong></a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-purescript.html">PureScript &#x26; purescript-react-dom</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2024/05/17/experiment-2-purescript-halogen.html">PureScript &#x26; Halogen</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-reasonml.html">ReasonML</a></li>
</ul>
</li>
</ol>
<p>In F# world, there is a framework called <a href="https://fable.io/">Fable</a>. It allows one to compile their F# code to JavaScript. There is a built-in package for React, but Fable developers themselves <a href="https://fable.io/docs/your-fable-project/use-a-fable-library.html">suggest</a> using <a href="https://elmish.github.io/">Elmish</a>, which is a framework similar to Elm, just suited for F#.</p>
<p>A sample Elmish application in the <a href="https://fable.io/repl/">online editor</a> looks like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="fsharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish.SimpleInput</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">(**</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">Minimal application showing how to use Elmish</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">You can find more info about Emish architecture and samples at https://elmish.github.io/</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">*)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.Core.JsInterop</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.React</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.React.Props</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish.React</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// MODEL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> string </span><span style="color:#D73A49;--shiki-dark:#F97583">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ChangeValue </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> init </span><span style="color:#D73A49;--shiki-dark:#F97583">()</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="color:#D73A49;--shiki-dark:#F97583"> },</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// UPDATE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> update </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">msg</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Msg</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">model</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Model</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> msg </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ChangeValue newValue </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newValue </span><span style="color:#D73A49;--shiki-dark:#F97583">},</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// VIEW (rendered with React)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> view model dispatch </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    div </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Class </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"main-container"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Class </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"input"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  Value model.Value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  OnChange </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> ev </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ev.target?value </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ChangeValue </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dispatch</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          span </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, "</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              str model.Value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"!"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// App</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Program.mkProgram init update view</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.withConsoleTrace</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.withReactSynchronous </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"elmish-app"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.run</span></span>
<span class="line"></span></code></pre>
<p>One can easily see the similarities to Elm (or so I think).</p>
<!--more-->
<p>Rewriting it to the application from above should not be a problem, right?</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="fsharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish.SimpleInput</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">(**</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">Minimal application showing how to use Elmish</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">You can find more info about Emish architecture and samples at https://elmish.github.io/</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">*)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.Core.JsInterop</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.React</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.React.Props</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish.React</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> System</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// MODEL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Rectangle </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Circle</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> calculateArea </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> float</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Circle </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Math.PI</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Rectangle </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Option</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Shape</span><span style="color:#D73A49;--shiki-dark:#F97583">>;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> float</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> float </span><span style="color:#D73A49;--shiki-dark:#F97583">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ShapeChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ValueChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> float</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CalculateArea</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> init </span><span style="color:#D73A49;--shiki-dark:#F97583">()</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Option.None</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#D73A49;--shiki-dark:#F97583"> },</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// UPDATE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> update </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">msg</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">model</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> msg </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ValueChanged newValue </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newValue </span><span style="color:#D73A49;--shiki-dark:#F97583">},</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ShapeChanged newShape </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newShape </span><span style="color:#D73A49;--shiki-dark:#F97583">},</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CalculateArea </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea model.shape model.value </span><span style="color:#D73A49;--shiki-dark:#F97583">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// VIEW (rendered with React)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> view model dispatch </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    div </span><span style="color:#D73A49;--shiki-dark:#F97583">[]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> select </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> OnChange </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> evt </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> evt.target?value </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ShapeChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dispatch</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            option </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            option </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            option </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"rectangle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          input </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value model.Value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  OnChange </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> evt </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> evt.target?value </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> float </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ValueChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dispatch</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          button </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> OnClick </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> evt </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dispatch CalculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Calculate area"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          span </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Area: "</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              str model.Area</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// App</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Program.mkProgram init update view</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.withConsoleTrace</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.withReactSynchronous </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"elmish-app"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.run</span></span>
<span class="line"></span></code></pre>
<p>I deliberately skipped few things to check what errors will I get from the compiler.</p>
<p>Now to the errors:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>    | Circle -> value * value * Math.PI</span></span>
<span class="line"><span>The value, constructor, namespace or type 'PI' is not defined.</span></span>
<span class="line"><span>| ShapeChanged newShape -></span></span>
<span class="line"><span>        { model with shape = newShape }, Cmd.none</span></span>
<span class="line"><span>This expression was expected to have type</span></span>
<span class="line"><span>    'Shape'    </span></span>
<span class="line"><span>but here has type</span></span>
<span class="line"><span>    'Shape option'</span></span>
<span class="line"><span>| CalculateArea -></span></span>
<span class="line"><span>        { model with area = calculateArea model.shape model.value }</span></span>
<span class="line"><span>All branches of a pattern match expression must return values of the same type as the first branch, which here is 'Model * Cmd&#x3C;'a>'. This branch returns a value of type 'Model'.</span></span>
<span class="line"><span>[ select [ OnChange (fun evt -> evt.target.value |> string |> ShapeChanged |> dispatch) ] [</span></span>
<span class="line"><span>            option [ Value "circle" ]</span></span>
<span class="line"><span>            option [ Value "rectangle" ]</span></span>
<span class="line"><span>          ]</span></span>
<span class="line"><span>          </span></span>
<span class="line"><span>The type 'EventTarget' does not define the field, constructor or member 'value'.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Type mismatch. Expecting a</span></span>
<span class="line"><span>    'string -> 'a'    </span></span>
<span class="line"><span>but given a</span></span>
<span class="line"><span>    'Shape -> Msg'    </span></span>
<span class="line"><span>The type 'string' does not match the type 'Shape'</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The type ''a -> ReactElement' is not compatible with the type 'ReactElement' (x2)</span></span>
<span class="line"><span>span [ ]</span></span>
<span class="line"><span>            [ str "Area: "</span></span>
<span class="line"><span>              str model.Area</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>            </span></span>
<span class="line"><span>Lookup on object of indeterminate type based on information prior to this program point. A type annotation may be needed prior to this program point to constrain the type of the object. This may allow the lookup to be resolved.</span></span>
<span class="line"><span></span></span></code></pre>
<p>The errors might be a tiny bit mysterious at times, but using simple intuition one can easily fix them all.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="fsharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish.SimpleInput</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.Core.JsInterop</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.React</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Fable.React.Props</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Elmish.React</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> System</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// MODEL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Rectangle </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Circle</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> calculateArea </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> float</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Circle </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Math.PI</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Rectangle </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> getShape </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> string</span><span style="color:#D73A49;--shiki-dark:#F97583">):</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Option</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Shape</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Option.Some Circle</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "rectangle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Option.Some Rectangle</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#D73A49;--shiki-dark:#F97583"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Option.None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Option</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Shape</span><span style="color:#D73A49;--shiki-dark:#F97583">>;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> float</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> float </span><span style="color:#D73A49;--shiki-dark:#F97583">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ShapeChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> string</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ValueChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> string</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CalculateArea</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> init </span><span style="color:#D73A49;--shiki-dark:#F97583">()</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Option.None</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#D73A49;--shiki-dark:#F97583"> },</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// UPDATE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> update </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">msg</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">model</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> msg </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ValueChanged newValue </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> float newValue </span><span style="color:#D73A49;--shiki-dark:#F97583">},</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ShapeChanged newShape </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> getShape newShape </span><span style="color:#D73A49;--shiki-dark:#F97583">},</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CalculateArea </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> newArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Option.map </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape model.value</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model.shape</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            |></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Option.defaultValue </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newArea </span><span style="color:#D73A49;--shiki-dark:#F97583">},</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Cmd.none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// VIEW</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> view model dispatch </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    div </span><span style="color:#D73A49;--shiki-dark:#F97583">[]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> select </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> OnChange </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> evt </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> evt.target?value </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ShapeChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dispatch</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            option </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            option </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            option </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"rectangle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Rectangle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">          ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          input </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value model.value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  OnChange </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> evt </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> evt.target?value </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ValueChanged </span><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dispatch</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          button </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> OnClick </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> evt </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dispatch CalculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span><span style="color:#D73A49;--shiki-dark:#F97583"> [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Calculate area"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          span </span><span style="color:#D73A49;--shiki-dark:#F97583">[</span><span style="color:#D73A49;--shiki-dark:#F97583"> ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            [</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Area: "</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              str </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string model.area</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            ]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// App</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Program.mkProgram init update view</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.withConsoleTrace</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.withReactSynchronous </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"elmish-app"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Program.run</span></span>
<span class="line"></span></code></pre>
<p>TL;DR:</p>
<img src="/images/strongly-typed-front-end/not-bad.png" loading="lazy" alt="Not bad"> </div>  </article><article> <h1> <a href="/2021/04/19/2021-04-19-experiment-2-reasonml.html">Strongly-typed front-end: experiment 2, simple application, in ReasonML</a> </h1> <time datetime="2021-04-19T00:23:02.000Z"> Apr 19, 2021 </time> <div class="content"> <h3 id="contents">Contents</h3>
<ol>
<li><a href="/strongly-typed-front-end/2021/04/19/introduction.html">Introduction</a></li>
<li><a href="/strongly-typed-front-end/experiment-1/2021/04/19/experiment-1.html">Experiment 1, darken_color</a></li>
<li>Experiment 2, simple application
<ul>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-elm.html">Elm</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-fsharp.html">F#</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-purescript.html">PureScript &#x26; purescript-react-dom</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2024/05/17/experiment-2-purescript-halogen.html">PureScript &#x26; Halogen</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-reasonml.html">ReasonML <strong>(you are here)</strong></a></li>
</ul>
</li>
</ol>
<p>For the sake of experiment, I have decided to implement the very same application in ReasonML → ReScript by Facebook.</p>
<p>Starting the React Hooks example on <a href="https://reasonml.github.io/en/try">Try ReasonML</a> website, you get this code, which resembles some of the React features, just in a slightly weird syntax:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">bs</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">config</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span><span style="color:#6F42C1;--shiki-dark:#B392F0">jsx</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;text-decoration:underline;--shiki-dark:#B392F0;--shiki-dark-text-decoration:underline">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Counter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">react</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">component</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">  let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> make</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#032F62;--shiki-dark:#DBEDFF">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">count</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setCount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">p</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ++ " </span><span style="color:#6F42C1;--shiki-dark:#B392F0">clicked</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> " ++ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">string_of_int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">count</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ++ " </span><span style="color:#6F42C1;--shiki-dark:#B392F0">times</span><span style="color:#24292E;--shiki-dark:#E1E4E8">")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">p</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button onClick</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> setCount(_ => count + 1)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Click </span><span style="color:#6F42C1;--shiki-dark:#B392F0">me</span><span style="color:#24292E;--shiki-dark:#E1E4E8">")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ReactDOMRe.renderToElementWithId(&#x3C;Counter name="Counter" />, "preview");</span></span>
<span class="line"></span></code></pre>
<p>Starting off by defining the enum type for shape:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Shape </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Square</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span></code></pre>
<p>And immediately getting an error:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Line 4:8-12 A type name must start with a lower-case letter or an underscore</span></span>
<span class="line"><span></span></span></code></pre>
<p>That one is easy to fix:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> shape</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Square</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span></code></pre>
<p>Now, add some markup:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">react</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">component</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> make</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#032F62;--shiki-dark:#DBEDFF">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setArea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">option</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> value</span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Choose</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Square</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> /></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">p</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string_of_float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">p</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Calculate")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">  &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span></code></pre>
<!--more-->
<p>And getting hit by another error:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 14:52-57</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The variant constructor Choose can't be found.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- If it's defined in another module or file, bring it into scope by:</span></span>
<span class="line"><span>  - Annotating it with said module name: let food = MyModule.Apple</span></span>
<span class="line"><span>  - Or specifying its type: let food: MyModule.fruit = Apple</span></span>
<span class="line"><span>- Constructors and modules are both capitalized. Did you want the latter?</span></span>
<span class="line"><span>  Then instead of let foo = Bar, try module Foo = Bar.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Not extremely helpful. Having to look into the OCaml code compiled from ReasonML:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@@@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">bs</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">config</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> jsx</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> }]</span></span>
<span class="line"><span style="color:#6F42C1;text-decoration:underline;--shiki-dark:#B392F0;--shiki-dark-text-decoration:underline">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Counter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  struct</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">    type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> shape</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Square</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">    let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> make</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  =</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">      let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;text-decoration:underline;--shiki-dark:#79B8FF;--shiki-dark-text-decoration:underline">_shape</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#005CC5;text-decoration:underline;--shiki-dark:#79B8FF;--shiki-dark-text-decoration:underline">setShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState (</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">in</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">      let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;text-decoration:underline;--shiki-dark:#79B8FF;--shiki-dark-text-decoration:underline">value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#005CC5;text-decoration:underline;--shiki-dark:#79B8FF;--shiki-dark-text-decoration:underline">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState (</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">in</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">      let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;text-decoration:underline;--shiki-dark:#79B8FF;--shiki-dark-text-decoration:underline">area</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#005CC5;text-decoration:underline;--shiki-dark:#79B8FF;--shiki-dark-text-decoration:underline">setArea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState (</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">in</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ((div</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">          ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((select</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">                         ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((option </span><span style="color:#032F62;--shiki-dark:#DBEDFF">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">                                        ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[Choose</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                                   [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                   ((option</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">                                       ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">reason</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw_literal</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">                                                           "circle"</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">                                       ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[Circle]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                   ((option</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">                                       ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">reason</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw_literal</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">                                                           "square"</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">                                       ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[Square]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ((input </span><span style="color:#032F62;--shiki-dark:#DBEDFF">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ((p </span><span style="color:#032F62;--shiki-dark:#DBEDFF">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string (string_of_float area)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ((button</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">                        ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                     ((</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Calculate"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">reason</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw_literal</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">                                                     "Calculate"</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">react</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">component</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  end</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">let</span><span style="color:#005CC5;font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"> _</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  ReactDOMRe</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">renderToElementWithId</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ((</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Counter</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">createElement</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">        ~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Counter"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">reason</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw_literal</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Counter"</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#DBEDFF">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">children</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[]</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSX</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ((</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"preview"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">reason</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw_literal</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "preview"</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Seems that this JSX does not work well with strings. Looking into the original example, one can deduct the format:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">option</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>{React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Choose shape"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">option</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>And having to replace this everywhere in the JSX:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#24292E;--shiki-dark:#E1E4E8">react</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">component</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> make</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#032F62;--shiki-dark:#DBEDFF">~</span><span style="color:#6F42C1;--shiki-dark:#B392F0">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setArea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">option</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> value</span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Choose </span><span style="color:#6F42C1;--shiki-dark:#B392F0">shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Circle")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Square")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> /></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">p</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span><span style="color:#24292E;--shiki-dark:#E1E4E8">"Area</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#032F62;--shiki-dark:#DBEDFF">++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string(string_of_float(area))</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">p</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Calculate")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">  &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span></code></pre>
<p>And the next error is</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 33:30-34</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This has type:</span></span>
<span class="line"><span>  float</span></span>
<span class="line"><span>But somewhere wanted:</span></span>
<span class="line"><span>  string</span></span>
<span class="line"><span></span></span>
<span class="line"><span>You can convert a float to a string with string_of_float.</span></span>
<span class="line"><span></span></span></code></pre>
<p>Seems that <code>value={value}</code> does not work out of the box too, since the <code>value</code> variable has the type <code>float</code> and this version of React expects it to be <code>string</code>. Okay, let’s use that <code>string_of_float</code> function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;input value={string_of_float(value)} /></span></span>
<span class="line"></span></code></pre>
<p>Apparently it is also not good enough:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Warning number 3</span></span>
<span class="line"><span>OCaml preview 33:37-51</span></span>
<span class="line"><span></span></span>
<span class="line"><span>deprecated: Pervasives.string_of_float</span></span>
<span class="line"><span>Please use Js.Float.toString instead, string_of_float generates unparseable floats</span></span>
<span class="line"><span></span></span></code></pre>
<p>So it should be</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;input value={Js.Float.toString(value)} /></span></span>
<span class="line"></span></code></pre>
<p>Okay, only the unused state setters left. Let’s implement the <code>shapeChanged</code> and the <code>calculateArea</code> helpers first:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> shapeChanged</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (shapeStr</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> option(shape) </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      switch shapeStr </span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> Some(Circle)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | "square" => Some(Square)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | _ => None</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      }</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> calculateArea</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (_shape</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> float) </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      switch _shape </span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | Circle </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> Js.Math.PI * value * value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | Square => value * value</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      }</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span></code></pre>
<p>The <code>Js.Math.PI</code> is not accessible, apparently:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 20:23-32</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The variant constructor Js.Math.PI can't be found.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- If it's defined in another module or file, bring it into scope by:</span></span>
<span class="line"><span>  - Annotating it with said module name: let food = MyModule.Apple</span></span>
<span class="line"><span>  - Or specifying its type: let food: MyModule.fruit = Apple</span></span>
<span class="line"><span>- Constructors and modules are both capitalized. Did you want the latter?</span></span>
<span class="line"><span>  Then instead of let foo = Bar, try module Foo = Bar.</span></span>
<span class="line"><span></span></span></code></pre>
<p>According to the <a href="https://rescript-lang.org/docs/manual/latest/api/js/math#_pi">docs</a>, it is <code>Js.Math._PI</code>. But even after fixing that, there is a mysterious error now:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 20:23-33</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This has type:</span></span>
<span class="line"><span>  float</span></span>
<span class="line"><span>But somewhere wanted:</span></span>
<span class="line"><span>  int</span></span>
<span class="line"><span></span></span>
<span class="line"><span>You can convert a float to a int with int_of_float.If this is a literal, you want a number without a trailing dot (e.g. 20).</span></span>
<span class="line"><span></span></span></code></pre>
<p>The error happens on this OCaml line:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">| Circle  -> (Js.Math._PI * value) * value</span></span>
<span class="line"></span></code></pre>
<p>Not helpful at all. The trick is that OCaml uses different operators for integer and floating-point math. This should do the trick:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">| Circle -> Js.Math._PI *. value *. value</span></span>
<span class="line"></span></code></pre>
<p>Now, the last bit: connecting the component to the state:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;select onChange={ event => setShape(shapeChanged(event.target.value)) }></span></span>
<span class="line"></span></code></pre>
<p>As usual, an error:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 26:62-67</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The record field target can't be found.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>If it's defined in another module or file, bring it into scope by:</span></span>
<span class="line"><span>- Annotating it with said module name: let baby = {MyModule.age: 3}</span></span>
<span class="line"><span>- Or specifying its type: let baby: MyModule.person = {age: 3}</span></span>
<span class="line"><span></span></span></code></pre>
<p>Apparently, this JSX implementation has <a href="https://reasonml.github.io/reason-react/docs/en/event">its own ways</a> of accessing event’s props:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ReactEvent.Form.target(event)##value</span></span>
<span class="line"></span></code></pre>
<p>The issue is that this code is a valid BuckleScript, but not ReasonML. These intuitions <a href="https://rescript-lang.org/docs/manual/latest/migrate-from-bucklescript-reason">described in docs</a> won’t work:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">setShape(shapeChanged(ReactEvent.Form.target(event).value))</span></span>
<span class="line"></span></code></pre>
<p>And here we go again:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 27:75-79</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The record field value can't be found.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>If it's defined in another module or file, bring it into scope by:</span></span>
<span class="line"><span>- Annotating it with said module name: let baby = {MyModule.age: 3}</span></span>
<span class="line"><span>- Or specifying its type: let baby: MyModule.person = {age: 3}</span></span>
<span class="line"><span>setShape(shapeChanged(ReactEvent.Form.target(event)["value"]))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 27:45-74</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This has type:</span></span>
<span class="line"><span>  &#x3C; .. > Js.t</span></span>
<span class="line"><span>But somewhere wanted:</span></span>
<span class="line"><span>  'a array</span></span>
<span class="line"><span></span></span></code></pre>
<p>I am yet to figure out WTF is going on there, but the rough solution would be to just smash some JS code in:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;select onChange={ event => {</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">        let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">%</span><span style="color:#24292E;--shiki-dark:#E1E4E8">bs</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {| event.target.value |}</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">        let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> s</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> option(shape) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shapeChanged(v)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        setShape(s)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}></span></span>
<span class="line"></span></code></pre>
<p>That worked just enough to show yet another error:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>We've found a bug for you!</span></span>
<span class="line"><span>OCaml preview 28:48</span></span>
<span class="line"><span></span></span>
<span class="line"><span>This has type:</span></span>
<span class="line"><span>  shape option</span></span>
<span class="line"><span>But somewhere wanted:</span></span>
<span class="line"><span>  'a option -> 'a option</span></span>
<span class="line"><span></span></span></code></pre>
<p>This is because state setters take a function, not just a value:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">setShape(_ => s)</span></span>
<span class="line"></span></code></pre>
<p>And the whole event handler can be simplified a little bit:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;select onChange={ event => {</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">        let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">%</span><span style="color:#24292E;--shiki-dark:#E1E4E8">bs</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {| event.target.value |}</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        setShape(_ </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shapeChanged(v))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}></span></span>
<span class="line"></span></code></pre>
<p>This breaks some of the type checking benefits, but it just works ™️ ©</p>
<p>Back to the other event handlers:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;input value={Js.Float.toString(value)} onChange={ event => {</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">        let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> [</span><span style="color:#032F62;--shiki-dark:#DBEDFF">%</span><span style="color:#24292E;--shiki-dark:#E1E4E8">bs</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raw</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> {| event.target.value |}</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        setValue(_ </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> float_of_string(v))</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }} /></span></span>
<span class="line"></span></code></pre>
<p>Surprisingly enough, here ReasonML is totally fine with <code>float_of_string</code>.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;button onClick={ _ => {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        setArea(_ => Belt.Option.mapWithDefault(_shape, 0.0, s => calculateArea(s, value)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}></span></span>
<span class="line"></span></code></pre>
<p>Tricky <code>Belt</code> library way to work with <code>option</code>s.</p>
<p>Now that the code is done and seems to work in the playground, it is time to introduce yet another issue with raw technology by Facebook: it has actually <strong>four</strong> completely different and incompatible versions:</p>
<ul>
<li>OCaml, with all of the libraries provided by Facebook</li>
<li>BuckleScript, the back-end of the ReasonML (<a href="https://rescript-lang.org/blog/bucklescript-is-rebranding">rebranding announcement</a>, <a href="https://rescript-lang.org/blog/bucklescript-8-1-new-syntax">differences</a>)</li>
<li>ReasonML, the old version of the language (<a href="https://reasonml.github.io/blog/">blogs up to 2018</a>)</li>
<li>ReScript, the new version of the language (<a href="https://rescript-lang.org/docs/manual/latest/migrate-from-bucklescript-reason">differences</a>)</li>
</ul>
<p>Each of them has incompatible syntax, all of them use the docs of one another (in particular, React docs are written for BuckleScript, but refer to ReScript docs).</p>
<p>Despite the bold proclamations like</p>
<blockquote>
<p>// ReScript / old Reason syntax should parse just
// fine (go to the “Settings” panel for toggling syntax).</p>
</blockquote>
<p>And</p>
<blockquote>
<p>What Will Change with ReScript?</p>
<p>Technically, not much. One of our main goals is to keep backwards compatibility for existing BuckleScript codebases and will provide an automated upgrade path from .re (Reason) to .res (ReScript) files.</p>
<p>The BuckleScript compiler toolchain and its new .res syntax will be unified into one platform called ReScript. Upgrading from the bs-platform to the soon-to-be-published ReScript npm package will just be a matter of updating your package.json file. Syntax wise, we believe that previous Reason users will feel right at home.</p>
<p>ReScript will continue shipping the old Reason v3.6 syntax as well and it will be possible to mix .re and .res files in one codebase (same with libraries).</p>
</blockquote>
<p>If you try to run the ReasonML code that works in ReasonML playground in ReScript playground, you will notice that it does not even compile:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[E] Line 6, column 19:</span></span>
<span class="line"><span>Missing expression</span></span>
<span class="line"><span>[E] Line 12, column 49:</span></span>
<span class="line"><span>Type parameters require angle brackets:</span></span>
<span class="line"><span>  option&#x3C;shape></span></span>
<span class="line"><span>[E] Line 27, column 32:</span></span>
<span class="line"><span>Did you forget a `,` here? </span></span>
<span class="line"><span>[E] Line 27, column 57:</span></span>
<span class="line"><span>Did you forget a `}` here? </span></span>
<span class="line"><span>[E] Line 36, column 32:</span></span>
<span class="line"><span>Did you forget a `,` here? </span></span>
<span class="line"><span></span></span></code></pre>
<p>With a few changes following intuition (and not those useless error messages), one can get it to compile:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">// no more </span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#DBEDFF">%</span><span style="color:#24292E;--shiki-dark:#E1E4E8">bs</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> annotations</span></span>
<span class="line"><span style="color:#6F42C1;text-decoration:underline;--shiki-dark:#B392F0;--shiki-dark-text-decoration:underline">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Counter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">  type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> shape</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Circle</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Square</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  </span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">  @</span><span style="color:#24292E;--shiki-dark:#E1E4E8">react</span><span style="color:#032F62;--shiki-dark:#DBEDFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">component // </span><span style="color:#6F42C1;--shiki-dark:#B392F0">annotations</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> look </span><span style="color:#6F42C1;--shiki-dark:#B392F0">more</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> java</span><span style="color:#032F62;--shiki-dark:#DBEDFF">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8">like or </span><span style="color:#6F42C1;--shiki-dark:#B392F0">typescript</span><span style="color:#032F62;--shiki-dark:#DBEDFF">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8">like</span></span>
<span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">  let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> make</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    let (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">setArea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">useState(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">()</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    // </span><span style="color:#6F42C1;--shiki-dark:#B392F0">option</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(type) </span><span style="color:#6F42C1;--shiki-dark:#B392F0">is</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> now</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> option</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;type></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    let </span><span style="color:#6F42C1;--shiki-dark:#B392F0">shapeChanged</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (shapeStr</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      switch shapeStr </span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | "</span><span style="color:#6F42C1;--shiki-dark:#B392F0">circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">" </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> Some(Circle)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | "square" => Some(Square)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | _ => None</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      }</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    let </span><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (_shape</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> float) </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      switch _shape </span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | Circle </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> Js.Math._PI *. value *. value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        | Square => value *. value</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      }</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> onChange</span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> event</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        // </span><span style="color:#6F42C1;--shiki-dark:#B392F0">the</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> issue</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> with</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">target</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> is</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> somewhat</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> resolved</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        let </span><span style="color:#6F42C1;--shiki-dark:#B392F0">v</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ReactEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Form</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">target(event)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"value"</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        setShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> shapeChanged(v))</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      }}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">        &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Choose </span><span style="color:#6F42C1;--shiki-dark:#B392F0">shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">        &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Circle")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">        &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">React</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">("Square")</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select</span><span style="color:#032F62;--shiki-dark:#DBEDFF">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input value</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> onChange</span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> event</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        let </span><span style="color:#6F42C1;--shiki-dark:#B392F0">v</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> string </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ReactEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Form</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">target(event)</span><span style="color:#6F42C1;--shiki-dark:#B392F0">[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"value"</span><span style="color:#6F42C1;--shiki-dark:#B392F0">]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> float_of_string(v));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      }</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;p>{React.string("Area:" ++ Js.Float.toString(area))}&#x3C;/p></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;button onClick={ _ => {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        setArea(_ => Belt.Option.mapWithDefault(_shape, 0.0, s => calculateArea(s, value)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {React.string("Calculate")}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/button></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/div></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>TL;DR:</p>
<img src="/images/strongly-typed-front-end/one-can-not-simply.png" loading="lazy" alt="One can&#x27;t simply..."> </div>  </article><article> <h1> <a href="/2021/04/19/2021-04-19-experiment-1.html">Experiment #1: mismatching type handling &amp; error helpfulness</a> </h1> <time datetime="2021-04-18T23:56:24.000Z"> Apr 19, 2021 </time> <div class="content"> <h3 id="contents">Contents</h3>
<ol>
<li><a href="/strongly-typed-front-end/2021/04/19/introduction.html">Introduction</a></li>
<li><a href="/strongly-typed-front-end/experiment-1/2021/04/19/experiment-1.html"><strong>Experiment 1, darken_color  (you are here)</strong></a></li>
<li>Experiment 2, simple application
<ul>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-elm.html">Elm</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-fsharp.html">F#</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-purescript.html">PureScript &#x26; purescript-react-dom</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2024/05/17/experiment-2-purescript-halogen.html">PureScript &#x26; Halogen</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-reasonml.html">ReasonML</a></li>
</ul>
</li>
</ol>
<p>For a sake 🍶of <del>science</del> experiment, I have <a href="https://github.com/shybovycha/darken_color.js/tree/experiment/strong-typing">converted</a> <strong>one function</strong> of a <a href="https://github.com/shybovycha/darken_color.js">library</a> I created long time ago to multiple languages that compile to JS and called it with various values.</p>
<p>The function is simple - it takes a color represented as a HEX string and converts it to <code>{ r, g, b }</code> object.</p>
<p>The test is relatively big - it passes various numbers (integer and floating point, negative and positive), booleans, objects, arrays, obvious candidates - <code>null</code> and <code>undefined</code> and incorrect string.</p>
<p>The implementations are made with:</p>
<ul>
<li>Scala.js</li>
<li>ReasonML</li>
<li>F#</li>
<li>PureScript</li>
<li>TypeScript</li>
<li>Elm</li>
</ul>
<h2 id="implementations">Implementations</h2>
<h3 id="scalajs">Scala.JS</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">package</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> darken_color</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> scala</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scalajs</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">js</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> scala</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scalajs</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">js</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">annotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">val</span><span style="color:#E36209;--shiki-dark:#FFAB70"> r</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">val</span><span style="color:#E36209;--shiki-dark:#FFAB70"> g</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">val</span><span style="color:#E36209;--shiki-dark:#FFAB70"> b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> js.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Object</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">@</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSExportTopLevel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"DarkenColor"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">object</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DarkenColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  @</span><span style="color:#6F42C1;--shiki-dark:#B392F0">JSExport</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">s</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGB</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    val</span><span style="color:#E36209;--shiki-dark:#FFAB70"> re</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> """^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$"""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.r</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    val</span><span style="color:#E36209;--shiki-dark:#FFAB70"> rgbStr</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s </span><span style="color:#D73A49;--shiki-dark:#F97583">match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> re(rStr, gStr, bStr) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Some</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((rStr, gStr, bStr))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> None</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    rgbStr.map (x </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Integer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.parseInt(x._1, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Integer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.parseInt(x._2, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Integer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.parseInt(x._3, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))).getOrElse(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h3 id="reasonml">ReasonML</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ocaml"><code><span class="line"><span style="color:#D73A49;text-decoration:underline;--shiki-dark:#F97583;--shiki-dark-text-decoration:underline">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rgb</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  r</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> int</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  g</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> int</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> int</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">let parse_hex </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> int_of_string("0x" </span><span style="color:#032F62;--shiki-dark:#DBEDFF">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> s)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">let hex2rgb </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> hex </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Re</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">fromString("</span><span style="color:#032F62;--shiki-dark:#DBEDFF">^#?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([a-f0-9]</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8">2</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)([a-f0-9]</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8">2</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)([a-f0-9]</span><span style="color:#6F42C1;--shiki-dark:#B392F0">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8">2</span><span style="color:#6F42C1;--shiki-dark:#B392F0">}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#032F62;--shiki-dark:#DBEDFF">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8">")</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Re</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">exec_(hex)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Belt</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Option</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Re</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">captures)</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Belt</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Option</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Array</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Nullable</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">toOption))</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Belt</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Option</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map (x </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Array</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">sliceFrom(1</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x))</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    -></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Belt</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Option</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Js</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Array</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map (x </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Belt</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Option</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">map(x</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> parse_hex)))</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">    -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (matches </span><span style="color:#032F62;--shiki-dark:#DBEDFF">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> switch </span><span style="color:#6F42C1;--shiki-dark:#B392F0">matches</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      | Some([ Some(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">r</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), Some(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">g</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), Some(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ]) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> Some({ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">r</span><span style="color:#032F62;--shiki-dark:#DBEDFF">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> g</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g</span><span style="color:#032F62;--shiki-dark:#DBEDFF">,</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b })</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#DBEDFF">      |</span><span style="color:#005CC5;font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"> _</span><span style="color:#032F62;--shiki-dark:#DBEDFF"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> None</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"></span></code></pre>
<h3 id="purescript">PureScript</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> DarkenColor</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">join</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">($)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">(&#x3C;#>)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">(>>=)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">(>>>)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">catMaybes</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Array.NonEmpty</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fromStringAs</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">hexadecimal</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Nullable</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Nullable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">toNullable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Either</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hush</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.String.Regex</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">regex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">match</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.String.Regex.Flags</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ignoreCase</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGB</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    r</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    g</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    b</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">constructRGB</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Array</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGB</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">constructRGB [ r, g, b ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { r</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r, g</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g, b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">constructRGB _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Nullable</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGB</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">hex2rgb hexString </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  toNullable </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ((hush </span><span style="color:#D73A49;--shiki-dark:#F97583">>>></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> join) </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (regex </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ignoreCase) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;#></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">re </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (match re hexString)))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  &#x3C;#></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (drop </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  &#x3C;#></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> catMaybes</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  &#x3C;#></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (map (fromStringAs hexadecimal))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  &#x3C;#></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> catMaybes</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  >>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> constructRGB</span></span>
<span class="line"></span></code></pre>
<h3 id="f">F#</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="fsharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DarkenColor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">open</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> System.Text.RegularExpressions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGBType</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> {</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> int16</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> int16</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> int16 </span><span style="color:#D73A49;--shiki-dark:#F97583">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> hex2rgb </span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">hex</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> string</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#E36209;--shiki-dark:#FFAB70"> m</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Regex.Match</span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">hex</span><span style="color:#D73A49;--shiki-dark:#F97583">,</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "^#?([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$"</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m.Success </span><span style="color:#D73A49;--shiki-dark:#F97583">then</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        m.Groups</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        |></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Seq.cast</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Group</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        |></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Seq.skip </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // zero capture group is always the full string, when it matches</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        |></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Seq.map </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m.Value</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        |></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Seq.map </span><span style="color:#D73A49;--shiki-dark:#F97583">(fun</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> System.Convert.ToInt16</span><span style="color:#D73A49;--shiki-dark:#F97583">(</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span><span style="color:#D73A49;--shiki-dark:#F97583">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 16</span><span style="color:#D73A49;--shiki-dark:#F97583">))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        |></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Seq.toList</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        |></span><span style="color:#D73A49;--shiki-dark:#F97583"> (function</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g </span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b </span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#D73A49;--shiki-dark:#F97583"> []</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Some </span><span style="color:#D73A49;--shiki-dark:#F97583">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g</span><span style="color:#D73A49;--shiki-dark:#F97583">;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b </span><span style="color:#D73A49;--shiki-dark:#F97583">}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            |</span><span style="color:#D73A49;--shiki-dark:#F97583"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> None</span><span style="color:#D73A49;--shiki-dark:#F97583">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> None</span></span>
<span class="line"></span></code></pre>
<h3 id="typescript">TypeScript</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGBType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  r</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  g</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  * Converts a HEX color value to RGB by extracting R, G and B values from string using regex.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  * Returns r, g, and b values in range [0, 255]. Does not support RGBA colors just yet.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  * </span><span style="color:#D73A49;--shiki-dark:#F97583">@param</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> hex</span><span style="color:#6A737D;--shiki-dark:#6A737D"> The color value</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  * </span><span style="color:#D73A49;--shiki-dark:#F97583">@returns</span><span style="color:#6A737D;--shiki-dark:#6A737D"> The RGB representation or {</span><span style="color:#D73A49;--shiki-dark:#F97583">@code</span><span style="color:#6A737D;--shiki-dark:#6A737D"> null} if the string value is invalid</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> hex2rgb</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">hex</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGBType</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> shorthandRegex</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> /</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#032F62;--shiki-dark:#DBEDFF">#</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#032F62;--shiki-dark:#DBEDFF">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">[a-f\d]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">)(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">[a-f\d]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">)(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">[a-f\d]</span><span style="color:#032F62;--shiki-dark:#DBEDFF">)</span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#D73A49;--shiki-dark:#F97583">i</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  hex </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> hex.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">replace</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shorthandRegex, (</span><span style="color:#E36209;--shiki-dark:#FFAB70">_match</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">r</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">g</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> result</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> /</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#032F62;--shiki-dark:#DBEDFF">#</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#032F62;--shiki-dark:#DBEDFF">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">[a-f\d]</span><span style="color:#D73A49;--shiki-dark:#F97583">{2}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">)(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">[a-f\d]</span><span style="color:#D73A49;--shiki-dark:#F97583">{2}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">)(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">[a-f\d]</span><span style="color:#D73A49;--shiki-dark:#F97583">{2}</span><span style="color:#032F62;--shiki-dark:#DBEDFF">)</span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#D73A49;--shiki-dark:#F97583">i</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">exec</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(hex);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    r: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">parseInt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(result[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    g: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">parseInt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(result[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    b: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">parseInt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(result[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { hex2rgb };</span></span>
<span class="line"></span></code></pre>
<h3 id="elm">Elm</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DarkenColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exposing (..)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">List</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe.Extra</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">import </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Regex</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">type alias </span><span style="color:#6F42C1;--shiki-dark:#B392F0">RGBType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = { r: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, g: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, b: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">hex2rgb : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RGBType</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">hex2rgb hex =</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Regex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.from</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> "^#?([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#6F42C1;--shiki-dark:#B392F0">f0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-9]{2})([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#6F42C1;--shiki-dark:#B392F0">f0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-9]{2})([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#6F42C1;--shiki-dark:#B392F0">f0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-9]{2})$"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        |> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.map (</span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#6F42C1;--shiki-dark:#B392F0">regex</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#D73A49;--shiki-dark:#F97583"> Regex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">find</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> regex</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> hex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        |> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.map (</span><span style="color:#D73A49;--shiki-dark:#F97583">List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">match</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        |> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.map (</span><span style="color:#D73A49;--shiki-dark:#F97583">List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#D73A49;--shiki-dark:#F97583"> String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toInt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        |> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.and</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Then</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#D73A49;--shiki-dark:#F97583">Extra</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">combine</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        |> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.and</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Then</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> construct</span><span style="color:#6F42C1;--shiki-dark:#B392F0">RGB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">construct</span><span style="color:#6F42C1;--shiki-dark:#B392F0">RGB</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> list =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    case list of</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ r, g, b ] -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe.Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { r = r, g = g, b = b }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        _ -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe.Nothing</span></span>
<span class="line"></span></code></pre>
<p>For fair comparison, the implementation is kept same (no platform-specific code, except <code>Option</code> in functional languages) and every single bundle is processed with Webpack 4.</p>
<p>The test checks both the result and the assumes no exception is thrown, even when the input is incorrect.
For the interest sake, the exceptions thrown as well as bundle sizes will be listed below.</p>
<!--more-->
<h3 id="the-test">The test</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> FSharp</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'./dist/bundle.fsharp.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Purescript</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'./dist/bundle.purescript.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Rescript</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'./dist/bundle.rescript.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ScalaJS</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'./dist/bundle.scalajs.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Typescript</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'./dist/bundle.typescript.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'DarkenColor'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> interpretations</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    'F#'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: FSharp,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    'PureScript'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: Purescript,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    'ReScript'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: Rescript,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    'ScalaJS'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: ScalaJS.DarkenColor,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    'TypeScript'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: Typescript</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Object.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">entries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(interpretations).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(([</span><span style="color:#E36209;--shiki-dark:#FFAB70">language</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">DarkenColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`in ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">language</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'hex2rgb'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for valid input'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'with hash prefix'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'long HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#bede12'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'returns correct result'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toMatchObject</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ r: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">190</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, g: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">222</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, b: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">18</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            xdescribe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'short HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#bd7'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'returns correct result'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toMatchObject</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ r: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">187</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, g: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">221</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, b: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">119</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'no hash prefix'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'long HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'bede12'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'returns correct result'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toMatchObject</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ r: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">190</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, g: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">222</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, b: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">18</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            xdescribe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'short HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'bd7'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'returns correct result'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toMatchObject</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ r: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">187</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, g: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">221</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, b: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">119</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for invalid input'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'invalid HEX string'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'invalid number of digits'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'too few'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for long HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#bede1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                  it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                xdescribe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for short HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#be'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                  it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'too many'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for long HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#bede128'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                  it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                xdescribe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for short HEX'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#bede'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                  it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'invalid letters'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#bfghij'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'invalid characters'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#be!?12'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'spaces'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#be de  12'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'invalid prefix'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '?bede12'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for number'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'positive'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'floating point'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'integer'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 314</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'negative'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'floating point'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'integer'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">              const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">314</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">              });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'for object'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'null'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'undefined'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NaN'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> NaN</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'JSON'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { r: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, g: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">76</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, b: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">120</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'array'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">76</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">120</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Boolean'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">          describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Map'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> input</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'does not fail'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">              expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DarkenColor.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hex2rgb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(input)).not.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toThrow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<h2 id="test-results">Test results</h2>
<p>Here is a comparison of the test results:</p>
<table>
  <thead>
    <tr>
      <th>Tool</th>
      <th>Test results</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>F#</td>
      <td>✅</td>
    </tr>
    <tr>
      <td>PureScript</td>
      <td>❌</td>
    </tr>
    <tr>
      <td>ReScript</td>
      <td>✅</td>
    </tr>
    <tr>
      <td>ScalaJS</td>
      <td>❌</td>
    </tr>
    <tr>
      <td>TypeScript</td>
      <td>❌</td>
    </tr>
    <tr>
      <td>Elm</td>
      <td>n/a</td>
    </tr>
  </tbody>
</table>
<h2 id="error-helpfulness">Error helpfulness</h2>
<p>Some implementations still throw error when the data type is not what the function expects.</p>
<h3 id="purescript-1">PureScript</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>  ● DarkenColor › in PureScript › hex2rgb › for number › positive › integer › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "TypeError"</span></span>
<span class="line"><span>    Error message: "u.match is not a function"</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>  ● DarkenColor › in PureScript › hex2rgb › for object › null › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "TypeError"</span></span>
<span class="line"><span>    Error message: "Cannot read property 'match' of null"</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>  ● DarkenColor › in PureScript › hex2rgb › for object › undefined › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "TypeError"</span></span>
<span class="line"><span>    Error message: "Cannot read property 'match' of undefined"</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="scalajs-1">ScalaJS</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span> ● DarkenColor › in ScalaJS › hex2rgb › for object › undefined › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "org.scalajs.linker.runtime.UndefinedBehaviorError"</span></span>
<span class="line"><span>    Error message: "java.lang.ClassCastException: undefined is not an instance of java.lang.String"</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ● DarkenColor › in ScalaJS › hex2rgb › for number › positive › floating point › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "org.scalajs.linker.runtime.UndefinedBehaviorError"</span></span>
<span class="line"><span>    Error message: "java.lang.ClassCastException: 3.14 is not an instance of java.lang.String"</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="typescript-1">TypeScript</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span> ● DarkenColor › in TypeScript › hex2rgb › for number › positive › floating point › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "TypeError"</span></span>
<span class="line"><span>    Error message: "e.replace is not a function"</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ● DarkenColor › in TypeScript › hex2rgb › for object › null › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "TypeError"</span></span>
<span class="line"><span>    Error message: "Cannot read property 'replace' of null"</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ● DarkenColor › in TypeScript › hex2rgb › for object › undefined › does not fail</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    expect(received).not.toThrow()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error name:    "TypeError"</span></span>
<span class="line"><span>    Error message: "Cannot read property 'replace' of undefined"</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="elm-1">Elm</h3>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Detected problems in 1 module.</span></span>
<span class="line"><span>-- TYPE MISMATCH ------------------------------------------- src/DarkenColor.elm</span></span>
<span class="line"><span></span></span>
<span class="line"><span>The 1st argument to `hex2rgb` is not what I expect:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>24| main = hex2rgb -12</span></span>
<span class="line"><span>                   ^^^</span></span>
<span class="line"><span>This argument is a number of type:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    number</span></span>
<span class="line"><span></span></span>
<span class="line"><span>But `hex2rgb` needs the 1st argument to be:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    String</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Hint: Try using String.fromInt to convert it to a string?</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="bundle-size">Bundle size</h2>
<table>
  <thead>
    <tr>
      <th>Tool</th>
      <th>Bundle size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>F#</td>
      <td>40K</td>
    </tr>
    <tr>
      <td>PureScript</td>
      <td>174K</td>
    </tr>
    <tr>
      <td>ReScript</td>
      <td>22K</td>
    </tr>
    <tr>
      <td>ScalaJS</td>
      <td>197K</td>
    </tr>
    <tr>
      <td>TypeScript</td>
      <td>1.4K</td>
    </tr>
    <tr>
      <td>Elm</td>
      <td>n/a</td>
    </tr>
  </tbody>
</table>
<img src="/images/strongly-typed-front-end/chart1.png" loading="lazy" alt="Bundle size comparison"> </div>  </article> </section> </main> <footer> <nav> <div class="prev"> <a href="/page2.html" class="next">&larr; Previous page</a> </div> <div class="current">Page #3 of 11</div> <div class="next"> <a href="/page4.html" class="next">Next page &rarr;</a> </div> </nav> </footer> </body></html>