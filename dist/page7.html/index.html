<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/page7.html/"><!-- Primary Meta Tags --><title>moofoo blog</title><meta name="title" content="moofoo blog"><meta name="description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main> <section> <article> <h1> <a href="/2015/12/16/2015-12-16-finishing-the-first-scene.html">Irrlicht Newton GD tutorial: finishing the first scene</a> </h1> <time datetime="2015-12-16T08:00:00.000Z"> Dec 16, 2015 </time> <div class="content"> <p>If you remember, we ended our coding excercises at place, where we almost created our first
Newtonian body, but we did not actually have enough models.</p>
<p>We discussed collision shapes a bit. So let’s create one for our brand new model!</p>
<p>We have a nice ramp to work with. But how we can reconstruct the same shape in the
terms of Newton? Newton offers a set of collision shapes for us:</p>
<ul>
<li>
<p>Sphere</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/sphere.webp" loading="lazy" alt="Sphere" class="img-responsive">
</li>
<li>
<p>Box</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/box.webp" loading="lazy" alt="Box" class="img-responsive">
</li>
<li>
<p>Cone</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/cone.webp" loading="lazy" alt="Cone" class="img-responsive">
</li>
<li>
<p>Capsule</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/capsule.webp" loading="lazy" alt="Capsule" class="img-responsive">
</li>
<li>
<p>Cylinder</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/cylinder.webp" loading="lazy" alt="Cylinder" class="img-responsive">
</li>
<li>
<p>Chamfer Cylinder</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/chamfer_cylinder.webp" loading="lazy" alt="Chamfer Cylinder" class="img-responsive">
</li>
<li>
<p>Convex Hull</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/convex_hull.webp" loading="lazy" alt="Convex Hull" class="img-responsive">
</li>
<li>
<p>Trimesh</p>
  <img src="/images/irrlicht-newton-tutorials/collision_shapes/trimesh.webp" loading="lazy" alt="Trimesh" class="img-responsive">
</li>
</ul>
<p>Obviously, not sphere, cone, capsule, nor cylinder make sense for us.
We could use box shape, but then we simply ignore our inner faces (inside walls):</p>
<img src="/images/irrlicht-newton-tutorials/collision_shapes/ramp_box.webp" loading="lazy" alt="Box collision shape for our ramp" class="img-responsive">
<p>A bit better, but still the same situation with convex hull shape:</p>
<img src="/images/irrlicht-newton-tutorials/collision_shapes/ramp_convex.webp" loading="lazy" alt="Convex hull collision shape for our ramp" class="img-responsive">
<p>Generally, the way we create our Newtonian body is:</p>
<ol>
<li>create collision shape</li>
<li>create blank Newtonian body</li>
<li>set body properties like collision shape, mass, inertia parameters, etc.</li>
<li>store the pointer to the graphical entity for that body in the <code>userData</code> property</li>
</ol>
<p>And then Newton Game Dynamics will take your body into account when processing other objects
in the <code>NewtonWorld</code>.</p>
<!--more-->
<h2 id="tree-mesh-collision-shape">Tree mesh collision shape</h2>
<p>So we gonna use the triangle mesh shape. What we gonna do is loop through all the triangles
of our mesh and build its copy, but in the world of <em>“physic”</em> bodies.</p>
<p>To loop through all the triangles, we need to take each 3 edges of our mesh and the corresponding
vertices <em>(because each edge is represented by two its vertices - their indexes in the list
of vertices)</em> and create Newtonian triangle. Irrlicht stores vertices in one of three formats:</p>
<ol>
<li>plain vertex, represented by its three coordinates; the <code>irr::video::S3DVertex</code> class in Irrlicht</li>
<li>vertex with texture coordinates; <code>irr::video::S3DVertex2TCoords</code> class</li>
<li>vertex with its tangent information; <code>irr::video::S3DVertexTangents</code> class</li>
</ol>
<p>All those are represented by <code>irr::video::S3DVertex</code> class or its children. Moreover, we do not
need nothing but the information on vertex’ coordinates in our case, so we may use only the
base class’ properties.</p>
<p>The code, creating trimesh collision shape is quite simple and straightforward:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createTrimeshShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IMeshBuffer</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">meshBuffer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">NewtonCollision</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">treeCollision</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                                     irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#E36209;--shiki-dark:#FFAB70"> scale</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df vArray[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::S3DVertex </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mb_vertices </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::S3DVertex </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) meshBuffer-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getVertices</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    u16 </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mb_indices </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> meshBuffer-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getIndices</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">unsigned</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> j </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; j </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> meshBuffer-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getIndexCount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(); j </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v1i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mb_indices[j </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v2i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mb_indices[j </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v3i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mb_indices[j </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        vArray[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mb_vertices[v1i].Pos </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scale.X;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        vArray[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mb_vertices[v2i].Pos </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scale.Y;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        vArray[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mb_vertices[v3i].Pos </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scale.Z;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        NewtonTreeCollisionAddFace</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(treeCollision, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">vArray[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].X, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>We take the edges <em>(indices)</em>, find their vertices, create a triangle - and we’re done!
You may have noticed, we do not actually create the collision shape here - we take it as
an argument for our function. You will see why this is done that way in a moment.</p>
<p>Now it’s body’s turn! But we need to extend our <code>Entity</code> class with the <code>NewtonBody</code>
field so that we can seamlesly integrate it to our engine:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Entity</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mNode;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewtonBody </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mBody;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Entity</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">mNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node), </span><span style="color:#6F42C1;--shiki-dark:#B392F0">mBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    Entity</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">NewtonBody</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) : </span><span style="color:#6F42C1;--shiki-dark:#B392F0">mNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node), </span><span style="color:#6F42C1;--shiki-dark:#B392F0">mBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body) { }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mNode;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBody</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mBody;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">NewtonBody</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        mBody </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> body;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>And now we are ready to set our <code>NewtonBody</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createMeshBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Entity </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">entity </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entities[name];</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IMeshSceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IMeshSceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) entity-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewtonCollision </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonCreateTreeCollision</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonTreeCollisionBeginBuild</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IMesh </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mesh </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getMesh</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">unsigned</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mesh-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getMeshBufferCount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(); i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IMeshBuffer </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mb </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mesh-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getMeshBuffer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(i);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        createTrimeshShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(mb, shape, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getScale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonTreeCollisionEndBuild</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mass </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dMatrix origin;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonCollisionGetMatrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewtonBody </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">body </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonCreateDynamicBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld, shape, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dVector inertia;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonConvexCollisionCalculateInertialMatrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">inertia[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetMassMatrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, mass, mass </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inertia.m_x, mass </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inertia.m_y, mass </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inertia.m_z);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetCentreOfMass</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonDestroyCollision</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetTransformCallback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, transformCallback);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetForceAndTorqueCallback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, applyForceAndTorqueCallback);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetUserData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, entity);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonInvalidateCache</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    entity-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>There is an interesting piece here, though: we used recursion to create collision shape…
But if you remember, we did not create collision shape with our <code>createTrimeshShape</code> method -
all we do in that method is that we add new triangles to the existing shape. That’s because meshes
in Irrlicht are stored as a tree structure - they may have sub-meshes, which are still
parts of the whole mesh. And they can have their sub-meshes too. So we created a blank
collision shape and fill it with new parts of the mesh.</p>
<p>Doing it that way prevents us from overcomplicating the task and building a composite mesh,
made of a set of trimeshes. That would be really hard to calculate in real-time! And our
really simple scene would work with the speed of 5x5 battle in Unreal Tournament 3…</p>
<p>Looking back to our list, we should now fill out all the fields for our <code>NewtonBody</code>. And since
we are making the static model, we will set its mass to zero. This is enough for Newton to
treat our body as the static one. I placed the other code to show the other fields, we need
to fill in case we have a “usual” body.</p>
<p>So the other fields of <code>NewtonBody</code> are:</p>
<ol>
<li><code>massMatrix</code>, which determines how the mass is spread along the body</li>
<li><code>transformCallback</code> and <code>forceAndTorqueCallback</code> are two mandatory fields, required by Newton</li>
<li><code>userData</code>, which will hold the pointer to the whole entity</li>
</ol>
<p><code>massMatrix</code> could be calculated automatically from the collision shape, like in our case.
Without digging much into details, we will simply set it so the mass of our body is distributed
uniformely.</p>
<p><code>transformCallback</code> is the function, which will be called for our body each time it changes its
position due to the interaction with other bodies inside <code>NewtonWorld</code>.</p>
<p><code>forceAndTorqueCallback</code> is the function, which applies forces and torques to our body. This is
a bit tricky, but you need to keep track of each force and torque by yourself and then apply
them in a way that they summ up and create the final force, influencing the body. We will
talk about it later, when we will deal with impulses.</p>
<p>So, the <code>transformCallback</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">static</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> transformCallback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonBody</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dFloat</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">matrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> threadIndex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Entity </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">entity </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (Entity </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#6F42C1;--shiki-dark:#B392F0">NewtonBodyGetUserData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entity-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::matrix4 transform;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    transform.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setM</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(matrix);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(transform.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTranslation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(transform.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotationDegrees</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Nothing tricky here.</p>
<p>To put everything in place, let’s add a sphere to our scene. The process is totally same,
except of the collision shape creation - in case of primitives like box, sphere or cylinder,
it is much more easy than with trimeshes - you do not need to loop through any indices or
vertices - just set shape params like dimensions or radius. And body creation process is
totally same.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createSphereNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> textureFile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addSphereSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (node) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(textureFile.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialFlag</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EMF_LIGHTING, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    entities[name] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Entity</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">NewtonCollision</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createSphereCollisionShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dQuaternion </span><span style="color:#6F42C1;--shiki-dark:#B392F0">q</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().X, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Y, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Z, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dVector </span><span style="color:#6F42C1;--shiki-dark:#B392F0">v</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().X, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Y, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Z);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dMatrix </span><span style="color:#6F42C1;--shiki-dark:#B392F0">origin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(q, v);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shapeId </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonCreateSphere</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld, radius, shapeId, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createSphereBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> mass</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Entity </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">entity </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entities[name];</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entity-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dQuaternion </span><span style="color:#6F42C1;--shiki-dark:#B392F0">q</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().X, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Y, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Z, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dVector </span><span style="color:#6F42C1;--shiki-dark:#B392F0">v</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().X, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Y, node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Z);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dMatrix </span><span style="color:#6F42C1;--shiki-dark:#B392F0">origin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(q, v);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shapeId </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewtonCollision </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonCreateSphere</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld, radius, shapeId, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dMatrix origin;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonCollisionGetMatrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewtonBody </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">body </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonCreateDynamicBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld, shape, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dVector inertia;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonConvexCollisionCalculateInertialMatrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">inertia[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetMassMatrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, mass, mass </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inertia.m_x, mass </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inertia.m_y, mass </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inertia.m_z);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetCentreOfMass</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">origin[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonDestroyCollision</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetTransformCallback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, transformCallback);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetForceAndTorqueCallback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, applyForceAndTorqueCallback);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetUserData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, entity);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonInvalidateCache</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    entity-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Have no fear about code duplication - we will remove it later. When you are done, you should
get picture like this one:</p>
<img src="/images/irrlicht-newton-tutorials/collision_shapes/ramp_with_ball.webp" loading="lazy" alt="First completed dynamic scene" class="img-responsive">
<p>Congrats! That’s our first completed dynamic scene!</p> </div>  </article><article> <h1> <a href="/2015/12/16/2015-12-15-making-simple-level-with-blender.html">Irrlicht Newton GD tutorial: making simple level with Blender</a> </h1> <time datetime="2015-12-15T17:06:00.000Z"> Dec 16, 2015 </time> <div class="content"> <p>In this section we will have short but powerful introduction to Blender. We will cover
just enough of model creation basics, you will need to create most of simple projects.</p>
<p>No, we will not cover animation, shaders or modificators here, but just enough minimum
to create this ramp floor for our tutorial:</p>
<img src="/images/irrlicht-newton-tutorials/blender/ramp_render.webp" loading="lazy" alt="The desired result" class="img-responsive">
<p>You will find lot of keyboard shortcuts here. And this is one of the most awesome
features of Blender - you can work without menus or panels! Everything you need
can be done with keyboard!</p>
<p>So let’s dive in Blender now!</p>
<!--more-->
<h2 id="welcome-to-belnder">Welcome to Belnder</h2>
<p>When you open Blender, you will see some pretty image, made with Belnder, version information,
some useful links and recent files</p>
<img src="/images/irrlicht-newton-tutorials/blender/0.webp" loading="lazy" alt="Blender" class="img-responsive">
<p>To close this window, simply click outside it. You will then see your workspace with the
<code>Default</code> window layout <em>(we will learn about them later)</em>. Workspace contains a few kickstarting
items:</p>
<ul>
<li>camera</li>
<li>light</li>
<li>cube</li>
</ul>
<img src="/images/irrlicht-newton-tutorials/blender/1.webp" loading="lazy" alt="Workspace" class="img-responsive">
<p>You may be confused of the last one, but you will see shortly that so many cool things could
be done starting with plain cube and modifying it. Oh, and about modifying: let’s switch to
the <strong>Edit mode</strong>, hitting the <kbd>Tab</kbd> key:</p>
<img src="/images/irrlicht-newton-tutorials/blender/2.webp" loading="lazy" alt="Edit mode" class="img-responsive">
<p>You can exit it hitting <kbd>Tab</kbd> again. In the <strong>edit mode</strong> you can manipulate mesh’
<strong>edges</strong>, <strong>vertices</strong> or <strong>faces</strong>. To switch between these, use three buttons on the screen’s
bottom:</p>
<img src="/images/irrlicht-newton-tutorials/blender/3.webp" loading="lazy" alt="Switching between edges, faces and vertices in edit mode" class="img-responsive">
<p>Let’s choose the <strong>faces</strong> editing mode. Unlike other 3D editors, in Blender selection is done
with the <strong>Right mouse button</strong>. Select one face of the cube:</p>
<img src="/images/irrlicht-newton-tutorials/blender/4.webp" loading="lazy" alt="Selecting items in blender" class="img-responsive">
<p>You may have noticed that the axis arrows have moved in the selected face’s place.
These are used to manipulate selected elements. Also, they show the orientation of the selected
element. You can move the selected element by simply dragging one of the arrows. Selected
element will be moved along the selected axis only:</p>
<img src="/images/irrlicht-newton-tutorials/blender/5.webp" loading="lazy" alt="Moving selected elements" class="img-responsive">
<p>The same operation, movement, could be performed hitting the <kbd>G</kbd> key. You can move other
elements, too - this will change the form of our cube:</p>
<img src="/images/irrlicht-newton-tutorials/blender/6.webp" loading="lazy" alt="Moving edges" class="img-responsive">
<p>Now let’s try something more complex. See the <strong>Tools</strong> panel on your left?</p>
<img src="/images/irrlicht-newton-tutorials/blender/7.webp" loading="lazy" alt="Tools panel" class="img-responsive">
<p>Select a face in a face editing mode and click <strong>Extrude</strong> (or hit the <kbd>E</kbd> key). Your face
will be extruded and you will be able to move it freely. But usually, designers move elements along
some axis - this makes models more accurate. To fix the movement axis, just hit its letter while being
in the extruding mode - <kbd>X</kbd>, <kbd>Y</kbd> or <kbd>Z</kbd>:</p>
<img src="/images/irrlicht-newton-tutorials/blender/8.webp" loading="lazy" alt="Extruding faces" class="img-responsive">
<p>Interesting fact: you may extrude both vertices and edges too.</p>
<p>Now, let’s use even more advanced operation, which is oftenly described later in tutorials on
3D modelling. Choose the <strong>Loop cut and slice</strong> operation from the <strong>Tools</strong> panel - you will
see nothing. <em>Until</em> you move your cursor over your model. Depending on the edge, cursor is closer
to, you will see purple rectangle, looping through your model:</p>
<img src="/images/irrlicht-newton-tutorials/blender/9.webp" loading="lazy" alt="Loop cut" class="img-responsive">
<p>When you click the <strong>Left mouse button</strong>, you will move to the next part of this operation -
<em>slicing</em>. Just place the new edges where you want:</p>
<img src="/images/irrlicht-newton-tutorials/blender/10.webp" loading="lazy" alt="Slicing the loop cut" class="img-responsive">
<p>Now let’s create walls for our “ramp”. Create a few loop cuts alongside the ramp and we will start
extruding:</p>
<img src="/images/irrlicht-newton-tutorials/blender/12.webp" loading="lazy" alt="Extruding one wall" class="img-responsive">
<p>Or maybe just moving faces?..</p>
<img src="/images/irrlicht-newton-tutorials/blender/13.webp" loading="lazy" alt="Moving vs extruding" class="img-responsive">
<p>No, that’s definitely not what we want! We want walls, not a new ramp! Hmmm… But if we will
extrude walls one-by-one, it will be inaccurate… Hold the <kbd>Shift</kbd> key and
<strong>right-click</strong> the two neighbour walls:</p>
<img src="/images/irrlicht-newton-tutorials/blender/14.webp" loading="lazy" alt="Multiple selection" class="img-responsive">
<p>Now we will work with three elements in the same way. Hit the <kbd>E</kbd> key and then - <kbd>Z</kbd>
and extrude all three walls at the same time up:</p>
<img src="/images/irrlicht-newton-tutorials/blender/15.webp" loading="lazy" alt="Simultaneous extrusion" class="img-responsive">
<p>Now we need two more walls to prevent our hero <em>(the ball, if you recall from the previous part)</em>
from falling aside. Select two edges at the corner of our ramp and hit the <kbd>W</kbd> key. You
will see the context menu like this:</p>
<img src="/images/irrlicht-newton-tutorials/blender/16.webp" loading="lazy" alt="Editing context menu" class="img-responsive">
<p>Click the <strong>Subdivide</strong> item, and the selected edges will be connected right in the middle:</p>
<img src="/images/irrlicht-newton-tutorials/blender/17.webp" loading="lazy" alt="Subdivision for two edges" class="img-responsive">
<p>You can perform that operation on faces - that is oftenly handy. Now, if you undo your changes with
usual <kbd>Ctrl</kbd>+<kbd>Z</kbd> (or <kbd>Command</kbd>+<kbd>Z</kbd> on Mac) and try to perform
the same operation on four opposite edges, you will see there is a redundant <em>(in our case)</em>
edge:</p>
<img src="/images/irrlicht-newton-tutorials/blender/18.webp" loading="lazy" alt="4-th subdivision" class="img-responsive">
<p>You can remove it by selecting that edge, hitting <kbd>X</kbd> and selecting <strong>Dissolve edges</strong>.
If you choose the <strong>Delete edge</strong> - you will loose the neighbour faces, which were made of that
edge.</p>
<img src="/images/irrlicht-newton-tutorials/blender/19.webp" loading="lazy" alt="Delete or dissolve?" class="img-responsive">
<p>So in the end we need to have two edges on the same line:</p>
<img src="/images/irrlicht-newton-tutorials/blender/20.webp" loading="lazy" alt="The needed edges" class="img-responsive">
<p>Now, switch to the <strong>Ortho View</strong>, choosing one from the <strong>View</strong> menu at the bottom of the
screen, or hitting the <kbd>Num 5</kbd> key:</p>
<img src="/images/irrlicht-newton-tutorials/blender/21.webp" loading="lazy" alt="View menu" class="img-responsive">
<p>Your workspace now should look different:</p>
<img src="/images/irrlicht-newton-tutorials/blender/22.webp" loading="lazy" alt="Ortho view" class="img-responsive">
<p>Using the <strong>View</strong> menu, you may switch between different views, perpendicular to your model.</p>
<img src="/images/irrlicht-newton-tutorials/blender/23.webp" loading="lazy" alt="Top view" class="img-responsive">
<img src="/images/irrlicht-newton-tutorials/blender/24.webp" loading="lazy" alt="Right view" class="img-responsive">
<p>Switching between different views will not clear the selection. And this is awesome!
So if you try to move the selected edges in the <strong>Right Ortho View</strong>, you will move
both of them:</p>
<img src="/images/irrlicht-newton-tutorials/blender/25.webp" loading="lazy" alt="Selection persistence" class="img-responsive">
<p>Yeeks… They move just along the Y axis, but not along the edge. But Blender easily handles
that - you need to switch between coordinate system using the corresponding menu
at the bottom of your screen:</p>
<img src="/images/irrlicht-newton-tutorials/blender/26.webp" loading="lazy" alt="Coordinate system" class="img-responsive">
<p>Use the <strong>Normal</strong> one and you will see the arrows at the selected edges changed:</p>
<img src="/images/irrlicht-newton-tutorials/blender/27.webp" loading="lazy" alt="Normal coordinate system" class="img-responsive">
<p>Now movement is done along the edge, just as we need:</p>
<img src="/images/irrlicht-newton-tutorials/blender/28.webp" loading="lazy" alt="Moving with Normal coordinate system" class="img-responsive">
<p>Try <strong>moving</strong> <em>(yes, moving, not extruding)</em> our edges up - they will move along the normal:</p>
<img src="/images/irrlicht-newton-tutorials/blender/30.webp" loading="lazy" alt="Moving edges in Right Ortho view" class="img-responsive">
<p>But if you <strong>click the mouse wheel</strong> and <strong>rotate camera</strong>, or even if you switch to the
<strong>Top Ortho</strong> view, you will notice that our walls have different width:</p>
<img src="/images/irrlicht-newton-tutorials/blender/31.webp" loading="lazy" alt="Whoops..." class="img-responsive">
<p>So we need to make one wall thinner. But we should not forget about other edges - ones,
which will make another wall for us. Undoing now is not an option… We need to move the edges.
But if you move only those visible at the <strong>Top Ortho</strong> view, you will forget about the ones
at the bottom and screw the model. And selecting all those edges one-by-one is not an option
too…</p>
<img src="/images/irrlicht-newton-tutorials/blender/32.webp" loading="lazy" alt="Selecting many edges manually is a pain..." class="img-responsive">
<p>Moreover, we do not see those edges at the bottom! This is easy to fix, though: see the small
button with rectangles near the <strong>vertex/edge/face</strong> switcher?</p>
<img src="/images/irrlicht-newton-tutorials/blender/33.webp" loading="lazy" alt="&#x27;Limit selection to visible&#x27; switcher" class="img-responsive">
<p>Click it and you will be able to select bottom edges without the need to rotate the camera.
And now we will try the circle-selection tool, which will come to help you when you need to
select many elements at a time. Hit the <kbd>C</kbd> key and you will see the circle in a
workspace. Try dragging it (<strong>left-click the mouse and drag</strong>) over the edges we need:</p>
<img src="/images/irrlicht-newton-tutorials/blender/35.webp" loading="lazy" alt="Circle selection" class="img-responsive">
<p>Hmmm… It’s way too much… Now, hold the <kbd>Shift</kbd> key and drag the circle over
the neighbour, redundant ones:</p>
<img src="/images/irrlicht-newton-tutorials/blender/36.webp" loading="lazy" alt="Unselecting elements" class="img-responsive">
<p>Now we can switch back to the <strong>Top Ortho View</strong> and successfully move our edges:</p>
<img src="/images/irrlicht-newton-tutorials/blender/37.webp" loading="lazy" alt="Making walls thinner" class="img-responsive">
<p>Now that we have our walls precisely set up, we can extrude the last two walls.
Select the <strong>Normal coordinate system</strong> and perform the extrusion along the Z axis:</p>
<img src="/images/irrlicht-newton-tutorials/blender/40.webp" loading="lazy" alt="Extruding last two walls" class="img-responsive">
<p>Now we will scale our model a few times. Staying in the <strong>Edit mode</strong>, select all the faces with
the <kbd>A</kbd> key:</p>
<img src="/images/irrlicht-newton-tutorials/blender/42.webp" loading="lazy" alt="Selecting everything" class="img-responsive">
<p>And hit the <kbd>S</kbd> key and start entering scale factor number. That’s right, just press,
say, <kbd>5</kbd>:</p>
<img src="/images/irrlicht-newton-tutorials/blender/41.webp" loading="lazy" alt="Entering factor while scaling" class="img-responsive">
<p>You can correct what you entered using the <kbd>Backspace</kbd> key. You can do the same
thing while moving or rotating elements. This is useful when you need to
make operation really precise. But you still can use your mouse, of course.</p>
<p><strong>Hint:</strong> if you scaled your model outside the <strong>Edit mode</strong>, you may find your scale, translation
or rotation different from identity values (<code>1, 1, 1</code> for scale or <code>0, 0, 0</code> for position/rotation).
This may cause different bugs while exporting models. To fix this, you need to select your
model in the <strong>Object mode</strong>, hit the <kbd>Ctrl</kbd>+<kbd>A</kbd> and select <strong>Apply Scale</strong>
<em>(or whatever you need to fix)</em> from the pop-up menu.</p>
<img src="/images/irrlicht-newton-tutorials/blender/44.webp" loading="lazy" alt="Applying scale" class="img-responsive">
<h2 id="texturing-our-model">Texturing our model</h2>
<p>Now we need to paint our model to have something more beautiful in our application than just
pitch black… stuff…</p>
<p>Adding textures to a model in Blender is extremely easy - you just select your model, switch to
the <strong>Texture</strong> tab on the right panel and click <strong>New</strong> button:</p>
<img src="/images/irrlicht-newton-tutorials/blender/47.webp" loading="lazy" alt="Creating a texture" class="img-responsive">
<p>Then you pass in some params like texture size, the background color and image name - and you are done!</p>
<img src="/images/irrlicht-newton-tutorials/blender/48.webp" loading="lazy" alt="New texture params" class="img-responsive">
<p>But that will only add a <strong>blank</strong> texture. And then you will need to paint it as you wish.
But painting a texture requires your model to have vertices, synchronized with your texture.
So each vertex will know where it lays both in 3D space and on the texture image. This
assignment process is called <strong>Texture unwrapping</strong> or <strong>UV mapping</strong> <em>(because texture
coordinates are usually called <code>u</code> and <code>v</code> instead of <code>x</code> and <code>y</code>, since those are already
involved to describe vertex’ position)</em>. And this process requires one thing from you: you
need to specify, where Blender should “cut” your model. This is quite simple task, but this
will result on how the texture will look like and how easy it will be to paint.</p>
<p>So, go to the <strong>Edit mode</strong> and select a few loops of edges:</p>
<img src="/images/irrlicht-newton-tutorials/blender/50.webp" loading="lazy" alt="Selecting seam edges" class="img-responsive">
<img src="/images/irrlicht-newton-tutorials/blender/51.webp" loading="lazy" alt="Selecting seam edges" class="img-responsive">
<p>Now, on the left panel, switch to the <strong>Shading/UVs</strong> tab and click the <strong>Mark Seam</strong> button:</p>
<img src="/images/irrlicht-newton-tutorials/blender/49.webp" loading="lazy" alt="Shading/UVs tab" class="img-responsive">
<p>This will mark the selected edges as seams to “cut” your model along. Have no fear, your model
will not be actually cut - it will be used for maths only.</p>
<p>Then, on the same panel click the <strong>Unwrap</strong> button and select the first unwrapping method on
the list:</p>
<img src="/images/irrlicht-newton-tutorials/blender/53.webp" loading="lazy" alt="Unwrapping method" class="img-responsive">
<p>Again, no effect you will see now. To see something, switch the window layout at the top menu to
<strong>UV Editing</strong>:</p>
<img src="/images/irrlicht-newton-tutorials/blender/54.webp" loading="lazy" alt="Layout switcher" class="img-responsive">
<img src="/images/irrlicht-newton-tutorials/blender/55.webp" loading="lazy" alt="Layouts available" class="img-responsive">
<p>You will see two windows - on your left there will be <strong>UV/image editor</strong> and on your right
there will be the <strong>3D view</strong>. And again, nothing interesting here… But I am not fooling
with you - it’s only how Blender works… To see something marvelous, select everything on
the <strong>3D view</strong>:</p>
<img src="/images/irrlicht-newton-tutorials/blender/58.webp" loading="lazy" alt="UV-Mapped model" class="img-responsive">
<p>You will see some lines on your left. That’s what you have selected, mapped onto image plane.
But there is no actual image in the <strong>UV/Image editor</strong> for now. To add one, just click the
<strong>New</strong> button on the bottom menu of the <strong>UV/Image editor</strong> or select an existing one:</p>
<img src="/images/irrlicht-newton-tutorials/blender/60.webp" loading="lazy" alt="Selecting background image for UV mapping" class="img-responsive">
<p>This will not change the image itself. The image will be the background for our image editor
window, nothing more. To start making miracles, go to the <strong>Texture Paint mode</strong> in the
<strong>3D view</strong>:</p>
<img src="/images/irrlicht-newton-tutorials/blender/61.webp" loading="lazy" alt="Texture Paint mode" class="img-responsive">
<p>And your model will change its look…</p>
<img src="/images/irrlicht-newton-tutorials/blender/62.webp" loading="lazy" alt="Pinky!" class="img-responsive">
<p>What is this pink monster?! Well, on the left panel of our <strong>3D View</strong> there’s a message,
saying the texture slot is missing and proposing to create one… Let’s do this…</p>
<img src="/images/irrlicht-newton-tutorials/blender/63.webp" loading="lazy" alt="Texture slot creation" class="img-responsive">
<p>Now we are able to paint our model! See, how awesome it is: you have a brush tool activated.
Brush has three params:</p>
<ol>
<li><strong>Color</strong> - this could be changed with the color circle below</li>
<li><strong>Radius</strong></li>
<li><strong>Pressure</strong>, or <strong>Alpha</strong></li>
</ol>
<p>Radius could be changed by pressing the <kbd>F</kbd> key and moving mouse cursor:</p>
<img src="/images/irrlicht-newton-tutorials/blender/64.webp" loading="lazy" alt="Brush radius changing" class="img-responsive">
<p>Pressure could be changed by pressing <kbd>Shift</kbd>+<kbd>F</kbd> and doing the same:</p>
<img src="/images/irrlicht-newton-tutorials/blender/65.webp" loading="lazy" alt="Brush pressure changing" class="img-responsive">
<p>And you can just pain like in… Microsoft Paint!</p>
<img src="/images/irrlicht-newton-tutorials/blender/66.webp" loading="lazy" alt="Just paint!!!" class="img-responsive">
<p>But if you look into the <strong>UV/Image editor</strong>, you will see… nothing! Again! ‘the hell?!</p>
<img src="/images/irrlicht-newton-tutorials/blender/67.webp" loading="lazy" alt="WTF?!" class="img-responsive">
<p>That is just misunderstanging - you were painting on the other image instead of the selected one:</p>
<img src="/images/irrlicht-newton-tutorials/blender/68.webp" loading="lazy" alt="Choosing image for UV/Image editor" class="img-responsive">
<p>We created a new one, when created a texture slot…</p>
<p>To start drawing in the <strong>UV/Image editor</strong> instead of <strong>3D View</strong>, you just need to switch
its mode to <strong>Paint</strong> at the bottom menu:</p>
<img src="/images/irrlicht-newton-tutorials/blender/71.webp" loading="lazy" alt="Painting in the UV/Image editor" class="img-responsive">
<p>Okay, so far so good. We are able to paint our model. But there’s one interesting thing: if
you try to draw a straight line - you may face situation, when line is straight in the image
but is curved on the model:</p>
<img src="/images/irrlicht-newton-tutorials/blender/72.webp" loading="lazy" alt="UV mapping mistakes" class="img-responsive">
<img src="/images/irrlicht-newton-tutorials/blender/74.webp" loading="lazy" alt="UV mapping mistakes" class="img-responsive">
<p>But that’s happening not everywhere - only on certain faces/edges:</p>
<img src="/images/irrlicht-newton-tutorials/blender/75.webp" loading="lazy" alt="Mistakes are only on certain faces" class="img-responsive">
<p>Well, that’s because of UV mapping is not precise enough. If you switch to the <strong>View mode</strong>
in the <strong>UV/Image editor</strong> and to the <strong>Edit mode</strong> in the <strong>3D View</strong>, and select all the model,
you will see the points in the image editor, you may drag:</p>
<img src="/images/irrlicht-newton-tutorials/blender/76.webp" loading="lazy" alt="Control points in the image editor" class="img-responsive">
<p>Try selecting them with <strong>Right mouse button</strong> and moving them with <kbd>G</kbd>:</p>
<img src="/images/irrlicht-newton-tutorials/blender/77.webp" loading="lazy" alt="Selecting control points" class="img-responsive">
<img src="/images/irrlicht-newton-tutorials/blender/78.webp" loading="lazy" alt="Moving control points" class="img-responsive">
<p>Yes, now texture looks creepy, but lines are almost straight:</p>
<img src="/images/irrlicht-newton-tutorials/blender/79.webp" loading="lazy" alt="Fixing UV mapping errors manually" class="img-responsive">
<img src="/images/irrlicht-newton-tutorials/blender/80.webp" loading="lazy" alt="Fixing UV mapping errors manually" class="img-responsive">
<h2 id="exporting-our-model">Exporting our model</h2>
<p>When you finish painting your texture, the last thing we need to do is to export our model
to the format, understandable by Irrlicht. For good, both Blender and Irrlicht support
many different formats:</p>
<img src="/images/irrlicht-newton-tutorials/blender/83.webp" loading="lazy" alt="Blender exporting" class="img-responsive">
<p>Blender’s file dialogs look differently, but have very intuitive interface:</p>
<img src="/images/irrlicht-newton-tutorials/blender/90.webp" loading="lazy" alt="Blender file dialog" class="img-responsive">
<p>If you do not see the needed format in Blender - you just need to turn on a corresponding plugin:</p>
<img src="/images/irrlicht-newton-tutorials/blender/95.webp" loading="lazy" alt="Blender settings menu" class="img-responsive">
<img src="/images/irrlicht-newton-tutorials/blender/96.webp" loading="lazy" alt="Blender settings menu" class="img-responsive">
<p>After exporting our model to, say, <strong>3DS</strong> format, take a look at the directory you have exported
your model to:</p>
<img src="/images/irrlicht-newton-tutorials/blender/88.webp" loading="lazy" alt="No textures!" class="img-responsive">
<p>Where are the textures? Relax, they are in the <strong>UV/Image editor</strong>, yet unsaved. You can
save the modified image with the <strong>Image -> Save</strong> menu at the bottom of <strong>UV/Image Editor</strong>:</p>
<img src="/images/irrlicht-newton-tutorials/blender/89.webp" loading="lazy" alt="Saving image from UV/Image Editor" class="img-responsive">
<p>Now we have everything we need for our Newtonian sample!</p>
<p><a href="/irrlicht-newton-tutorials/2015/12/16/finishing-the-first-scene.html" class="btn btn-success">Next chapter</a></p> </div>  </article><article> <h1> <a href="/2015/11/27/2015-11-26-end-to-end-testing-with-webdriverio.html">End-to-end testing with WebdriverIO</a> </h1> <time datetime="2015-11-26T16:03:39.000Z"> Nov 27, 2015 </time> <div class="content"> <h2 id="small-intro">Small intro</h2>
<p>Have you ever heard about end-to-end testing? Or maybe about testing automation?
Those of you who had, may now be imaging Selenium. That’s right, in most of cases
you will need to run <em>Selenium Server</em> and use <em>Selenium Webdriver</em> in your
tests. Those come handy to run a standalone browser window, with no caches,
filled-in fields or cookies and perform some operations in it.</p>
<p>In this article I will tell you my story of writing E2E tests for Angular webapp.</p>
<h2 id="a-brief-of-history">A brief of history</h2>
<p>In my case, we first tried to use <em>Protractor</em> with <em>Chai.js</em>. That time we ended
up with almost unsupportable bunch of code, succeeding in 100% of runs.</p>
<p>Next time we eliminated <em>Chai</em> and reworked all our tests to use <em>Protractor</em> only.
So the code became more clear <em>(I did not like the syntax, but it worked…)</em>,
but after upgrading libraries <em>(including Protractor)</em>, the ratio of successfull
test runs decreased to just 40%.</p>
<p>We worked for two days, trying to fix those tests. And that’s how <em>webdriverio</em>
came to our project.</p>
<p>And here’s a short tutorial on how to implement E2E tests with <em>webdriverio</em> in
a sample project.</p>
<!--more-->
<h2 id="the-requirements">The requirements</h2>
<p>Before we start, we need to initialize an NPM project:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span></span>
<span class="line"></span></code></pre>
<p>We barely want to manage Selenium versions by ourselves. When it comes to
continuous integration, that is not an option. So we’d better find a way of
downloading the needed Selenium version automatically. And writing a short
script is somehow a bad idea - there is an NPM module for that task already:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> selenium-standalone</span></span>
<span class="line"></span></code></pre>
<p>After installing that module, you may manage and run your Selenium with</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">./node_modules/selenium-standalone/bin/selenium-standalone</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">./node_modules/selenium-standalone/bin/selenium-standalone</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> start</span></span>
<span class="line"></span></code></pre>
<p>Now, in all our tests we will be using using <em>Jasmine</em>, since it allows to
create a beautiful code, which is easy to support (if you need the maximum
help from your customer - consider using <em>Cucumber</em> and BDD approach - I will
cover this topic in one of my future posts). So we need to add Jasmine
dependency to our project:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> jasmine</span></span>
<span class="line"></span></code></pre>
<p>To initialize bare Jasmine-ready project you may use Jasmine itself:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">./node_modules/jasmine/bin/jasmine.js</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span></span>
<span class="line"></span></code></pre>
<p>This will create this directory structure for you:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>.</span></span>
<span class="line"><span>├── package.json</span></span>
<span class="line"><span>└── spec</span></span>
<span class="line"><span>    ├── helpers</span></span>
<span class="line"><span>    └── support</span></span>
<span class="line"><span>        ├── config.json</span></span>
<span class="line"><span>        └── jasmine.json</span></span>
<span class="line"><span></span></span></code></pre>
<p>So now you may place your tests in the <code>spec</code> directory, on any level. Just
remember to name your test files with the <code>spec</code> postfix
(for ex. <code>spec/feature1_spec.js</code> or <code>tests/spec/Feature1spec.js</code>).
To change that lowercase <code>spec</code> postfix, specify which files Jasmine should
look for in the <code>spec/support/jasmine.json</code> file, using the option <code>spec_files</code>.
For example, you can make it look for both <code>*_spec</code> and <code>*Spec</code> (underscore and
camel case file naming) postfixes:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "spec_dir"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"spec"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "spec_files"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "features/**/*[sS]pec.js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "**/*_spec.js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "**/*_Spec.js"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>The <code>spec_dir</code> option specifies the directory, where the test files are located.
And the <code>spec_files</code> option is what we are mostly interested in: it tells Jasmine
the pattern, it should use to check if a file (inside the <code>#{spec_dir}</code> directory)
is a test file or not. For example, the first value, <code>"features/**/*[sS]pec.js"</code>,
tells that any file, whose path is <code>spec/features/{any directory nesting depth}/*Spec.js</code>
as well as any file with a path <code>spec/features/{any directory nesting depth}/*spec.js</code> is a
file, containing a test definition.</p>
<p>The last, but not least, we need the <em>webdriverio</em> itself:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> webdriverio</span></span>
<span class="line"></span></code></pre>
<p>And now we are ready to make some code!</p>
<h2 id="preparation">Preparation</h2>
<p>First of all, we need to initialize the Selenium client.
Generally speaking, it’s a special browser instance, which will be used for
our tests only and when all the tests are done - it will be closed automatically.
This browser (or a client) provides a programmable interface, e.g. executes commands
we ask it to execute. The commands allow, for example, to manipulate the currently opened document
(just like you used to do with javascript in the developer tools in your browser) -
find an element, click it, retrieve its computed styles, etc. It also allows to manipulate
the browser window itself - open a new tab, get and set its properties like width, height, position
and many others.</p>
<p>So we really need that client for our tests - that’s the core! And we need that to run all our
tests (we don’t want to run a new browser instance for each separate test case, right?). So we
can put all the code, initializing Selenium client in a helper script and make Jasmine run it
before all (again, <strong>not each, but all</strong> - I’ll explain why this is essential in a moment) tests.
Let’s define this in the <code>spec/helpers/settings.js</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> webdriverio </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'webdriverio'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timeout </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> config </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">  "desiredCapabilities"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "browserName"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"chrome"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "host"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"localhost"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "port"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">9876</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">  "baseUrl"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"http://localhost"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">jasmine.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DEFAULT_TIMEOUT_INTERVAL</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timeout;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">beforeAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">done</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.client </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> webdriverio</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">remote</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(config)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(done);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">afterAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">done</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.client.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(done);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.webdriverio </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> webdriverio;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.config </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> config;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.timeout </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timeout;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.baseUrl </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> config.baseUrl;</span></span>
<span class="line"></span></code></pre>
<p>This code does three simple, but really important things:</p>
<ol>
<li>it sets up the <em>webdriverio</em> (which is an enhanced wrapper for Selenium client)
<strong>for all the tests</strong>, opens browser <em>(configured by the <code>browserName</code> option)</em> window
and navigates to the page, defined in the <code>baseUrl</code> option</li>
<li>makes Jasmine wait a bit longer for each assertion in the tests, before marking it as
<strong>failed on timeout</strong> <em>(when Jasmine has timed out, waiting for an assertion)</em></li>
<li>makes <em>webdriverio</em> client instance available in any test through the <code>this.client</code> member
(where <code>this</code> means the test instance)</li>
</ol>
<p>See, this code is run once, previous to <strong>all</strong> the tests, found by Jasmine. This is defined
by the <code>beforeAll()</code> call. We could use the <code>beforeEach()</code> function instead, but since opening
a new browser (Selenium client) instance is a time-consuming task, it’s better to do it once
and then just operate on an existing instance, opening new tabs when necessary. Thus is why
we are using <code>beforeAll()</code> for all the tests <em>in the scope</em>.</p>
<p>Here I’ve mentioned another essential thing, <em>the test scope</em>. Test scope is the current set of tests.
It could be defined by the <code>describe("description", function () { /* test code */ })</code> function call.
But since we have no <code>describe()</code> calls before the <code>beforeAll</code> and <code>afterAll</code> calls, Jasmine
assumes we want to use those functions for all the known tests. But if you use the <code>beforeAll</code> inside
the <code>describe()</code> block, then this function (<code>beforeAll()</code>) will be run before all the tests,
<em>defined inside that <code>describe()</code> block</em>.</p>
<h2 id="first-scenario">First scenario</h2>
<p>Assume our application is a simple webshop - it has three pages: <code>/#/products</code>, <code>/#/billing-details</code>
and <code>/#/order-summary</code>. Rather simple webshop:</p>
<img src="/images/e2e-testing-with-webdriverio/webshop1.webp" loading="lazy" alt="">
<img src="/images/e2e-testing-with-webdriverio/webshop2.webp" loading="lazy" alt="">
<img src="/images/e2e-testing-with-webdriverio/webshop3.webp" loading="lazy" alt="">
<p>And here is our first scenario: user selects the iPhone, clicks <em>“Buy”</em>, fills in
his billing details and waits for his brand-new iPhone to come.</p>
<p>In terms of BDD it could be described in a scenario like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="gherkin"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">Feature</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> Placing an order</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    Scenario</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> Ordering a single product</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        Given </span><span style="color:#24292E;--shiki-dark:#E1E4E8">a webshop page</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            And </span><span style="color:#24292E;--shiki-dark:#E1E4E8">a guest user</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        When </span><span style="color:#24292E;--shiki-dark:#E1E4E8">the user selects the </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"iPhone"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> product</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            And </span><span style="color:#24292E;--shiki-dark:#E1E4E8">clicks the </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Buy"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> button</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            And </span><span style="color:#24292E;--shiki-dark:#E1E4E8">fills out the billing details correctly</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            And </span><span style="color:#24292E;--shiki-dark:#E1E4E8">clicks the </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Submit"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> button</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        Then </span><span style="color:#24292E;--shiki-dark:#E1E4E8">the </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Billing successfull"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> page is shown</span></span>
<span class="line"></span></code></pre>
<p>This scenario is great for the customer. And it’s awesome if the customer
is able to provide developer(-s) with a number of such scenarios.
But our test will be more kind of “developer-friendly”.</p>
<p>Let’s create a <code>specs/ordering_a_single_product_spec.js</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> settings </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'../helpers/settings.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'buying iPhone'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'when user selects iPhone'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'he gets redirected to the billing-details page'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">done</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.client</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">waitForExist</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.title*=iPhone 6 White'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, settings.timeout)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.title*=iPhone 6 White'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'..'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">click</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button*=Buy'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">waitForExist</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button*=Check out'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, settings.timeout)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">err</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">res</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(res.value).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toMatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#22863A;font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold">\/</span><span style="color:#032F62;--shiki-dark:#DBEDFF">#</span><span style="color:#22863A;font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold">\/</span><span style="color:#032F62;--shiki-dark:#DBEDFF">billing-details</span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(done);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>Let’s run our test: first, start your webserver to handle the webshop; then run a
Selenium instance and at last, start <code>./node_modules/jasmine/bin/jasmine.js</code>.</p>
<p>In this test case we do the following things:</p>
<ol>
<li>wait untill all the products are loaded (<code>waitForExist('.title*=iPhone 6 White', settings.timeout)</code>)</li>
<li>select parent element for <em>iPhone 6 White</em> product (<code>element('.title*=iPhone 6 White').element('..')</code>)</li>
<li>click on the <em>Buy</em> button within that product’ container (<code>click('button*=Buy')</code>)</li>
<li>wait until the <em>Create account</em> button is shown, signalizing we have been redirected to the next page</li>
<li>get page’ URL and make an assertion to check if we have been redirected to the correct page</li>
</ol>
<p>When we have done everything we need in our test case, we call the <code>done</code> callback to notify Jasmine
we have finished our test. This is how asynchronous tests are made in Jasmine - you define the test
with <code>it(...)</code>, providing it with a callback. And when you finish all the asynchronous things in your
test, you just call that callback so Jasmine could switch to the next test.</p>
<p>What’s interesting, Jasmine runs test in the order they are defined. So you may assume that everything
you did in previous test cases defines your current state. For example, after our test case, namely
<em>‘when user selects iPhone he gets redirected to the billing-details page’</em>, we stay on the page
we finished shortly.</p>
<p>Given that, we will not add additional checks or <code>waitForExist()</code>s to get to the next steps.</p>
<h2 id="dealing-with-forms">Dealing with forms</h2>
<p>The next step is filling out billing details:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'when user provides his billing details'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'he gets redirected to the order-summary page'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">done</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> billing </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            firstName: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Test'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            lastName: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'User'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'United Kingdom'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            city: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'London'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            address: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'221B, Baker Street'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            zipCode: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'12345'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            phone: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'9998882245'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.client</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'[name="firstName"]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, billing.firstName)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'[name="lastName"]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, billing.lastName)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'[name="address"]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, billing.address)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'[name="country"]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, billing.country)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'[name="city"]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, billing.city)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'[name="zipCode"]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, billing.zipCode)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'[name="phone"]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, billing.phone)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">click</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button*=Check out'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">waitForExist</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'h2*=Order summary'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, settings.timeout)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">err</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(url.value).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toMatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#22863A;font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold">\/</span><span style="color:#032F62;--shiki-dark:#DBEDFF">#</span><span style="color:#22863A;font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold">\/</span><span style="color:#032F62;--shiki-dark:#DBEDFF">order-summary</span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(done);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>The new thing here is how we fill out input fields with <em>webdriverio</em> - using the <code>setValue()</code> method.</p>
<h2 id="advanced-element-lookup">Advanced element lookup</h2>
<p>The last page we need to check is <code>order-summary</code>. Here we want to check if the order total
is exactly the same, as our iPhone’ price. But this is where things got tricky: we have two
different rows with the same value. How do we check if we are looking at the correct one?</p>
<p>We will use <em>XPath</em> to get to the correct element:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">describe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'order summary page'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    it</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'contains correct order total'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">done</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.client</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isVisible</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'//div[contains(@class, "row") and contains(., "iPhone 6 White") and contains(., "$450.00") and ancestor-or-self::div[@ng-repeat]]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">visibility</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(visibility).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isVisible</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'//div[contains(@class, "row") and descendant::div[contains(., "Total:")] and contains(., "$300.00") and not(contains(@class, "ng-scope"))]'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">visibility</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(visibility).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toBe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(done);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>Seems complicated, doesn’t it?.. But it’s not that hard. We used XPath instead of usual selectors
to find the element needed. And here’s how one could read it:</p>
<p>say, we have this XPath: <code>//div[contains(@class, "row") and contains(., "iPhone 6 White") and contains(., "$450.00") and ancestor-or-self::div[@ng-repeat]]</code>.</p>
<p>This could be split into three parts:</p>
<ol>
<li>path to the element, <code>//</code> - it tells browser’s engine to look for this element everywhere,
independently on its parent</li>
<li>element tag, <code>div</code>; it could be <em>“any”</em> selector, <code>*</code>, but we precised our search</li>
<li>element attributes’ matchers, or everything in square brackets</li>
</ol>
<p>Let’s take a closer look on those - they are really interesting ones:</p>
<ol>
<li>first we have <code>contains(@class, "row")</code>; it tells engine to look for an element, whose <code>class</code>
attribute contains <em>(or “partially matches” if you wish)</em> <code>row</code> string</li>
<li>now we have <code>contains(., "iPhone 6 White")</code>; it looks for text content inside tag; including its
children</li>
<li>speaking of children, we’ve also got a parent matcher, <code>ancestor-or-self::div[@ng-repeat]</code>, which
looks for <code>&#x3C;div></code> element with <code>ng-repeat</code> attribute in the current element or any of its parents</li>
<li>you may noticed a concatenation of all those matchers with <code>and</code> keyword</li>
</ol>
<h2 id="wrapping-up">Wrapping up</h2>
<p>So that was a really short example on how to use Jasmine, webdriverio and how to create end-to-end tests.
As promised, I will cover the BDD testing and Cucumber in some of my future posts.</p>
<h2 id="references">References</h2>
<p>Try reading more on XPath on <a href="http://www.w3schools.com/xsl/xpath_intro.asp">w3schools</a>.</p>
<p>Webdriverio API you may find <a href="http://webdriver.io/api.html">on its docs page</a>.</p>
<p>Webshop application, used in this article is <a href="https://github.com/shybovycha/e2e-webshop">available on GitHub</a>.</p> </div>  </article><article> <h1> <a href="/2015/010/17/2015-10-16-loooong-tasks-with-clojure.html">Loooong lists with Clojure</a> </h1> <time datetime="2015-10-16T17:11:39.000Z"> Oct 17, 2015 </time> <div class="content"> <h2 id="whaaaaat">Whaaaaat?</h2>
<p>These days I was given a reeeeally interesting homework at the university. I was given a set of
MD5 hashes, calculated from single words <em>(taken from Libre Office’ dictionaries)</em> with a given
sault. And the task was to find all those words.</p>
<p>So, the first idea which came to my mind was using an internet service for MD5 breaking. But…
aaarrrggghhh! There’s a sault, so the webservice, looking for words over a dictionary fails to
find mines…</p>
<p>So the second idea was to take that dictionary from Libre Office and iterate through it. At the
end, it worked =) And worked reeeally fast. But that is not an interesting part.</p>
<p>I wandered if I could find those words in my dictionary, generated by my own code.</p>
<!--more-->
<h2 id="hoooow">Hoooow?</h2>
<p>I was thinking of writing it functionally. Really functionally, in Clojure. And, highly motivated
by how good Clojure is at parallelism <em>(sarcasm?..)</em>, I started thinking. After many tries and
even installing Clojure REPL on my phone and writing code all the way home from university and work,
I asked my dear friend to help me with this.</p>
<p>And so we went non-functional way first… We wrote a Java class, having two methods for generating
words recursively. The idea was, to make a new word by appending it with each letter, then appending
each of the alphabet’ letters to this word and so on, until we get all the words of <code>N</code> characters.</p>
<img src="/images/looong-tasks-with-clojure/collaborative-java.webp" loading="lazy" class="img-responsive" style="max-height: 150px">
<p>When our pretty class was created and working <em>(for some cases)</em>, we decided to do it more
Java-correct and created two more classes, implementing a single interface, doing the same thing
but differently each. And decided to skip writing <code>context.xml</code> and going deeper with Spring =)</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> java.util.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> java.util.stream.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IWordGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">final</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MooWordGenerator</span><span style="color:#D73A49;--shiki-dark:#F97583"> implements</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IWordGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // Best practices in naming convention =)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /** not necessary */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MooWordGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> completeWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">final</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">Character</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#E36209;--shiki-dark:#FFAB70">cs</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#E36209;--shiki-dark:#FFAB70">words</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (length </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            String word </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stream</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Object</span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8">toString).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">collect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Collectors.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">joining</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()); </span><span style="color:#6A737D;--shiki-dark:#6A737D">// what the fuuck???</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            words.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(word);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'a'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; c </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'z'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; c</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">Character</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> ncs </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ArrayList&#x3C;>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ncs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">addAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(cs);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ncs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(c);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            completeWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(length </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, ncs, words);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    @</span><span style="color:#D73A49;--shiki-dark:#F97583">Override</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">final</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> words </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ArrayList&#x3C;>();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">Character</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> cs </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ArrayList&#x3C;>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        completeWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(length, cs, words);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> words;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> FooWordGenerator</span><span style="color:#D73A49;--shiki-dark:#F97583"> implements</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IWordGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /** */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> StringBuilder sb;</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /** */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> words;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /**</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * Creates list of strings containing all possible words with given length.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * </span><span style="color:#D73A49;--shiki-dark:#F97583">@param</span><span style="color:#E36209;--shiki-dark:#FFAB70"> length</span><span style="color:#6A737D;--shiki-dark:#6A737D"> - the length of words to generate.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * </span><span style="color:#D73A49;--shiki-dark:#F97583">@return</span><span style="color:#6A737D;--shiki-dark:#6A737D"> List&#x3C;String> words.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     */</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    @</span><span style="color:#D73A49;--shiki-dark:#F97583">Override</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">final</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> allWords </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getAllWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(length);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        sb </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        words </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> allWords;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /**</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * Creates list of strings containing all possible words with given length.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * Possible to run this method ONLY ONCE! Next calls will</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * give the wrong result.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * </span><span style="color:#D73A49;--shiki-dark:#F97583">@param</span><span style="color:#E36209;--shiki-dark:#FFAB70"> length</span><span style="color:#6A737D;--shiki-dark:#6A737D"> - the length of words to generate.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * </span><span style="color:#D73A49;--shiki-dark:#F97583">@return</span><span style="color:#6A737D;--shiki-dark:#6A737D"> List&#x3C;String> words.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">getAllWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">final</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'a'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; c </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'c'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; c</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { </span><span style="color:#6A737D;--shiki-dark:#6A737D">//doesn't work</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            getSB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(c);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> length) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                getAllWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(length);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                getWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            getSB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">deleteCharAt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /**</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * Get string builder. create new if null.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * </span><span style="color:#D73A49;--shiki-dark:#F97583">@return</span><span style="color:#6A737D;--shiki-dark:#6A737D"> sb.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> StringBuilder </span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSB</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (sb </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            sb </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> StringBuilder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sb;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /**</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * Get words array. create new if null.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     * </span><span style="color:#D73A49;--shiki-dark:#F97583">@return</span><span style="color:#6A737D;--shiki-dark:#6A737D"> words.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">     */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> List&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">getWords</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (words </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            words </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ArrayList&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> words;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#D73A49;--shiki-dark:#F97583"> static</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[] </span><span style="color:#E36209;--shiki-dark:#FFAB70">args</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        /** D: go smoke</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">         *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">         *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">         *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">         *</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">         **/</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        IWordGenerator gen1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MooWordGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        IWordGenerator gen2 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> FooWordGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        System.out.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Moo:"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        gen1.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stream</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(System.out</span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8">println);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        System.out.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Foo:"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        gen1.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stream</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(System.out</span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8">println);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>The solution was made. It worked reaaaally loooooong for words with six letters. I decided to start
working on Clojure implementation of this idea. I started writing a function, generating a list of
words. <em>Word</em> in this code was represented by a list of numbers from 0 to 25, associated with
corresponding letters of latin alphabet. That allowed me not to bore myself with generating a
list of chars and use a built-in Clojure’ <code>range</code> function.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> gen-words</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [len cs]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> len)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        cs</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gen-words</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dec</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> len) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">conj</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cs %)) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">range</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 26</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))</span></span>
<span class="line"></span></code></pre>
<p>But ended up with the same results as for Java on six letters. Moreover, my implementation
gave me strangely-nested list, which caused writing special flattening functions; Clojure’s
<code>flatten</code> gave me a plain list, where all the words were merged with others.</p>
<p>I needed performance boost!</p>
<p>I tried using <code>pmap</code> instead of <code>map</code> to parallelize the list generation process, but that
did not helped. I also tried generating a list of <code>future</code> objects, so each list element will be
calculated only when needed:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> gen-words</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [len cs]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> len)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        cs</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">future</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gen-words</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dec</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> len) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">conj</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cs %))) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">range</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 26</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))</span></span>
<span class="line"></span></code></pre>
<p>But that caused my futures never to be finished. And then my collegue reminded me I can create
a function, which will only rely on a previously generated word and will return the next one,
not a list of words. <em>“That might save me lot of memory!”</em>, I thought and started coding.</p>
<p>And finished with this pretty implementation:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> next-word</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [prev-word]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            l (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop-while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">partial</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) prev-word)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            l-size (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">count</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> prev-word) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">count</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> l))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            zeroes (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">repeat</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> l-size </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            new-head (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">inc</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">first</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> l))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            new-tail (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rest</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> l)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">concat</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> zeroes [new-head] new-tail)))</span></span>
<span class="line"></span></code></pre>
<p>See, in this implementation no word is being saved nowhere except the return value or an
input argument <em>(well, actually the output from a function is then being used as an input
for itself)</em>.</p>
<p>I converted all the word representations into words with this over-complicated function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> word-to-str</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [w] (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">clojure.string/join</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> \a) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> %))) w)))</span></span>
<span class="line"></span></code></pre>
<p>And then I created a function, generating a list of those words.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> words</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ([n] (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">words</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">repeat</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ([n w]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [str-w (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">word-to-str</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> w)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">every?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">partial</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) w)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [str-w]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">lazy-seq</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">cons</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str-w (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">words</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">next-word</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> w))))))))</span></span>
<span class="line"></span></code></pre>
<p>Yeah, again! But not a plain list or vector, as previously, nooo. I generated a lazy-sequence!
This is where Clojure meets ES6 generators =) See, lazy sequence in Clojure is a <em>(possibly)</em> endless
collection, each element of which could be evaluated <em>(or assigned a value)</em> when it is
needed. Besides that, collection takes almost no memory and its creation costs almost
no time. Saying <em>almost</em> I mean the time, needed to construct and store an object in memory.
Just a simple, plain class’ instance.</p>
<p>But that was not an option - it took nearly <code>45 minutes</code> to find all the 6-letter words even
when using <code>pmap</code> and eaten SO much damn memory!..</p>
<img class="img-responsive" style="max-height: 150px" src="/images/looong-tasks-with-clojure/mem-consumption-1.webp">
<p>However, idle REPL eats much memory too:</p>
<img class="img-responsive" style="max-height: 150px" src="/images/looong-tasks-with-clojure/idle-repl-memory.webp">
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> seq-contains?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [coll target]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">some</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> target %) coll))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> decode-1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [n]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ ws (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">seq-contains?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input-hashes (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">encode</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> %)) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">words</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)) ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pmap</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [w] [w (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">encode</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> w)]) ws)))</span></span>
<span class="line"></span></code></pre>
<p>Then I enhanced this implementation eliminating the <code>lazy-seq</code> completely. So, there was no
collection creation at all! All the results were printed onto screen right away when found.
This could be replaced with any other storage - file, database, anything! Printing results
on the screen is a habit from my student years…</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> decode-2</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ([n] (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">decode-2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">repeat</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ([n prev-word]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                prev-word-str (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">word-to-str</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> prev-word)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">seq-contains?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input-hashes (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">encode</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> prev-word-str))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">encode</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> prev-word-str) prev-word-str)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">every?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">partial</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) prev-word)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                nil</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                (</span><span style="color:#D73A49;--shiki-dark:#F97583">recur</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">next-word</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> prev-word))))))</span></span>
<span class="line"></span></code></pre>
<p>The memory consumption got minimal:</p>
<img class="img-responsive" style="max-height: 150px" src="/images/looong-tasks-with-clojure/mem-consumption-2.webp">
<p>And the time consumption was not <strong>that</strong> good, though…</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">task1.core=> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">time</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">decode-2</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">adbc43d3e1b432aea5e657cd57016de rampa</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">bba60169d41b2dce7d0b37b2f9d637e0 kolej</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">7914</span><span style="color:#24292E;--shiki-dark:#E1E4E8">da949837cbdecf35cbf5951ad518 argon</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">"Elapsed time: 92879.138203 msecs"</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span></span>
<span class="line"></span></code></pre>
<p>Running it from non-REPL environment helped a bit:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">╰─$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> lein</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> run</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">4adbc43d3e1b432aea5e657cd57016de</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> rampa</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">bba60169d41b2dce7d0b37b2f9d637e0</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> kolej</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">7914da949837cbdecf35cbf5951ad518</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> argon</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">"Elapsed time: 73796.575567 msecs"</span></span>
<span class="line"></span></code></pre>
<h2 id="profit">Profit?</h2>
<p><em>But where’s the Saint Graal for brute-forcing like that? How to speed that algorithm?</em>
I don’t know, actually =) Well, I know how to do it with <em>OpenMP</em>, I have a couple of
ideas on how this task could be distributed, but those desire a separate article.</p> </div>  </article><article> <h1> <a href="/2015/010/05/2015-10-05-custom-logging-with-timbre.html">Custom logging with timbre</a> </h1> <time datetime="2015-10-04T14:00:00.000Z"> Oct 5, 2015 </time> <div class="content"> <h2 id="timbre">Timbre?</h2>
<p>At my job we recently started researching logging tools to make our RESTful API, written in Clojure,
writing logs in JSON format. We were using <strong>Log4j</strong> already, but decided to use another tool for
this task, making it less painful. So we felt into <strong>timbre</strong>. Is seemed so easy to use, but it is
really undocumented.</p>
<p>According to timbre’s API, we needed to define our own <strong>appender</strong> for writing to a custom JSON file.
And we found the <code>output-fn</code> option to configure this behaviour. But it is not documented at all,
so we started looking for repositories, using timbre, examples and all the stuff. And finally,
we ended up with our own solution.</p>
<p>Underneath you will find description of our way to use timbre from scratch.</p>
<!--more-->
<h2 id="getting-started">Getting started</h2>
<p>First of all, you will need a <strong>Leiningen</strong> project. We already have one, but you may want to create
a blank one for the test purpose. But beware, you’d better generate it from an <code>app</code> template, so
when you run it with <code>lein run</code>, you face not the problem I faced. The problem was an error I could
not get rid of, saying <code>Cannot find anything to run for: my-ns</code>. So I just re-generated project from
scratch and the problem gone. <em>I did no research deeper, but if I will, I’ll write about it for sure</em>.</p>
<p>Generating project from an <code>app</code> template is done really easily:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">lein</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> new</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> app</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> your-app-name</span></span>
<span class="line"></span></code></pre>
<p>The process will be finished in seconds. Then you’ll need to add a few dependencies in your <code>project.clj</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defproject</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> your-app-name</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; ...</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    :dependencies</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [[org.clojure/clojure </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"1.6.0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 [com.taoensso/timbre </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"4.1.4"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 [org.clojure/data.json </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"0.2.6"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>To install dependencies for your project, simply run <code>lein deps</code>.</p>
<h2 id="configuring-timbre">Configuring timbre</h2>
<p>To use timbre in your project all you need is to require it:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">ns</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timbre-test1.core</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:require</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [taoensso.timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:refer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info warn debug error)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [clojure.data.json </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json]))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:some-complicated-hash</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:inner-hash</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:more-inner</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"value1"</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "value2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]}}})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Hello, World!"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">error</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "SOMETHING WENT WELL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span></code></pre>
<p>This example shows one very important feature of timbre: <strong>it can log objects, other than strings and
exceptions</strong>. This is really handy! Doing so, timbre is able to log a JSON object simply, almost
out-of-the-box.</p>
<h2 id="custom-configuration">Custom configuration</h2>
<p>Now the time has come for something non-trivial. We need to set up our own appender to force timbre
log everything in JSON.</p>
<p>There is a set of default appenders in timbre already. For instance, there is a <code>spit</code> appender,
writing logs to a file. And the default timbre’s appender, writing logs to <code>stdout</code>, is called
<code>sample</code>. But there’s a trick: each appender in timbre should be configured by its <strong>id</strong>, not
by its <strong>type</strong>. So you may have two different <code>spit</code> appenders, for example, writing to different
files.</p>
<p>Timbre provides two methods of configuration:</p>
<ul>
<li><strong>merging</strong>, when you can override only some options of default config</li>
<li><strong>setting</strong>, when you override all the default options at once</li>
</ul>
<p>We used the first way, because some of timbre’s options were mystical to us - if we do not set them,
we will get no output at all. And we have not researched which ones we need to set.</p>
<p>At first, we wrote a simple config, forcing logging to be printed onto a screen with some JSON
formatting:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">ns</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timbre-test1.core</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:require</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [taoensso.timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:refer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info warn debug error)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [clojure.data.json </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json]))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> json-output-fn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:keys</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [vargs_ hostname_ timestamp_ level] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> args}]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [msg] { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:timestamp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> @timestamp_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :level</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     level</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :hostname</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  @hostname_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">   msg })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                   @vargs_)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        json-messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">json/write-str</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> %) messages)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">clojure.string/join</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-messages)))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timbre/merge-config!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:appenders</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                    :output-fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-output-fn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 }}})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Note the appender id: <code>println</code>. This code overrides <code>output-fn</code> for <code>println</code> appender <em>(e. g. the
default one)</em>. The parameter for <code>output-fn</code> is a function, receiving a map with different keys. The
most important ones are <code>vargs_</code>, <code>hostname_</code>, <code>timestamp_</code> and <code>level</code>. Those are enough to format
the correct and full message with any format you might want.</p>
<p>The <code>vargs_</code> variable contains all the arguments, passed to a logging call <em>(<code>info</code>, <code>warn</code>, <code>error</code> -
any function from <code>timbre</code> namespace, which performs logging)</em>. And the <code>clojure.data.json/write-str</code>
function converts its params to JSON and stringifies it, returning valid JSON as a string.</p>
<p>A function should return a string, representing a message, which will be written to a screen or a file,
depending on appender.</p>
<p><code>level</code> argument is set by a macro, you are logging with. For example, <code>timbre/info</code> will set
<code>level</code> to <code>"info"</code>, <code>timbre/error</code> - to <code>"error"</code> and so on.</p>
<p><code>hostname_</code> and <code>timestamp_</code> are helper arguments, you might not need them in all the use cases.
But the <code>timestamp_</code> one is really helpful. Always.</p>
<p>Then we overrided the default file appender, extending it with our <code>json-output-fn</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">ns</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timbre-test1.core</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:require</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [taoensso.timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:refer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info warn debug error)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [taoensso.timbre.appenders.core </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> appenders]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [clojure.data.json </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json]))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> json-output-fn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:keys</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [vargs_ hostname_ timestamp_ level] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> args}]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [msg] {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:timestamp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> @timestamp_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :level</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     level</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :hostname</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  @hostname_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">   msg})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                   @vargs_)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        json-messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">json/write-str</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> %) messages)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">clojure.string/join</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-messages)))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timbre/merge-config!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:appenders</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :spit</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">merge</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">appenders/spit-appender</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:fname</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "timbre.log"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}) {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:output-fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-output-fn})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 }})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Nothing new here, except of the appender used - now the application will log to both file and screen.
To prevent logging to <code>stdout</code>, we disabled the <code>println</code> appender:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timbre/merge-config!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:appenders</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:enabled?</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :spit</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">merge</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">appenders/spit-appender</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:fname</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "timbre.log"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}) {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:output-fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-output-fn})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 }})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Here I should mention that we were not made to call our JSON appender <code>spit</code> - it was used for convention
reasons only.</p>
<p>And that’s basically it - we made our logging to be written to a JSON file only.</p> </div>  </article><article> <h1> <a href="/2015/09/21/2015-09-20-two-sides-of-web-application-part-1.html">Two sides of web application. Part 1: the tools</a> </h1> <time datetime="2015-09-20T19:18:39.000Z"> Sep 21, 2015 </time> <div class="content"> <div class="row" style="justify-content: space-between">
  <div class="col-md-6 col-xs-12">
    <div class="card">
      <div class="card-header">
        Article series
      </div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          <a href="/2015/09/20/two-sides-of-web-application-part-1.html">
            Part 1: The Tools
          </a>
        </li>
        <li class="list-group-item">
          <a href="/2016/02/11/two-sides-of-web-application-part-2.html">
            Part 2: Sketching
          </a>
        </li>
        <li class="list-group-item">
          <a href="/2016/02/11/two-sides-of-web-application-part-3.html">
            Part 3: Communication Layer
          </a>
        </li>
      </ul>
    </div>
  </div>
  <div class="col-md-6 col-xs-12 text-xs-center text-md-right">
    <img src="/images/two-sides-of-web-application/chocolate_tools.webp" class="img-responsive" style="max-height: 150px">
  </div>
</div>
<h2 id="prologue">Prologue</h2>
<p>How do we usually create a web application? We run a bootstrapping script, which provides us with a skeleton of our application and then we just extend it with the features we need.</p>
<p>That’s exactly what we did at the last hackathon we were attending - we started with <code>rails new twf</code> and spent half of the day integrating our blank app with Angular, Paperclip, creating API methods and so on. But the effort we needed to accomplish our goal (quite a simple web app) was really huge.</p>
<p>So I decided to find the best combination of backend and frontend technologies that would cause less pain.</p>
<p>At the project I was recently introduced to, the line between frontend and backend is distinguished very clearly: we have an API, written in Clojure and thin frontend application, made with Angular that works on a generated set of static assets - HTMLs, CSS and JS files <em>(but under the hood we are using HAML and SCSS)</em>.</p>
<p>The application I will be implementing throughout the whole article has the same architecture: it has RESTful API and MVVM on the frontend, made with Angular. I welcome you to the journey of research and new technologies!</p>
<!--more-->
<h2 id="why-not-go-with-rails">Why not go with Rails?</h2>
<p>Because Rails is often overused. Especially if you install all of frontend libraries
<em>(like Angular, Bootstrap, some Angular plugins, etc.)</em> as RubyGems. Frontend should stay
on the front end of the application; you should not lock your application at some precise
version of the JS script, provided by a gem and rely on author’s way to integrate it with
Rails.</p>
<p>In our case, Rails is too heavy - when all you need is database + routing + a couple of
lightweight controllers, all Rails’ features will become a ballast to our app, which
must be small, by design.</p>
<h2 id="the-goal">The goal</h2>
<p>Before we start, let’s think of what we’ll be creating. Will it be a web shop? Or a blog?
No, we need something outstanding! Something we’ve done never before…</p>
<p>After an hour of imaging what it may be, I decided to go with web analytics tool. A prototype,
which will be able to tell how many visitors your web application gained recently.</p>
<p>It shouldn’t be too complicated, because, you know, it’s just a tutorial… So we’ll be
tracking users’ location and browser only. And we’ll be displaying those analytics as a chart
<em>(values like total visitors, browser usage)</em> and in a table <em>(the same info as the chart)</em>.</p>
<h2 id="architecture-preview">Architecture preview</h2>
<p>We will be developing our application with two layers (or two sides) - front-end and back-end:</p>
<div class="text-center">
    <img src="/images/two-sides-of-web-application/general_architecture.webp" loading="lazy" class="img-responsive">
</div>
<p>The front-end part is the one the user sees and uses - the web page, mobile or desktop application. The back-end part is the one, which does all the magic - prepares data for the front-end side to display, performs data operations as a reaction on user’s actions, etc. Thus we could easily replace either the back-end part or the front-end one or even both and replace them with all brand-new implementation. This architecture allows us to do that really easily.</p>
<h2 id="build-with-the-right-tools">Build with the right tools!</h2>
<p>Now, since we separated our frontend part of application from the backend part, we may use different preprocessing
languages to write stylesheets and views. And even controllers! So let’s take the most from 2015 and use the newest
tool set: <em>Jade</em>, <em>ES6+</em> and <em>SCSS</em>. And put them all together with <em>Bower</em> and <em>Gulp</em>.</p>
<p>All those Jade, SCSS and ES6 are not supported by a browser out-of-the box. They must be compiled to HTML, CSS and JS in order to be recognized by the browser. But they are here to help you writing code quickly. I listed some of their key features below.</p>
<h3 id="jade">Jade</h3>
<p>Jade is a template rendering engine with its own markup language. It is somewhat similar to Haml and Slim - it
nests XHTML nodes with indentation, closes tags automatically… But it is especially good at writing complex web
pages, consisting of <em>layouts</em> and <em>partials</em>.</p>
<p><em>Layouts</em> are big templates, containing placeholders, where
concrete partials will be placed. So, for example, you may create a separate layout for your webshop’ landing
page, account page and shopping cart. They will be different. And all of them will use different sets of partials.
But, for example, a footer and a quick shopping cart preview or user account widget (the one with a link to user’s
account page) will be the same. To prevent duplicating those widgets’ code on each of the layouts, we extract them
to separate files, called <em>partials</em> and then just make a reference (a placeholder) in our layouts, saying
<em>“place that partial’s content here”</em>.</p>
<p>In case of Jade, we may override or extend existing partials in a layout, without touching partial’s file itself.
So, for example, if we want to make user’s avatar to be shown in a user account widget only on a product page, we just override user widget partial on a product page, removing the part with the avatar.</p>
<h3 id="scss">SCSS</h3>
<p>SCSS is a way to simplify writing CSS. It is so simple, yet so powerful, that you will fall in love with it
after the first few stylesheets! See, in CSS when you write a long selector, specifying many parents, you may
find your stylesheets ugly and huge, when describing different children of one, deeply nested parent.</p>
<p>So, let’s say you are having a user widget. And it may be placed both on page’s header, footer and sidebar. But
the avatar image will look differently on each of those - it must be smaller in header and footer. So you
start writing selectors like <code>.sidebar .user-widget .avatar img</code> and <code>.header .user-widget .avatar img</code>.
That’s painful, but not that much, if you have just a couple of those. However, as your website grows, you
start getting really, really upset about that.</p>
<p>And here’s where SCSS is just a revelation: its great power is in its <em>selectors</em>, <em>variables</em> and <em>mixins</em>.</p>
<p><em>Selectors</em> allow you to describe selector’ nesting just as you’d be writing C code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scss"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.header</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // header styles</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .user-widget</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // header user-widget styles</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .avatar</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">            // maybe something differs in avatar itself?</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            img</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // ah! here's it!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><em>Variables</em> allow you to get rid of all those magic values. So if you use one color many times across your styles,
you just extract it into a named constant and use the pretty named value everywhere!</p>
<p><em>Mixins</em> allow even more: you may extract the parts of the styles into a named and even <strong>parametrized</strong> function!</p>
<p>Relating on all of those, you may re-write your user widget as follows:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scss"><code><span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">$header-avatar-size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">$sidebar-avatar-size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">150</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">@mixin</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> avatar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">$avatar_size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    max-width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#E36209;--shiki-dark:#FFAB70">$avatar_size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    max-height</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#E36209;--shiki-dark:#FFAB70">$avatar_size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.header</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .user-widget</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .avatar</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        @include</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> avatar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">$header-avatar-size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.sidebar</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .user-widget</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .avatar</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        @include</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> avatar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">$sidebar-avatar-size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h3 id="gulp">Gulp</h3>
<p>I found Gulp to be super-easy for tasks like compiling stylesheets, views and javascripts. But before
we continue with Gulp, let’s initialize an NPM project with <code>npm init</code> and install the plugins required:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> gulp</span></span>
<span class="line"></span></code></pre>
<p>And Gulp plugins:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save-dev</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> gulp</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> gulp-babel</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> gulp-scss</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> gulp-jade</span></span>
<span class="line"></span></code></pre>
<p>I will describe how Gulp works and how we can use it in our project in a minute. For now, let’s
just install the frontend dependencies.</p>
<h3 id="bower">Bower</h3>
<p>Let’s fix our frontend on specific versions of frontend libraries, so when we update the whole project, nothing gets broken. To make our development quick, we’ll use <em>Twitter Bootstrap</em>. All the frontend dependencies will be managed by a tool called <em>Bower</em>.</p>
<p>Bower is a tool like <code>npm</code>, but used strictly with frontend libraries like <em>jQuery</em>, <em>Angular</em>, <em>Twitter Bootstrap</em> and many others. It’s important to keep frontend libraries separate from the backend ones, so we can keep our backend application completely separate from frontend one.</p>
<p>Bower comes with a command-line tool, <code>bower</code>, which we’ll use to fill out the <code>bower.json</code> file. It is used by Bower to specify which libraries does our application require:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bower</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">bower</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> init</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">bower</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bootstrap</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> angular</span></span>
<span class="line"></span></code></pre>
<p>These commands create a directory <code>bower_components</code>, containing all the dependencies installed, each in its own sub-directory. With that in mind, we’ll be referencing our frontend dependencies, relatively to their catalogs within the <code>bower_components</code> directory.</p>
<p>Now let’s write a build task for Gulp. Gulp is a streamed build tool. That means, that each operation you perform, passes its result to another operation as the input argument. So, for example, if you run <code>gulp.src('src/styles/*.scss')</code>, it’ll return you an object with the list of all the SCSS files and the magic <code>pipe()</code> method. And when you call the <code>gulp.src(...).pipe(scss())</code>, Gulp will pass that list to the SCSS compiler plugin, so you will get a compiled CSS code. That is, not a CSS file itself, but a compressed, merged, CSS file’ content.</p>
<p>And that describes the second important feature of Gulp: it does not store the intermediate operation results. It is almost like a functional programming - you just have the input data. Then you call a chain of functions on it,
passing the result of one function call to the next function as its input. Same happens here, but in
a manner not that strict - since we are using Javascript, we can store the intermediate results in the memory. But to store
the results in the files, we should pass them to the <code>gulp.dest(...)</code> function. Depending on the function, looking
to store its results, <code>gulp.dest()</code> may point to a directory or a single file, where the results will be stored.</p>
<p>Below is our first Gulp task. Write this code in the <code>gulpfile.js</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gulp </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'gulp'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    sass </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'gulp-scss'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    babel </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'gulp-babel'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    jade </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'gulp-jade'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">task</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'build'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/views/**/*.jade'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">jade</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dest</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/javascripts/**/*.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">babel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dest</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/javascripts'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/stylesheets/**/*.scss'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sass</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ style: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'expanded'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dest</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/stylesheets'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>This tells Gulp to define <code>build</code> task, which compiles all the Jade, SCSS and ES6+ files into HTML, CSS
and JS files, correspondingly. Compiled files are placed within the <code>public/</code> directory, so we may
easily render them with almost any web-server. But first things first, we need to prepare directory structure
like this for our task:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____bower.json</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____gulpfile.js</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____package.json</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____public</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____src</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____javascripts</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____stylesheets</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0">____views</span></span>
<span class="line"></span></code></pre>
<p>This may seem odd to the paragraph, dedicated to build tools, but let’s check how our tasks work.
To do this, we need to write some test files to check our <code>build</code> task. So let’s create one of each kind:</p>
<p><em><code>src/views/index.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">lang</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"en"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">head</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    meta</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">charset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"UTF-8"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    title</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> OurStats</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    link</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"stylesheet"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/stylesheets/main.css"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    script</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text/javascript"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/javascripts/main.js"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">body</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    h1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Hello, world!</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/stylesheets/main.scss</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scss"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">h1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    border-bottom</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> solid</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> #dedede</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/javascripts/main.js</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timeout</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">ms</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Promise</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">res</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setTimeout</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(res, ms));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">async</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  await</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timeout</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  await</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timeout</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span></code></pre>
<p><a href="https://github.com/shybovycha/two-sides-of-web-application/tree/10f770a5ca64fad1cb6e58bc957e5210bc95bda3" class="btn btn-info">Full code of these steps</a></p>
<p>And to actually check our task, we need to run it with</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">gulp</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span></span>
<span class="line"></span></code></pre>
<p>Now, you may open the HTML generated from Jade in a browser, but it’ll look ugly, because your
browser will doubtfully find stylesheets and javascripts that easily. To make the magic happen, we
will use another Gulp plugin, <code>gulp-server-livereload</code>. Generally, the development process with
different build tools looks very similar nowadays: you set up the environment, find the plugins
you need, install and configure them - and violà!</p>
<p>I’ve chosen that server plugin because it comes with one handy feature: it automatically reloads
the opened pages in your web-browser if any of the files you are browsing has changed. Here’s
the code of our serving task:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">task</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'serve'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            livereload: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            directoryListing: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            open: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>But if you remember, we are compiling our sources from SCSS/Jade into the <code>public/</code> directory.
So how the server would know if anything changed in our <code>*.scss</code> or <code>*.jade</code> files? We need to
reload the page in web-browser if anything changes in those files. To do that, we’ll write one
more task, which will re-build our source files if anything changes:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">task</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'watch'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">watch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/**/*'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'build'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>Here we used two new features of Gulp: <em>watching for file changes</em> and <em>running existing tasks from another task</em>.
Simple? Yeah, <strong>that</strong> simple! So we just tell Gulp: <em>keep an eye on those files - if anything happens - run
those tasks immediately!</em> - and the magic happens.</p>
<p>But why should we run two tasks? Let’s merge them into one so we just run <code>gulp serve</code> and get both live reload
and live re-compilation:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">task</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'serve'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">watch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/**/*'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'build'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            port: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            livereload: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            directoryListing: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            open: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>This task first defines a watcher for our sources and then starts server, which will react to any changes
in the <code>public/</code> directory. To check how this awesomeness works, start <code>gulp serve</code>, open the
<a href="localhost:3000/test.html"><code>localhost:3000/test.html</code></a> page and then change, for example,
color for the <code>h1</code> tag to green. Save the SCSS file and just switch to the browser window, <strong>don’t reload
it manually</strong>.</p>
<p><a href="https://github.com/shybovycha/two-sides-of-web-application/tree/07f6cda21da377719861f41f89064a414e808268" class="btn btn-info">Full code of these steps</a></p> </div>  </article><article> <h1> <a href="/2015/09/16/2015-09-16-email-validation-regexp.html">Email validation regexp</a> </h1> <time datetime="2015-09-15T14:00:00.000Z"> Sep 16, 2015 </time> <div class="content"> <img src="/images/regex-compressed.webp" loading="lazy" class="img-responsive img-sm img-rounded pull-right">
<p>At my work we’ve lately been having a discussions on email validation. I recalled a post on
<a href="http://habrahabr.ru/post/55820/">habrahabr</a>, showing
different options, including <strong>effective</strong> and <strong>psycho</strong> solutions.</p>
<!--more-->
<p>From <a href="http://search.cpan.org/~pdwarren/Mail-RFC822-Address-0.3/Address.pm">CPAN</a>:</p>
<blockquote>
Mail::RFC822::Address: regexp-based address validation
<p>This regular expression will only validate addresses that have had any comments stripped and replaced with whitespace (this is done by the module).</p>
</blockquote>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">(</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">[</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\t]))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*))*@(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*(?:[^()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\] \</span><span style="color:#005CC5;--shiki-dark:#79B8FF">000</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">31</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">+</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">r</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">[</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">[</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">*:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">+</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">(</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">?</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">:(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">?</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">:(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">?</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t]))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)*:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*(?:(?:(?:[^()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">000</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">031</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">|</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t]))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\.</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*(?:[^()&#x3C;</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\.</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*(</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">?</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">:[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*))*|(?:[^()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\] \</span><span style="color:#005CC5;--shiki-dark:#79B8FF">000</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">031</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">(</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t]))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\&#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*(?:@(?:[^()&#x3C;>@,</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">[</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">]</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*))*(?:,@(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*(?:[^()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[\] \</span><span style="color:#005CC5;--shiki-dark:#79B8FF">000</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">031</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">\000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">*:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \0</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">00-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">.</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*))*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\></span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)(?:,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\s</span><span style="color:#032F62;--shiki-dark:#9ECBFF">*</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">(</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">[</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)(</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">?</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">:\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">|</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">]]))|"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\.</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*))*(?:,@(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">[</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\.</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*))*)*:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*)</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">?</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">.</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"(?:[^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.|(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))*"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">@(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">+|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Z</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"()&#x3C;>@,;:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.\[\]]))</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[([</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\[\]\r\\]</span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\\.)</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\](</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">.(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#D73A49;--shiki-dark:#F97583">^</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> \000</span><span style="color:#032F62;--shiki-dark:#9ECBFF">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\031</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]+(?:(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])+|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\Z</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">|(?=[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8">@,;:\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]))|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">([^</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\[\]\r\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]|</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.)*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\]</span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:(?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)?[ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\t</span><span style="color:#032F62;--shiki-dark:#9ECBFF">])*))*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\></span><span style="color:#032F62;--shiki-dark:#9ECBFF">(?:</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">(</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">\r\n)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[ \t])</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;\s</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">/</span></span>
<span class="line"></span></code></pre>
<p>And below is the most effective solution <em>(also matches virtual Gmail addresses with <code>+</code> sign)</em>.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">.</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#005CC5;--shiki-dark:#79B8FF">.</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#22863A;font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold">\.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">.</span><span style="color:#D73A49;--shiki-dark:#F97583">{2,}</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#D73A49;--shiki-dark:#F97583">i</span></span>
<span class="line"></span></code></pre>
<p>To match development addresses, you may want to make it even shorter:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">.</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#DBEDFF">@</span><span style="color:#005CC5;--shiki-dark:#79B8FF">.</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/</span><span style="color:#D73A49;--shiki-dark:#F97583">i</span></span>
<span class="line"></span></code></pre>
<p>You won’t believe me, but this is it =)</p> </div>  </article><article> <h1> <a href="/2015/08/30/2015-08-29-prepare-to-add-some-newtonianity.html">Irrlicht Newton GD tutorial: prepare to add some Newtonianity</a> </h1> <time datetime="2015-08-29T17:06:00.000Z"> Aug 30, 2015 </time> <div class="content"> <p>At this point we have an application with</p>
<ul>
<li><strong>1x Ninja</strong>, walking around</li>
<li><strong>1x sphere</strong>, hanging in the center of the screen</li>
<li><strong>1x cube</strong>, flying around the sphere</li>
</ul>
<p>That’s our “game”? Doubtely… So let’s make things move like in real world! Or just like that…</p>
<h2 id="requirements">Requirements</h2>
<p>First of all, <a href="https://github.com/MADEAPPS/newton-dynamics/archive/newton-3.13.zip"><strong>go and get</strong></a> the
Newton GD files. And unpack it… right to the <code>source</code> directory of our project! That’s right!
I’m not insane and I’m aware you are going to put <strong>a lot</strong> of files in your project. But have no
fear - you may always add them to <code>.gitignore</code> and skip them from being tracked in your Git repo:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>source/newton-dynamics-master/applications</span></span>
<span class="line"><span>source/newton-dynamics-master/packages/projects</span></span>
<span class="line"><span>source/newton-dynamics-master/packages/thirdParty</span></span>
<span class="line"><span>source/newton-dynamics-master/coreLibrary_300/projects</span></span>
<span class="line"><span></span></span></code></pre>
<p>You are using Git, right?.. Now, you place the Newton GD sources in your project directory and change
your <code>CMakeLists.txt</code> file to look like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3.1)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">CMAKE_CXX_FLAGS</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${CMAKE_CXX_FLAGS} -std=c++11"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">option</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"NEWTON_DEMOS_SANDBOX"</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Build demos sandbox"</span><span style="color:#D73A49;--shiki-dark:#F97583"> OFF</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTONGD_PATH source/newton-dynamics-master)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTONGD_INCLUDE_DIRS</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dCustomJoints</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dContainers</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dMath</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTON_LIBRARIES Newton dMath)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(X11)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(OpenGL)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(ZLIB)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> IRRLICHT_LIBRARY_PATH)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    find_library</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_LIBRARY_PATH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            NAMES</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Irrlicht</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            PATHS</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/lib/</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            PATH_SUFFIXES Linux MacOSX </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-gcc </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-visualstudio Win64-visualstudio)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(STATUS </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Found Irrlicht: ${IRRLICHT_LIBRARY_PATH}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">include_directories</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include </span><span style="color:#D73A49;--shiki-dark:#F97583">${NEWTONGD_INCLUDE_DIRS}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SOURCE_FILES source/main.cpp)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(EXECUTABLE_NAME irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCE_FILES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">target_link_libraries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTON_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${IRRLICHT_LIBRARY_PATH}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${X11_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${OPENGL_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${ZLIB_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${X11_Xxf86vm_LIB}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Try to compile your project - it should be just fine. And observe the power of CMake!</p>
<!--more-->
<h2 id="gravity">Gravity</h2>
<p>Let’s start modifying our Irrlicht sample application. First of all, we will add some Newton headers:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "newton-dynamics-master/coreLibrary_300/source/newton/Newton.h"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "newton-dynamics-master/packages/dMath/dVector.h"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "newton-dynamics-master/packages/dMath/dMatrix.h"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "newton-dynamics-master/packages/dMath/dQuaternion.h"</span></span>
<span class="line"></span></code></pre>
<p>The basic thing in the whole Newton GD library is <code>NewtonWorld</code>. That is what it means - the world, where
all the physics happen. It is something different from where we place our 3D models. And that should be
obvious - graphics are managed by Irrlicht and physics - by Newton. Those are totally different libraries.
So we need to tie those two so that graphics correspond to what happens in <em>physical</em> world.</p>
<p>First of all, we need to have a variable for our <code>NewtonWorld</code>. And since physics are handled by scripts too,
we need to have that variable close to our other objects - in the <code>ScriptManager</code> class.</p>
<p>There are two functions we need to bind to our <code>NewtonBody</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">static</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> transformCallback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonBody</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dFloat</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> matrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> threadIndex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // update ISceneNode so that it is in the same position and rotation as the NewtonBody</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">static</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> applyForceAndTorqueCallback</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NewtonBody</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">dFloat</span><span style="color:#E36209;--shiki-dark:#FFAB70"> timestep</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> threadIndex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // just add gravity to our body</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dFloat Ixx, Iyy, Izz;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dFloat mass;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodyGetMassMatrix</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mass, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Ixx, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Iyy, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Izz);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dVector </span><span style="color:#6F42C1;--shiki-dark:#B392F0">gravityForce</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.0</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, mass </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">9.8</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.0</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    NewtonBodySetForce</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(body, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">gravityForce[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>The first one, <code>transformCallback</code>, is called whenever body changes its transform -
e. g. either position or rotation. This is a good place to synchronize our Irrlicht meshes’
positions with their Newton bodies.</p>
<p>The <code>applyForceAndTorqueCallback</code> function is called on each <code>NewtonUpdate</code> to set the final
forces and torques for bodies. We will modify this one later, but for now its implementation
is just good.</p>
<p>But what’s with that <code>NewtonUpdate</code>? This is a function, which does as it says: it
updates <code>NewtonWorld</code> and all its bodies, taking into account the time since the
last update. This function call has one great candidate to be placed into: <code>handleFrame</code>.
But we need to modify that method to receive the time since the last frame been rendered
and we will use this time to update <code>NewtonWorld</code> too.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> updatePhysics</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> dt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">         NewtonUpdate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld, dt);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> handleFrame</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> dt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handler </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">LuaFunction</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">>></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"handleFrame"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        updatePhysics</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(dt);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        setKeyStates</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        handler.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Invoke</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span></code></pre>
<p>Remember about architecture: everything, what needs to be exposed to our scripts should be
declared as <code>public</code> in our <code>ScriptManager</code>. Everything else - as <code>protected</code> or <code>private</code>.
This is the basic principle of <em>encapsulation</em>, so let’s keep it in our application.</p>
<p>And update the main application loop:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // Work out a frame delta time.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u32 now </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTimer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTime</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f32 frameDeltaTime </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (f32) (now </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> then);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    then </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> now;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    scriptMgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">handleFrame</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(frameDeltaTime);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><strong>Hint:</strong> to make simulation slower and so watch ball falling in detail, make the
<code>NewtonUpdate</code> argument even smaller. Thousand times, say.</p>
<p>Since we have initialization for our Newton stuff, we need to clean it up at the exit
to prevent memory leaks. Let’s declare a method for that:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> stopPhysics</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        NewtonDestroyAllBodies</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        NewtonDestroy</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(newtonWorld);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span></code></pre>
<p>And call it right before the program’s end:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">scriptMgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">handleExit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">delete</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scriptMgr;</span></span>
<span class="line"></span></code></pre>
<p>And now is the right moment to add key codes’ definitions and exit function to our
<code>ScriptManager</code> so that we could write more clear code and close our application
correctly, using, say, <kbd>Esc</kbd> key.</p>
<p>To stop our application, we need to break our <code>while (device->run())</code> loop. This could be
achieved by simply closing the <code>IrrlichtDevice</code> with <code>device->closeDevice()</code>. But we
do not have an access to the device from the <code>ScriptManager</code>. So let’s add it as a
constructor argument:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IrrlichtDevice </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">device;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    ScriptManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IrrlichtDevice </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">_device, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneManager </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">_smgr, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IVideoDriver </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">_driver) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        driver </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _driver;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        smgr </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _smgr;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        device </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _device;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        initPhysics</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span></code></pre>
<p>So now we can create a function, exposed to our scripts, which will stop our application:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> exit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">closeDevice</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>And bind it to the Lua function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exitFn </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.CreateFunction</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]() -> </span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">exit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(); });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">global.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"exit"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, exitFn);</span></span>
<span class="line"></span></code></pre>
<p>Now we can use our <code>exit</code> function in the Lua scripts. But we will need to use hexadecimal
key codes and that’s… ugly. So we need to define some symbolic names for those codes:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setGlobalVariables</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    setKeyStates</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    setKeyCodeConstants</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setKeyCodeConstants</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::map</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::string, </span><span style="color:#D73A49;--shiki-dark:#F97583">int></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> keyMapping </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_LBUTTON"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">01</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Left mouse button</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_RBUTTON"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">02</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Right mouse button</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_CANCEL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">03</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Control-break processing</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_MBUTTON"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">04</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Middle mouse button (three-button mouse)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_XBUTTON1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">05</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Windows 2000/XP: X1 mouse button</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_XBUTTON2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">06</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Windows 2000/XP: X2 mouse button</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_BACK"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">08</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // BACKSPACE key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_TAB"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">09</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // TAB key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_CLEAR"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0C</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // CLEAR key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_RETURN"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0D</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // ENTER key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SHIFT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // SHIFT key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_CONTROL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">11</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // CTRL key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_MENU"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // ALT key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_PAUSE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">13</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // PAUSE key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_CAPITAL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">14</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // CAPS LOCK key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KANA"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME Kana mode</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_HANGUEL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME Hanguel mode (maintained for compatibility use KEY_HANGUL)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_HANGUL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME Hangul mode</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_JUNJA"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">17</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME Junja mode</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_FINAL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">18</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME final mode</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_HANJA"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">19</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME Hanja mode</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KANJI"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">19</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME Kanji mode</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_ESCAPE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // ESC key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_CONVERT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1C</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME convert</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NONCONVERT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1D</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME nonconvert</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_ACCEPT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1E</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME accept</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_MODECHANGE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1F</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // IME mode change request</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SPACE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // SPACEBAR</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_PRIOR"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">21</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // PAGE UP key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NEXT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">22</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // PAGE DOWN key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_END"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">23</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // END key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_HOME"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // HOME key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_LEFT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">25</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // LEFT ARROW key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_UP"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">26</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // UP ARROW key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_RIGHT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">27</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // RIGHT ARROW key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_DOWN"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">28</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // DOWN ARROW key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SELECT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">29</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // SELECT key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_PRINT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2A</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // PRINT key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_EXECUT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // EXECUTE key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SNAPSHOT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2C</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // PRINT SCREEN key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_INSERT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // INS key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_DELETE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2E</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // DEL key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_HELP"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2F</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // HELP key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">30</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 0 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">31</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 1 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 2 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">33</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 3 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_4"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">34</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 4 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_5"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">35</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 5 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_6"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">36</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 6 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_7"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">37</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 7 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">38</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 8 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_9"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">39</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // 9 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_A"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">41</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // A key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_B"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">42</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // B key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_C"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">43</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // C key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_D"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">44</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // D key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_E"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">45</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // E key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_F"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">46</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_G"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">47</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // G key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_H"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">48</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // H key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_I"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">49</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // I key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_J"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4A</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // J key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_K"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // K key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_L"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4C</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // L key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_M"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4D</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // M key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_N"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4E</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // N key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_O"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4F</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // O key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_P"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // P key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_Q"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">51</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Q key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_R"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">52</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // R key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_S"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">53</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // S key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_T"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">54</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // T key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_U"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">55</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // U key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_V"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">56</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // V key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_W"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">57</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // W key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_X"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">58</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // X key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_Y"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">59</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Y key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_KEY_Z"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">5A</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Z key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_LWIN"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">5B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Left Windows key (Microsoft Natural keyboard)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_RWIN"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">5C</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Right Windows key (Natural keyboard)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_APPS"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">5D</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Applications key (Natural keyboard)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SLEEP"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">5F</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Computer Sleep key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">60</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 0 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">61</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 1 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">62</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 2 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">63</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 3 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD4"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 4 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD5"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">65</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 5 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD6"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">66</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 6 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD7"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">67</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 7 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">68</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 8 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMPAD9"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">69</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Numeric keypad 9 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_MULTIPLY"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6A</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Multiply key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_ADD"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Add key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SEPARATOR"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6C</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Separator key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SUBTRACT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6D</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Subtract key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_DECIMAL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6E</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Decimal key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_DIVIDE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6F</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Divide key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">70</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F1 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">71</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F2 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">72</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F3 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F4"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">73</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F4 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F5"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">74</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F5 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F6"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">75</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F6 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F7"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">76</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F7 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">77</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F8 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F9"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">78</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F9 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F10"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">79</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F10 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F11"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7A</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F11 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F12"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F12 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F13"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7C</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F13 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F14"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7D</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F14 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F15"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7E</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F15 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F16"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7F</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F16 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F17"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">80</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F17 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F18"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">81</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F18 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F19"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">82</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F19 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F20"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">83</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F20 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F21"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">84</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F21 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F22"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">85</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F22 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F23"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">86</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F23 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_F24"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">87</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // F24 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_NUMLOCK"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">90</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // NUM LOCK key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_SCROLL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">91</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // SCROLL LOCK key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_LSHIFT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">A0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Left SHIFT key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_RSHIFT"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">A1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Right SHIFT key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_LCONTROL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">A2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Left CONTROL key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_RCONTROL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">A3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Right CONTROL key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_LMENU"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">A4</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Left MENU key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_RMENU"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">A5</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Right MENU key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BA</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for US    ";:"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_PLUS"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BB</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Plus Key   "+"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_COMMA"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BC</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Comma Key  ","</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_MINUS"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Minus Key  "-"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_PERIOD"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Period Key "."</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BF</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for US    "/?"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">C0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for US    "`~"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_4"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DB</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for US    "[{"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_5"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DC</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for US    "\|"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_6"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for US    "]}"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_7"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for US    "'""</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DF</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // None</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_AX"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">E1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // for Japan "AX"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_102"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">E2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // "&#x3C;>" or "\|"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_ATTN"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">F6</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Attn key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_CRSEL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">F7</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // CrSel key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_EXSEL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">F8</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // ExSel key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_EREOF"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">F9</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Erase EOF key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_PLAY"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">FA</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Play key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_ZOOM"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">FB</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Zoom key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_PA1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">FD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // PA1 key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_OEM_CLEAR"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">FE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Clear key</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> it </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> keyMapping.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">begin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(); it </span><span style="color:#D73A49;--shiki-dark:#F97583">!=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> keyMapping.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(); </span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">it) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(it->first, it->second);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Now we can create a <kbd>Esc</kbd> key handler in our script:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="lua"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> handleFrame</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    -- Esc</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> KEY_STATE[KEY_ESCAPE] </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#D73A49;--shiki-dark:#F97583"> then</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        exit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">end</span></span>
<span class="line"></span></code></pre>
<p>Now we are ready to create our first Newton bodies. Bodies are some invisible objects,
which define how our Irrlicht meshes will behave (e. g. where they will be placed,
how they will interact when moving, etc.). Basically, there are two types of bodies:</p>
<ol>
<li><strong>dynamic</strong>, whose movement is determined by the forces, applied to them</li>
<li><strong>kinematic</strong>, which are controlled by setting their velocities</li>
</ol>
<p>Those two kinds of bodies are totally different, so the interactions between them
are not pre-defined. So when your dynamic body will fall onto a kinematic one, it will
fall through.</p>
<p>And each body has its shape, which determines behaviour of the body, when it collides others
and the collision detection itself, of course. Shapes could be <strong>convex</strong> or <strong>concave</strong>.
Convex shapes are easier to work with <em>(on the level of physics simulation)</em>, but not all the
bodies in practice are convex. For example, levels are oftenly concave. So they need their special
shapes, which are called <code>Triangle Mesh</code>.</p>
<p><strong>Note:</strong> to keep the performance of your application high, try to minimalize the use of
triangle meshes and use as simple shapes, as possible. Sometimes it is more effective to
combine a set of primitive shapes, like spheres, cylinders and boxes into one <strong>compound</strong>
shape, then to use a trimesh.</p>
<p>Let’s create our first simple scene, empowered with physics! We will need only two things:</p>
<ol>
<li>a sphere</li>
<li>the floor</li>
</ol>
<p>Since we do not have the good mesh in standard Irrlicht distribution for the floor
<em>(there is a Quake-like level, but that is too much for our case)</em>, we will learn how
to make that simple thing in Blender. The next part is a short break between coding
sessions.</p>
<p><a href="/irrlicht-newton-tutorials/2015/12/15/making-simple-level-with-blender.html" class="btn btn-success">Next chapter</a></p> </div>  </article><article> <h1> <a href="/2015/08/29/2015-08-28-first-script.html">Irrlicht Newton GD tutorial: first script</a> </h1> <time datetime="2015-08-28T17:10:00.000Z"> Aug 29, 2015 </time> <div class="content"> <p>As we discussed, we will describe the whole game in scripts, and the core functionality
we will define in the core. In this chapter we will be adding <strong>Lua</strong> to our application.
You do not need to download Lua itself - you’d better install it with your system’s
package manager <em>(<code>yum</code> or <code>apt</code> or whatever your Linux uses, <code>brew</code> for OSX…)</em>.</p>
<h2 id="dependencies">Dependencies</h2>
<p>The only thing you need to download from Internet this time is Lua wrapper called
<strong>luacppinterface</strong>.
So <a href="https://github.com/davidsiaw/luacppinterface/archive/master.zip"><strong>go and get it</strong></a> from
Github.</p>
<p>And unpack it… right to the <code>source</code> directory of our project! That’s right! That’s
really small library so it will not pollute your project with tons of files.</p>
<p>Now, I mentioned dependency managers earlier. This is how <em>we</em> will handle them in our <em>C++</em>
application - we will simply put the sources of all the libraries we depend on, with the
versions we depend on, right in our project. Given that, you may put Irrlicht there as well -
you are free to do anything with our project!</p>
<!--more-->
<h2 id="build-instructions">Build instructions</h2>
<p>To build our project we will need to change our <code>CMakeLists.txt</code> file to fetch
our new dependency:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3.1)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">CMAKE_CXX_FLAGS</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${CMAKE_CXX_FLAGS} -std=c++11"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SOURCE_FILES source/main.cpp)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(EXECUTABLE_NAME irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(LUACPPINTERFACE_PATH source/luacppinterface-master)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${LUACPPINTERFACE_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(X11)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(OpenGL)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(ZLIB)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Lua)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> IRRLICHT_LIBRARY_PATH)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    find_library</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_LIBRARY_PATH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            NAMES</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Irrlicht</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            PATHS</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/lib/</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            PATH_SUFFIXES Linux MacOSX </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-gcc </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-visualstudio Win64-visualstudio)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(STATUS </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Found Irrlicht: ${IRRLICHT_LIBRARY_PATH}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">include_directories</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include </span><span style="color:#D73A49;--shiki-dark:#F97583">${LUA_INCLUDE_DIR}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${LUACPPINTERFACE_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCE_FILES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">target_link_libraries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        luacppinterface</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${IRRLICHT_LIBRARY_PATH}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${X11_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${OPENGL_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${ZLIB_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${X11_Xxf86vm_LIB}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LUA_LIBRARIES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>And here’s the thing: if you try to compile our project on another machine, you will
not need to install any other libraries than Lua on that machine! That supposed to sound
like <em>“sweet, huh?”</em>, except that one little <em>“but…”</em>… Bittersweet…</p>
<p>Back to our busines… <code>luacppinterface</code> needs to be tweaked a bit to fit our project -
we will hack its <code>CMakeLists.txt</code> file to make it depend on system Lua libraries.
Just make it look like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 2.6)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(luacppinterface)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">include_directories</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"lua/src"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Lua)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">include_directories</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${LUA_INCLUDE_DIR}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_library</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(luacppinterface STATIC</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    include</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/luacoroutine.cpp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    include</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/luareference.cpp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    include</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/luacppinterface.cpp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    include</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/luatable.cpp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    include</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/luafunction.cpp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">target_link_libraries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(luacppinterface </span><span style="color:#D73A49;--shiki-dark:#F97583">${LUA_LIBRARIES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>It barely differs from the original file, but it makes a compilation pleasant - you
do not need to specify paths to Lua libs anymore!</p>
<h2 id="injecting-some-lua">Injecting some Lua</h2>
<p>Our application now uses C++ code to place some 3D objects in a scene. Let’s move,
say, sphere creation, to the script.</p>
<p>First of all, add <code>luacppinterface</code> headers to our <code>main.cpp</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "luacppinterface-master/include/luacppinterface.h"</span></span>
<span class="line"></span></code></pre>
<p>Now let’s look at some of Irrlicht’ conventions:</p>
<ul>
<li>it uses <code>irr::video::IVideoDriver</code> for rendering operations</li>
<li>it uses <code>irr::scene::ISceneManager</code> for scene management</li>
</ul>
<p>So why not to define a <code>ScriptManager</code> to handle scripts? Our requirements
for this class (for now) are:</p>
<ul>
<li>it should load and evaluate scripts</li>
<li>it should provide simple API to our scripts</li>
</ul>
<p>Let’s get coding!</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ScriptManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Lua luaState;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::map</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::string, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583">*></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nodes;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IVideoDriver </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">driver;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneManager </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">smgr;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> bindFunctions</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    ScriptManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISceneManager</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">_smgr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IVideoDriver</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">_driver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        driver </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _driver;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        smgr </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _smgr;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createSphereNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> textureFile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setNodePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">LuaTable</span><span style="color:#E36209;--shiki-dark:#FFAB70"> pos</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    LuaTable</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getNodePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loadScript</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> filename</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ifstream </span><span style="color:#6F42C1;--shiki-dark:#B392F0">inf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(filename);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::string </span><span style="color:#6F42C1;--shiki-dark:#B392F0">code</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">istreambuf_iterator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(inf)), </span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">istreambuf_iterator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        bindFunctions</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">RunScript</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(code);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>This is just a skeleton - we will fill it out in a minute. Just catching up:</p>
<ol>
<li>this class depends on <code>IVideoDriver</code> and <code>ISceneManager</code> to handle 3D objects and the scene</li>
<li>it contains <code>Lua luaState</code> field to store the current state of our script running</li>
<li>it stores all the nodes as a <code>&#x3C;string, ISceneNode*></code> map to allow access to our nodes from scripts</li>
<li>it exposes three methods as an API to Lua scripts: <code>createSphereNode</code>, <code>setNodePosition</code> and
<code>getNodePosition</code> so we will be able to make some manipulations in our scripts</li>
<li>it provides really short and simple interface to our C++ core: <code>ScriptManager(...)</code> and <code>loadScript</code></li>
</ol>
<p>The main principle, each and every programmer breaks every day is <strong>KISS</strong> <em>(Keep It Stupidly Simple)</em>.
And that principle should guide us through this whole tutorial to not overthink and override
ourselves as well as the project we are making. That is why our APIs are that simple.</p>
<p>But let’s get back to our <code>ScriptManager</code>. It shows how things will look like, but never
defines how they will actually <strong>work</strong>. So here are the key points to Lua API:</p>
<ol>
<li>
<p><code>LuaTable</code> is an array-like structure in Lua, representing both indexed as well as key-value
arrays in Lua. This type is a way to pass variables between Lua script and C++ program. You
may use both <code>table.Get&#x3C;value_type>(index)</code> and <code>table.Get&#x3C;value_type>("key")</code> methods
to access its values.</p>
</li>
<li>
<p>To bind our <code>ScriptManager</code> methods to Lua functions, we need to use pointers to those
functions. And as it is not that simple in usual C++, we will use C++11x lambdas:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> createSphere </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.CreateFunction</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::string, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::string)</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">](</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> tex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) -> </span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">createSphereNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(name, tex); });</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>All the functions and variables you want to pass to Lua scripts should be global. And since
we have our pretty <code>luaState</code> member, we may set global members through its methods:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">LuaTable global </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">global.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"createSphere"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, createSphere);</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>We will be using just a map of a Irrlicht’ nodes and its name to bypass those nodes between
scripts and core:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createSphereNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> textureFile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addSphereSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (node) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">30</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(textureFile.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialFlag</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EMF_LIGHTING, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  nodes[name] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setNodePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">LuaTable</span><span style="color:#E36209;--shiki-dark:#FFAB70"> pos</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x, y, z;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pos.Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;float></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"x"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pos.Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;float></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"y"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pos.Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;float></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"z"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      nodes[name]-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(x, y, z));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  LuaTable</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getNodePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      LuaTable pos </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">CreateTable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nodes[name]-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      pos.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"x"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v.X);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      pos.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"y"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v.Y);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      pos.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"z"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v.Z);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pos;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span></code></pre>
</li>
</ol>
<p>Given those, we have our API and are able to create and run our first Lua script.
Add one in the <code>media/scripts/</code> directory:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="lua"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">createSphere</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"sphere1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/textures/wall.webp"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p><strong>Note:</strong> paths in the script will be used by C++ core, relatively to the binary file, which
is… generated by our C++ code! So all the paths in the scripts are just the same as they
are in C++ core.</p>
<p>And add the <code>ScriptManager</code> initialization code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ScriptManager </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">scriptMgr </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ScriptManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(smgr, driver);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">scriptMgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">loadScript</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/scripts/test1.lua"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>Now you may remove the code, creating sphere in the <code>main()</code> function. And run the code.
You should see exactly the same picture as before:</p>
<img src="/images/04_movement_untouched.webp" loading="lazy">
<h2 id="homework">Homework</h2>
<p>Your task is: try to move all the other “factory” functions <em>(creating cube, ninja,
circle animator for cube and fly animator for Ninja)</em> to Lua script, adding API for them
to <code>ScriptManager</code>.</p>
<h2 id="more-separation">More separation</h2>
<p>We will now advance our script and add some convention to it. These will be our tasks
for the rest of this chapter:</p>
<ol>
<li>move keyboard events handling to script</li>
<li>create two function in script so we may call them <em>by convention, not by configuration</em></li>
</ol>
<p>The last phrase I took from <strong>Ember.js introduction</strong>. It says <em>“prefer convention over
configuration”</em>, meaning we’d better call the functions of same name on different scripts,
instead of setting somehow which function to call.</p>
<p>That is, we will define <code>handleFrame()</code> function in our script, which will be called
on each <code>onFrame</code> event in our C++ core and the <code>main()</code> function, which will be called right
after script has been loaded.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handler </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">LuaFunction</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">>></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"handleFrame"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">handler.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Invoke</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span></code></pre>
<p>Moreover, we will define a global keyboard state table for each of scripts we load and will
be updating it as user presses keys on his keyboard. And this variable will be shared with
script, but as read-only one. So changes in that table will have no effect on the application
itself.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ScriptManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::map</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">bool></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> keyStates;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setGlobalVariables</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        setKeyStates</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setKeyStates</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        LuaTable keysTable </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">CreateTable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">kv : keyStates) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            keysTable.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(kv.first, kv.second);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_STATE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, keysTable);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setKeyState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> key</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">bool</span><span style="color:#E36209;--shiki-dark:#FFAB70"> state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        keyStates[key] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> handleFrame</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handler </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">LuaFunction</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">>></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"handleFrame"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        setKeyStates</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        handler.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Invoke</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loadScript</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> filename</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ifstream </span><span style="color:#6F42C1;--shiki-dark:#B392F0">inf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(filename);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::string </span><span style="color:#6F42C1;--shiki-dark:#B392F0">code</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">istreambuf_iterator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(inf)), </span><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">istreambuf_iterator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        bindFunctions</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        setGlobalVariables</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">RunScript</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(code);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scriptMainFn </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">LuaFunction</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">>></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"main"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        scriptMainFn.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Invoke</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MyEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    MyEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ScriptManager</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">scriptManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        scriptMgr </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scriptManager;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u32 i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> KEY_KEY_CODES_COUNT; </span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">i)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            scriptMgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setKeyState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(i, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // This is the one method that we have to implement</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SEvent</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70">event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // Remember whether each key is down or up</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_KEY_INPUT_EVENT)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            scriptMgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setKeyState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(event.KeyInput.Key, event.KeyInput.PressedDown);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ScriptManager </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">scriptMgr;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>Variables are added to a <code>GlobalEnvironment</code> just as function do:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"KEY_STATE"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, keysTable);</span></span>
<span class="line"></span></code></pre>
<p>Lua-defined functions are found by their names and called with <code>Invoke(args)</code> method:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handler </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> luaState.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">GetGlobalEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().Get</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">LuaFunction</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">>></span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"handleFrame"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">handler.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Invoke</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span></code></pre>
<p>Let’s add some simple interaction to our script now. I’ll help you a bit:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moveNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">LuaTable</span><span style="color:#E36209;--shiki-dark:#FFAB70"> pos</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> findNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(name);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df vec </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> tableToVector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(pos);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::matrix4 m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df rot </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    m.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setRotationDegrees</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(rot);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    m.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">transformVect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> vec);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">updateAbsolutePosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This is how nodes could be moved relatively to their current position in Irrlicht.</p>
<p>And here’s how our Lua script may look like now:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="lua"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> handleFrame</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    -- w</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> KEY_STATE[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x57</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#D73A49;--shiki-dark:#F97583"> then</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        move</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"sphere1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    -- s</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> KEY_STATE[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x53</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#D73A49;--shiki-dark:#F97583"> then</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        move</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"sphere1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    createSphere</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"sphere1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/textures/wall.webp"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"sphere1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 30</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    createCube</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cube1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/textures/t351sml.webp"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    addCircleAnimator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cube1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 30</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">20.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    createAnimatedMesh</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ninja"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/models/ninja.b3d"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"media/textures/nskinbl.webp"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">13</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    setRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ninja"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">90</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    setScale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ninja"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    addForwardAnimator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ninja"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 100</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 60</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, { x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">100</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, z </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 60</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3500</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">end</span></span>
<span class="line"></span></code></pre>
<p>If you run our application <em>now</em>, you should be able to control sphere with <kbd>w</kbd> and
<kbd>s</kbd> keys:</p>
<img src="/images/irrlicht-newton-tutorials/lua_script_with_kbd_handling.webp" loading="lazy">
<p><a href="/irrlicht-newton-tutorials/2015/08/29/prepare-to-add-some-newtonianity.html" class="btn btn-success">Next chapter</a></p> </div>  </article><article> <h1> <a href="/2015/08/28/2015-08-27-first-application.html">Irrlicht Newton GD tutorial: first application</a> </h1> <time datetime="2015-08-27T17:05:00.000Z"> Aug 28, 2015 </time> <div class="content"> <h2 id="install-irrlicht">Install Irrlicht</h2>
<p>First of all, you will definetely need the Irrlicht engine, so
<a href="http://irrlicht.sourceforge.net/downloads/"><strong>go get it</strong></a>.</p>
<p>Then you will need to compile it. Compilation process depends on the operating system you use,
but it’s really similar on every one.</p>
<h3 id="linux">Linux</h3>
<p>Install these dependencies with your system’ package manager:
<code>libenet-dev libxxf86vm-dev zlib-dev cmake</code>.</p>
<p>Unzip Irrlicht, go to the directory you unpacked with the terminal and run the following:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">cd</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> source/Irrlicht</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">make</span></span>
<span class="line"></span></code></pre>
<p>Belive it or not, but that’s all!</p>
<h3 id="windows">Windows</h3>
<p>Unzip Irrlicht, go to the directory you unpacked and open the VisualStudio project <em>(depending on
VisualStudio version, you might want to open a bit different file)</em> in <code>source/Irrlicht</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Irrlicht10.0.sln</span></span>
<span class="line"><span>Irrlicht11.0.sln</span></span>
<span class="line"><span>Irrlicht8.0.sln</span></span>
<span class="line"><span>Irrlicht9.0.sln</span></span>
<span class="line"><span></span></span></code></pre>
<p>Build it with VisualStudio - and you are done!</p>
<h3 id="macos-x">MacOS X</h3>
<p>The steps are a bit complicated. And they require you to install <strong>XCode</strong> and
<strong>Command-Line Tools</strong> - those could be found either in  AppStore or on the Apple
website.</p>
<ul>
<li>
<p>First of all, you need to install a bunch of dependencies <em>(I use <code>brew</code> for this purpose)</em>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">brew</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> tinyxml</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> enet</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> lua</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> cmake</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>Get a list of all compilers available for your OSX version:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">xcodebuild</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -showBuildSettings</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> grep</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DEFAULT_COMPILER</span></span>
<span class="line"></span></code></pre>
<p>I got something like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> xcodebuild</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -showBuildSettings</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> grep</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DEFAULT_COMPILER</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  DEFAULT_COMPILER</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> com.apple.compilers.llvm.clang.1_0</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>Now the build process:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">cd</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> source/Irrlicht/MacOSX</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">xcodebuild</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -project</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> MacOSX.xcodeproj</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> GCC_VERSION=com.apple.compilers.llvm.clang.1_0</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>And the final step - copy the library to the <code>lib/MacOSX</code> directory:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">cp</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build/Release/libIrrlicht.a</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ../../../lib/MacOSX</span></span>
<span class="line"></span></code></pre>
</li>
</ul>
<p>Phew! That’s a damn bunch of commands, don’t you think?</p>
<!--more-->
<h3 id="common">Common</h3>
<p>By performing those steps, described above, you will end up with the compiled Irrlicht library file
within the <code>lib/</code> directory, depending on your platform:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Linux/libIrrlicht.a</span></span>
<span class="line"><span>MacOSX/libIrrlicht.a</span></span>
<span class="line"><span>Win32-visualstudio/Irrlicht.lib</span></span>
<span class="line"><span>Win64-visualStudio/Irrlicht.lib</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now, create a blank project in your favorite IDE and proceed…</p>
<h2 id="application-itself">Application itself</h2>
<p>Our first application will show you Irrlicht basic features we will use later. They are:</p>
<ul>
<li><strong>mesh handling</strong> - loading, rendering, animating, etc.</li>
<li><strong>user input handling</strong> - reacting to keyboard and mouse events</li>
<li><strong>user interface (UI)</strong> - displaying some information within the application window</li>
</ul>
<p>The good start for that is standard example from Irrlicht pack, the <strong>04 - Movement</strong> one.
Let’s take a look over its code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">/** Example 004 Movement</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">This Tutorial shows how to move and animate SceneNodes. The</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">basic concept of SceneNodeAnimators is shown as well as manual</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">movement of nodes using the keyboard.  We'll demonstrate framerate</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">independent movement, which means moving by an amount dependent</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">on the duration of the last run of the Irrlicht loop.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">Example 19.MouseAndJoystick shows how to handle those kinds of input.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">As always, I include the header files, use the irr namespace,</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">and tell the linker to link with the .lib file.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">*/</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#ifdef</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _MSC_VER</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// We'll also define this to stop MSVC complaining about sprintf().</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#define</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _CRT_SECURE_NO_WARNINGS</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#pragma</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> comment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">lib</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Irrlicht.lib"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;irrlicht.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">using</span><span style="color:#D73A49;--shiki-dark:#F97583"> namespace</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">/*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">To receive events like mouse and keyboard input, or GUI events like "the OK</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">button has been clicked", we need an object which is derived from the</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">irr::IEventReceiver object. There is only one method to override:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">irr::IEventReceiver::OnEvent(). This method will be called by the engine once</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">when an event happens. What we really want to know is whether a key is being</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">held down, and so we will remember the current state of each key.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">*/</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MyEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IEventReceiver</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // This is the one method that we have to implement</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // Remember whether each key is down or up</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.EventType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EET_KEY_INPUT_EVENT)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            KeyIsDown[event.KeyInput.Key] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event.KeyInput.PressedDown;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // This is used to check whether a key is being held down</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> IsKeyDown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">EKEY_CODE</span><span style="color:#E36209;--shiki-dark:#FFAB70"> keyCode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">const</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> KeyIsDown[keyCode];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    MyEventReceiver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u32 i</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">KEY_KEY_CODES_COUNT; </span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">i)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            KeyIsDown[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">private:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // We use this array to store the current state of each key</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    bool</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> KeyIsDown[KEY_KEY_CODES_COUNT];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">/*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">The event receiver for keeping the pressed keys is ready, the actual responses</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">will be made inside the render loop, right before drawing the scene. So lets</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">just create an irr::IrrlichtDevice and the scene node we want to move. We also</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">create some other additional scene nodes, to show that there are also some</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">different possibilities to move and animate scene nodes.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">*/</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // create device</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    MyEventReceiver receiver;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    IrrlichtDevice</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createDevice</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EDT_OPENGL,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dimension2d</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">u32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">640</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">480</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">receiver);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (device </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // could not create selected driver.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IVideoDriver</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> driver </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getVideoDriver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneManager</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getSceneManager</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    Create the node which will be moved with the WSAD keys. We create a</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    sphere node, which is a built-in geometry primitive. We place the node</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    at (0,0,30) and assign a texture to it to let it look a little bit more</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    interesting. Because we have no dynamic lights in this scene we disable</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    lighting for each model (otherwise the models would be black).</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    */</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addSphereSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (node)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">30</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../../media/wall.webp"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialFlag</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EMF_LIGHTING, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    Now we create another node, movable using a scene node animator. Scene</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    node animators modify scene nodes and can be attached to any scene node</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    like mesh scene nodes, billboards, lights and even camera scene nodes.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    Scene node animators are not only able to modify the position of a</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    scene node, they can also animate the textures of an object for</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    example. We create a cube scene node and attach a 'fly circle' scene</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    node animator to it, letting this node fly around our sphere scene node.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    */</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addCubeSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (n)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        n-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../../media/t351sml.webp"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        n-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialFlag</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EMF_LIGHTING, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNodeAnimator</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> anim </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">createFlyCircleAnimator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">30</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">20.0</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (anim)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            n-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addAnimator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(anim);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            anim-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    The last scene node we add to show possibilities of scene node animators is</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    a b3d model, which uses a 'fly straight' animator to run between to points.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    */</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IAnimatedMeshSceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> anms </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addAnimatedMeshSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getMesh</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../../media/ninja.b3d"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (anms)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNodeAnimator</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> anim </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">createFlyStraightAnimator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">100</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">60</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">100</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">60</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3500</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (anim)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            anms-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addAnimator</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(anim);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            anim-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        To make the model look right we disable lighting, set the</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        frames between which the animation should loop, rotate the</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        model around 180 degrees, and adjust the animation speed and</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        the texture. To set the right animation (frames and speed), we</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        would also be able to just call</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        "anms->setMD2Animation(scene::EMAT_RUN)" for the 'run'</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        animation instead of "setFrameLoop" and "setAnimationSpeed",</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        but this only works with MD2 animations, and so you know how to</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        start other animations. But a good advice is to not use</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        hardcoded frame-numbers...</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        */</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        anms-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setMaterialFlag</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::EMF_LIGHTING, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        anms-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setFrameLoop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">13</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        anms-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAnimationSpeed</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//      anms->setMD2Animation(scene::EMAT_RUN);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        anms-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setScale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        anms-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">90</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//      anms->setMaterialTexture(0, driver->getTexture("../../media/sydney.webp"));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    To be able to look at and move around in this scene, we create a first</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    person shooter style camera and make the mouse cursor invisible.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    */</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addCameraSceneNodeFPS</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getCursorControl</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setVisible</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    Add a colorful irrlicht logo</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    */</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getGUIEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addImage</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTexture</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../../media/irrlichtlogoalpha2.tga"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">position2d</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIStaticText</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> diagnostics </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getGUIEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addStaticText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        L""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">400</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    diagnostics-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setOverrideColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    We have done everything, so lets draw it. We also write the current</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    frames per second and the name of the driver to the caption of the</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    window.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    */</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> lastFPS </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // In order to do framerate independent movement, we have to know</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // how long it was since the last frame</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    u32 then </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTimer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTime</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // This is the movemen speed in units per second.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f32 MOVEMENT_SPEED </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // Work out a frame delta time.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u32 now </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTimer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTime</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f32 frameDeltaTime </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (f32)(now </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> then) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1000.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // Time in seconds</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        then </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> now;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        /* Check if keys W, S, A or D are being held down, and move the</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        sphere node around respectively. */</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector3df nodePosition </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(receiver.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IsKeyDown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::KEY_KEY_W))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            nodePosition.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> MOVEMENT_SPEED </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> frameDeltaTime;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(receiver.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IsKeyDown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::KEY_KEY_S))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            nodePosition.Y </span><span style="color:#D73A49;--shiki-dark:#F97583">-=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> MOVEMENT_SPEED </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> frameDeltaTime;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(receiver.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IsKeyDown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::KEY_KEY_A))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            nodePosition.X </span><span style="color:#D73A49;--shiki-dark:#F97583">-=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> MOVEMENT_SPEED </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> frameDeltaTime;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(receiver.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">IsKeyDown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">irr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::KEY_KEY_D))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            nodePosition.X </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> MOVEMENT_SPEED </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> frameDeltaTime;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(nodePosition);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">beginScene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">113</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">113</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">133</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drawAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // draw the 3d scene</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getGUIEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drawAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // draw the gui environment (the logo)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">endScene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fps </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getFPS</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (lastFPS </span><span style="color:#D73A49;--shiki-dark:#F97583">!=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fps)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::stringw </span><span style="color:#6F42C1;--shiki-dark:#B392F0">tmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">L"Movement Example - Irrlicht Engine ["</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            tmp </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getName</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            tmp </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> L"] fps: "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            tmp </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fps;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setWindowCaption</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tmp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">c_str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            lastFPS </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fps;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    /*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    In the end, delete the Irrlicht device.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    */</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">/*</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">That's it. Compile and play around with the program.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">**/</span></span>
<span class="line"></span></code></pre>
<h2 id="building-the-project">Building the project</h2>
<p>Paste the code from above to your blank project in your IDE, in the <code>source/main.cpp</code> file.
This may differ, but is not critical. Now, add the <code>CMakeLists.txt</code> file to your project
and fill it with these commands:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3.1)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">CMAKE_CXX_FLAGS</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${CMAKE_CXX_FLAGS} -std=c++11"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(X11)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(OpenGL)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(ZLIB)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> IRRLICHT_LIBRARY_PATH)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    find_library</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_LIBRARY_PATH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            NAMES</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Irrlicht</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            PATHS</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/lib/</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            PATH_SUFFIXES Linux MacOSX </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-gcc </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-visualstudio Win64-visualstudio)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(STATUS </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Found Irrlicht: ${IRRLICHT_LIBRARY_PATH}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">include_directories</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SOURCE_FILES source/main.cpp)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(EXECUTABLE_NAME irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCE_FILES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">target_link_libraries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${IRRLICHT_LIBRARY_PATH}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${X11_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${OPENGL_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${ZLIB_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${X11_Xxf86vm_LIB}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p><strong>Note:</strong> for those of you, guys, running MacOS X I prepared a bit more complicated
<code>CMakeLists.txt</code> file - just to make our application run everywhere:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3.1)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">CMAKE_CXX_FLAGS</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${CMAKE_CXX_FLAGS} -std=c++11"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">option</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"NEWTON_DEMOS_SANDBOX"</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Build demos sandbox"</span><span style="color:#D73A49;--shiki-dark:#F97583"> OFF</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(LUACPPINTERFACE_PATH source/luacppinterface-master)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(CPPFORMAT_PATH source/cppformat-master)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTONGD_PATH source/newton-dynamics-master)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTONGD_INCLUDE_DIRS</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dCustomJoints</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dContainers</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dMath)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTON_LIBRARIES Newton dMath)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${LUACPPINTERFACE_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${CPPFORMAT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(X11)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(OpenGL)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(ZLIB)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Lua)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> IRRLICHT_LIBRARY_PATH)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">UNIX</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX Linux)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">APPLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX MacOSX)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">WIN32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">MSVC</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-visualstudio Win64-visualstudio)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (MINGW)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-gcc)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    find_library</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_LIBRARY_PATH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            NAMES</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Irrlicht</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            PATHS</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/lib/</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            PATH_SUFFIXES </span><span style="color:#D73A49;--shiki-dark:#F97583">${IRRLICHT_PATH_SUFFIX}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(STATUS </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Found Irrlicht: ${IRRLICHT_LIBRARY_PATH}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(LIBRARIES luacppinterface</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        cppformat</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTON_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${IRRLICHT_LIBRARY_PATH}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${X11_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${OPENGL_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${ZLIB_LIBRARIES}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LUA_LIBRARIES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> APPLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(LIBRARIES </span><span style="color:#D73A49;--shiki-dark:#F97583">${LIBRARIES}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${X11_Xxf86vm_LIB}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">include_directories</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LUA_INCLUDE_DIR}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LUACPPINTERFACE_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${CPPFORMAT_PATH}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_INCLUDE_DIRS}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SOURCE_FILES source/main.cpp)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(EXECUTABLE_NAME irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCE_FILES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">APPLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">CMAKE_CXX_FLAGS</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${CMAKE_CXX_FLAGS} -framework Foundation -framework OpenGL -framework Cocoa -framework Carbon -framework AppKit -framework IOKit"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">target_link_libraries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LIBRARIES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<h2 id="cmake-file">CMake file</h2>
<p>But what happens in all that code? First two lines of our <code>CMakeLists.txt</code> file define the project:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">cmake_minimum_required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">VERSION</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 3.1)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">project</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(irrlicht_newton_game1)</span></span>
<span class="line"></span></code></pre>
<p>Then we modify the variable <code>CMAKE_CXX_FLAGS</code>, which will be used to set compiler flags.
This is how we add items to lists or modify string variables with CMake: we set it the new
value, consisting of the old one and the new elements / parts:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">CMAKE_CXX_FLAGS</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${CMAKE_CXX_FLAGS} -std=c++11"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Then we tell CMake not to build <em>Newton demo sandbox</em> subproject and set a few path variables -
we will use them to point compiler to the header and library files of our third-party libraries
(like Newton itself, Irrlicht and others).</p>
<p><strong>Remember:</strong> these are only plain variables, they have no effect on compiler themselves.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(LUACPPINTERFACE_PATH source/luacppinterface-master)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(CPPFORMAT_PATH source/cppformat-master)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTONGD_PATH source/newton-dynamics-master)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTONGD_INCLUDE_DIRS</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dCustomJoints</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dContainers</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/packages/dMath)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(NEWTON_LIBRARIES Newton dMath)</span></span>
<span class="line"></span></code></pre>
<p>Next, we point CMake to our sub-projects, which are by the fact our third-party libraries:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${LUACPPINTERFACE_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${CPPFORMAT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_subdirectory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${NEWTONGD_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>These tell CMake to build sub-projects before building our application. Because our sub-projects
are nothing but libraries, we can then look for the built libraries, required by our project
in the sub-projects’ output directories like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Lua)</span></span>
<span class="line"></span></code></pre>
<p>Same way we look for system libraries:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(X11)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(OpenGL)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">find_package</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(ZLIB)</span></span>
<span class="line"></span></code></pre>
<p>These commands set compile-ready variables like <code>X11_LIBRARIES</code>.</p>
<p>Some sub-projects may set CMake variables too, providing us with paths to include files or
library files. If Irrlicht did not do this, we try to find its paths with CMake:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">NOT</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> IRRLICHT_LIBRARY_PATH)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">UNIX</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX Linux)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">APPLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX MacOSX)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">WIN32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">MSVC</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-visualstudio Win64-visualstudio)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (MINGW)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_PATH_SUFFIX </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Win32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-gcc)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    find_library</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(IRRLICHT_LIBRARY_PATH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            NAMES</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Irrlicht</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            PATHS</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/lib/</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            PATH_SUFFIXES </span><span style="color:#D73A49;--shiki-dark:#F97583">${IRRLICHT_PATH_SUFFIX}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(STATUS </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Found Irrlicht: ${IRRLICHT_LIBRARY_PATH}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span></code></pre>
<p>Note the environment variables CMake provides us with: <code>UNIX</code>, <code>APPLE</code>, <code>WIN32</code>, <code>MSVC</code>
and many others. They describe which operating system CMake was ran under and which
compiler it was told to use.</p>
<p>And the most important part of our <code>CMakeLists.txt</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">include_directories</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${IRRLICHT_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LUA_INCLUDE_DIR}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LUACPPINTERFACE_PATH}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/include</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${CPPFORMAT_PATH}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${NEWTONGD_INCLUDE_DIRS}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SOURCE_FILES source/main.cpp)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(EXECUTABLE_NAME irrlicht_newton_game1)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCE_FILES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>This actually runs the <strong>compiler</strong> with the include directories, source files and
output file specified.</p>
<p>After that, we may run <strong>linker</strong> to link the intermediate object files, provided by
compiler, and end up with the application executable:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">target_link_libraries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ${LIBRARIES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>For OSX users there is a small hack, needed to build the application:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">APPLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">CMAKE_CXX_FLAGS</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${CMAKE_CXX_FLAGS} -framework Foundation -framework OpenGL -framework Cocoa -framework Carbon -framework AppKit -framework IOKit"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span></code></pre>
<p><strong>Note the order the commands are specified in:</strong> having include path variables definitions
placed before sub-projects commands may be no harmful, but more <em>“effective”</em> commands,
like compiling sub-projects (<code>add_subdirectory</code>) depend on other CMake commands, so
be sure to keep the order sane and clean.</p>
<h2 id="running-the-build">Running the build</h2>
<p>Now that you are ready, run the following commands from your project directory
<strong>(you will need <code>cmake</code> to be installed in your system)</strong>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">mkdir</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">cd</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> build</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">cmake</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -DIRRLICHT_PATH=path_to_directory_where_you_unpacked_irrlicht</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ..</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">make</span></span>
<span class="line"></span></code></pre>
<p><strong>Warning:</strong> do not forget to replace <code>path_to_directory_where_you_unpacked_irrlicht</code> with
the actual path to the directory, where your Irrlicht files lay!</p>
<p>This will build our first Irrlicht application. Not obvious how handy it is right now,
but you will see the power of CMake in our later sessions.</p>
<p>Before you run the application, copy the whole <code>media</code> directory from the Irrlicht
dir to the parent dir of your project. You should end up with directory structure like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>.</span></span>
<span class="line"><span>└── irrlicht_newton_tutorials</span></span>
<span class="line"><span>    ├── irrlicht_newton_game1</span></span>
<span class="line"><span>    │   ├── build</span></span>
<span class="line"><span>    │   ├── CMakeLists.txt</span></span>
<span class="line"><span>    │   └── source</span></span>
<span class="line"><span>    │       └── main.cpp</span></span>
<span class="line"><span>    └── media</span></span>
<span class="line"><span></span></span></code></pre>
<p><strong>Note:</strong> If you now just run the <code>irrlicht_newton_game1</code> binary on OSX, you will see
your application does not react to keyboard events. This is tricky, but you need
to pack your application as OSX application. This is easy, though: just create
a directory tree <code>mkdir -p irrlicht_newton_game1.app/Contents/MacOS/</code> and move
your binary file there:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>├── irrlicht_newton_game1.app</span></span>
<span class="line"><span>│   └── Contents</span></span>
<span class="line"><span>│       └── MacOS</span></span>
<span class="line"><span>│           └── irrlicht_newton_game1</span></span>
<span class="line"><span></span></span></code></pre>
<p>Open <strong>Finder</strong> and run the application from there. On other operating systems run
the executable file in your <code>build</code> directory.</p>
<p>Buuuuut, since we have CMake, we may simplify this task because this is a part of
application build process. So we need to create a usual binary file, when we are
running Linux or Windows or create a directory structure with binary on its deepest
level, when running OSX. CMake allows to do it in a really easy way:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cmake"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">APPLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#E36209;--shiki-dark:#FFAB70"> MACOSX_BUNDLE</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCE_FILES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add_executable</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">${EXECUTABLE_NAME}</span><span style="color:#D73A49;--shiki-dark:#F97583"> ${SOURCE_FILES}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">endif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span></code></pre>
<p>You should see something like this:</p>
<img src="/images/04_movement_untouched.webp" loading="lazy">
<p>To end the process you may consider switching to a terminal and running</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">pkill</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> irrlicht_newton_game1</span></span>
<span class="line"></span></code></pre>
<h2 id="understanding-the-code">Understanding the code</h2>
<p>Here are few simple things we could extract from application’ code and understand right from scratch:</p>
<ul>
<li>
<p>Each 3D model is a <em>scene node</em></p>
</li>
<li>
<p>Primitive scene nodes (such as <em>cube</em> or <em>sphere</em>) could be easily created with built-in functions:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addSphereSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addCubeSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>Animated 3D models (such as <em>character models</em>) could be loaded from file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">scene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IAnimatedMeshSceneNode</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addAnimatedMeshSceneNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getMesh</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../../media/ninja.b3d"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span></code></pre>
<p><strong>Hint:</strong> if mesh is animated, animation could be started with:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setFrameLoop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">13</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAnimationSpeed</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p><strong>Hint:</strong> animation could be stopped with setting its speed to zero:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setAnimationSpeed</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>Node could be described not only by its vertices and indices <em>(forming a set of triangles which are drawn
in 3D forming a model, called <strong>mesh</strong>)</em> but by its <strong>position</strong>, <strong>rotation</strong> and <strong>scale</strong></p>
<p>Those could be set with:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(x, y, z));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setRotation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(x_angle, y_angle, z_angle));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">node-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setScale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">vector3df</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(width_factor, height_factor, depth_factor));</span></span>
<span class="line"></span></code></pre>
<p><strong>Hint:</strong> rotation is a set of angles relatively to the corresponding axes, the node will be rotated
around. E. g., <code>vector3df(45, 90, 0)</code> sets the rotation by <code>45 deg</code> around <code>X axis</code>, <code>90 deg</code> around <code>Y axis</code>
and no rotation aroung <code>Z axis</code>. All those axes are relative to the node itself.</p>
<img src="/images/irrlicht-newton-tutorials/euler_angles.webp" loading="lazy">
</li>
<li>
<p>Graphics User Interface’ <em>(GUI)</em> widgets for information output are labels; they are created with
<strong>GUI Manager</strong>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">gui</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::IGUIStaticText</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> label </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getGUIEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">addStaticText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">L""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">core</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">s32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">400</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span></code></pre>
<p><strong>Hint:</strong> its text could be set with:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">label-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">setText</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#D73A49;--shiki-dark:#F97583"> wchar_t*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"some text"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>User input is handled by an external <code>IEventReceiver</code> class object.</p>
<p>Its method,</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">virtual</span><span style="color:#D73A49;--shiki-dark:#F97583"> bool</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> OnEvent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> SEvent</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70"> event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>defines the logic of handling events like <em>mouse events</em>, <em>keyboard events</em>, <em>joystick events</em>,
<em>GUI events</em>, etc.</p>
<p>The type of event is passed with the <code>event.EventType</code> field. The corresponding field is filled
with the event parameters.</p>
<p>For example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.type </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> EET_MOUSE_INPUT_EVENT) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (event.MouseInput.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isLeftPressed</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> is cursor position</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, event.MouseInput.X, event.mouseInput.Y);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><strong>Hint:</strong> <code>EventReceiver</code> object has nothing in common with our main game loop. So we should create
some interface, some architecture trick to link those two. Because they are strongly related!</p>
</li>
<li>
<p>Main game loop should contain <strong>rendering call</strong>, <strong>GUI rendering call</strong> and other game logic processing
calls.</p>
<p>The simplest main loop could look like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">beginScene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">video</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">255</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">113</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">113</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">133</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    smgr-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drawAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // draw the 3d scene</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getGUIEnvironment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">drawAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // draw the gui</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    driver-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">endScene</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>There is no simple <em>(or at least, built-in)</em> way to get the delta time between two rendered frames.
<strong>This is an important variable!</strong> We’ll need that later, when we inject physics engine. And Newton GD
is not the only engine requiring this variable!</p>
<p>But that could be easily done with this workaround:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// before main loop</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">u32 then </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTimer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTime</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// within the main game loop</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u32 now </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> device-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTimer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()-></span><span style="color:#6F42C1;--shiki-dark:#B392F0">getTime</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f32 frameDeltaTime </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (f32)(now </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> then) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1000.</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span><span style="color:#6A737D;--shiki-dark:#6A737D"> // delta time in seconds</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">then </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> now;</span></span>
<span class="line"></span></code></pre>
</li>
</ul>
<p>That was some short introduction to the Irrlicht engine. And that’s basically everything we will use
for the next few sections.</p>
<p><a href="/irrlicht-newton-tutorials/2015/08/28/first-script.html" class="btn btn-success">Next chapter</a></p> </div>  </article> </section> </main> <footer> <nav> <div class="prev"> <a href="/page6.html" class="next">&larr; Previous page</a> </div> <div class="current">Page #7 of 11</div> <div class="next"> <a href="/page8.html" class="next">Next page &rarr;</a> </div> </nav> </footer> </body></html>