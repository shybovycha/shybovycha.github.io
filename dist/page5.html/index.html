<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/page5.html/"><!-- Primary Meta Tags --><title>moofoo blog</title><meta name="title" content="moofoo blog"><meta name="description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main> <section> <article> <h1> <a href="/2019/03/21/2019-03-10-casts-in-cpp-explained.html">Type casts in C++, explained</a> </h1> <time datetime="2019-03-21T00:00:56.000Z"> Mar 21, 2019 </time> <div class="content"> <p>As explained by my colleague, former professional C++ developer (now writes schwifty Java).
Below is a quick explanation of four basic C++ type casts. Just for the matter of shorter post,
consider each cast taking a template type <code>T</code> and a parameter value <code>v</code> like this: <code>const_cast&#x3C;T>(v)</code>.</p>
<ul>
<li><code>const_cast</code> - removes the <code>const</code> from the type of <code>v</code> (think of casting <code>const char*</code> will produce <code>char*</code>)</li>
<li><code>static_cast</code> - C-style, unchecked explicit type casting (just like in old 90s: <code>(int) 3.14</code>)</li>
<li><code>reinterpret_cast</code> - hard low-level treating a block of memory as type <code>T</code>, no matter what resides in that memory</li>
<li><code>dynamic_cast</code> - does the runtime checks of param type and template type</li>
</ul> </div>  </article><article> <h1> <a href="/2019/03/20/2019-03-20-partial-application-vs-currying.html">Partial application vs currying</a> </h1> <time datetime="2019-03-20T04:18:56.000Z"> Mar 20, 2019 </time> <div class="content"> <p>Here’s a quick explanation of the difference between <strong>currying</strong> and <strong>partial application</strong>.</p>
<p>For a one- or two-argument functions there is little to none difference. But for function with multiple arguments…</p>
<p>Say you have a function <code>f(a1, a2, a3, a4)</code> (it does not really matter what it returns or what the arguments are):</p>
<ul>
<li>
<p><em>currying</em> it will give you a function of one argument, which will return a function of one argument (and so on and so forth), calling which (the last one-argument function) will give you same result as calling the original function <code>f</code> with all the arguments of single-argument functions passed at once <em>(curried)</em>: <code>curry(f) = f1(x1) => f2(x2) => f3(x3) => f4(x4) === f(x1, x2, x3, x4)</code></p>
</li>
<li>
<p><em>partially applying</em> a function <em>to some N values</em> will give you a function of smaller amount of arguments, where the first <em>N</em> arguments are already defined: <code>papply(f, 1, 17) => f1(x3, x4) === f(1, 17, x3, x4)</code></p>
</li>
</ul>
<p>In Javascript, the two could be implemented like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> curry</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> curry</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> currySub</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">args</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // Surprisingly, `fn.length` returns the number of arguments of a function `fn`</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (args.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fn.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> currySub</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(fn, args.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">concat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ x ]));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, args);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> currySub</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(f, []);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> papply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> f</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> args0</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Array.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">slice</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> args1</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Array.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> args</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> args0.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">concat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(args1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, args);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre> </div>  </article><article> <h1> <a href="/2018/010/15/2018-10-15-newton-gd-irrlicht-tutorial.html">Game development with Newton Game Dynamics and Irrlicht tutorial</a> </h1> <time datetime="2018-10-14T14:00:00.000Z"> Oct 15, 2018 </time> <div class="content"> <img src="/images/slow-compressed.webp" loading="lazy" class="img-responsive pull-right" style="max-height: 150px" alt="Slowpoke image">
<p>As there was not a high load on my tutorial on game development with Irrlicht and Newton Game Dynamics engines
as a separate site, I have decided to merge them with my blog and proceed with occasional updates to both as a
whole.</p>
<p>So far, these are the changes to the tutorial in comparison to what it used to be <em>(long time ago)</em>:</p>
<ul>
<li>moved all the build instructions to <strong>CMake</strong></li>
<li>added scripting with <strong>Lua</strong></li>
<li>upgraded the whole tutorial to match <strong>latest Irrlicht and Newton versions</strong></li>
<li>added chapter on <strong>modelling with Blender</strong></li>
</ul>
<p>The things which are already done (just not published yet), in progress and the future plans for this tutorial include:</p>
<ul>
<li>comparison of different build systems for C++ (including <a href="https://cmake.org/">CMake</a>, <a href="https://bazel.build/">Bazel</a> and <a href="https://buckbuild.com/">Buck</a>)</li>
<li>a better approach to application architecture (plus the comparison of different scripting languages - <a href="https://www.angelcode.com/angelscript/">AngelScript</a>, <a href="http://www.squirrel-lang.org/">Squirrel</a>, <a href="https://www.lua.org/">Lua</a>, <a href="http://chaiscript.com/">ChaiScript</a> and <a href="https://www.python.org">Python</a>)</li>
<li>a sane 3D modelling in blender lessons (preserving texturing and adding advanced materials, possibly even animation!)</li>
<li>advanced topics in Newton Game Dynamics featuring character controller and joints</li>
</ul>
<p>Tutorial chapters <em>(yet to be updated)</em>:</p>
<div>
    <ul>
        <li>
            <a href="/irrlicht-newton-tutorials/2015/08/25/introduction.html">
                Introduction
            </a>
        </li>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>    &#x3C;li></span></span>
<span class="line"><span>        &#x3C;a href="/irrlicht-newton-tutorials/2015/08/26/application-architecture.html"></span></span>
<span class="line"><span>            Application architecture</span></span>
<span class="line"><span>        &#x3C;/a></span></span>
<span class="line"><span>    &#x3C;/li></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &#x3C;li></span></span>
<span class="line"><span>        &#x3C;a href="/irrlicht-newton-tutorials/2015/08/27/first-application.html"></span></span>
<span class="line"><span>            First application</span></span>
<span class="line"><span>        &#x3C;/a></span></span>
<span class="line"><span>    &#x3C;/li></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &#x3C;li></span></span>
<span class="line"><span>        &#x3C;a href="/irrlicht-newton-tutorials/2015/08/28/first-script.html"></span></span>
<span class="line"><span>            First script</span></span>
<span class="line"><span>        &#x3C;/a></span></span>
<span class="line"><span>    &#x3C;/li></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &#x3C;li></span></span>
<span class="line"><span>        &#x3C;a href="/irrlicht-newton-tutorials/2015/08/29/prepare-to-add-some-newtonianity.html"></span></span>
<span class="line"><span>            Let's add some physics</span></span>
<span class="line"><span>        &#x3C;/a></span></span>
<span class="line"><span>    &#x3C;/li></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &#x3C;li></span></span>
<span class="line"><span>        &#x3C;a href="/irrlicht-newton-tutorials/2015/12/15/making-simple-level-with-blender.html"></span></span>
<span class="line"><span>            Modelling simple level with Blender3D</span></span>
<span class="line"><span>        &#x3C;/a></span></span>
<span class="line"><span>    &#x3C;/li></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &#x3C;li></span></span>
<span class="line"><span>        &#x3C;a href="/irrlicht-newton-tutorials/2015/12/16/finishing-the-first-scene.html"></span></span>
<span class="line"><span>            Finishing the first scene</span></span>
<span class="line"><span>        &#x3C;/a></span></span>
<span class="line"><span>    &#x3C;/li></span></span>
<span class="line"><span>&#x3C;/ul></span></span>
<span class="line"><span></span></span></code></pre>
</ul></div> </div>  </article><article> <h1> <a href="/2018/08/08/2018-01-15-software-engineering-101.html">Software Engineering 101: how computer works</a> </h1> <time datetime="2018-08-08T10:20:00.000Z"> Aug 8, 2018 </time> <div class="content"> <p>There is some bit of information about computers which I was never told in school or at the university.
This writing is trying to cover these bits in details for those interested out there.</p>
<h2 id="processors-guts">Processor’s guts</h2>
<p>In essence, processor consists of these main blocks:</p>
<ul>
<li><strong>instruction decoder</strong>, which decodes the operation code (see below) and tells processor what it should do next</li>
<li><strong>ALU</strong> <em>(arithmetical-logic unit)</em> - the device, which performs all the operations a processor is capable of - arithmetic <em>(addition, subtraction, multiplication)</em> and logical <em>(bitwise OR, AND, XOR, NOT; comparing numbers)</em></li>
<li><strong>registers</strong> are the places, where processor takes the input data for each operation and stores the results of each operations</li>
<li><strong>data bus</strong> - the place, which passes data to or from memory (RAM, peripheral devices and other types of memory)</li>
<li><strong>address bus</strong> passes memory addresses between processor and memory (to be read from or written to)</li>
</ul>
<p>To best illustrate our examples, consider this much simplified processor model:</p>
<img src="/images/software-engineering-101/simplified-processor-architecture.webp" loading="lazy" alt="">
<p>It has only three registers, ALU and data/address buses. I will explain all the examples below in reference to this processor.</p>
<h2 id="workflow">Workflow</h2>
<p>Processor works <strong>discretely</strong>, meaning it executes commands at certain points in time <em>(as opposed to <strong>continuous</strong> work, where something works all the time)</em>. Those points in time are marked by <strong>clock signals</strong> <em>(or simply, clocks)</em>. Processor is connected to <em>(or has an internal one)</em> <strong>clock signal generator</strong>, which regularly tells processor to operate. <em>Operation</em> is nothing but a change of the internal processor’ state.</p>
<p>So how does processor knows what to do next? On the first clock signal, CPU loads the command with the help of instruction decoder. On the next clock tick, processor starts executing an instruction <em>(or a command)</em> - it either copies data to / from registers or RAM, or involves ALU. On the next clock, processor increases the command counter by one and hence proceeds to the next instruction from the pool.</p>
<p>In reality, this mechanism is somewhat more complex and involves more steps to just even read the command from the pool. And the pool itself is a unit on a processor chip as well and acts as another register. But to explain the processor operation, I’ve simplified that.</p>
<p><em>Read more to where I explain how a program in Assembly language is transformed to ones and zeroes; show a sample processor instruction set and how a program in C could be compiled to that instruction set.</em></p>
<!--more-->
<h2 id="assembly-language">Assembly language</h2>
<p>Each processor instruction is a chain of ones and zeros. Assume we have these commands processor can understand:</p>
<ul>
<li>adding the values in registers A and B and storing the sum in register C and the information about <em>possible</em> register overflow in register S <em>(this occurs when we do not have enough memory in register to store the result: say we have only 4 bits in each register, then what will the sum of <code>1111</code> and <code>0001</code>? <code>10000</code>, which takes <code>5</code> bits - more than we have in a register; we can then set the result to <code>10000 - 1111 == 0001</code> and proclaim “we have come over the size of register”)</em></li>
<li>subtract the values in registers A and B and handling overflows the same way as in addition <em>(imagine subtracting 0001 - 0001 with only 4-bit-wide registers)</em></li>
<li>multiply registers A and B</li>
<li>divide registers A and B (A / B)</li>
<li>perform bitwise operations AND, OR, NOT and XOR on registers A and B and store the value in register C</li>
<li>set the value of a register (either A or B) to a specific constant value</li>
<li>move a value from register C to either register A or register B</li>
<li>load data from memory under the address specified to a specific register (A or B)</li>
<li>save data from register A or B to a memory under the address specified</li>
<li>compare the values in registers A and B and set the corresponding flag in register C <em>(whether the values are equal or A > B or B > A)</em></li>
<li>go to a specific instruction of a program</li>
<li>go to a specific instruction of a program, based on comparison flags in register C</li>
</ul>
<p>Let us name these commands:</p>
<ol>
<li><code>ADD</code> = A + B -> C</li>
<li><code>SUB</code> = A - B -> C</li>
<li><code>MUL</code> = A * B -> C</li>
<li><code>DIV</code> = A / B -> C</li>
<li><code>NOTA</code> = NOT A</li>
<li><code>NOTB</code> = NOT B</li>
<li><code>AND</code> = A AND B -> C</li>
<li><code>OR</code> = A OR B -> C</li>
<li><code>XOR</code> = A XOR B -> C</li>
<li><code>SHR</code> = A >> B -> C (bitwise shift right)</li>
<li><code>SHL</code> = A &#x3C;&#x3C; B -> C (bitwise shift left)</li>
<li><code>MOV A, const</code> = const -> A</li>
<li><code>MOV B, const</code> = const -> B</li>
<li><code>MOV C, A</code> = C -> A</li>
<li><code>MOV C, B</code> = C -> B</li>
<li><code>MOV A, C</code> = A -> C</li>
<li><code>MOV B, C</code> = B -> C</li>
<li><code>LOAD addr, A</code> = memory[addr] -> A</li>
<li><code>LOAD addr, B</code> = memory[addr] -> B</li>
<li><code>LOADB</code> = memory[A] -> B</li>
<li><code>SAVEB</code> = B -> memory[A]</li>
<li><code>CMP</code> = A &#x3C;=> B -> C</li>
<li><code>JMP line</code> = GOTO line</li>
<li><code>JL line</code> = if A &#x3C; B (from comparison flags in C) then GOTO line</li>
<li><code>JLE line</code> = if A &#x3C;= B then GOTO line</li>
<li><code>JEQ line</code> = if A == B then GOTO line</li>
<li><code>JNEQ line</code> = if A != B then GOTO line</li>
<li><code>JGE line</code> = if A >= B then GOTO line</li>
<li><code>JG line</code> = if A > B then GOTO line</li>
<li><code>NOP</code> = do nothing</li>
</ol>
<p>This is a great subset of Assembly language commands! Just think about it: you can actually represent pretty much any program using only these 30 instructions! All the modern processors’ instructions are mostly optimized variations of the commands listed above.</p>
<p>You can notice each command has its own number. We have fit all our commands in 25 numbers, which is great - in order to represent them in binary number we will only need 5 bits of data (<code>2^5 == 32; 32 > 30</code>). Now, commands have at maximum one argument. Let’s say it could be at maximum 8-bit number (both addresses and lines are numbers; and since processor can only operate numbers - constants are also only numbers; when you need to represent a number as a character or vice versa - just use its ASCII code). Hence we can define an <strong>operation code</strong> format:</p>
<ol>
<li>fixed-width number of 8 bits, containing instruction number</li>
<li>optional 8-bit argument</li>
</ol>
<p>Assembly language is not invented separatedly from processor design, so assume all the integrated units and transistors inside our processor are aligned in a way so that when a processor receives our operation code - all of its components begin to operate immediately, according to the operation logic. In other words, processor is designed in a way which allows it to “understand” operation and its argument and set the results of its execution straight in place, when it arrives at processor’s inputs.</p>
<p>Now let us describe the process of a program execution. The program will calculate the sum of some memory cells and store the result in a memory address:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#E36209;--shiki-dark:#FFAB70"> a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[i];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>We now will represent this program in our simple Assembly language dialect. But first we need to design a few conventions, function call conventions. Our processor has a very limited number of registers, but is capable of operating a very big amount of RAM memory. This amount is actually determined by three factors:</p>
<ol>
<li>the size of an address bus, which determines the maximum memory address which can be represented using ones and zeros (and thus transferred to a processor via wires)</li>
<li>the size of a data bus, which determines the maximum amount of data which can be sent to processor</li>
<li>the capability of ALU, which determins the maximum amount of data which ALU can take in and give out</li>
</ol>
<p>So if the address bus has the size of 8 bits, processor is only capable of addressing <code>2^8 == 256</code> memory cells. But if both data bus and ALU are capable of transporting and operating 32 bits of data - then the amount of data we are able to process is <code>256 cells of 32 bit == 256 * 32 == 8192 bits == 8 MB</code>.</p>
<p>Back to our function call convention, we need to determine how function arguments will be passed in and how the results will be passed out. The better question is not “how” but rather “where” - we have either three registers or memory cells to choose from. Thus we can either pass up to two arguments to a function or act more clever - assume the program’ memory starts at <code>0x0000</code> and has the following format:</p>
<ul>
<li><code>0x0000</code> - the number of program arguments</li>
<li><code>0x0000 + ((n + 1) * 8)</code> - the <code>n-th</code> argument</li>
</ul>
<p>Then we need to determine how many arguments a function can take in and where to store the result of a function. Let us limit the amount of memory dedicated to function arguments to 10. Then we can determine the address of a function result: <code>0x0000 + ((10 + 1) * 8) == 0x0000 + 88 == 0x0058</code>. Everything beyond this address is treated as a program internal memory (used for storing intermediate data, variables, etc.).</p>
<p>In order to define the <code>GOTO</code> operator better and not worry about line numbers we shall use labels (but only during composing programs - assume compiler will substitute them with the actual line number values). Labels will be used like this: <code>LABEL_NAME: &#x3C;instruction></code>.</p>
<p>It would also be nice to be able to comment out some code. To comment the line (and thus do not take it into account when processing) we will use the semicolon symbol: <code>; comment</code>.</p>
<p>Now that we have everything we need to componse a full program we can finally translate our <code>sum</code> function in C to our Assembly dialect:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; program bootstrap:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; these 3 steps are done by the callee (operating system or other function)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; - load the number of arguments, 2, to memory[0x0000]</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; - load the address `*a` to memory[0x0008]</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; - load the value of `n` to memory[0x00F0]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; assumptions:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; - i &#x3C;=> memory[0x0058 + 8] == memory[0x0060]</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; - result &#x3C;=> memory[0x0058] == memory[0x0058] - we can just use the defined-by-convention memory cell in-place</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0060</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; A = &#x26;i</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> B, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0000</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; B = 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">SAVEB                </span><span style="color:#6A737D;--shiki-dark:#6A737D">; move B -> memory[A] &#x3C;=> i = 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0058</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; A = &#x26;result</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> B, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0000</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; B = 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">SAVEB                </span><span style="color:#6A737D;--shiki-dark:#6A737D">; move B -> memory[A] &#x3C;=> result = 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">LOOP</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: LOAD A, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0060</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; i -> A</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">LOAD B, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x00F0</span><span style="color:#6A737D;--shiki-dark:#6A737D">       ; n -> B</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">CMP</span><span style="color:#6A737D;--shiki-dark:#6A737D">                  ; A &#x3C;=> B => C</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">JGE</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> RETURN           </span><span style="color:#6A737D;--shiki-dark:#6A737D">; if i >= n then GOTO RETURN</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">LOAD B, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0060</span><span style="color:#6A737D;--shiki-dark:#6A737D">       ; B = i</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0004</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; A = 4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MUL</span><span style="color:#6A737D;--shiki-dark:#6A737D">                  ; C = A * B &#x3C;=> C = i * 4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> C, A             </span><span style="color:#6A737D;--shiki-dark:#6A737D">; A = C &#x3C;=> A = i * 4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> B, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0004</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; B = *a (the beginning of array `a`)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ADD</span><span style="color:#6A737D;--shiki-dark:#6A737D">                  ; C = A + B &#x3C;=> C = &#x26;a + i * 4 == a[i]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> C, A             </span><span style="color:#6A737D;--shiki-dark:#6A737D">; A = a[i]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">LOAD B, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0058</span><span style="color:#6A737D;--shiki-dark:#6A737D">       ; B = memory[0x0058] &#x3C;=> B = result</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ADD</span><span style="color:#6A737D;--shiki-dark:#6A737D">                  ; C = A + B &#x3C;=> C = result + a[i]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> C, B             </span><span style="color:#6A737D;--shiki-dark:#6A737D">; B = C</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0058</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; A = &#x26;result</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">SAVEB                </span><span style="color:#6A737D;--shiki-dark:#6A737D">; memory[0x0058] = B &#x3C;=> result = B &#x3C;=> result == result + a[i]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">LOAD </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0060</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, B       </span><span style="color:#6A737D;--shiki-dark:#6A737D">; B = i</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0001</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; A = 1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ADD</span><span style="color:#6A737D;--shiki-dark:#6A737D">                  ; C = A + B &#x3C;=> C = i + 1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> C, B             </span><span style="color:#6A737D;--shiki-dark:#6A737D">; B = C &#x3C;=> B = i + 1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0x0060</span><span style="color:#6A737D;--shiki-dark:#6A737D">        ; A = &#x26;i</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">SAVEB                </span><span style="color:#6A737D;--shiki-dark:#6A737D">; memory[0x0060] = B &#x3C;=> i = B &#x3C;=> i = i + 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">JMP</span><span style="color:#D73A49;--shiki-dark:#F97583"> LOOP</span><span style="color:#6A737D;--shiki-dark:#6A737D">             ; GOTO LOOP</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">RETURN:</span><span style="color:#D73A49;--shiki-dark:#F97583"> NOP</span><span style="color:#6A737D;--shiki-dark:#6A737D">          ; program shutdown:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                     ; store the `result` value in memory[0x0058] - we operate on `result` through this address already, nothing to do here</span></span>
<span class="line"></span></code></pre>
<p>For processor to run this code it needs to be compiled to opcodes first. For example, the <code>MOV A, 0x0060</code> instruction will be converted (according to our convention) as:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>0000 1100    0110 0000</span></span>
<span class="line"><span>~~~~~~~~~    ~~~~~~~~~</span></span>
<span class="line"><span>    ^            ^</span></span>
<span class="line"><span>    |            |</span></span>
<span class="line"><span>    |    0x0060 -┘</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    └- MOV A, const</span></span>
<span class="line"><span></span></span></code></pre>
<p>To quickly recap, here is our processor instruction list together with its opcodes:</p>
































































































































































<table><thead><tr><th>No.</th><th>Instruction</th><th>Operation code</th></tr></thead><tbody><tr><td>1</td><td><code>ADD</code></td><td><code>0000 0001 0000 0000</code></td></tr><tr><td>2</td><td><code>SUB</code></td><td><code>0000 0010 0000 0000</code></td></tr><tr><td>3</td><td><code>MUL</code></td><td><code>0000 0011 0000 0000</code></td></tr><tr><td>4</td><td><code>DIV</code></td><td><code>0000 0100 0000 0000</code></td></tr><tr><td>5</td><td><code>NOT A</code></td><td><code>0000 0101 0000 0000</code></td></tr><tr><td>6</td><td><code>NOT B</code></td><td><code>0000 0110 0000 0000</code></td></tr><tr><td>7</td><td><code>AND</code></td><td><code>0000 0111 0000 0000</code></td></tr><tr><td>8</td><td><code>OR</code></td><td><code>0000 1000 0000 0000</code></td></tr><tr><td>9</td><td><code>XOR</code></td><td><code>0000 1001 0000 0000</code></td></tr><tr><td>10</td><td><code>SHR</code></td><td><code>0000 1010 0000 0000</code></td></tr><tr><td>11</td><td><code>SHL</code></td><td><code>0000 1011 0000 0000</code></td></tr><tr><td>12</td><td><code>MOV A, const</code></td><td><code>0000 1100 xxxx xxxx</code></td></tr><tr><td>13</td><td><code>MOV B, const</code></td><td><code>0000 1101 xxxx xxxx</code></td></tr><tr><td>14</td><td><code>MOV C, A</code></td><td><code>0000 1110 0000 0000</code></td></tr><tr><td>15</td><td><code>MOV C, B</code></td><td><code>0000 1111 0000 0000</code></td></tr><tr><td>16</td><td><code>MOV A, C</code></td><td><code>0001 0000 0000 0000</code></td></tr><tr><td>17</td><td><code>MOV B, C</code></td><td><code>0001 0001 0000 0000</code></td></tr><tr><td>18</td><td><code>LOAD A, addr</code></td><td><code>0001 0010 xxxx xxxx</code></td></tr><tr><td>19</td><td><code>LOAD B, addr</code></td><td><code>0001 0011 xxxx xxxx</code></td></tr><tr><td>20</td><td><code>LOADB</code></td><td><code>0001 0100 0000 0000</code></td></tr><tr><td>21</td><td><code>SAVEB</code></td><td><code>0001 0101 0000 0000</code></td></tr><tr><td>22</td><td><code>CMP</code></td><td><code>0001 0110 0000 0000</code></td></tr><tr><td>23</td><td><code>JMP line</code></td><td><code>0001 0111 xxxx xxxx</code></td></tr><tr><td>24</td><td><code>JLE line</code></td><td><code>0001 1000 xxxx xxxx</code></td></tr><tr><td>25</td><td><code>JL line</code></td><td><code>0001 1001 xxxx xxxx</code></td></tr><tr><td>26</td><td><code>JEQ line</code></td><td><code>0001 1010 xxxx xxxx</code></td></tr><tr><td>27</td><td><code>JNEQ line</code></td><td><code>0001 1011 xxxx xxxx</code></td></tr><tr><td>28</td><td><code>JGE line</code></td><td><code>0001 1100 xxxx xxxx</code></td></tr><tr><td>29</td><td><code>JG line</code></td><td><code>0001 1101 xxxx xxxx</code></td></tr><tr><td>30</td><td><code>NOP</code></td><td><code>0001 1110 0000 0000</code></td></tr></tbody></table>
<p>We will also need to extract only effective lines from our code and number each line (in order to operate with JMP-like instructions). And then all we need to do - is to substitute the commands in the source code with the ones from a table above and replace all those <code>xxxx xxxx</code> values (which stand for 8 bits of instruction’ argument):</p>





























































































































































































































































<table><thead><tr><th>Line no.</th><th>Code</th><th>Instruction code</th><th>Argument</th><th>Argument (binary)</th><th>Instruction + argument</th></tr></thead><tbody><tr><td>0</td><td><code>MOV A, 0x0060</code></td><td><code>0000 1100 xxxx xxxx</code></td><td><code>0x0060</code></td><td><code>0110 0000</code></td><td><code>0000 1100 0110 0000</code></td></tr><tr><td>1</td><td><code>MOV B, 0x0000</code></td><td><code>0000 1101 xxxx xxxx</code></td><td><code>0x0000</code></td><td><code>0000 0000</code></td><td><code>0000 1101 0000 0000</code></td></tr><tr><td>2</td><td><code>SAVEB</code></td><td><code>0001 0101 0000 0000</code></td><td></td><td></td><td><code>0001 0101 0000 0000</code></td></tr><tr><td>3</td><td><code>MOV A, 0x0058</code></td><td><code>0000 1100 xxxx xxxx</code></td><td><code>0x0058</code></td><td><code>0101 1000</code></td><td><code>0000 1100 0101 1000</code></td></tr><tr><td>4</td><td><code>MOV B, 0x0000</code></td><td><code>0000 1101 xxxx xxxx</code></td><td><code>0x0000</code></td><td><code>0000 0000</code></td><td><code>0000 1101 0000 0000</code></td></tr><tr><td>5</td><td><code>SAVEB</code></td><td><code>0001 0101 0000 0000</code></td><td></td><td></td><td><code>0001 0101 0000 0000</code></td></tr><tr><td>6</td><td><code>LOOP: LOAD A, 0x0060</code></td><td><code>0001 0010 xxxx xxxx</code></td><td><code>0x0060</code></td><td><code>0110 0000</code></td><td><code>0001 0010 0110 0000</code></td></tr><tr><td>7</td><td><code>LOAD B, 0x00F0</code></td><td><code>0001 0011 xxxx xxxx</code></td><td><code>0x00F0</code></td><td><code>1111 0000</code></td><td><code>0001 0011 1111 0000</code></td></tr><tr><td>8</td><td><code>CMP</code></td><td><code>0001 0110 0000 0000</code></td><td></td><td></td><td><code>0001 0110 0000 0000</code></td></tr><tr><td>9</td><td><code>JGE RETURN</code></td><td><code>0001 1100 xxxx xxxx</code></td><td><code>29</code></td><td><code>0001 1101</code></td><td><code>0001 1100 0001 1101</code></td></tr><tr><td>10</td><td><code>LOAD B, 0x0060</code></td><td><code>0001 0011 xxxx xxxx</code></td><td><code>0x0060</code></td><td><code>0110 0000</code></td><td><code>0001 0011 0110 0000</code></td></tr><tr><td>11</td><td><code>MOV A, 0x0004</code></td><td><code>0000 1100 xxxx xxxx</code></td><td><code>0x0004</code></td><td><code>0000 0100</code></td><td><code>0000 1100 0000 0100</code></td></tr><tr><td>12</td><td><code>MUL</code></td><td><code>0000 0011 0000 0000</code></td><td></td><td></td><td><code>0000 0011 0000 0000</code></td></tr><tr><td>13</td><td><code>MOV C, A</code></td><td><code>0000 1110 0000 0000</code></td><td></td><td></td><td><code>0000 1110 0000 0000</code></td></tr><tr><td>14</td><td><code>MOV B, 0x0004</code></td><td><code>0000 1101 xxxx xxxx</code></td><td><code>0x0004</code></td><td><code>0000 0100</code></td><td><code>0000 1101 0000 0100</code></td></tr><tr><td>15</td><td><code>ADD</code></td><td><code>0000 0001 0000 0000</code></td><td></td><td></td><td><code>0000 0001 0000 0000</code></td></tr><tr><td>16</td><td><code>MOV C, A</code></td><td><code>0000 1110 0000 0000</code></td><td></td><td></td><td><code>0000 1110 0000 0000</code></td></tr><tr><td>17</td><td><code>LOAD B, 0x0058</code></td><td><code>0001 0011 xxxx xxxx</code></td><td><code>0x0058</code></td><td><code>0101 1000</code></td><td><code>0001 0011 0101 1000</code></td></tr><tr><td>18</td><td><code>ADD</code></td><td><code>0000 0001 0000 0000</code></td><td></td><td></td><td><code>0000 0001 0000 0000</code></td></tr><tr><td>19</td><td><code>MOV C, B</code></td><td><code>0000 1111 0000 0000</code></td><td></td><td></td><td><code>0000 1111 0000 0000</code></td></tr><tr><td>20</td><td><code>MOV A, 0x0058</code></td><td><code>0000 1100 xxxx xxxx</code></td><td><code>0x0058</code></td><td><code>0101 1000</code></td><td><code>0000 1100 0101 1000</code></td></tr><tr><td>21</td><td><code>SAVEB</code></td><td><code>0001 0101 0000 0000</code></td><td></td><td></td><td><code>0001 0101 0000 0000</code></td></tr><tr><td>22</td><td><code>LOAD B, 0x0060</code></td><td><code>0001 0011 xxxx xxxx</code></td><td><code>0x0060</code></td><td><code>0110 0000</code></td><td><code>0001 0011 0110 0000</code></td></tr><tr><td>23</td><td><code>MOV A, 0x0001</code></td><td><code>0000 1100 xxxx xxxx</code></td><td><code>0x0001</code></td><td><code>0000 0001</code></td><td><code>0000 1100 0000 0001</code></td></tr><tr><td>24</td><td><code>ADD</code></td><td><code>0000 0001 0000 0000</code></td><td></td><td></td><td><code>0000 0001 0000 0000</code></td></tr><tr><td>25</td><td><code>MOV C, B</code></td><td><code>0000 1111 0000 0000</code></td><td></td><td></td><td><code>0000 1111 0000 0000</code></td></tr><tr><td>26</td><td><code>MOV A, 0x0060</code></td><td><code>0000 1100 xxxx xxxx</code></td><td><code>0x0060</code></td><td><code>0110 0000</code></td><td><code>0000 1100 0110 0000</code></td></tr><tr><td>27</td><td><code>SAVEB</code></td><td><code>0001 0101 0000 0000</code></td><td></td><td></td><td><code>0001 0101 0000 0000</code></td></tr><tr><td>28</td><td><code>JMP LOOP</code></td><td><code>0001 0111 xxxx xxxx</code></td><td><code>6</code></td><td><code>0000 0110</code></td><td><code>0001 0111 0000 0110</code></td></tr><tr><td>29</td><td><code>RETURN: NOP</code></td><td><code>0001 1110 0000 0000</code></td><td></td><td></td><td><code>0001 1110 0000 0000</code></td></tr></tbody></table>
<p>We have just did the same job a compiler does for us when we write code in a high-level language like C. You can see the code is verbose, what is caused by us and the limitations / conventions we have agreed on. But we can extend either the assembly language by adding new instructions, which will simplify writing programs or by extending the processor architecture by introducing stack and increasing the power of ALU etc. For instance, we could have changed the moving data between memory and registers and thus reduce the amount of both registers needed to do that and the amount of commands needed for the operation:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> A, addr</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> B, value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">SAVEB</span></span>
<span class="line"></span></code></pre>
<p>could become</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">MOV</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> B, [addr]</span></span>
<span class="line"></span></code></pre>
<p>Or we could have agreed on opcode size and skip the 8 bits of data for instructions without arguments and thus reduce the size of compiled programs.</p>
<h2 id="processing-programs">Processing programs</h2>
<p>What happens when we run a program on our PC? There is a little bit of magic which must happen first. You run a program
(most of the time) from an operating system. And this operating system needs to perform some actions
before it can send your program’s commands straight to a processor - reserve some memory, make scheduling…
And since most operating systems are meant to be multi-tasked (allow multiple programs to run simultaneously),
OS can not allow your program to just send all of its commands to a processor, one by one - if your program is faulty then
any other program might have never been executed again, even the OS itself! That’s why operating system decides
when to send the next command to a processor to execute it. This also allows for optimizations on multi-core
and multi-processor systems - when two operations could be executed simultaneously, whithout overwriting memory used
by another one - it can be run on a different core or processor to speed up the execution.</p>
<p>That’s why our program will not contain programmer-defined commands only. Let’s have a look at the
standard Windows executable file (PE32) structure:</p>
<img src="/images/functional-programming-in-a-real-world/pe32-diagram.webp" loading="lazy" alt="">
<p>You can see it has lots of <em>headers</em>, which describe different aspects of a program and
two major <em>sections</em> - <strong>text</strong> (containing the code itself) and <strong>data</strong> (containing all
the constant definitions and allocations). Each executable can also contain resources like images,
sounds and others - if needed.</p>
<p>We all know how to write a program in, say, C. But how a program in C (or any other language) is “understood”
(and thus, executed) by a processor? One may have heard of Assembly language. This is a low-level programming
language (in opposite to C, which is a high-level programming language). <em>“Low-level”</em> means that a programmer
writes instructions for the processor in the order processor will pick them up and execute, one by one, exactly as
they are set in a program, ommiting syntactic sugar constructions like loops, if-then-else operators and so on.
Usually in such programming languages programmers operate memory addresses and numbers only.
On the other hand, <em>high-level</em> programs, containing all the syntactic sugar features, are first translated
to something processor can “understand” and execute - processors commands (instructions). The program is also being
in terms of removing unused and unreacheable code, replacing expressions which can be pre-calculated into the results
of pre-calculation (like the expression <code>x * 2 * 32</code> could be simply written as <code>x * 64</code> or <code>x &#x3C;&#x3C; 4</code>, which most
of the compilers will do by default because of performance reasons - binary shift operation is way more faster than
multiplication; but for programmer it might be required to stay explicit in order to highlight some calculations or
just to stay clear for other programmers).</p>
<p>Let us have a look at how programs are compiled. Consider this program in C:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> product</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>It will be compiled into this assembly code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">product(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">):</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # @product(int, int)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  imul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">esi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">edi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  ret</span></span>
<span class="line"></span></code></pre>
<p>Looks simple, huh?</p>
<p>In essence, each line of a program in assembly language looks like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">label:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> command operand1, operand2</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # comment</span></span>
<span class="line"></span></code></pre>
<p>Both label, operands and comment are optional with the exception that operands requirements
depend on command.</p>
<p>Operands could be either numbers, registers (refer to processor registers) or memory addresses.</p>
<p>Registers represent cells in processor memory, those are very limited in number and size, but are directly
accessed by processor and thus are very, very fast. There are eight general-purpose registers, common for
majority of processors: AX, BX, CX, DX, SP, BP, SI, DI. There are other registers, but we will cover them later.
Each command will store its result in one of
these registers. These registers have size of one word (2 bytes, 16 bits). Each register has “lower byte” and,
correspondingly, “higher byte” - for AX they are AL (low) and AH (high), representing first and last 8 bits of
a register. These registers are available for all 16-bit processors. More modern 32-bit processors have extended
versions of each register, for AX it is EAX, for CX its ECX and so on. They are twice as big as their non-extended
versions (32 bit, 2 words). Nowadays 64-bit systems have extended versions of extended registers, having 4 words
and precended with letter R: RAX, RBX and so on. There are also 16 registers worth 128 bit each, XMM0 .. XMM15.</p>
<p>Addressing memory refers to the computer’s RAM; in order to operate with RAM processor first copies the
data from RAM to its registers and then performs operation on data in registers. Processor is unable
to operate with RAM data directly. You can see clearly such operations require additional actions
from processor, namely - copy data from RAM to registers before executing operation and copy the data
back to RAM after the operation execution (usually this step is stated separatedly by a programmer).
This is time-consuming. And since RAM is not that fast as processor’s registers, it makes operations slow.
Memory is addressed using one of these syntaxes:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[address] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; [0x12345]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[register] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; [RAX] - takes address, contained in register RAX</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[register + number] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; [RAX + 2]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[register + register * number] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; [RAX + RBX * 3]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[register + register * number + number] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; [RBX + EAX * 4 + 3]</span></span>
<span class="line"></span></code></pre>
<p>You can also do more tricky thing: define a named constant - give a literal name to a number and then refer
to a value by its name. But first you need to reserve a memory for it:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">constant_name:</span><span style="color:#D73A49;--shiki-dark:#F97583"> db</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0x123</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; define one byte value (0x123) and give it a name "constant_name"</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">constant2:</span><span style="color:#D73A49;--shiki-dark:#F97583"> dw</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 'ab' </span><span style="color:#6A737D;--shiki-dark:#6A737D">; define one word (two bytes) of values 0x61 and 0x62, correspondingly</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">const3:</span><span style="color:#D73A49;--shiki-dark:#F97583"> dd</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 'abcd' </span><span style="color:#6A737D;--shiki-dark:#6A737D">; define double-word (four bytes)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">const4:</span><span style="color:#D73A49;--shiki-dark:#F97583"> dq</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0x123456789abcdef0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; 8-byte wide constant</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">const5:</span><span style="color:#D73A49;--shiki-dark:#F97583"> dq</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1.234567e20</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; double-precision constant</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">const6:</span><span style="color:#D73A49;--shiki-dark:#F97583"> dt</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1.234567e20</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; extended-precision constant</span></span>
<span class="line"></span></code></pre>
<p>Note I’m constantly mentioning numbers, but never characters or strings. That’s because eventually all this
data is just a number (character code or a pointer to a memory - effectively, an address of a memory). And
processor can only operate on numbers, nothing else. Compiler will convert all these characters and floating-point
values to hexadecimal integer values anyway.</p>
<p>You can also reserve a bunch of memory cells using <code>res</code> command:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">const1:</span><span style="color:#D73A49;--shiki-dark:#F97583"> resb</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; reserve 2 bytes</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">const2:</span><span style="color:#D73A49;--shiki-dark:#F97583"> resw</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 16</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; reserve 16 words</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">const3:</span><span style="color:#D73A49;--shiki-dark:#F97583"> resq</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 7</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; reserve seven 8-byte cells</span></span>
<span class="line"></span></code></pre>
<p>This way each constant will point to the first of the reserved array’ cells in RAM.</p>
<p>Let’s take a look at our example again:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> product</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Its assembly code is:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">product(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">):</span><span style="color:#6A737D;--shiki-dark:#6A737D"> # @product(int, int)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  imul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">esi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">edi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  ret</span></span>
<span class="line"></span></code></pre>
<p>This program has exactly three effective lines:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">imul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">esi</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; multiply the data in two registers, EDI and ESI and store the result of multiplication in EAX register</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">edi</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; copy the data from EAX to EDI</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">ret</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; restore pointer to the currently running command and the values in registers from stack</span></span>
<span class="line"></span></code></pre>
<p>See, assembly is still a somewhat high-level language - one command does a little bit of “magic” like
storing the result somewhere, or restoring the processor state (<code>ret</code>) or storing its state and moving to the
different command or sub-routing or function (<code>call</code>). Each processor has its own set of commands, which might
be more optimized for this particular processor. That’s why it is really hard to get each program run best
on all possible computers when distributing it. But the “basic set” of commands is quite common for majority
of processors and you can be quite confident about them.</p>
<p>So after the program is written in Assembly (which is the lowest reasonable language we can more or less easily
write code in) it is compiled into… something… <em>Binary code</em> is what you might have been thinking of.
And you are totally correct - programs are essentially just a set of ones and zeros. But more interesting question
is how a computer executes them?</p>
<p>If we compile our function into binary file - we will get each Assembly command translated into a long
hexadecimal (or binary - if you split a long list of ones and zeros into chunks of 16 digits - you will be able to
write them down as one character, which is much more compach, right?) value, describing the opcode of a command
and its arguments. Each Assembly command has its own code, just like character in a string. And each register has
its own code too. Combine them - and you will get a long number. Convert it to binary - and you will get a line of
machine codes.</p>
<p>Processor then reads the operation code and acts exactly as it says - if it would be <code>imul RAX, RBX</code> - processor
will do just exactly as it says - multiply the value in register <code>RAX</code> by the value in register <code>RBX</code> and then
save the result in register <code>RAX</code>. To explain how processor actually multiplies values from registers and stores
them - we need to go one level lower - and get familiar with how processor does that on the electonics level.
But we won’t do that. Instead, we will just scratch the surface by describing how <em>fast</em> those operations could be.</p>
<p>You might have heard about <em>processor’s frequency</em> or <em>clock rate</em>. This is a number, showing how frequently an
electronic impulse is sent over all the processor’s schematic to enforce its state update. Effectively, what it means is each processor operation like multiplication, addition, subtraction, moving the data around and others, need to change the state of different electronic components, mainly - triggers and transistors. When talking about addition of two registers, for example, processor will need to calculate the sum of each bit pair in registers given, handling overflows, different register lengths and clearing the state of the resutl register beforehand. Some processors are designed to do that in one cycle, but mainly addition will be done in several <em>clocks</em>. Hence a processor with a clock rate of 1 GHz <strong>will not</strong> make 1 billion additions, subtractions, multiplications or other operations per second. For a reference, here is a diagram, showing how many clocks does each operation takes in average</p>
<p>Remember I have mentioned optimization a while ago? Here’s a sample table of how many clocks do some processor
instructions take (in average):</p>
<img src="/images/functional-programming-in-a-real-world/cpu-operations-cost.webp" loading="lazy" alt="">
<p>With this knowledge we can easily talk about more high-level things.</p>
<p><em>Based on <a href="https://computer.howstuffworks.com/microprocessor2.htm">How stuff works</a></em></p> </div>  </article><article> <h1> <a href="/2018/06/01/2018-06-01-zsh-startup-performance.html">Improving ZSH startup performance</a> </h1> <time datetime="2018-06-01T04:00:00.000Z"> Jun 1, 2018 </time> <div class="content"> <h2 id="adding-profiling-to-zsh">Adding profiling to ZSH</h2>
<p>Add this line as the first one, to the very top of your <code>~/.zshrc</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>zmodload zsh/zprof</span></span>
<span class="line"><span></span></span></code></pre>
<p>And add this one to the very bottom of this same file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>zprof</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now, whenever you open up ZSH, you shall see a list of things which start and how much time each entry takes to load.
For me it was like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>num  calls                time                       self            name</span></span>
<span class="line"><span>-----------------------------------------------------------------------------------</span></span>
<span class="line"><span> 1)    1        1123.49  1123.49   87.59%   1123.49  1123.49   87.59%  _pyenv-from-homebrew-installed</span></span>
<span class="line"><span> 2)    1          84.02    84.02    6.55%     59.50    59.50    4.64%  compinit</span></span>
<span class="line"><span> 3)    3          26.94     8.98    2.10%     26.94     8.98    2.10%  __sdkman_export_candidate_home</span></span>
<span class="line"><span> 4)    3          25.77     8.59    2.01%     25.77     8.59    2.01%  __sdkman_prepend_candidate_to_path</span></span>
<span class="line"><span> 5)    2          24.52    12.26    1.91%     24.52    12.26    1.91%  compaudit</span></span>
<span class="line"><span> 6)    2           7.98     3.99    0.62%      7.98     3.99    0.62%  grep-flag-available</span></span>
<span class="line"><span> 7)    2           7.54     3.77    0.59%      7.54     3.77    0.59%  env_default</span></span>
<span class="line"><span> 8)    2           2.43     1.22    0.19%      2.43     1.22    0.19%  _has</span></span>
<span class="line"><span> 9)   23           2.43     0.11    0.19%      2.43     0.11    0.19%  compdef</span></span>
<span class="line"><span>10)    1           1.09     1.09    0.09%      1.09     1.09    0.09%  colors</span></span>
<span class="line"><span>11)   12           0.38     0.03    0.03%      0.38     0.03    0.03%  is_plugin</span></span>
<span class="line"><span>12)    1           0.38     0.38    0.03%      0.38     0.38    0.03%  is-at-least</span></span>
<span class="line"><span>13)    1           0.21     0.21    0.02%      0.21     0.21    0.02%  _homebrew-installed</span></span>
<span class="line"><span>14)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  __sdkman_echo_debug</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-----------------------------------------------------------------------------------</span></span>
<span class="line"><span></span></span></code></pre>
<p>I was able to measure the total startup time by running <code>time zsh -i -c exit</code>. And the total startup time was <strong>almost two seconds</strong>.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>zsh -i -c exit  1.16s user 0.73s system 100% cpu 1.889 total</span></span>
<span class="line"><span></span></span></code></pre>
<p>As you can see, <code>pyenv</code> takes whole bunch of time (1123 millis!). So I do have the <code>pyenv</code> plugin for ZSH and I did disable it. Here’s what happened afterwards:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>num  calls                time                       self            name</span></span>
<span class="line"><span>-----------------------------------------------------------------------------------</span></span>
<span class="line"><span> 1)    1          91.42    91.42   53.38%     62.48    62.48   36.48%  compinit</span></span>
<span class="line"><span> 2)    2          28.94    14.47   16.90%     28.94    14.47   16.90%  compaudit</span></span>
<span class="line"><span> 3)    3          28.62     9.54   16.71%     28.62     9.54   16.71%  __sdkman_export_candidate_home</span></span>
<span class="line"><span> 4)    3          27.65     9.22   16.14%     27.65     9.22   16.14%  __sdkman_prepend_candidate_to_path</span></span>
<span class="line"><span> 5)    2           8.27     4.14    4.83%      8.27     4.14    4.83%  grep-flag-available</span></span>
<span class="line"><span> 6)    2           8.22     4.11    4.80%      8.22     4.11    4.80%  env_default</span></span>
<span class="line"><span> 7)    2           2.55     1.28    1.49%      2.55     1.28    1.49%  _has</span></span>
<span class="line"><span> 8)   23           2.50     0.11    1.46%      2.50     0.11    1.46%  compdef</span></span>
<span class="line"><span> 9)    1           1.24     1.24    0.72%      1.24     1.24    0.72%  colors</span></span>
<span class="line"><span>10)    1           0.41     0.41    0.24%      0.41     0.41    0.24%  is-at-least</span></span>
<span class="line"><span>11)   10           0.37     0.04    0.21%      0.37     0.04    0.21%  is_plugin</span></span>
<span class="line"><span>12)    1           0.02     0.02    0.01%      0.02     0.02    0.01%  __sdkman_echo_debug</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-----------------------------------------------------------------------------------</span></span>
<span class="line"><span></span></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>zsh -i -c exit  0.28s user 0.23s system 96% cpu 0.526 total</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="nvm">NVM</h2>
<p>Not to forget I had NVM installed with the default settings.</p>
<p>With it I had the startup time of <code>1.9</code> seconds:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>zsh -i -c exit  1.17s user 0.74s system 99% cpu 1.916 total</span></span>
<span class="line"><span></span></span></code></pre>
<p>If you follow this <a href="http://www.growingwiththeweb.com/2018/01/slow-nvm-init.html">simple instruction</a> or just replace these two lines, initializing NVM in your <code>~/.zshrc</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[ </span><span style="color:#D73A49;--shiki-dark:#F97583">-s</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$NVM_DIR</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/nvm.sh"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] &#x26;&#x26; </span><span style="color:#6F42C1;--shiki-dark:#B392F0">\.</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$NVM_DIR</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/nvm.sh"</span><span style="color:#6A737D;--shiki-dark:#6A737D">  # This loads nvm</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[ </span><span style="color:#D73A49;--shiki-dark:#F97583">-s</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$NVM_DIR</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/bash_completion"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] &#x26;&#x26; </span><span style="color:#6F42C1;--shiki-dark:#B392F0">\.</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$NVM_DIR</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/bash_completion"</span><span style="color:#6A737D;--shiki-dark:#6A737D">  # This loads nvm bash_completion</span></span>
<span class="line"></span></code></pre>
<p>with these lines:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#D73A49;--shiki-dark:#F97583">-s</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$HOME</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/.nvm/nvm.sh"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] &#x26;&#x26; [ </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "$(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">type</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> __init_nvm)"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> function ]; </span><span style="color:#D73A49;--shiki-dark:#F97583">then</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583"> export</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NVM_DIR</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$HOME</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/.nvm"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#D73A49;--shiki-dark:#F97583">-s</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$NVM_DIR</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/bash_completion"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] &#x26;&#x26; </span><span style="color:#005CC5;--shiki-dark:#79B8FF">.</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$NVM_DIR</span><span style="color:#032F62;--shiki-dark:#9ECBFF">/bash_completion"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583"> declare</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -a</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> __node_commands</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'nvm'</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'node'</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'npm'</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'yarn'</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'gulp'</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'grunt'</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'webpack'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> __init_nvm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">   for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">__node_commands</span><span style="color:#032F62;--shiki-dark:#9ECBFF">[</span><span style="color:#D73A49;--shiki-dark:#F97583">@</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> unalias</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> $i; </span><span style="color:#D73A49;--shiki-dark:#F97583">done</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">   .</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$NVM_DIR</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/nvm.sh</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">   unset</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> __node_commands</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">   unset</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -f</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> __init_nvm</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583"> for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">__node_commands</span><span style="color:#032F62;--shiki-dark:#9ECBFF">[</span><span style="color:#D73A49;--shiki-dark:#F97583">@</span><span style="color:#032F62;--shiki-dark:#9ECBFF">]}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> alias</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> $i</span><span style="color:#032F62;--shiki-dark:#9ECBFF">='__init_nvm &#x26;&#x26; '</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$i; </span><span style="color:#D73A49;--shiki-dark:#F97583">done</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">fi</span></span>
<span class="line"></span></code></pre>
<p>The start-up time drops by <code>0.1</code> second. But it still is an improvement, right?</p> </div>  </article><article> <h1> <a href="/2018/06/01/2018-06-01-one-night-games-snake.html">One-night games: snake</a> </h1> <time datetime="2018-05-31T14:00:00.000Z"> Jun 1, 2018 </time> <div class="content"> <p><a href="https://github.com/shybovycha/moo-snake">source code</a></p>
<img src="" alt="" data-src="/images/one-night-games/snake-screenshot.webp" class="medium">
<p>Under the cut you can find the interesting algorithmic solutions I’ve mentioned.</p>
<!--more-->
<h2 id="snake">Snake</h2>
<p><a href="https://github.com/shybovycha/moo-snake">Source code</a></p>
<p>Snake is a very simple game to implement. The core is the field, which is a binary matrix of whether there is something to draw in a specific position or there is nothing. The game is tightly bound to the timer, since it is almost a turn-based game and the movement speed should increase as the snake grows. The only things which might be interesting are: snake movement <em>(in other words, how do we update the game matrix on each timer tick)</em>, snake growth <em>(or what happens when a snake collides with the food)</em> and the collision test <em>(or how to determine what the snake collided with)</em>.</p>
<p>The snake movement is quite simple - try thinking of a snake as of a stack of <code>Vector2</code> objects, having just the coordinates of each body part of a snake:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Point</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    equals</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">other</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.x </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> other.x) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.y </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> other.y));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Snake</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">points</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">direction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">maxX</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">maxY</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.points </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> points;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.direction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> direction;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxX </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> maxX;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxY </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> maxY;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    advance</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.points.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">shift</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.points.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">nextPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    nextPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { x, y } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.points.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">last</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.direction </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'up'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            y</span><span style="color:#D73A49;--shiki-dark:#F97583">--</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.direction </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'right'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            x</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.direction </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'down'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            y</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.direction </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'left'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            x</span><span style="color:#D73A49;--shiki-dark:#F97583">--</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (x </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxX;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (x </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxX) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (y </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxY;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (y </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxY) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Point</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(x, y);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>On every timer tick we should “advance” the snake in the direction of movement by simply adding a new element to the top of a stack and remove the last one, representing snake’s tail. When a player hits any of the arrow keys, we simply set the movement direction for a snake, which will be considered on a next timer tick:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Game</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">rows</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">cols</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rows;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cols;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.score </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.snake </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_createSnake</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.food </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_generateFood</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    updateState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nextSnakePoint</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.snake.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">nextPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.food.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">equals</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(nextSnakePoint)) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.score</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.snake.points.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(nextSnakePoint);</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.food </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_generateFood</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.snake.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">advance</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>There is a need for one more bounds check: when a snake is about to cross the boundaries of a game field, we need to change the next point a snake is about to advance to the opposite “wall” <em>(if we want such a feature)</em>.</p>
<p>The game ends when a snake hits one of its body parts. The check for that is really simple: we just need to check whether the next point is contained in the stack of a snake:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">isGameOver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> p</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.snake.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">nextPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.snake.points.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">find</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">equals</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(p));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>To render a field, we need to render the food and each of snake’s body parts:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Renderer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    _render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_clearCanvas</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.game.snake.points.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.game.snake.points[i];</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_drawRectangle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(x </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize, y </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_drawRectangle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.game.food.x </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.game.food.y </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cellSize);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h2 id="tetris">Tetris</h2>
<p><a href="https://github.com/shybovycha/moo-tetris">Source code</a></p>
<p>The most interesting part about tetris was to implement piece rotation. I’ve represented all the possible figures as a list of matrices.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> FIGURES</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span></code></pre>
<p>The problem however is that all figures are different, hence all the matrices have different dimensions - a “stick” is 4x1, whilst a “cube” is 2x2. Other pieces are 3x2. Rotation algorithm might not be simple. And it implies one limitation - pieces should preserve their position - not to move to the sides when rotating them.</p>
<p>Pieces are best represented as matrices, but in order to operate on matrices we need to have the corresponding methods. I decided to just implement the class <code>Piece</code> with the essential methods:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Piece</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">row</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">col</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.piece </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [].slice.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape);</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.col </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.row </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> row;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Here <code>row</code> and <code>col</code> describe the position of a piece on a screen whilst <code>rows</code> and <code>cols</code> are the dimensions of a piece. <code>piece</code> contains the matrix data of a piece.</p>
<p>The rotation algorithm I’ve implemented tries to transpose piece’s matrix in a very simple manner:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Piece</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    rotate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result[i]) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                result[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                result[i][t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure[t][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>What it does is actually creating a totally new matrix, where the dimensions are swapped and the data is the opposite data to what was in the original matrix. In other words, we iterate the original matrix over its normal indices, but write the data to the new matrix in the reversed direction. So if we read the row with index <code>0</code> and column with index <code>2</code>, this means we need to write the data from the source matrix at <code>data[0][2]</code> to the destination matrix at <code>data[2][0]</code>. Sounds correct, right?</p>
<p>But if we do that with the array, we will end up having the new matrix mirrored:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>           given:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      0   1   2   3</span></span>
<span class="line"><span>    +---+---+---+---+</span></span>
<span class="line"><span> 0  | 1 | 2 | 3 | 4 |</span></span>
<span class="line"><span>    +---+---+-------+</span></span>
<span class="line"><span> 1  | 5 | 6 | 7 | 8 |</span></span>
<span class="line"><span>    +---+---+---+---+</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>            expectation:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      0   1                0    1</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span> 0  | 4 | 8 |          0  | 5 | 1 |</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span> 1  | 3 | 7 |          1  | 6 | 2 |</span></span>
<span class="line"><span>    +---+---+    or       +---+---+</span></span>
<span class="line"><span> 2  | 2 | 6 |          2  | 7 | 3 |</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span> 3  | 1 | 5 |          3  | 8 | 4 |</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    reality:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      0   1</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 0  | 1 | 5 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 1  | 2 | 6 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 2  | 3 | 7 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 3  | 4 | 8 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span></span></span></code></pre>
<p>Thus we need to copy the data to the new matrix in the reverse order along one axis.</p>
<p>In order to allow for a two-way rotation I’ve introduced a numeric argument to the <code>Piece#rotate</code> method, defining which way <em>(clockwise or counter-clockwise)</em> the piece will be rotated:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">rotate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(direction) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        result[i][t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> direction </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure[t][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i] </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t][i];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>The other interesting algorithm is collision detection. This is slightly more complex than just checking boundariesof a figure. Since we can not think of a regular (circle, rectangle, line) shape for the field formed by the previous pieces, we will need to check each cell of a field against each cell of a currently falling piece. But if we decide to do that - we should either do this before rendering the falling piece (to check whether we are allowed to render it) and then, in the case of collision we will be made to “cancel” the piece’s move down one cell. Alternatively, we could check each cell of a field agains the data of a falling piece, but with a one row shift down:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>what we draw:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span>|   xx  |</span></span>
<span class="line"><span>|    x  |</span></span>
<span class="line"><span>|    x  |</span></span>
<span class="line"><span>|   *   |</span></span>
<span class="line"><span>| ****  |</span></span>
<span class="line"><span>| ***** |</span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>what we check:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span>|       |</span></span>
<span class="line"><span>|   ..  |</span></span>
<span class="line"><span>|    .  |</span></span>
<span class="line"><span>|   *.  |</span></span>
<span class="line"><span>| ****  |</span></span>
<span class="line"><span>| ***** |</span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>same example,</span></span>
<span class="line"><span>but with the</span></span>
<span class="line"><span>collision occuring:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span>|       |</span></span>
<span class="line"><span>|       |</span></span>
<span class="line"><span>|   ..  |</span></span>
<span class="line"><span>|   *.  |</span></span>
<span class="line"><span>| ***!  |</span></span>
<span class="line"><span>| ***** |</span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span></span></span></code></pre>
<p>The check is trivial: if both field cell at the checked position and any of the piece data at the piece position plus one row shift down are non-zero - then we have detected a collision and we should not move the piece down, but just render it and generate the next piece.</p> </div>  </article><article> <h1> <a href="/2017/09/18/2017-09-18-intellij-productivity-tips.html">IntelliJ productivity tips</a> </h1> <time datetime="2017-09-18T07:00:00.000Z"> Sep 18, 2017 </time> <div class="content"> <p>This post is based on a <a href="https://www.youtube.com/watch?v=eq3KiAH4IBI">talk on IntelliJ productivity</a> and contains some tips and tricks I found handy in my everyday work.</p>
<p>You may disagree with me or find these recommendations useless for yourself, but I and some of my teammates have found out these tips have made us more efficient when dealing with lots of code in a big project.</p>
<ul>
<li>
<p><strong>say “no!” to tabs</strong> — that’s it — disable them. Forever. IntellJ has many ways to navigate the project, just check them out: <kbd>Cmd+E</kbd>, <kbd>Cmd+Alt+←</kbd> and <kbd>Cmd+Alt+→</kbd></p>
</li>
<li>
<p><strong>stop using mouse</strong> — just as with navigation in open files, IntelliJ offers awesome code navigation: want to go to the method definition? <kbd>Cmd+B</kbd>, want to find a file or class or method? <kbd>Shift, Shift</kbd> or <kbd>Ctrl+Shift+N</kbd> or <kbd>Ctrl+N</kbd>, want to move around in Project Manager? <kbd>Cmd+1</kbd> (and then <kbd>Esc</kbd> to switch between editor and Manager)</p>
</li>
<li>
<p><strong>use IntelliJ’s code intelligence</strong> — if you forgot what params method takes, use <kbd>Cmp+P</kbd>, if you want to find variable or class or method usage — use <kbd>Alt+F7</kbd>, use the power of <em>“Refactor -> Extract Constant/Field”</em> function</p>
</li>
<li>
<p><strong>use action finder popup</strong> — that one can save you lot of time when you do not remember where the function needed is located or what key shortcut to use — <kbd>Cmd+Shift+A</kbd> is your friend</p>
</li>
</ul>
<p><strong>WARNING: lots of video/gifs under the cut!</strong></p>
<!--more-->
<h2 id="summary">Summary</h2>
<section>
    <div>Open/hide tool window (Project, Structure, Version Control, etc.)</div>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;div>&#x3C;kbd>Cmd+1&#x3C;/kbd> .. &#x3C;kbd>Cmd+9&#x3C;/kbd>&#x3C;/div></span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;div></span></span>
<span class="line"><span>    To go back to editor - just hit &#x3C;kbd>Esc&#x3C;/kbd> &#x3C;br /></span></span>
<span class="line"><span>    Project Tree: &#x3C;br /></span></span>
<span class="line"><span>    &#x3C;video preload autoplay loop muted></span></span>
<span class="line"><span>        &#x3C;source src="/images/intellij-performance-tips/cmd_1_esc.webm" /></span></span>
<span class="line"><span>        &#x3C;source src="/images/intellij-performance-tips/cmd_1_esc.webp" /></span></span>
<span class="line"><span>    &#x3C;/video></span></span>
<span class="line"><span>    &#x3C;br /></span></span>
<span class="line"><span>    Search results:</span></span>
<span class="line"><span>    &#x3C;br /></span></span>
<span class="line"><span>    &#x3C;video preload autoplay loop muted></span></span>
<span class="line"><span>        &#x3C;source src="/images/intellij-performance-tips/cmd_3_esc.webm" /></span></span>
<span class="line"><span>        &#x3C;source src="/images/intellij-performance-tips/cmd_3_esc.webp" /></span></span>
<span class="line"><span>    &#x3C;/video></span></span>
<span class="line"><span>    &#x3C;br /></span></span>
<span class="line"><span>    Version Control:</span></span>
<span class="line"><span>    &#x3C;br /></span></span>
<span class="line"><span>    &#x3C;video preload autoplay loop muted></span></span>
<span class="line"><span>        &#x3C;source src="/images/intellij-performance-tips/cmd_9_esc.webm" /></span></span>
<span class="line"><span>        &#x3C;source src="/images/intellij-performance-tips/cmd_9_esc.webp" /></span></span>
<span class="line"><span>    &#x3C;/video></span></span>
<span class="line"><span>&#x3C;/div></span></span>
<span class="line"><span></span></span></code></pre>
</section>
<section>
    <div>Switch between open files</div>
    <div><kbd>Cmd+E</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_e.webm">
            <source src="/images/intellij-performance-tips/cmd_e.webp">
        </video>
    </div>
</section>
<section>
    <div>Go back/forward</div>
    <div><kbd>Cmd+Alt+←</kbd> and <kbd>Cmd+Alt+→</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_alt_arrows.webm">
            <source src="/images/intellij-performance-tips/cmd_alt_arrows.webp">
        </video>
    </div>
</section>
<section>
    <div>Search for class, method, variable</div>
    <div><kbd>Shift, Shift</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/shift_shift.webm">
            <source src="/images/intellij-performance-tips/shift_shift.webp">
        </video>
        <br>
        Use <kbd>Cmd+N</kbd> for class search:
        <br>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_n.webm">
            <source src="/images/intellij-performance-tips/cmd_n.webp">
        </video>
    </div>
</section>
<section>
    <div>Search for file</div>
    <div><kbd>Cmd+Shift+N</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_shift_n.webm">
            <source src="/images/intellij-performance-tips/cmd_shift_n.webp">
        </video>
    </div>
</section>
<section>
    <div>Go to variable/method definition</div>
    <div><kbd>Cmd+B</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_b.webm">
            <source src="/images/intellij-performance-tips/cmd_b.webp">
        </video>
        <br>
        To go to implementations/overrides, use <kbd>Cmd+Alt+B</kbd>:
        <br>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_alt_b.webm">
            <source src="/images/intellij-performance-tips/cmd_alt_b.webp">
        </video>
    </div>
</section>
<section>
    <div>Search for actions available</div>
    <div><kbd>Cmd+Shift+A</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_shift_a.webm">
            <source src="/images/intellij-performance-tips/cmd_shift_a.webp">
        </video>
    </div>
</section>
<section>
    <div>Disable tabs</div>
    <div><kbd>Cmd+Shift+A</kbd> and search for <em>tabs placement</em></div>
    <div>
        <img src="/images/intellij-performance-tips/intellij-disable-tabs-optimized.webp" loading="lazy" alt="">
    </div>
</section>
<section>
    <div>Show method parameters hint</div>
    <div><kbd>Cmd+P</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/cmd_p.webm">
            <source src="/images/intellij-performance-tips/cmd_p.webp">
        </video>
    </div>
</section>
<section>
    <div>Find method/class/variable usages</div>
    <div><kbd>Alt+F7</kbd></div>
    <div>
        <video preload="" autoplay loop muted>
            <source src="/images/intellij-performance-tips/alt_f7.webm">
            <source src="/images/intellij-performance-tips/alt_f7.webp">
        </video>
    </div>
</section> </div>  </article><article> <h1> <a href="/2017/09/04/2017-08-16-floyd-warshall-algorithm.html">Floyd-Warshall algorithm</a> </h1> <time datetime="2017-09-04T00:38:24.000Z"> Sep 4, 2017 </time> <div class="content"> <style>
    table td {
        padding: 0.25em 1em;
        text-align: center;
    }
</style>
<h2 id="update">Update</h2>
<p>There is <a href="/2023/01/12/floyd-warshall-revised.html">a revised version of this blog</a>, showing how an algorithm implementation could be optimized.</p>
<h2 id="the-story-behind-this-post">The story behind this post</h2>
<p>Recently I’ve received <code>+10</code> karma on StackOverflow. I was curious for what question or answer and clicked to check this. It appeared
to be a <a href="https://stackoverflow.com/a/4526639/330471"><strong>seven-year-old</strong> answer</a> about a Floyd-Warshall algorithm. I was surprised with both my bad English (back those days…) and the very small value the answer had. So I’ve revised it and here it is — the brand-new version!</p>
<h2 id="the-definitions">The definitions</h2>
<p>Let us have a graph, described by matrix <code>D</code>, where <code>D[i][j]</code> is the length of the edge <code>(i -> j)</code> <em>(from graph’s vertex with index <code>i</code> to the vertex with index <code>j</code>)</em>.</p>
<p>Matrix <code>D</code> has the size of <code>N * N</code>, where <code>N</code> is a total number of vertices in a graph because we can reach the maximum of paths by connecting each graph’s vertex to each other.</p>
<p>Also, we’ll need matrix <code>R</code>, where we will store the vertices of the shortest paths (<code>R[i][j]</code> contains the index of a vertex, where the shortest path from vertex <code>i</code> to vertex <code>j</code> lies).</p>
<p>Matrix <code>R</code> has the same size as <code>D</code>.</p>
<p>The Floyd-Warshall algorithm performs these steps:</p>
<ol>
<li>
<p>initialize the matrix of all the paths between any two pairs of vertices in a graph with the edge’s end vertex <em>(this is important since this value will be used for path reconstruction)</em></p>
</li>
<li>
<p>for each pair of connected vertices <em>(read: for each edge <code>(u -> v)</code>)</em>, <code>u</code> and <code>v</code>, find the vertex, which forms shortest path between them: if the vertex <code>k</code> defines two valid edges <code>(u -> k)</code> and <code>(k -> v)</code> <em>(if they are present in the graph)</em>, which are together shorter than path <code>(u -> v)</code>, then assume the shortest path between <code>u</code> and <code>v</code> lies through <code>k</code>; set the shortest pivot point in matrix <code>R</code> for edge <code>(u -> v)</code> to be the corresponding pivot point for edge <code>(u -> k)</code></p>
</li>
</ol>
<p>But how do we read the matrix <code>D</code>?</p>
<!--more-->
<h2 id="inputs">Inputs</h2>
<p>Take sample graph:</p>
<img src="/images/floyd-warshall/floyd-warshall-graph-sample.webp" loading="lazy" alt="">
<p>In <em>GraphViz</em> it would be described as follows:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="mermaid"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">digraph G {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    layout = "circo";</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    0->2 [label = "1"];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    2->3 [label = "5"];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    3->1 [label = "2"];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    1->2 [label = "6"];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    1->0 [label = "7"];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>We first create a two-dimensional array of size <code>4</code> <em>(since there are exactly <code>4</code> vertices in our graph)</em>.</p>
<p>We initialize its main diagonal <em>(the items, whose indices are equal, for ex. <code>G[0, 0]</code>, <code>G[1, 1]</code>, etc.)</em> with zeros, because
the shortest path from vertex to itself has the length <code>0</code> and the other elements with a very large number <em>(to indicate there is no edge or an infinitely long edge between them)</em>. The defined elements, corresponding to graph’s edges, we fill with edges’ lengths:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> N</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[,] </span><span style="color:#6F42C1;--shiki-dark:#B392F0">D</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[N, N];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> t</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (i </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            D[i, t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            D[i, t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 9999</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>And let’s say we initialize our <code>D</code> matrix by hand:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span></code></pre>
<h2 id="the-algorithm-itself">The algorithm itself</h2>
<p>Now that we are on a same page with definitions, algorithm can be implemented like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[,] </span><span style="color:#6F42C1;--shiki-dark:#B392F0">R</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[N, N];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Initialise the routes matrix R, essentially saying "the shortest path from u to v is straight"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> t</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        R[i, t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Floyd-Warshall algorithm; note the order of iterators DOES matter:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> k</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; k </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; k</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> u</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; u </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; u</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; v </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; v</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">            // check if the shortest path from "u" to "v" is actually through "k"</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (D[u, v] </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[u, k] </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[k, v]) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                D[u, v] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[u, k] </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[k, v];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                R[u, v] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> R[u, k];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Let’s “animate” this algorithm in few steps for the sample graph from above:</p>
<h3 id="initial-state">Initial state</h3>
<ul>
<li>the <code>D</code> matrix contains distance from vertex <code>u</code> to vertex <code>v</code>, where both <code>u</code> and <code>v</code> are indexes of those vertices in a graph and <code>u</code> is the index of a row and <code>v</code> is the index of the column in any of the matrices <code>R</code> and <code>D</code></li>
<li>path from <code>u</code> to <code>u</code> is thought to be infinitely long meaning we do not allow this type of paths</li>
<li>in matrix <code>R</code> we define the shortest path from <code>u</code> to <code>v</code> to lie through <code>v</code></li>
</ul>
<div class="row space-between">
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">D</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>∞</td>
                    <td>1</td>
                    <td>∞</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>7</td>
                    <td>0</td>
                    <td>6</td>
                    <td>∞</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>∞</td>
                    <td>∞</td>
                    <td>0</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>∞</td>
                    <td>2</td>
                    <td>∞</td>
                    <td>0</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">R</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<h3 id="step-1">Step 1</h3>
<div class="content-read-marker" data-fraction="25"></div>
<p>We try to find the vertex which makes the <strong>shorter</strong> path through itself than the direct path between two vertices. E.g. for every vertex <code>k</code> we find the pair of vertices <code>u</code> and <code>v</code> where path <code>u -> v</code> is <strong>longer</strong> than the path <code>u -> k -> v</code>. If we found one - we will update the matrices <code>D</code> and <code>R</code>, correspondingly.</p>
<p>For vertex <code>k = 0</code> we will check each combination of:</p>
<p><strong>paths through <code>0</code> starting at <code>0</code>:</strong></p>
<ul>
<li><code>0 -> 0</code> vs <code>0 -> 0 -> 0</code></li>
<li><code>0 -> 1</code> vs <code>0 -> 0 -> 1</code></li>
<li><code>0 -> 2</code> vs <code>0 -> 0 -> 2</code></li>
<li><code>0 -> 3</code> vs <code>0 -> 0 -> 3</code></li>
</ul>
<p><strong>paths through <code>0</code> starting at <code>1</code>:</strong></p>
<ul>
<li><code>1 -> 0</code> vs <code>1 -> 0 -> 0</code></li>
<li><code>1 -> 1</code> vs <code>1 -> 0 -> 1</code></li>
<li><code>1 -> 2</code> vs <code>1 -> 0 -> 2</code></li>
<li><code>1 -> 3</code> vs <code>1 -> 0 -> 3</code></li>
</ul>
<p><strong>paths through <code>0</code> starting at <code>2</code>:</strong></p>
<ul>
<li><code>2 -> 0</code> vs <code>2 -> 0 -> 0</code></li>
<li><code>2 -> 1</code> vs <code>2 -> 0 -> 1</code></li>
<li><code>2 -> 2</code> vs <code>2 -> 0 -> 2</code></li>
<li><code>2 -> 3</code> vs <code>2 -> 0 -> 3</code></li>
</ul>
<p><strong>paths through <code>0</code> starting at <code>3</code>:</strong></p>
<ul>
<li><code>3 -> 0</code> vs <code>3 -> 0 -> 0</code></li>
<li><code>3 -> 1</code> vs <code>3 -> 0 -> 1</code></li>
<li><code>3 -> 2</code> vs <code>3 -> 0 -> 2</code></li>
<li><code>3 -> 3</code> vs <code>3 -> 0 -> 3</code></li>
</ul>
<p>As you can see, there are lots of invalid paths here - those which either do not exist or do not make sense. Examples are: paths which do not exist <em>(like <code>0 -> 3</code>)</em> and paths to any vertex through source vertex <em>(like <code>0 -> 0 -> 0</code> and <code>0 -> 0 -> (any)</code>)</em>.</p>
<p>We could easily reduce the amount of the steps performed by the algorithm by throwing few <code>if</code> conditions to check for those cases.</p>
<p>But let’s first finish animating this step: there are very few valid paths amongst <code>N * N === 16</code> of those we’ve checked. And only one comparison: for path <code>1 -> 2</code> vs <code>1 -> 0 -> 2</code> we compare <code>6</code> <em>(direct)</em> and <code>7 + 1 = 8</code> <em>(<code>1 -> 0</code> and then <code>0 -> 2</code>)</em>.</p>
<img src="/images/floyd-warshall/floyd-warshall-sample-step-1.webp" loading="lazy" alt="">
<!--
digraph G {
    layout = "circo";

    0->2 [label = "1", color = "blue"];
    2->3 [label = "5"];
    3->1 [label = "2"];
    1->2 [label = "6", color = "green"];
    1->0 [label = "7", color = "blue"];
}
-->
<p>So there are no changes in our matrices.</p>
<div class="row space-between">
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">D</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>∞</td>
                    <td>1</td>
                    <td>∞</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>7</td>
                    <td>0</td>
                    <td>6</td>
                    <td>∞</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>∞</td>
                    <td>∞</td>
                    <td>0</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>∞</td>
                    <td>2</td>
                    <td>∞</td>
                    <td>0</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">R</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<h3 id="step-2">Step 2</h3>
<p>For vertex <code>1</code> we will check each combination of:</p>
<p><strong>paths through <code>1</code> starting at <code>0</code>:</strong></p>
<ul>
<li><code>0 -> 0</code> vs <code>0 -> 1 -> 0</code></li>
<li><code>0 -> 1</code> vs <code>0 -> 1 -> 1</code></li>
<li><code>0 -> 2</code> vs <code>0 -> 1 -> 2</code></li>
<li><code>0 -> 3</code> vs <code>0 -> 1 -> 3</code></li>
</ul>
<p><strong>paths through <code>1</code> starting at <code>1</code>:</strong></p>
<ul>
<li><code>1 -> 0</code> vs <code>1 -> 1 -> 0</code></li>
<li><code>1 -> 1</code> vs <code>1 -> 1 -> 1</code></li>
<li><code>1 -> 2</code> vs <code>1 -> 1 -> 2</code></li>
<li><code>1 -> 3</code> vs <code>1 -> 1 -> 3</code></li>
</ul>
<p><strong>paths through <code>1</code> starting at <code>2</code>:</strong></p>
<ul>
<li><code>2 -> 0</code> vs <code>2 -> 1 -> 0</code></li>
<li><code>2 -> 1</code> vs <code>2 -> 1 -> 1</code></li>
<li><code>2 -> 2</code> vs <code>2 -> 1 -> 2</code></li>
<li><code>2 -> 3</code> vs <code>2 -> 1 -> 3</code></li>
</ul>
<p><strong>paths through <code>1</code> starting at <code>3</code>:</strong></p>
<ul>
<li><code>3 -> 0</code> vs <code>3 -> 1 -> 0</code></li>
<li><code>3 -> 1</code> vs <code>3 -> 1 -> 1</code></li>
<li><code>3 -> 2</code> vs <code>3 -> 1 -> 2</code></li>
<li><code>3 -> 3</code> vs <code>3 -> 1 -> 3</code></li>
</ul>
<p>This case is more interesting - there are more things to compare. Let’s see each combination:</p>
<ol>
<li><code>3 -> 0</code> does not exist (<code>inf</code>)</li>
<li><code>3 -> 1</code> has length <code>2</code> and <code>1 -> 0</code> has length <code>7</code>, the indirect path <code>3 -> 1 -> 0</code> has length <code>9</code></li>
</ol>
<p>Hence we will update matrices <code>D</code> and <code>R</code> reflecting that.</p>
<p>For path <code>3 -> 1 -> 2</code>:</p>
<ol>
<li>there is no path from <code>3</code> to <code>2</code> directly, so its length is <code>inf</code></li>
<li><code>3 -> 1</code> has length <code>2</code> and <code>1 -> 2</code> has length <code>6</code>, the total is <code>8</code> which is infinitely better than infinity</li>
</ol>
<div class="content-read-marker" data-fraction="50"></div>
<p>Here are the updated matrices:</p>
<div class="row space-between">
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">D</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>∞</td>
                    <td>1</td>
                    <td>∞</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>7</td>
                    <td>0</td>
                    <td>6</td>
                    <td>∞</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>∞</td>
                    <td>∞</td>
                    <td>0</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td class="change">9</td>
                    <td>2</td>
                    <td class="change">8</td>
                    <td>0</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">R</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td class="change">1</td>
                    <td>1</td>
                    <td class="change">1</td>
                    <td>3</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<h3 id="step-3">Step 3</h3>
<p>For vertex <code>2</code> we will check each combination of:</p>
<p><strong>paths through <code>2</code> starting at <code>0</code>:</strong></p>
<ul>
<li><code>0 -> 0</code> vs <code>0 -> 2 -> 0</code></li>
<li><code>0 -> 1</code> vs <code>0 -> 2 -> 1</code></li>
<li><code>0 -> 2</code> vs <code>0 -> 2 -> 2</code></li>
<li><code>0 -> 3</code> vs <code>0 -> 2 -> 3</code></li>
</ul>
<p><strong>paths through <code>2</code> starting at <code>1</code>:</strong></p>
<ul>
<li><code>1 -> 0</code> vs <code>1 -> 2 -> 0</code></li>
<li><code>1 -> 1</code> vs <code>1 -> 2 -> 1</code></li>
<li><code>1 -> 2</code> vs <code>1 -> 2 -> 2</code></li>
<li><code>1 -> 3</code> vs <code>1 -> 2 -> 3</code></li>
</ul>
<p><strong>paths through <code>2</code> starting at <code>2</code>:</strong></p>
<ul>
<li><code>2 -> 0</code> vs <code>2 -> 2 -> 0</code></li>
<li><code>2 -> 1</code> vs <code>2 -> 2 -> 1</code></li>
<li><code>2 -> 2</code> vs <code>2 -> 2 -> 2</code></li>
<li><code>2 -> 3</code> vs <code>2 -> 2 -> 3</code></li>
</ul>
<p><strong>paths through <code>2</code> starting at <code>3</code>:</strong></p>
<ul>
<li><code>3 -> 0</code> vs <code>3 -> 2 -> 0</code></li>
<li><code>3 -> 1</code> vs <code>3 -> 2 -> 1</code></li>
<li><code>3 -> 2</code> vs <code>3 -> 2 -> 2</code></li>
<li><code>3 -> 3</code> vs <code>3 -> 2 -> 3</code></li>
</ul>
<p>The valid comparisons are:</p>
<ul>
<li><code>0 -> 3</code> vs <code>0 -> 2 -> 3</code></li>
<li><code>1 -> 3</code> vs <code>1 -> 2 -> 3</code></li>
</ul>
<p>In first case, we compare infinity (<code>0 -> 3</code>) to <code>1 + 5 == 6</code> (<code>0 -> 2</code> and then <code>2 -> 3</code>).
In second case we compare infinity again (<code>1 -> 3</code>) to <code>6 + 5 == 11</code> (<code>1 -> 2</code> and then <code>2 -> 3</code>).
In both cases we select the path through vertex <code>2</code>.</p>
<div class="row space-between">
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">D</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>∞</td>
                    <td>1</td>
                    <td class="change">6</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>7</td>
                    <td>0</td>
                    <td>6</td>
                    <td class="change">11</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>∞</td>
                    <td>∞</td>
                    <td>0</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>9</td>
                    <td>2</td>
                    <td>8</td>
                    <td>0</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">R</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td class="change">2</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td class="change">2</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>1</td>
                    <td>1</td>
                    <td>1</td>
                    <td>3</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<h3 id="step-4">Step 4</h3>
<p>For vertex <code>3</code> we will check each combination of:</p>
<p><strong>paths through <code>3</code> starting at <code>0</code>:</strong></p>
<ul>
<li><code>0 -> 0</code> vs <code>0 -> 3 -> 0</code></li>
<li><code>0 -> 1</code> vs <code>0 -> 3 -> 1</code></li>
<li><code>0 -> 2</code> vs <code>0 -> 3 -> 2</code></li>
<li><code>0 -> 3</code> vs <code>0 -> 3 -> 3</code></li>
</ul>
<p><strong>paths through <code>3</code> starting at <code>1</code>:</strong></p>
<ul>
<li><code>1 -> 0</code> vs <code>1 -> 3 -> 0</code></li>
<li><code>1 -> 1</code> vs <code>1 -> 3 -> 1</code></li>
<li><code>1 -> 2</code> vs <code>1 -> 3 -> 2</code></li>
<li><code>1 -> 3</code> vs <code>1 -> 3 -> 3</code></li>
</ul>
<p><strong>paths through <code>3</code> starting at <code>2</code>:</strong></p>
<ul>
<li><code>2 -> 0</code> vs <code>2 -> 3 -> 0</code></li>
<li><code>2 -> 1</code> vs <code>2 -> 3 -> 1</code></li>
<li><code>2 -> 2</code> vs <code>2 -> 3 -> 2</code></li>
<li><code>2 -> 3</code> vs <code>2 -> 3 -> 3</code></li>
</ul>
<p><strong>paths through <code>3</code> starting at <code>3</code>:</strong></p>
<ul>
<li><code>3 -> 0</code> vs <code>3 -> 3 -> 0</code></li>
<li><code>3 -> 1</code> vs <code>3 -> 3 -> 1</code></li>
<li><code>3 -> 2</code> vs <code>3 -> 3 -> 2</code></li>
<li><code>3 -> 3</code> vs <code>3 -> 3 -> 3</code></li>
</ul>
<p>This case is the last one. It is similar to the previous two. But please note that we are using the matrix values from the previous step.</p>
<div class="content-read-marker" data-fraction="75"></div>
<p>For path <code>0 -> 1</code>:</p>
<ol>
<li>direct path from <code>0</code> to <code>1</code> does not exist, take it as <code>inf</code></li>
<li>shortest path from <code>0</code> to <code>3</code> <em>(whichever it is)</em> has length <code>6</code>; <code>3 -> 1</code> has length <code>2</code>; the total path has length <code>8</code> which is better than infinity</li>
</ol>
<img src="/images/floyd-warshall/floyd-warshall-sample-step-4-1.webp" loading="lazy" alt="">
<!--
digraph G {
    layout = "circo";

    0->2 [label = "1", color = "blue"];
    2->3 [label = "5", color = "blue"];
    3->1 [label = "2", color = "blue"];
    1->2 [label = "6"];
    1->0 [label = "7"];
    0->1 [label = "∞", style = "dashed", color = "red"];
}
-->
<p>For path <code>2 -> 0</code>:</p>
<ol>
<li>direct path <code>2 -> 0</code> does not exist</li>
<li>the edge <code>2 -> 3</code> exists and has length <code>5</code>; path from <code>3</code> to <code>0</code> has length <code>9</code>; so the shortest path from <code>2</code> to <code>0</code> through <code>3</code> will have length <code>9 + 5 == 14</code></li>
</ol>
<p>For path <code>2 -> 1</code>:</p>
<ol>
<li>there is no direct path <code>2 -> 1</code></li>
<li>the path <code>2 -> 3</code> is <code>5</code> and <code>3 -> 1</code> is <code>2</code>, so <code>2 -> 3 -> 1</code> is <code>7</code></li>
</ol>
<p>Both matrices <code>R</code> and <code>D</code> will be updated to reflect that:</p>
<div class="row space-between">
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">D</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td class="change">8</td>
                    <td>1</td>
                    <td>6</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>7</td>
                    <td>0</td>
                    <td>6</td>
                    <td>11</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td class="change">14</td>
                    <td class="change">7</td>
                    <td>0</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>9</td>
                    <td>2</td>
                    <td>8</td>
                    <td>0</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col">
        <table>
            <tbody>
                <tr>
                    <td rowspan="2"></td>
                    <td colspan="5" class="center head">R</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td class="head">1</td>
                    <td class="head">2</td>
                    <td class="head">3</td>
                </tr>
                <tr>
                    <td class="head">0</td>
                    <td>0</td>
                    <td class="change">2</td>
                    <td>2</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td class="head">1</td>
                    <td>0</td>
                    <td>1</td>
                    <td>2</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td class="head">2</td>
                    <td class="change">3</td>
                    <td class="change">3</td>
                    <td>2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td class="head">3</td>
                    <td>1</td>
                    <td>1</td>
                    <td>1</td>
                    <td>3</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<p>And then the algorithm is done.</p>
<h2 id="path-reconstruction">Path reconstruction</h2>
<p>In order to reconstruct the path from vertex <code>u</code> to vertex <code>v</code>, you need follow the elements of matrix <code>R</code>, effectively going “through” each vertex:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Path</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (start </span><span style="color:#D73A49;--shiki-dark:#F97583">!=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> end) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        Path.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(start);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        start </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> R[start, end];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Path.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(end);</span></span>
<span class="line"></span></code></pre>
<p>Let’s follow this logic in steps again, “animating” the algorithm. For instance, the longest path in this graph possible, from <code>0</code> to <code>1</code>:</p>
<ol start="0">
<li><code>start = 0, end = 1</code></li>
<li><code>R[0, 1] == 2, start = 2, end = 1</code></li>
<li><code>R[2, 1] == 3, start = 3, end = 1</code></li>
<li><code>R[3, 1] == 1, start = 1, end = 1</code></li>
</ol>
<p>So the path from <code>0</code> to <code>1</code> is all the values the <code>start</code> variable takes <em>(except last)</em>, namely: <code>0 -> 2 -> 3</code>.</p>
<h2 id="summary">Summary</h2>
<p>The whole code could be wrapped in a couple of methods:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">using</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">using</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#D73A49;--shiki-dark:#F97583"> class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> FloydWarshallPathFinder</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> N</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[,] </span><span style="color:#6F42C1;--shiki-dark:#B392F0">D</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    private</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[,] </span><span style="color:#6F42C1;--shiki-dark:#B392F0">R</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> FloydWarshallPathFinder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NumberOfVertices</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[,] </span><span style="color:#6F42C1;--shiki-dark:#B392F0">EdgesLengths</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        N </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NumberOfVertices;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        D </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> EdgesLengths;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        R </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[,] </span><span style="color:#6F42C1;--shiki-dark:#B392F0">FindAllPaths</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        R </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[N, N];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> t</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                R[i, t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> k</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; k </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; k</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; v </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; v</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> u</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; u </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; u</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (D[u, k] </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[k, v] </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[u, v]) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        D[u, v] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[u, k] </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> D[k, v];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        R[u, v] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> R[u, k];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> R;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">FindShortestPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (R </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            FindAllPaths</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Path</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Int32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (start </span><span style="color:#D73A49;--shiki-dark:#F97583">!=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> end) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Path.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(start);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            start </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> R[start, end];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        Path.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(end);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Path;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#D73A49;--shiki-dark:#F97583"> class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MainClass</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    public</span><span style="color:#D73A49;--shiki-dark:#F97583"> static</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> N</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[,] </span><span style="color:#6F42C1;--shiki-dark:#B392F0">D</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[N, N];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> t</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (i </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    D[i, t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    D[i, t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 9999</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        D[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        FloydWarshallPathFinder</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> pathFinder</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> FloydWarshallPathFinder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(N, D);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> start</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> end</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        Console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">WriteLine</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Path: {0}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, String.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Join</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">" -> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, pathFinder.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">FindShortestPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(start, end).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ToArray</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>You can read ‘bout this algorithm on <a href="http://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm">wikipedia</a> and get some data structures generated automatically <a href="http://quickgraph.codeplex.com/">here</a></p>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2017/09/01/2017-09-10-one-night-games-tetris.html">One-night games: Tetris</a> </h1> <time datetime="2017-09-01T06:00:00.000Z"> Sep 1, 2017 </time> <div class="content"> <p>Did you ever think of how old games like tetris or snake <em>(hail the Nokia fans!)</em> work?</p>
<p>I always wanted to write a few relatively simple games just to practice my coding skills.
Back when I was at the uni, I’ve made <a href="https://en.wikipedia.org/wiki/Peg_solitaire">peg solitaire</a> and <a href="https://en.wikipedia.org/wiki/Bejeweled">three-in-a-row</a> games in C/C++ with SFML. I even wrote a <em>(pretty shitty)</em> server-client <a href="https://github.com/shybovycha/moo-chess">chess game</a> <em>(be warned: this code was written in 2011 and only contains fixes to make it run on a new version of SFML, so it might look… smelly… on each and every line…)</em>. My latest achievements were the <a href="https://github.com/shybovycha/entanglement-ios">Entanglement</a> game and a well-designed <em>(at least from my perspective)</em> <a href="https://github.com/shybovycha/python-shooter">arcade space shooter</a>.</p>
<p>But I’ve never implemented more well-known games like tetris or snake. And they are interesting from the algorithmic perspective.</p>
<p>And recently I’ve came to the point when I really wanted to create something interesting. And that was the chance to try myself as a early-2000-ies developer!</p>
<p>As I wanted to accomplish my goal as soon as possible, I’ve decided to not pick up any libraries and just implement everything with HTML5 Canvas API. And this is what I ended up with:</p>
<img src="" alt="" data-src="/images/one-night-games/snake-screenshot.webp" class="medium">
<p>In this post I’ll talk about Tetris. Under the cut you’ll find the interesting algorithmic solutions I’ve used for it.</p>
<!--more-->
<h2 id="tetris">Tetris</h2>
<p><a href="https://github.com/shybovycha/moo-tetris">Source code</a></p>
<p>The most interesting part about tetris was to implement piece rotation. I’ve represented all the possible figures as a list of matrices.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> FIGURES</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span></code></pre>
<p>The problem however is that all figures are different, hence all the matrices have different dimensions - a “stick” is 4x1, whilst a “cube” is 2x2. Other pieces are 3x2. Rotation algorithm might not be simple. And it implies one limitation - pieces should preserve their position - not to move to the sides when rotating them.</p>
<p>Pieces are best represented as matrices, but in order to operate on matrices we need to have the corresponding methods. I decided to just implement the class <code>Piece</code> with the essential methods:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Piece</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">row</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">col</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.piece </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [].slice.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shape);</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.col </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.row </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> row;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Here <code>row</code> and <code>col</code> describe the position of a piece on a screen whilst <code>rows</code> and <code>cols</code> are the dimensions of a piece. <code>piece</code> contains the matrix data of a piece.</p>
<p>The rotation algorithm I’ve implemented tries to transpose piece’s matrix in a very simple manner:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Piece</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    rotate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result[i]) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                result[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                result[i][t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure[t][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>What it does is actually creating a totally new matrix, where the dimensions are swapped and the data is the opposite data to what was in the original matrix. In other words, we iterate the original matrix over its normal indices, but write the data to the new matrix in the reversed direction. So if we read the row with index <code>0</code> and column with index <code>2</code>, this means we need to write the data from the source matrix at <code>data[0][2]</code> to the destination matrix at <code>data[2][0]</code>. Sounds correct, right?</p>
<p>But if we do that with the array, we will end up having the new matrix mirrored:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>           given:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      0   1   2   3</span></span>
<span class="line"><span>    +---+---+---+---+</span></span>
<span class="line"><span> 0  | 1 | 2 | 3 | 4 |</span></span>
<span class="line"><span>    +---+---+-------+</span></span>
<span class="line"><span> 1  | 5 | 6 | 7 | 8 |</span></span>
<span class="line"><span>    +---+---+---+---+</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>            expectation:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      0   1                0    1</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span> 0  | 4 | 8 |          0  | 5 | 1 |</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span> 1  | 3 | 7 |          1  | 6 | 2 |</span></span>
<span class="line"><span>    +---+---+    or       +---+---+</span></span>
<span class="line"><span> 2  | 2 | 6 |          2  | 7 | 3 |</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span> 3  | 1 | 5 |          3  | 8 | 4 |</span></span>
<span class="line"><span>    +---+---+             +---+---+</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    reality:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      0   1</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 0  | 1 | 5 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 1  | 2 | 6 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 2  | 3 | 7 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span> 3  | 4 | 8 |</span></span>
<span class="line"><span>    +---+---+</span></span>
<span class="line"><span></span></span></code></pre>
<p>Thus we need to copy the data to the new matrix in the reverse order along one axis.</p>
<p>In order to allow for a two-way rotation I’ve introduced a numeric argument to the <code>Piece#rotate</code> method, defining which way <em>(clockwise or counter-clockwise)</em> the piece will be rotated:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">rotate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(direction) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        result[i][t] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> direction </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure[t][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.cols </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i] </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.figure[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.rows </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t][i];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>The other interesting algorithm is collision detection. This is slightly more complex than just checking boundariesof a figure. Since we can not think of a regular (circle, rectangle, line) shape for the field formed by the previous pieces, we will need to check each cell of a field against each cell of a currently falling piece. But if we decide to do that - we should either do this before rendering the falling piece (to check whether we are allowed to render it) and then, in the case of collision we will be made to “cancel” the piece’s move down one cell. Alternatively, we could check each cell of a field agains the data of a falling piece, but with a one row shift down:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>what we draw:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span>|   xx  |</span></span>
<span class="line"><span>|    x  |</span></span>
<span class="line"><span>|    x  |</span></span>
<span class="line"><span>|   *   |</span></span>
<span class="line"><span>| ****  |</span></span>
<span class="line"><span>| ***** |</span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>what we check:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span>|       |</span></span>
<span class="line"><span>|   ..  |</span></span>
<span class="line"><span>|    .  |</span></span>
<span class="line"><span>|   *.  |</span></span>
<span class="line"><span>| ****  |</span></span>
<span class="line"><span>| ***** |</span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span></span></span>
<span class="line"><span>same example,</span></span>
<span class="line"><span>but with the</span></span>
<span class="line"><span>collision occuring:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span>|       |</span></span>
<span class="line"><span>|       |</span></span>
<span class="line"><span>|   ..  |</span></span>
<span class="line"><span>|   *.  |</span></span>
<span class="line"><span>| ***!  |</span></span>
<span class="line"><span>| ***** |</span></span>
<span class="line"><span>+-------+</span></span>
<span class="line"><span></span></span></code></pre>
<p>The check is trivial: if both field cell at the checked position and any of the piece data at the piece position plus one row shift down are non-zero - then we have detected a collision and we should not move the piece down, but just render it and generate the next piece.</p> </div>  </article><article> <h1> <a href="/2017/08/15/2017-08-15-easy-way-to-understand-big-o-notation.html">Easy way to understand algorithm complexity and big O notation</a> </h1> <time datetime="2017-08-15T09:38:24.000Z"> Aug 15, 2017 </time> <div class="content"> <h2 id="foreword">Foreword</h2>
<p>Some time ago I’ve published an <a href="/2016/08/25/big-o-notation.html">article about bit O notation</a>. I’ve mentioned its source but never published it. So here it is, the original article.</p>
<h2 id="the-article">The article</h2>
<p>Big O notation is the most widely used method which describes algorithm complexity - the execution time required or the space used in memory or in the disk by an algorithm. Often in exams or interviews, you will be asked some questions about algorithm complexity in the following form:</p>
<blockquote>
<p>For an algorithm that uses a data structure of size n, what is the run-time complexity or space complexity of the algorithm? The answer to such questions often uses big O notations to describe the algorithm complexity, such as <code>O(1)</code>, <code>O(n)</code>, <code>O(n^2)</code> or <code>O(log(n))</code>.</p>
</blockquote>
<!--more-->
<h2 id="big-o-for-time-complexity">Big O for time complexity</h2>
<p>Here we don’t want to discuss big O mathematically. Basically, when analyzing the time complexity of an algorithm, big O notation is used to describe the rough estimate of the number of “steps” to complete the algorithm. Let’s take the following example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // partl</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    doSomething</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // part2</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> j </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; j </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; j</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        doSomething</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // part3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> j </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; j </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; j</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            doSomething</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // part4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Here lets assume that <code>doSomething()</code> takes <code>C</code> steps to complete. The whole <code>fun(n)</code> method has 4 parts. What is the time complexity of each part for different parameters <code>n</code>?</p>
<p>For part 1, it does <code>doSomething()</code> so it takes constant <code>C</code> steps. Here <code>C</code> is independent of the parameter <code>n</code>. When the time complexity is independent of the parameter, we use <code>O(1)</code> to mark it.</p>
<p>For part 2, it does <code>doSomething()</code> exactly <code>n</code> times. Each time it takes <code>C</code> steps. So in total, it takes <code>C*n</code> steps to complete part 2. Then as described above, we use <code>O(1)</code> to complete the <code>C</code> steps. Then for <code>C*n</code>, the complexity becomes <code>n * O(1)</code>. Here, an important rule is that <code>a * O(n)</code> equals <code>O(a * n)</code>. In such case, <code>n * O(1) = O(n)</code>. So the time complexity of part 2 is <code>O(n)</code>.</p>
<p>For part 3, it has two loops. The inner loop is exactly like part 2. The outer loop does part 2 <code>n</code> times again so the time complexity of part 3 is <code>n * O(n)</code> which is <code>O(n^2)</code>.</p>
<p>For part 4, it takes exactly <code>1</code> step to return. So the time complexity is <code>O(1)</code>.</p>
<p>Then what is the total time complexity of the whole <code>fun(n)</code>? It is easy, we just need to add up the time complexity of all the 4 parts:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>O(1) + O(n) + O(n^2) + O(1)</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now let’s assume <code>n</code> becomes very-very large. Parts 1 and 4 will still take constant number of steps, <code>C + 1</code>, to complete, so the total time of running part 1 and part 4 could be ignored when calculating the execution time for part 2 and part 3, as now both part 2 and part 3 take much more time than part 1 and part 4.</p>
<p>Let’s we compare part 2 and part 3:</p>
<ul>
<li>when <code>n</code> is <code>1</code>, both part 2 and part 3 take <code>C</code> steps</li>
<li>when <code>n</code> is <code>3</code>, part 2 takes <code>3*C</code> steps while part 3 takes <code>9*C</code> steps</li>
<li>when <code>n</code> is <code>1000</code>, part 2 needs <code>1000 * C</code> steps but part 3 takes <code>1000000 * C</code> steps!</li>
</ul>
<p>As <code>n</code> increases, the time complexity of part 3 increases much quicker than part 2. When <code>n</code> becomes extremely large, the time of part 2 can be ignored by the time of part 3.</p>
<p>So here is another rule: when we add up big O notation, the notation with slower increase speed could be ignored by the notation with faster increase speed. As we could see, <code>O(1)</code> does not increase at all so it could be ignored by <code>O(n)</code>. <code>O(n)</code> is slower than <code>O(n^2)</code> so it could be ignored by <code>O(n^2)</code>. Therefore, the complexity of the whole <code>fun()</code> is <code>O(n^2)</code>.</p>
<h2 id="rules-summary-of-big-o-notation">Rules summary of big O notation</h2>
<p>From the above examples, we could summarize the following rule: for multiplying two O notations, <code>O(A)</code> and <code>O(B)</code>, the result is <code>O(A*B)</code>. For example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>O(1) x O(n) = O(n).</span></span>
<span class="line"><span>O(n) x O(n) = O(n^2).</span></span>
<span class="line"><span>O(1) + O(n) = O(n).</span></span>
<span class="line"><span>O(n) + O(n^2) = O(n^2).</span></span>
<span class="line"><span>O(1) + O(n) + O(n^2) = O(n^2).</span></span>
<span class="line"><span></span></span></code></pre>
<p>Here is the comparison of the increase speed of different O notations:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>O(1) &#x3C; O(log(n)) &#x3C; O(n) &#x3C; O(n * log(n)) &#x3C; O(n^2)</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="how-to-use-big-o-notation-to-compare-algorithm-complexity-and-why">How to use big O notation to compare algorithm complexity and why</h2>
<p>When comparing different algorithms, we often say the one with a “smaller” big O notation is more efficient. However, there are situations that algorithms with “smaller” bit O is faster.</p>
<p>For example, there are two algorithms <code>f1(n)</code> and <code>f2(n)</code>. <code>f(1)</code> takes <code>100</code> steps and <code>f(2)</code> takes <code>n</code> steps so <code>f(1)</code> is <code>O(1)</code> and <code>f(2)</code> is <code>O(n)</code>. When <code>n</code> is less than <code>100</code>, <code>f1(n)</code> is more efficient than <code>f2(n)</code>. However, big O compares when <code>n</code> goes to extremely (or infinitely) large. When <code>n</code> goes up to <code>10000</code>, <code>f2(n)</code> becomes way more efficient. As the nature of large-scale data in computer engineering, it makes more sense to compare algorithms in the cases that the data is very large.</p>
<h2 id="big-0-for-space-complexity">Big 0 for space complexity</h2>
<p>It is easier to understand using big O to estimate space complexity as it is more concrete. For example, in an algorithm, we need to create an array of size <code>n</code> to store the temporary results before getting the final result. If we assume that the size of the element in the array is a constant <code>C</code> which is independent of <code>n</code>, the space complexity of using the array is <code>C*n</code> which is</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>O(n) x O(C) = O(n) x O(1) = O(n)</span></span>
<span class="line"><span></span></span></code></pre>
<p>When comparing different algorithms, we often compare how much “extra” space complexity is needed to solve the problem. For example, as an algorithm that needs an extra array of size <code>n</code> is not as good as the one which only needs two variables, <code>O(1)</code> space complexity is more efficient than <code>O(n)</code>.</p> </div>  </article> </section> </main> <footer> <nav> <div class="prev"> <a href="/page4.html" class="next">&larr; Previous page</a> </div> <div class="current">Page #5 of 11</div> <div class="next"> <a href="/page6.html" class="next">Next page &rarr;</a> </div> </nav> </footer> </body></html>