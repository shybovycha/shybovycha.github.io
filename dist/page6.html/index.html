<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/page6.html/"><!-- Primary Meta Tags --><title>moofoo blog</title><meta name="title" content="moofoo blog"><meta name="description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main> <section> <article> <h1> <a href="/2017/04/09/2017-04-09-gantt-chart-with-d3.html">Gantt chart with D3</a> </h1> <time datetime="2017-04-09T09:04:24.000Z"> Apr 9, 2017 </time> <div class="content"> <h2 id="contents">Contents</h2>
<ul>
<li><a href="/2017/04/09/gantt-chart-with-d3.html"><strong>Gantt chart with D3 (you are here)</strong></a></li>
<li><a href="/2020/08/02/gantt-chart-part2.html">Gantt chart with D3. Part 2</a></li>
<li><a href="/2021/03/04/gantt-chart-part3.html">Gantt chart with Canvas</a></li>
<li><a href="/2024/06/26/gantt-chart-part4.html">Gantt chart with CSS Grids</a></li>
</ul>
<p>At work, I’ve had a task to implement a Gantt chart diagram to show dependencies and order of some… let’s say, milestones.
Given this feature is in a very unstable beta in Google Charts, I thought to myself: <em>“Why don’t I implement it on my own?”</em>.
And tried to recall my D3 knowledge.</p>
<p>I’ve also found a minimalistic, but helpful example / screenshot of some Gantt chart implementation:</p>
<img src="/images/gantt_chart_with_d3/gantt-sample_optimized.webp" loading="lazy" alt="">
<p>The challenges I’ve faced were:</p>
<ol>
<li>order milestones on a timeline</li>
<li>scale milestones to fit in a viewport</li>
<li>create pretty connection lines</li>
<li>center text inside each milestone</li>
</ol>
<p>And since D3 is a data-driven library, I’ve used map/reduce where possible.</p>
<p>Here’s how the result looked like:</p>
<img src="/images/gantt_chart_with_d3/d3-gantt-chart_optimized.webp" loading="lazy" alt="">
<p>The implementation details are under the cut.</p>
<h2 id="update-august-2020">Update August 2020</h2>
<p>There are few updates to this original implementation in my <a href="/2020/08/02/gantt-chart-part2.html">new blog</a>.</p>
<!--more-->
<p>I hope the implementation is more or less clear, but here are some details: the algorithm consists of three main parts - initial data pre-processing - (parsing and validating dates, calculating the default values and so on); calculating the graphics params (positions, sizes) and finally, rendering that into SVG.</p>
<p>I’ve tried using caches whenever possible to optimize the performance and save some calculation time by just creating maps <code>id -> object</code>, since the algorithm refers to objects by their IDs a lot (like getting all the children of an element or getting a particular child’s data).</p>
<p>The data pre-processing is basically computing the length of each element based on either <code>startDate</code> and <code>endDate</code> or <code>startDate</code> and <code>duration</code>. Adding the <code>endDate</code> and <code>duration</code> option is possible and trivial, but I thought this is a less useful feature.</p>
<p>The transformation of data is the most interesting part - we need to calculate the positions of each element on a “screen”, and it heavily relies on data sorting mode - if we need to sort the data by the amount of children - this is somewhat simple. But if we sort data by dates - we need to count for element’s index in the overall list of elements.</p>
<p>Then we calculate the parameters of connection lines. They might be redundant for some users, but in my case it was essential to show the dependencies between elements sorted by children count. This is less trivial, since one needs to find the bends of each line. Hence I decided to simplify this problem by putting all the lines <em>under</em> the rectangles and assuming every line consists of these sections:</p>
<ol>
<li>the “input” and “output” pins (near the <code>endDate</code> end of a parent element and near <code>startDate</code> end of children element)</li>
<li>two vertical sections to reach the height of a children element</li>
<li>a connection between the lines from p. 2</li>
</ol>
<p>The last piece of an algorithm is generating SVG. This is where D3 strikes in and, given all the params generated in the previous section, creates SVG elements in DOM tree and scales them considering <code>svgOptions</code> passed to the main function.</p>
<p>The implementation is below and the live demo is <a href="https://codepen.io/shybovycha/pen/vxdePv">here</a></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> *</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d3 </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'd3'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> moment </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'moment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> prepareDataElement</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">label</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">startDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">endDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">duration</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">dependsOn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">startDate </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">endDate) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">duration) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    throw</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Error</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Wrong element format: should contain either startDate and duration, or endDate and duration or startDate and endDate'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (startDate) startDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(startDate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (endDate) endDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(endDate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (startDate </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">endDate </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> duration) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    endDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(startDate);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    endDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(duration[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], duration[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">startDate </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> endDate </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> duration) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    startDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(endDate);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    startDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">subtract</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(duration[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], duration[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dependsOn)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dependsOn </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    label,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    startDate,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    endDate,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    duration,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dependsOn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> findDateBoundaries</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> minStartDate, maxEndDate;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">startDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">endDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">minStartDate </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> startDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isBefore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(minStartDate)) minStartDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(startDate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">minStartDate </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> endDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isBefore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(minStartDate)) minStartDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(endDate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">maxEndDate </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> endDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isAfter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxEndDate)) maxEndDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(endDate);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">maxEndDate </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> startDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isAfter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxEndDate)) maxEndDate </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(startDate);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    minStartDate,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    maxEndDate</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createDataCacheById</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reduce</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">cache</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">elt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">cache, [elt.id]: elt }), {});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createChildrenCache</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> dataCache</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createDataCacheById</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fillDependenciesForElement</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">eltId</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">dependenciesByParent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dataCache[eltId].dependsOn.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">parentId</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">dependenciesByParent[parentId])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        dependenciesByParent[parentId] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (dependenciesByParent[parentId].</span><span style="color:#6F42C1;--shiki-dark:#B392F0">indexOf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(eltId) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        dependenciesByParent[parentId].</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(eltId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      fillDependenciesForElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(parentId, dependenciesByParent);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reduce</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">cache</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">elt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">cache[elt.id])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      cache[elt.id] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    fillDependenciesForElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(elt.id, cache);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cache;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, {});</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sortElementsByChildrenCount</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> childrenByParentId</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createChildrenCache</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sort</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">e1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">e2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (childrenByParentId[e1.id] </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> childrenByParentId[e2.id] </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> childrenByParentId[e1.id].</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> childrenByParentId[e2.id].</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    else</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sortElementsByEndDate</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sort</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">e1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">e2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e1.endDate).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isBefore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">moment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e2.endDate)))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    else</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sortElements</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">sortMode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (sortMode </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'childrenCount'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sortElementsByChildrenCount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (sortMode </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'date'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sortElementsByEndDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parseUserData</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(prepareDataElement);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createPolylineData</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">rectangleData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">elementHeight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // prepare dependencies polyline data</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> cachedData</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createDataCacheById</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(rectangleData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // used to calculate offsets between elements later</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> storedConnections</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rectangleData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reduce</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">acc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">acc, [e.id]: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }), {});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // create data describing connections' lines</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rectangleData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">flatMap</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    d.dependsOn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">parentId</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cachedData[parentId])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">parent</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> color</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '#'</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">max</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">min</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">random</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0xFFF</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // increase the amount rows occupied by both parent and current element (d)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        storedConnections[parent.id]</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        storedConnections[d.id]</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> deltaParentConnections</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> storedConnections[parent.id] </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> deltaChildConnections</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> storedConnections[d.id] </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> points</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          d.x, (d.y </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          d.x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> deltaChildConnections, (d.y </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          d.x </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> deltaChildConnections, (d.y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          parent.xEnd </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> deltaParentConnections, (d.y </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          parent.xEnd </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> deltaParentConnections, (parent.y </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          parent.xEnd, (parent.y </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          points: points.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">join</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">','</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          color</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createElementData</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">elementHeight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">xScale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">fontSize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">i</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> x</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> xScale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(d.startDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> xEnd</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> xScale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(d.endDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> y</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1.5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> width</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> xEnd </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> height</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> elementHeight;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> charWidth</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (width </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fontSize);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> dependsOn</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.dependsOn;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> id</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> tooltip</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.label;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> singleCharWidth</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fontSize </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> singleCharHeight</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fontSize </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.45</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> label </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.label;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (label.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> charWidth) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      label </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> label.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">split</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">''</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">slice</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, charWidth </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">join</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">''</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '...'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> labelX</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((width </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((label.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> /</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> singleCharWidth));</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> labelY</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((height </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (singleCharHeight));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      x,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      y,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      xEnd,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      width,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      height,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      id,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      dependsOn,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      label,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      labelX,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      labelY,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      tooltip</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createChartSVG</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { </span><span style="color:#E36209;--shiki-dark:#FFAB70">svgWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">svgHeight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">elementHeight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">scaleWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">fontSize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">minStartDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">maxEndDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">margin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">showRelations</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // create container element for the whole chart</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> svg</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d3.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(placeholder).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'svg'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'width'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, svgWidth).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'height'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, svgHeight);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> xScale</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d3.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scaleTime</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">domain</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([minStartDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(), maxEndDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">range</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, scaleWidth]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // prepare data for every data element</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rectangleData</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createElementData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data, elementHeight, xScale, fontSize);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> xAxis</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d3.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">axisBottom</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(xScale);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // create container for the data</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> g1</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> svg.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'g'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'transform'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`translate(${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">margin</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">left</span><span style="color:#032F62;--shiki-dark:#9ECBFF">},${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">margin</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">top</span><span style="color:#032F62;--shiki-dark:#9ECBFF">})`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // add milestone relationship lines to the SVG</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (showRelations) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // create data describing connections' lines</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> polylineData</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createPolylineData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(rectangleData, elementHeight);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> linesContainer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g1.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'g'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'transform'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`translate(0,${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">margin</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">top</span><span style="color:#032F62;--shiki-dark:#9ECBFF">})`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    linesContainer</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">selectAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'polyline'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(polylineData)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">enter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'polyline'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'fill'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'none'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'stroke'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.color)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'points'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.points);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // append milestones only after we have rendered the connections to prevent lines overlapping the milestones</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> barsContainer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> g1.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'g'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'transform'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`translate(0,${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">margin</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">top</span><span style="color:#032F62;--shiki-dark:#9ECBFF">})`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  g1.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'g'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(xAxis);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // create axes</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> bars</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> barsContainer</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">selectAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'g'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(rectangleData)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">enter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'g'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  bars</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'rect'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'rx'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ry'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'x'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.x)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'y'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.y)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'width'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.width)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'height'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.height)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'fill'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'#ddd'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'stroke'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'black'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  bars</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'text'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'fill'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'black'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'font-family'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'sans-serif'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'x'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.labelX)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">attr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'y'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.labelY)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">text</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.label);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  bars</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">append</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'title'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">text</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">d</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d.tooltip);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createGanttChart</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { </span><span style="color:#E36209;--shiki-dark:#FFAB70">elementHeight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">sortMode</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'date'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">showRelations</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">svgOptions</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // prepare data</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> margin</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (svgOptions </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> svgOptions.margin) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    top: elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    left: elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> scaleWidth</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((svgOptions </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> svgOptions.width) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 600</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (margin.left </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> scaleHeight</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">max</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((svgOptions </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> svgOptions.height) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, data.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> elementHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (margin.top </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> svgWidth</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scaleWidth </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (margin.left </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> svgHeight</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scaleHeight </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (margin.top </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> fontSize</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (svgOptions </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> svgOptions.fontSize) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parseUserData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data); </span><span style="color:#6A737D;--shiki-dark:#6A737D">// transform raw user data to valid values</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  data </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sortElements</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data, sortMode);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">minStartDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">maxEndDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> findDateBoundaries</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // add some padding to axes</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  minStartDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">subtract</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'days'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  maxEndDate.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'days'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  createChartSVG</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data, placeholder, { svgWidth, svgHeight, scaleWidth, elementHeight, scaleHeight, fontSize, minStartDate, maxEndDate, margin, showRelations });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>The data format is like follows</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    startDate: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2017-02-27'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    endDate: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2017-03-04'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    label: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'milestone 01'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m01'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dependsOn: []</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    startDate: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2017-02-23'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    endDate: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2017-03-01'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    label: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'milestone 06'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m06'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dependsOn: [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m01'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    duration: [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'days'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    endDate: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2017-03-24'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    label: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'milestone 02'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m02'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dependsOn: [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m04'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    startDate: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2017-02-27'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    duration: [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'days'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    label: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'milestone 03'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m03'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dependsOn: [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m01'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    endDate: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2017-03-17'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    duration: [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'days'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    label: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'milestone 04'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m04'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    dependsOn: [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'m01'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span></code></pre>
<p>To create a chard on a page, you need to pass the reference to a valid existing DOM element where you want the diagram to appear, the data and the SVG options. These options define the looks of a chart - width, height of an element (rectangle), font size and so on. One more option is</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">createGanttChart</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(document.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">querySelector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'body'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), data, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  elementHeight: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  sortMode: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'date'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6A737D;--shiki-dark:#6A737D">// alternatively, 'childrenCount'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  svgOptions: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    width: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    height: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">400</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    fontSize: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>A lot of things are happening here. In short, here are few key points:</p>
<ul>
<li>we have to render entities (milestones, lines, labels) in a specific “layered” order, to prevent one set of things covering the other</li>
<li>it is both good for performance and is kind of a requirement to calculate the data before rendering it</li>
</ul>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2017/03/13/2017-03-13-entanglement.html">Entanglement</a> </h1> <time datetime="2017-03-13T09:42:24.000Z"> Mar 13, 2017 </time> <div class="content"> <img src="/images/entanglement/ios-screen1_optimized.webp" loading="lazy" alt="">
<h1 id="entanglement">Entanglement?</h1>
<p>Some time ago there was a game popular over there, called Entanglement:</p>
<img src="/images/entanglement/web-screen1.webp" loading="lazy" alt="">
<p>There are a few implementations of this game under Android:</p>
<style>
  .row {
    display: flex;
    flex-wrap: wrap;
  }

  .row .col {
    max-width: 48%;
    margin: 0 1%;
  }
</style>
<div class="row">
    <div class="col">
        <img src="/images/entanglement/android-screen1.webp" loading="lazy" alt="">
    </div>
    <div class="col">
        <img src="/images/entanglement/android-screen2.webp" loading="lazy" alt="">
    </div>
</div>
<p>But there was no such game for iOS. And as I pursued my second M. Sc. degree, I have had a course
“iOS development”, where we were learning to use Swift and iOS platform.</p>
<p>I decided to implement this game as my course project. In Swift. Originally the game was implemented
in Swift 2 <em>(there was no Swift 3 back those days)</em>.</p>
<p>And recently I decided to refactor the game a bit and update it to the most recent Swift version
<em>(which is Swift 3 at the moment of writing this post)</em>.</p>
<p>In this post I’ll describe some interesting decisions I made while creating this game.</p>
<!--more-->
<h1 id="the-game">The game</h1>
<p>The idea of the game is to prolong the line as much as possible by using the tiles with pieces
of a path for a line. At the beginning of the game, a single tile is placed at the center of a
hexagonal field and the line starts from that tile. You are also given a tile in the “pocket”,
which you can swap with the currently active one. At each turn, a game will place a new tile
at the end of the line and you have three actions available:</p>
<ol>
<li>rotate the current tile clockwise or counter-clockwise, as many times as you want</li>
<li>swap the current tile with one in the pocket; you can repeat this action as many times as you want to</li>
<li>place the tile; this action is performed once and can not be undone</li>
</ol>
<p>But the trick here is: each tile contains six line pieces. And by using one of them, be aware
that other pieces might be used later as well.</p>
<p>When you place a tile, you get one point for the first piece of the line, which prolongs it.
You also get one point more for the next piece, if it prolongs the line too. For the third
line piece, you’ll get 3 points and so on. The point here is: the more pieces you connect in
a single move - the more points you get.</p>
<h1 id="implementation">Implementation</h1>
<p>My implementation contains several core elements:</p>
<ol>
<li>tiles</li>
<li>field</li>
<li>tile renderer</li>
<li>game itself</li>
</ol>
<p>Tiles contain information on the line pieces they contain and provide methods to rotate themselves
and find connections with neighbor tiles.</p>
<p>The field contains information on all the tiles on the field - where they are placed and how they are
rotated.</p>
<p>Tile renderer simply draws tiles into an image. Doing so allows having an animation for tile rotation.</p>
<p>The game holds all the data on the game state - tile in the pocket, currently selected tile, line path
done so far and a score.</p>
<h1 id="field">Field</h1>
<p>The core of the game is tiles. The tiles are hexagons. And the whole field is hexagonal.
The problem was to handle the positions of all the tiles in a handy manner. Thus I decided
to go from a standard Cartesian coordinate system, which has 90° angle between axes
and go for a one with 120°:</p>
<img src="/images/entanglement/120-deg-coordinate-system.webp" loading="lazy" alt="">
<p>Here, <code>u</code> and <code>v</code> vectors represent coordinate axes and <code>w</code> vector is a diagonal. So the tiles
could now be allocated so their centers are at the points of the coordinate system with integer
coordinates:</p>
<img src="/images/entanglement/tiles-1.webp" loading="lazy" alt="">
<p>Now, there’s a tricky thing regarding this coordinate system: how should we know, where to render
the actual tile image on a screen? E. g. how can we convert coordinates in this system back to Cartesian?</p>
<p>After doing some math on a piece of paper, I came up with this function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> uv2xy</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> uv: (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> uv.0, v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> uv.1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> kx </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(u </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.0</span><span style="color:#D73A49;--shiki-dark:#F97583"> /</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ky </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(u </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">sqrt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ceil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(kx </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tileSideLength)))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ceil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(ky </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tileSideLength)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cx </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 9</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (tileSideLength)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cy </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ceil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8.0</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> sqrt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tileSideLength)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (cx </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x, cy </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>What happens here is: since every tile is a regular hexagon, we can simply calculate the distance between the sides
of neighbour tiles and, based on how the tiles are layed out relative to each other, multiply that by either taking
one and a half of every coordinate system unit or <code>sqrt(3) / 2</code> of one unit. The <code>sqrt(3) / 2</code> comes from the length
of a unit regular hexagon’s height <em>(a line, perpendicular to any side of a hexagon, starting at its center)</em>. Every
unit scales with the tile’ size.</p>
<p>As you can see, it depends on tile side length. This is the major tile parameter. Since I render tiles
based on that parameter.</p>
<h1 id="tiles">Tiles</h1>
<p>Each tile should have six lines. To do that, I created 12 <em>“connection slots”</em>, two on each
side of a tile, as shown below:</p>
<img src="/images/entanglement/tile-connections-1.webp" loading="lazy" alt="">
<p>Then, by generating six random pairs of integer numbers from the range <code>[1, 12]</code>, we can obtain actual
connections inside a single tile. Note that none of the numbers should be used more than once and
that none of the pairs should have a duplicate. Then a tile might look like this:</p>
<img src="/images/entanglement/tile-sample.webp" loading="lazy" alt="">
<p>To display a tile, I’ve developed a prototype tile in SVG:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">svg</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> height</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"232"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"232"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">polygon</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> points</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"55.0,5.0 155.0,5.0 205.0,92.0 155.0,178.0 55.0,178.0 5.0,92.0"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"fill:none;stroke:#000;stroke-width:2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">svg</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>And to make this template re-usable, I’ve dropped in a <em>“side length”</em> parameter. Pre-calculating
pins’ slots positions and hexagon’s vertex positions and making it parametric <em>(with a side length
parameter)</em>, I’ve got this function, which generates a tile:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TileImageGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> vertices: [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">150</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">87</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">150</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">173</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">173</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">87</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> width: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> height: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scaleCoefficient: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> centerX: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> centerY: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sideLength</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sideLength) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 100.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.width </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ceil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2.0</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sideLength)))</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.height </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ceil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.73</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sideLength)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.centerX </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.width </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.centerY </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.height </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> borderTile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIImage {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> size </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGSize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.width, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">height</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.height)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> opaque </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scale: CGFloat </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        UIGraphicsBeginImageContextWithOptions</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(size, opaque, scale)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> context </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> UIGraphicsGetCurrentContext</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // draw outer shape</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shapePathRef: CGMutablePath </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGMutablePath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setFillColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(UIColor.black.cgColor)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setLineJoin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(CGLineJoin.round)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">count</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i].0) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i].1) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x0 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].0) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y0 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].1) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                shapePathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">move</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">to</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: x0, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: y0))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            shapePathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addLine</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">to</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: x1, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: y1))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        shapePathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">closeSubpath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shapePathRef)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">fillPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // finish drawing</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> image </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> UIGraphicsGetImageFromCurrentImageContext</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        UIGraphicsEndImageContext</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> image</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Now, if I want to draw connection lines, I can just spicy that code with pre-calculated pin slots
connections coordinates and, using some neat line stroke technique, draw tile exactly as shown above:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RenderingParams</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sideLength: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> stroke: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pathStroke: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> strokeColor: UIColor</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pathColor: UIColor</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> highlightPathColor: UIColor</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> markPathColor: UIColor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sideLength</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        stroke</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        pathStroke</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        strokeColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: UIColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> UIColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">red</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">green</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">blue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">alpha</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        pathColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: UIColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIColor.white,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        highlightPathColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: UIColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> UIColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">red</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">green</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">blue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">alpha</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        markPathColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: UIColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> UIColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">red</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">green</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">blue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">alpha</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sideLength </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sideLength</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> stroke</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.pathStroke </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pathStroke</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.strokeColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> strokeColor</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.pathColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pathColor</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.highlightPathColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> highlightPathColor</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">            self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.markPathColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> markPathColor</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TileImageGenerator</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> vertices: [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">150</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">87</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">150</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">173</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">50</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">173</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">87</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pins: [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">83</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">116</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">166</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">29</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">182</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">58</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">182</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">116</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">166</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">145</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">116</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">173</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">83</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">173</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">34</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">145</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">18</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">116</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">18</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">58</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">34</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">29</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> width: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> height: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scaleCoefficient: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> centerX: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> centerY: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> renderingParams: RenderingParams</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">renderingParams</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: RenderingParams) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> renderingParams</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sideLength) </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 100.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.width </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ceil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2.0</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sideLength </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.height </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ceil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.73</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.sideLength </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.centerX </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.width </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.centerY </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.height </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> nonEmptyTile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tileParams: TileParams) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIImage {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> size </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGSize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.width, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">height</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.height)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> opaque </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> scale: CGFloat </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        UIGraphicsBeginImageContextWithOptions</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(size, opaque, scale)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> context </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> UIGraphicsGetCurrentContext</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // draw outer shape</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shapePathRef: CGMutablePath </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGMutablePath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setFillColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">UIColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">red</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.88</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">green</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.88</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">blue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.88</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">alpha</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).cgColor)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setLineJoin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(CGLineJoin.round)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">count</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i].0) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i].1) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x0 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].0) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y0 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.vertices[i </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].1) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                shapePathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">move</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">to</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: x0, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: y0))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            shapePathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addLine</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">to</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: x1, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: y1))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        shapePathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">closeSubpath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shapePathRef)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">fillPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // draw connections</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (c0, c1) </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tileParams.connections {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setLineWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.pathStroke))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> connectionPathRef: CGMutablePath </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGMutablePath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pathColor: CGColor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tileParams.mark.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">contains</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">where</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: { (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">$0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.0 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c0 </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> $0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.1 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c1) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">$0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.0 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c1 </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> $0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.1 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c0) }) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                pathColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.markPathColor.cgColor</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tileParams.highlight.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">contains</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">where</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: { (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">$0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.0 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c0 </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> $0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.1 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c1) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">$0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.0 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c1 </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> $0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.1 </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c0) }) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                pathColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.highlightPathColor.cgColor</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                pathColor </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.pathColor.cgColor</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p0x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.pins[c0].0) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p0y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.pins[c0].1) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p1x </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.pins[c1].0) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p1y </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.pins[c1].1) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.scaleCoefficient </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            connectionPathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">move</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">to</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: p0x, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: p0y))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            connectionPathRef.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addQuadCurve</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">to</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: p1x, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: p1y), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">control</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGPoint</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.centerX, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.centerY))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setLineWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.pathStroke) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1.25</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setStrokeColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(UIColor.black.cgColor)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(connectionPathRef)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">strokePath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setLineWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.pathStroke))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setStrokeColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(pathColor)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(connectionPathRef)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">strokePath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // stroke out the outer shape to cover the paths</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setStrokeColor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.strokeColor.cgColor)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">setLineWidth</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">CGFloat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.renderingParams.stroke)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">addPath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shapePathRef)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        context</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">strokePath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // finish drawing</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> image </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> UIGraphicsGetImageFromCurrentImageContext</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        UIGraphicsEndImageContext</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> image</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>As you can see, two major things happened here:</p>
<ol>
<li>I encapsulated all the parameters like line stroke width and line colors ina a separate class, <code>RenderingParams</code></li>
<li>I added rendering lines using two-time rendering technique to emulate borders over connection lines; e. g. I first draw a thick line, filled with the stroke color, which should be applied, and then I render a thinner line with exactly the same coordinates, but different color; doing so, the bottom line becomes just a background for the top one</li>
</ol>
<p>Now, tiles should be rotated. To do that, two tricks have been applied:</p>
<ol>
<li>as we have our tiles drawn as <code>UIImage</code>, we can simply rotate that image around its center to create the visual effect of rotation</li>
<li>as we have our connection pins as a plain array, we can just re-calculate the indices of connection’s <em>“input”</em> and <em>“output”</em></li>
</ol>
<p>There are a couple of points, which should be described prior to the algorithm of a tile rotation.</p>
<p>The tiles are connected using those connection pins. And based on the coordinates of a tile and its
neighbor, we can tell, which pins of those two will be connected. And since our game goal is to prolong
a single line, by keeping track of which connections of which tiles form a line, we may define a couple
rules:</p>
<ul>
<li>given connected pins inside one tile, we may describe that connection in two pins’ indices, namely <em>“input”</em> and <em>“output”</em></li>
<li>connections of a tile, not involved in forming a line, can be treated in either way - input and output could be named in a reversed order <em>(again, <strong>unless they are forming a line</strong>, otherwise it’s essential to say where the line comes from and where it ends inside a given tile)</em></li>
<li>the central tile will have only one output - the one, where the line starts its journey; let it be the connection pair <code>(0, 0)</code></li>
<li>one can easily calculate the neighbor’s output, given the last tile of a line path and its successor</li>
</ul>
<p>Let’s define a class <code>Tile</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Tile</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> connections: [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Simple enough, right? Now let’s assume our program will fill out <code>connections</code> list automatically and
all the tiles will be assigned the correct list of connections. Given that, we may define two helper
methods on a <code>Tile</code> class:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Tile</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> connections: [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> output</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (inPin, outPin) </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.connections {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inPin </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> outPin</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> outPin </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inPin</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> input</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">from</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> output: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (output </span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (output </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (output </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>The first one, <code>output(from input: Int)</code> will return us the output index inside a given tile, where the line
will come out from, when entering our tile from input with index <code>from</code>.</p>
<p>So, for example, given a tile with connections</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t: Tile </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Tile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">t.connections </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">11</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"></span></code></pre>
<p>the call <code>t.output(from: 11)</code> will give us <code>8</code>, which could be easily found from the list of connections
by hand.</p>
<p>The second method will give us the input index inside the neighbor tile, which is connected to an output of
the given tile.</p>
<p>And for the example above, the call <code>t.input(from: 0)</code> will give us <code>7</code>. And here’s an image to show why:</p>
<img src="/images/entanglement/entanglement-tile-neighbours.webp" loading="lazy" alt="">
<p>Given we have a portion of a path layed out on a game plane already, there is only one way of correctly placing
each next tile <em>(the path which is already present on a plane never changes and always comes to the same connection point)</em>.</p>
<p>And now it’s finally the time to explain the rotation of the tiles!</p>
<p>After a tile has been assigned a set of connected pins, the rotation should preserve those connections.
The rotation operation uses modulo operation, as with calculating neighbor tile’s input pin index,
but on a scale of each connection pair <em>(a pair of input and output)</em>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Tile</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rotate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> direction: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.connections </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.connections.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">input</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">output</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ((input </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (direction </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, (output </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (direction </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    //...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Here, <code>direction</code> is either <code>1</code> for clockwise rotation or <code>-1</code> for counter-clockwise rotation.</p>
<h1 id="path-prediction">Path prediction</h1>
<p>Finding a place where to put the next tile is an iterative process, which hardly depends on a current tile
(its connections and position) and the tiles which are already placed on the field.</p>
<p>At the very beginning of the game, the next place could be set as a constant and is always above the
central tile <em>(so if the central tile has the position <code>(4, 4)</code>, then the next place would be <code>(5, 5)</code> - along with the diagonal in our coordinate system)</em>.</p>
<p>To track the boundaries of a field and the beginning of the line <em>(in other words - the places, where the line cannot go)</em>, I inherited a <code>Tile</code> class with a set of other classes just to track if the game can
continue or not: <code>ZeroTile</code> and <code>BorderTile</code> represent restricted bounds of a game field.</p>
<p>Now, given the output of a current tile, which the line will use to continue through the tile,
we can predict where the next tile should be put on a field:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> findNextPlace</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> path: Path, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">currentPosition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (u, v) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentPosition</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> output: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> path.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">lastOutput</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> output {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u, v </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">9</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">11</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u, v </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    default:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (u, v)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>If, however, there is a tile at the next place on the field, we should use its connections to determine
the next position.</p>
<p>Otherwise, if the next position is either the border of a field or an empty space - we stop the search.</p>
<p>Search itself is just as simple as that:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">func</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> findFuturePath</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tile: NonEmptyTile) </span><span style="color:#D73A49;--shiki-dark:#F97583">throws</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (Path, (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">isPathFinished</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        throw</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> GameError.gameOver</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpPath: Path </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpNextPlace: (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.nextPlace</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    tmpPath.items </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.path.items.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">last</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (u, v) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpNextPlace</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    while</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> lastOutput: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpPath.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">lastOutput</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextTile: Tile</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.nextPlace.0 </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.nextPlace.1 {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            nextTile </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tile</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        } </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            nextTile </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.tiles[u][v]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(nextTile </span><span style="color:#D73A49;--shiki-dark:#F97583">is</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NonEmptyTile) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            break</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        tmpPath.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">expand</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(u, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">v</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: v, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">input</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: nextTile.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">input</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">to</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: lastOutput), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">output</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">try</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> nextTile.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">outputFromNeighbourOutput</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">from</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: lastOutput))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        tmpNextPlace </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">findNextPlace</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tmpPath, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">nextPlace</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: tmpNextPlace)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> u </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpNextPlace.0 </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpNextPlace.1 {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            break</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (u, v) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpNextPlace</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    tmpPath.items.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">removeFirst</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (tmpPath, tmpNextPlace)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h1 id="counting-points">Counting points</h1>
<p>This task is quite simple, compared to the others described above. When a user places a tile, we estimate
the length of a predicted path and add numbers from <code>[1..L]</code> <em>(where <code>L</code> is the length of the predicted path)</em>
to score. This could be expressed as a sum of a finite arithmetic sequence with a step of <code>1</code>:</p>
<img src="/images/entanglement/score_equation.webp" loading="lazy" alt="">
<h1 id="the-end-result">The end result</h1>
<p>The end result of this coding exercise looks like exactly as the one at the very top of this post:</p>
<img src="/images/entanglement/ios-screen1.webp" loading="lazy" alt=""> </div>  </article><article> <h1> <a href="/2017/03/13/2017-03-12-libc-component-interaction.html">libc.js: component interaction</a> </h1> <time datetime="2017-03-12T21:22:24.000Z"> Mar 13, 2017 </time> <div class="content"> <img src="/images/microverse-battery_optimized.webp" loading="lazy" alt="">
<h1 id="libcjs">libc.js</h1>
<p>Recently I’ve written a post about functional programming techniques, coming into the world of front-end and
the library I crafted as an experiment. That library, <a href="https://github.com/shybovycha/libc.js">libc.js</a> was
highly inspired by <a href="http://elm-lang.org/">Elm</a> and <a href="http://mithril.js.org">Mithril</a>. But it suffered two major features:</p>
<ol>
<li>components were hardly able to be used in other components</li>
<li>the interaction between components was nearly impossible <em>(or, at least, not very transparent)</em></li>
</ol>
<p>What’s hidden beneath the next version of the library?</p>
<!--more-->
<p>The next logical step in library development was to make the interaction between components smooth and
natural. I was primarily thinking of two options:</p>
<ol>
<li>inheriting component from a <code>VirtualDOMNode</code> class</li>
<li>passing both properties and children as arguments to the <code>view</code> function of a component</li>
</ol>
<p>I’ll first describe the second approach a bit: since properties and children basically describe
a <code>VirtualDOMNode</code> itself, that meant to pass a <code>VirtualDOMNode</code> instance to the <code>view</code> function.
And if I did so, I’d get <code>Mithril.js</code>.</p>
<p>If I inherit a component class from a <code>VirtualDOMNode</code>, I’d step away from the initial purpose
of keeping <code>view</code> and <code>update</code> functions separated and pure.</p>
<p>The library exposes a <code>Store</code> class, which is very similar to <a href="http://redux.js.org">Redux</a>.
This class was also used internally to handle components’ state changes. But that did not
solve the problem in any way.</p>
<p>I ended up creating a <code>Component</code> class, which encapsulated both <code>view</code> and
<code>update</code> functions, internal component state and the <code>dispatch</code> function, which operated on
the component’s internal state. I also exposed the <code>render()</code> method, which could then be used
to bind a component to an external <code>Store</code> object <em>(which I’ll cover in a minute)</em>.</p>
<h1 id="re-using-components">Re-using components</h1>
<p>The changes made allowed components to be used in other components. To illustrate that, I
created a <code>Tab</code> component and the corresponding example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tabs </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> update</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (message.type </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'SELECT_TAB'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Object.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">assign</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({}, state, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                currentTabIndex: message.tabIndex</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> view</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentTabIndex </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state.currentTabIndex </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tabHeaders </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> children.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">tab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">tabIndex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`tab-header ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">tabIndex</span><span style="color:#D73A49;--shiki-dark:#F97583"> ==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentTabIndex</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'selected'</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ''}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    click</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        type: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'SELECT_TAB'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        tabIndex</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ tab.children[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tabs </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> children.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">tab</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">tabIndex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`tab-content ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">tabIndex</span><span style="color:#D73A49;--shiki-dark:#F97583"> ==</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> currentTabIndex</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'selected'</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ''}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                tab.children.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">slice</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'tab-headers'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, tabHeaders ],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'tab-container'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, tabs ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createComponent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(view, update);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">})();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> app </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> view</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ Tabs, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'header'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Tab #1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'FIRST TAB CONTENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'header'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Tab #2'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'SECOND TAB CONTENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'header'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Tab #3'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'THIRD TAB CONTENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ] ];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createComponent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(view);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">})();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">app.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span><span style="color:#6F42C1;--shiki-dark:#B392F0">mount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(document.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">querySelector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'#app'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span></code></pre>
<p>I also use these styles to make tabs look like tabs:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-container</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">flex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    flex-direction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">column</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-headers</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">flex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    justify-content</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">space-around</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-header</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    text-align</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    cursor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">pointer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    flex-grow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-header:hover</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    text-decoration</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">underline</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-header.selected:hover</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    text-decoration</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-header.selected</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    background</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#ddd</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-content</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.tab-content.selected</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">block</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This example shows how <code>Tabs</code> component could be used and, what’s more important,
<strong>as a High-Order Component</strong>, passing tabs along with their headers as a set
of children to the <code>Tabs</code> component.</p>
<h1 id="using-external-state">Using external state</h1>
<p>Using component’s <code>render()</code> method and the <code>createStore(initialState)</code> function,
exposed by a library, we can also create and use the store as an external state
provider for our component:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> counterStore </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createStore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> update</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (message </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'INCREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (message </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'DECREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">counterStore.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">onAction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(update);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> view</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state.store;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">click</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'INCREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Increment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">click</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'DECREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Decrement'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`Count: ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getState</span><span style="color:#032F62;--shiki-dark:#9ECBFF">() </span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Counter </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createComponent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(view);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">counterStore.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">onStateChanged</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Counter.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Counter.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ store: counterStore }).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">mount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(document.body);</span></span>
<span class="line"></span></code></pre>
<p>Here you can see how to create a store with an initial state. The initial state could be pretty
much anything - a number, a string, an array, an object…</p>
<p>Using store’s <code>onAction(handler)</code> and <code>onStateChanged(handler)</code> methods, we can set
a chain of reducers and a list of observers to state changes, correspondingly.</p>
<p>This example also shows how we can pass the initial state to a component’s instance, using
the <code>init(state, children)</code> method of a <code>Component</code> instance <em>(in this example - <code>Counter.init()</code>)</em>.</p>
<p>In this example a few method signatures are also shown in action:</p>
<ul>
<li><code>Component.init()</code> has two arguments: <code>initialState</code> and <code>children</code> and both are optional</li>
<li><code>createComponent()</code> has two arguments: <code>viewFn</code> and <code>updateFn</code> and, again, both are optional</li>
<li><code>viewFn</code> has three arguments: <code>state</code>, <code>children</code> and <code>dispatchFn</code>; last one is used to change component’s internal state; second one is used for HOCs and will be handy to make configurations or to wrap the children with a markup or logic; first argument is just an internal component’s state and, by the first call of the <code>viewFn</code> is equal to component’s <code>initialState</code>, passed by <code>Component.init()</code> call</li>
<li><code>createStore(initialState)</code> is used to create a <code>Store</code> instance, where <code>initialState</code> is pretty much anything</li>
<li><code>Store.dispatch()</code> has exactly the same signature as the <code>dispatchFn</code>, used in <code>viewFn</code></li>
</ul>
<h1 id="instead-of-wrap-up">Instead of wrap-up</h1>
<p>I hope this library is a little bit more than just an experiment and once it will be used for a great good!</p> </div>  </article><article> <h1> <a href="/2017/02/22/2017-02-21-speeding-up-algorithms-with-sse.html">Speeding-up algorithms with SSE</a> </h1> <time datetime="2017-02-21T15:59:54.000Z"> Feb 22, 2017 </time> <div class="content"> <p>Have you ever asked anyone if assembly language might be useful nowadays? So, here’s the short answer: <strong>YES</strong>. When you know how your computer works <em>(not a processor itself, but the whole thing - memory organization, math co-processor and others)</em>, you may optimize your code while writing it. In this short article, I shall try to show you some use cases of optimizations, which you may incorporate with the usage of low-level programming.</p>
<p>Recently I was reading through my old posts and found out there is a gap in the article about SSE - the post did not cover some of the implementation caveats. I decided to fulfill this and re-publish a new version.</p>
<!--more-->
<h2 id="finding-maximum">Finding maximum</h2>
<p>So, let’s start-off searching a maximum element in the array. Usually, it is nothing just iterating through the array, comparing each element with some starting value. For optimization reason and for the precision’s sake we set the initial value to the first array’s element. Like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> max_value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a[i];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h2 id="index-based-search">Index-based search</h2>
<p>What we could do firstly is to store not the search element itself, but its index:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> max_index</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (a[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a[res])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a[res];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This naive optimization has its effect <em>(time in seconds; the value found in braces)</em>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>Value-based: 0.00732200 (0.99999827)</span></span>
<span class="line"><span>Index-based: 0.00674200 (0.99999827)</span></span>
<span class="line"><span></span></span></code></pre>
<h2 id="vector-operations">Vector operations</h2>
<p>This is quite a universal algorithm, which could be used for any type, which allows comparing. But let’s think abotu how we can speed up that code. First of all, we could split the array into pieces and find maximum among them.</p>
<p>There is a technology, allowing that. It is called <strong>SIMD</strong> - <strong>S</strong>ingle <strong>I</strong>nstruction - <strong>M</strong>ultiple <strong>D</strong>ata Stream. Simply saying, it means dealing with multiple data pieces <em>(cells, variables, elements)</em> with the use of a single processor’ instruction. This is done in processor command extension called <strong>SSE</strong>.</p>
<p><strong>Note:</strong> your processor or even operating system may not support these operations. So, before continuing reading this article, be sure to check if it does. On Unix systems you may look for <code>mmx|sse|sse2|sse3|sse4_1|sse4_1|avx</code> in <code>/proc/cpuinfo</code> file.</p>
<p>SSE extension has a set of vector variables to be used. These variables <em>(on the lowest, assembly level, they are called <code>XMM0</code> .. <code>XMM7</code> registers)</em> allow us for storing and processing 128 bits of data as it was a set of <code>16 char</code>, <code>8 short</code>, <code>4 float/int</code>, <code>2 double</code> or <code>1 128-bit int</code> variables.</p>
<p>But wait! There are other versions of SSE, allowing for different registers of a different size! Check this out:</p>
<p><strong>SIMD extensions</strong></p>
<p><strong>MMX - hot 1997:</strong></p>
<ul>
<li>only integer items</li>
<li>vectors have a length of <code>64 bits</code></li>
<li>8 registers, namely <code>MM0</code>..<code>MM7</code></li>
</ul>
<p><strong>SSE highlights:</strong></p>
<ul>
<li>only 8 registers</li>
<li>each register has a size of 128 bit</li>
<li>70 operations</li>
<li>allow for floating-point operations and vector’ elements</li>
</ul>
<p><strong>SSE2 features:</strong></p>
<ul>
<li>adds 8 more registers <em>(so now we have <code>XMM0</code> .. <code>XMM15</code>)</em></li>
<li>adds 144 more operations</li>
<li>makes floating-point operations more precise</li>
</ul>
<p><strong>SSE3 changes:</strong></p>
<ul>
<li>adds 13 more operations</li>
<li>allows for horizontal vector operations</li>
</ul>
<p><strong>SSE4 advantages:</strong></p>
<ul>
<li>adds 54 more operations (47 are given by SSE4.1 and 7 more come from SSE4.2)</li>
</ul>
<p><strong>AVX - brand new version:</strong></p>
<ul>
<li>vector size is now <code>256 bit</code></li>
<li>registers are renamed to <code>YMMi</code>, while <code>XMMi</code> are the lower 128 bits of <code>YMMi</code></li>
<li>operations now have three operands - <code>DEST</code>, <code>SRC1</code>, <code>SRC2</code> (<code>DEST = SRC1 op SRC2</code>)</li>
</ul>
<p><strong>SSE operations</strong></p>
<p>So, I mentioned <strong>horizontal vector operations</strong>. But let’s do it in a series.</p>
<p>There are two SSE operation types: <strong>scalar</strong> and <strong>packed</strong>. Scalar operations use only the lowest elements of vectors. Packed operations deal with each element of vectors given. Look at the images below and you shall see the difference:</p>
<div>
    <img src="/images/sse-optimizations/addss.webp" loading="lazy" alt="">
</div>
<div>
    <img src="/images/sse-optimizations/addps.webp" loading="lazy" alt="">
</div>
<div>
    <img src="/images/sse-optimizations/addsd.webp" loading="lazy" alt="">
</div>
<div>
    <img src="/images/sse-optimizations/addpd.webp" loading="lazy" alt="">
</div>
<p>Horizontal operations deal on vectors in a different direction. Instead of operating on elements in the corresponding positions, these operate on elements in adjacent positions:</p>
<div>
    <img src="/images/sse-optimizations/haddps.webp" loading="lazy" alt="">
</div>
<!--more-->
<div class="content-read-marker" data-fraction="25"></div>
<p>So there are six “types” of operations, as described above. They are:</p>
<ul>
<li>operations, dealing with <strong>scalar</strong> or <strong>double</strong> values</li>
<li>operations, operating on <strong>all elements in a pack</strong> or on <strong>last elements of a pack</strong></li>
<li>operations, handling values on <strong>corresponding</strong> or <strong>adjacent</strong> positions</li>
</ul>
<p>To determine if an operation type, you just need to look at the last two characters of operation’s name:</p>
<p><code>HADDPS</code> -> <code>Horizontal</code> <code>ADD</code> <code>Packed</code> <code>Single-precision</code></p>
<p><strong>Working with SSE</strong></p>
<p>Images above describe how processor instructions <em>(assembly commands)</em> work. To map those onto C++ functions, you only need to replace assembly operation with the corresponding function from SSE headers <em>(I’ll cover that in just a second)</em>. But the main goal of those explanations above was to give you an idea how operations themselves work and where do they store results.</p>
<p>To work with SSE we need to follow these three steps:</p>
<ol>
<li>load data into XMM registers</li>
<li>perform all the operations needed on those XMM registers</li>
<li>store data from XMMs into usual variables</li>
</ol>
<p>To use vector operations, you shall need to have some header files included in your code, as well as compiler flags, turned on.</p>
<p>These are header files:</p>
<ul>
<li><code>mmintrin.h</code> - MMX</li>
<li><code>xmmintrin.h</code> - SSE</li>
<li><code>emmintrin.h</code> - SSE2</li>
<li><code>pmmintrin.h</code> - SSE3</li>
<li><code>smmintrin.h</code> - SSE4.1</li>
<li><code>nmmintrin.h</code> - SSE4.2</li>
<li><code>immintrin.h</code> - AVX</li>
</ul>
<p>None of the header files requires all the previous ones to be included too. Compiler flags are <code>-mmmx</code>, <code>-msse</code>, <code>-msse2</code>, <code>-msse3</code>, <code>-msse4</code>, <code>-mavx</code>, correspondingly. As with header files, none of these flags requires previous ones to be turned on.</p>
<p><strong>Data types</strong></p>
<p>There are three <em>“standard”</em> data types within SSE:</p>
<ol>
<li><code>__m128</code>, which is SSE’s <code>float[4]</code></li>
<li><code>__m128d</code> corresponds to <code>double[2]</code></li>
<li><code>__m128i</code> represents one of these: <code>char[16]</code>, <code>short int[8]</code>, <code>int[4]</code> or <code>uint64_t[2]</code></li>
</ol>
<p>Each of them needs to be converted from or to standard C++ types with its own <strong>intrinsic</strong> (SSE operation).</p>
<p><strong>Intrinsics</strong></p>
<p>SSE operations in C++ are named this way: <code>_mm_{OPERATION}_{SUFFIX}</code>. The <strong>operation</strong> is the operation on vectors you want to perform. The <strong>suffix</strong> is a set of flags for a processor, showing in what way it should work with operands <em>(packed/scalar, single-/double- precision, etc.)</em>.</p>
<p>For optimization’s sake, it is better if operands for intrinsincs are aligned in memory for base 16. But do not worry, the compiler will automatically decide if the variable is aligned or not and perform all the needed operations itself.</p>
<p>For loading data into SSE vectors there are four intrinsics:</p>
<ol>
<li><code>_mm_set_ps(4.0, 3.0, 2.0, 1.0)</code> -> <code>[4.0, 3.0, 2.0, 1.0]</code></li>
<li><code>_mm_set1_ps(3.0)</code> -> <code>[3.0, 3.0, 3.0, 3.0]</code></li>
<li><code>_mm_set_ss(4.0)</code> -> <code>[0.0, 0.0, 0.0, 4.0]</code></li>
<li><code>_mm_setzero_ps()</code> -> <code>[0.0, 0.0, 0.0, 0.0]</code></li>
</ol>
<p>And like those, there are very similar intrinsics for storing data from vectors in a usual C++ types <em>(in the examples below assume working with the same <code>__m128 t = [4.0, 3.0, 2.0, 1.0]</code>)</em>:</p>
<ol>
<li><code>_mm_store_ps(float[4], __m128)</code> -> <code>[4.0, 3.0, 2.0, 1.0]</code></li>
<li><code>_mm_store_ss(float*, __m128)</code> -> <code>1.0</code></li>
<li><code>_mm_store_ss(float*, __m128)</code> -> <code>[1.0, 1.0, 1.0, 1.0]</code></li>
<li><code>double _mm_cvtsd_f64(__m128d)</code> -> <code>1.0</code></li>
<li><code>int _mm_cvtsi128_si32(__m128i)</code> -> <code>1</code> <em>(for given <code>__m128i [4, 3, 2, 1]</code>)</em></li>
</ol>
<p><strong>Finding maximum</strong></p>
<p>So, let’s get back to finding the maximum in an array. For this task we will search maximums on each 4 elements of our array, storing them in the <code>XMMi</code> register:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> max_sse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f4 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (__m128</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_setzero_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_max_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, f4[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    _mm_store_ss</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res, maxval);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>But if you run this code, you may notice it returns the maximum, not in 100% of cases. This is because we are storing <strong>four maximums</strong> between <strong>each portion of an array</strong>. So, only one of those four is the maximum. But how can we find the maximum among four numbers? Running a loop seems obvious but not effective enough…</p>
<p>We may use the <code>shuffle</code> intrinsic! That is, cycle-shifting vector three times and finding maximum between that shifted vector and its previous value. That will give us the maximum in all four positions of our vector.</p>
<p>Here is a better explanation:</p>
<p>If we want to cycle-shift a 4-number array, we use <code>_mm_shuffle_ps</code> intrisinc.</p>
<p>It takes 3 parameters: <code>m1</code>, <code>m2</code>, and <code>mask</code>. First two are four-word (four-number) packs. The mask consists of four numbers and shows which elements of pack <code>m2</code> and which elements of pack <code>m1</code> will form the result. This mask could be obtained using <code>_MM_SHUFFLE(z, y, x, w)</code> macro, which forms an integer according to the formula <code>(z &#x3C;&#x3C; 6) | (y &#x3C;&#x3C; 4) | (x &#x3C;&#x3C; 2) | w</code>.</p>
<p>Given those definitions, the call <code>m3 = _mm_shuffle_ps(m1, m2, _MM_SHUFFLE(z, y, x, w))</code> is equal to the formula <code>m3 = (m2(z) &#x3C;&#x3C; 6) | (m2(y) &#x3C;&#x3C; 4) | (m1(x) &#x3C;&#x3C; 2) | m1(w)</code>.</p>
<p>So we want to shift a pack by one element right, like this: <code>[4, 2, 3, 1] => [2, 3, 1, 4]</code>. We need to pass the initial pack, <code>[4, 2, 3, 1]</code> twice: <code>_mm_shuffle_ps([4, 2, 3, 1], [4, 2, 3, 1], mask)</code> and form a mask, which will use elements <code>[2, 3]</code> for the higher words of a result and elements <code>[3, 1]</code> for the lower words. These elements can be then indexed as follows:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>+-----------+---------+</span></span>
<span class="line"><span>| index     | 3 2 1 0 |</span></span>
<span class="line"><span>+-----------+---------+</span></span>
<span class="line"><span>| element   | 4 2 3 1 |</span></span>
<span class="line"><span>+-----------+---------+</span></span>
<span class="line"><span></span></span></code></pre>
<p>So to get the pair <code>[2, 3]</code> we need elements with indices <code>[2, 1]</code>. And to get the pair <code>[1, 4]</code> we need elements with indices <code>[0, 3]</code>.</p>
<p>Given that, we can use macro <code>_MM_SHUFFLE()</code> to generate the mask: <code>_MM_SHUFFLE(2, 1, 0, 3)</code>. And the final formula looks like this: <code>_mm_shuffle_ps(m1, m2, _MM_SHUFFLE(2, 1, 0, 3))</code>.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>+--+---------+</span></span>
<span class="line"><span>|  | 3 2 1 0 |</span></span>
<span class="line"><span>+------------+</span></span>
<span class="line"><span>|m1| 4 2 3 1 |</span></span>
<span class="line"><span>+------------+</span></span>
<span class="line"><span>|m2| 4 2 3 1 |</span></span>
<span class="line"><span>+------------+</span></span>
<span class="line"><span>|m3| 2 3 1 4 |</span></span>
<span class="line"><span>+------------+</span></span>
<span class="line"><span></span></span></code></pre>
<p>And our <code>max</code> function in pseudo-code looks like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// given val = [4, 2, 3, 1]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> val;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    val </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_shuffle_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(val, val, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">_MM_SHUFFLE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_max_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, val);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Which will be executed like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="groovy"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// preparation</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// i = 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">val </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _mm_shuffle_ps(val, val, _MM_SHUFFLE(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="color:#6A737D;--shiki-dark:#6A737D">// = [2, 3, 1, 4]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _mm_max_ps([</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]) </span><span style="color:#6A737D;--shiki-dark:#6A737D">// = [4, 3, 3, 4]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// i = 1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">val </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _mm_shuffle_ps(val, val, _MM_SHUFFLE(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="color:#6A737D;--shiki-dark:#6A737D">// = [3, 1, 4, 2]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _mm_max_ps([</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]) </span><span style="color:#6A737D;--shiki-dark:#6A737D">// = [4, 3, 4, 4]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// i = 2</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">val </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _mm_shuffle_ps(val, val, _MM_SHUFFLE(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="color:#6A737D;--shiki-dark:#6A737D">// = [1, 4, 2, 3]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _mm_max_ps([</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]) </span><span style="color:#6A737D;--shiki-dark:#6A737D">// = [4, 4, 4, 4]</span></span>
<span class="line"></span></code></pre>
<p>The <code>_MM_SHUFFLE(2, 1, 0, 3)</code> call could be expanded to <code>(2 &#x3C;&#x3C; 6) | (1 &#x3C;&#x3C; 4) | (0 &#x3C;&#x3C; 2) | 3</code>, which equals to <code>147</code> or <code>0x93</code> in HEX.</p>
<p>And here is the final C++ implementation:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> max_sse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f4 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (__m128</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_setzero_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_max_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, f4[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_max_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">_mm_shuffle_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, maxval, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">93</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    _mm_store_ss</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res, maxval);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<div class="content-read-marker" data-fraction="50"></div>
<p><strong>And how about integers?</strong></p>
<p>The code for finding maximum with SSE among integer array is very, very similar to the previous one - you just need to decorate intrinsics with a different prefix and change store operation:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> max_sse_int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128i </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f4 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (__m128i</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128i maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_setzero_si128</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_max_epi32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, f4[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        maxval </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_max_epi32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">_mm_shuffle_epi32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval, </span><span style="color:#D73A49;--shiki-dark:#F97583">0x</span><span style="color:#005CC5;--shiki-dark:#79B8FF">93</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_cvtsi128_si32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(maxval);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><strong>Profit?</strong></p>
<p>If we compare the results of all three methods - usual loop, index-based searching and SSE, we may see something like this <em>(I ran these tests on my laptop’s i7 processor on one million random float/int values)</em>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span></span></span>
<span class="line"><span>=== Looking for a maximum element in a list of 1000000 floats ===</span></span>
<span class="line"><span>* Value-based: 0.00382500 sec; max = 0.99999923</span></span>
<span class="line"><span>* Index-based: 0.00282200 sec; max = 0.99999923</span></span>
<span class="line"><span>* SSE: 0.00131300 sec; max = 0.99999923</span></span>
<span class="line"><span>=== Looking for a maximum element in a list of 1000000 integers ===</span></span>
<span class="line"><span>* Value-based: 0.00384200 sec; max = 99</span></span>
<span class="line"><span>* Index-based: 0.00298300 sec; max = 99</span></span>
<span class="line"><span>* SSE: 0.00130400 sec; max = 99</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre>
<p>Here you can see that index-based searching gives some speeding-up (around <code>15%</code>). But the real speed boost is gained with SSE (almost <strong><code>4 times</code></strong>!).</p>
<h2 id="calculating-the-sum">Calculating the sum</h2>
<p>Now let’s try something harder - calculating a sum of array’s elements. Here we will use the horizontal vector operations. But first, here’s the general algorithm:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        res </span><span style="color:#D73A49;--shiki-dark:#F97583">+=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a[i];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Simple enough, huh? Now let’s use the SSE’s <code>_mm_add_ps</code> intrinsic. Running it on each pack of four elements will give us the summary vector of four floats:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum_sse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">v4 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (__m128</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_setzero_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_add_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum, v4[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    _mm_store_ss</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res, vec_sum);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>But if we now add the elements of that vector horizontally to themselves, we would then have the two-element vector. Adding it to itself will give us the final single-element vector:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum_sse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">v4 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (__m128</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128 vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_setzero_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_add_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum, v4[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_hadd_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum, vec_sum);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_hadd_ps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum, vec_sum);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    _mm_store_ss</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res, vec_sum);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Nice, isn’t it? But wait! Integers are available too! And they need their special intrinsics! Have no fear, nothing that different here, only the prefixes are different:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">unsigned</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    unsigned</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128i </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">f4 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (__m128i</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) a;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    __m128i vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_setzero_si128</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_hadd_epi32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum, f4[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_hadd_epi32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum, vec_sum);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    vec_sum </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_hadd_epi32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum, vec_sum);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> _mm_cvtsi128_si32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(vec_sum);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>And, just to approve our assumption of speeding-up, here’s the benchmarking <em>(on one million of elements)</em>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Value-based: 0.00853100 (500245.28125000)</span></span>
<span class="line"><span>SSE: 0.00319800 (500243.50000000)</span></span>
<span class="line"><span>Value-based on integers: 0.00773100 (49453512)</span></span>
<span class="line"><span>SSE on integers: 0.00274800 (49453512)</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now here is a thing to think about: the assembly output of the <code>sum</code> function is much shorter than the one for the <code>sum_sse</code> function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">sum(float*, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">):</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        push</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    rbp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rsp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">28</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">esi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        pxor</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#D73A49;--shiki-dark:#F97583">   DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L3:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cmp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">28</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jge</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L2</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cdqe</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        add</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   xmm1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        addss</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#D73A49;--shiki-dark:#F97583">   DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        add</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L2:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        pop</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ret</span></span>
<span class="line"></span></code></pre>
<p>vs</p>
<div class="content-read-marker" data-fraction="75"></div>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">sum_sse(float*, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">):</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        push</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    rbp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rsp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        sub</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rsp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">72</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">184</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">188</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">esi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        pxor</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#D73A49;--shiki-dark:#F97583">   DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">164</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">184</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        pxor</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L5:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">188</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        test</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cmovs</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">edx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        sar</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cmp</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jge</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cdqe</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        sal</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        add</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">48</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">48</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        addps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        add</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L5</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L3:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">80</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">96</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">80</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        haddps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">96</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        nop</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">112</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">112</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        haddps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">128</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        nop</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">164</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">136</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movaps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  XMMWORD PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">160</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">160</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">136</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#D73A49;--shiki-dark:#F97583">   DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">xmm0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        nop</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movss</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   xmm0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">164</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ret</span></span>
<span class="line"></span></code></pre>
<p>And yet, the performance of that longer piece of code is still higher!</p>
<h2 id="limitations">Limitations?</h2>
<p>Please note the difference between sums calculated with naive loop and the one calculated with SSE: <strong>they do differ</strong>. This is caused by a way computer work nowadays. Actually, how they store floating-point values. Since computers deal with binary system, they can not simply store all those digits after point in the memory and operate on them effectively.</p>
<p>Remember, how integers are stored in a binary system? Say, 14:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>+-----------+------------------------+</span></span>
<span class="line"><span>|     n     | 5   4   3   2   1   0  |</span></span>
<span class="line"><span>+------------------------------------+</span></span>
<span class="line"><span>| pow(2, n) | 32  16  8   4   2   1  |</span></span>
<span class="line"><span>+------------------------------------+</span></span>
<span class="line"><span>|   fits?   | N   N   Y   Y   Y   N  |</span></span>
<span class="line"><span>+------------------------------------+</span></span>
<span class="line"><span>|   14  =   | 0 + 0 + 8 + 4 + 2 + 0  |</span></span>
<span class="line"><span>+-----------+------------------------+</span></span>
<span class="line"><span>| bin(14) = | 0   0   1   1   1   0  |</span></span>
<span class="line"><span>+-----------+------------------------+</span></span>
<span class="line"><span></span></span></code></pre>
<p>E.g. binary representation of <code>14</code> is: <code>14<sub>2</sub> = 001110</code>. Leading zeroes could be skipped in a binary system <em>(as there might be as many of those as you wish)</em>.</p>
<p>A similar thing happens to floating-point numbers: the difference is that computer stores the negative powers of two:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>+------------+-----------------------------------------+</span></span>
<span class="line"><span>|     n      | 5        4       3      2     1    0    |</span></span>
<span class="line"><span>+------------------------------------------------------+</span></span>
<span class="line"><span>| pow(2, -n) | 0.03125  0.0625  0.125  0.25  0.5  1.0  |</span></span>
<span class="line"><span>+------------------------------------------------------+</span></span>
<span class="line"><span>|   fits?    | N        N       Y      Y      Y    N   |</span></span>
<span class="line"><span>+------------------------------------------------------+</span></span>
<span class="line"><span>|   0.9  =   | 0    +   0  +  0.125 + 0.25 + 0.5 + 0   |</span></span>
<span class="line"><span>+------------------------------------------------------+</span></span>
<span class="line"><span>| bin(0.9) = | 0        0       1      1      1    0   |</span></span>
<span class="line"><span>+------------------------------------------------------+</span></span>
<span class="line"><span></span></span></code></pre>
<p>As you can see, using 5 bits is not enough to represent 0.9, but only <code>0.875</code>. Even if we use 32 bits <em>(which is just a <code>float</code> data type in C)</em>, we will have <code>0.011001100110011001100110011001110<sub>2</sub></code>, which is <code>0.8999999999068677</code>, but still, it’s not exactly what we wanted. On 64 bits <em>(<code>double</code> type in C)</em> it is better, <code>0.8999999999999999</code>, but, again, not exact value. And if we try adding one million unprecise numbers, we will probably get the unprecise result.</p>
<p>Another big limitation of SSE is that initial data should be aligned to contain the number of elements, which is a multiply of either 2 or 4 <em>(depending on the SSE operation type you are using - scalar or double)</em>.</p>
<h2 id="resources">Resources</h2>
<ol>
<li><a href="http://www.slideshare.net/mkurnosov/3-code-vectorization-sse-avx">Code vectorization with SSE</a></li>
<li><a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/">Intel intrinsics guide</a></li>
<li><a href="https://github.com/shybovycha/sse-optimizations">Examples source code</a></li>
</ol>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2017/02/19/2017-02-14-functional-web.html">Functional web</a> </h1> <time datetime="2017-02-18T16:44:39.000Z"> Feb 19, 2017 </time> <div class="content"> <img src="/images/functional_web/bicycle.webp" loading="lazy" class="img-responsive img-sm img-rounded pull-right">
<p>In last couple of years the functional programming paradigm became very popular.
A huge amount of libraries, tools, tutorials and blog posts appeared.
Although the paradigm itself is rather old <em>(lambda calculus was developed around 1930 and the Lisp language was introduced in 1950)</em>, its popularity blew up rapidly somewhere in 2014-2016 and that’s what is happening right now.
Probably one of the most powerful influencers, giving FP <em>(functional programming)</em> that thrust is web development.
Since Facebook introduced <strong>React</strong>, the community started incorporating many things from FP with React - including <strong>Redux</strong> and <strong>Immutable.js</strong>.
But there are much more interesting things which were invented on this wave of FP popularity. One of them is <a href="http://elm-lang.org/">Elm</a>.</p>
<p>This is a story how I <s>implemented</s> invented yet another <s>web framework</s> wheel.</p>
<!--more-->
<h2 id="tldr">TL;DR</h2>
<style>
  .row {
    display: flex;
    flex-wrap: wrap;
  }

  .row .col {
    max-width: 48%;
    margin: 0 1%;
  }
</style>
<div class="row">
  <div class="col">
    <p><a href="https://facebook.github.io/react/" target="_blank">React</a></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>```js</span></span>
<span class="line"><span>class App extends React.Component {</span></span>
<span class="line"><span>  constructor(props) {</span></span>
<span class="line"><span>    super(props);</span></span>
<span class="line"><span>    this.state = { counter: 0 };</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  increment() {</span></span>
<span class="line"><span>    this.setState({ counter: this.state.counter + 1 });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  decrement() {</span></span>
<span class="line"><span>    this.setState({ counter: this.state.counter - 1 });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  render() {</span></span>
<span class="line"><span>    return (</span></span>
<span class="line"><span>      &#x3C;div></span></span>
<span class="line"><span>        &#x3C;button onClick={() => this.increment()}>Increment&#x3C;/button></span></span>
<span class="line"><span>        &#x3C;button onClick={() => this.decrement()}>Decrement&#x3C;/button></span></span>
<span class="line"><span>        &#x3C;div>Counter: {this.state.counter}&#x3C;/div></span></span>
<span class="line"><span>      &#x3C;/div></span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ReactDOM.render(&#x3C;App />, document.body);</span></span>
<span class="line"><span>```</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;p></span></span>
<span class="line"><span>  &#x3C;a href="http://codepen.io/shybovycha/pen/dNErOY" target="_blank" class="btn btn-md">Run this code&#x3C;/a></span></span>
<span class="line"><span>&#x3C;/p></span></span>
<span class="line"><span></span></span></code></pre>
  </div>
  <div class="col">
    <p><a href="https://facebook.github.io/react/" target="_blank">React</a> + <a href="http://redux.js.org/" target="_blank">Redux</a></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>```js</span></span>
<span class="line"><span>function App(props) {</span></span>
<span class="line"><span>  var store = props.store;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  return (</span></span>
<span class="line"><span>    &#x3C;div></span></span>
<span class="line"><span>      &#x3C;button onClick={() => store.dispatch({ type: 'INCREMENT' })}>Increment&#x3C;/button></span></span>
<span class="line"><span>      &#x3C;button onClick={() => store.dispatch({ type: 'DECREMENT' })}>Decrement&#x3C;/button></span></span>
<span class="line"><span>      &#x3C;div>Counter: {store.getState()}&#x3C;/div></span></span>
<span class="line"><span>    &#x3C;/div></span></span>
<span class="line"><span>  );</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function update(state = 0, action) {</span></span>
<span class="line"><span>  switch (action.type) {</span></span>
<span class="line"><span>  case 'INCREMENT':</span></span>
<span class="line"><span>    return state + 1</span></span>
<span class="line"><span>  case 'DECREMENT':</span></span>
<span class="line"><span>    return state - 1</span></span>
<span class="line"><span>  default:</span></span>
<span class="line"><span>    return state</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>var store = Redux.createStore(update);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function render() {</span></span>
<span class="line"><span>  ReactDOM.render(&#x3C;App store={store} />, document.body);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>render();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>store.subscribe(render);</span></span>
<span class="line"><span>```</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;p></span></span>
<span class="line"><span>  &#x3C;a href="http://codepen.io/shybovycha/pen/RKmYVy" target="_blank" class="btn btn-md">Code&#x3C;/a></span></span>
<span class="line"><span>&#x3C;/p></span></span>
<span class="line"><span></span></span></code></pre>
  </div>
  <div class="col">
    <p><a href="http://elm-lang.org" target="_blank">Elm</a></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>```haskell</span></span>
<span class="line"><span>import Html exposing (beginnerProgram, div, button, text)</span></span>
<span class="line"><span>import Html.Events exposing (onClick)</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>initialState = 0</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>view state =</span></span>
<span class="line"><span>  div []</span></span>
<span class="line"><span>    [ button [ onClick Increment ] [ text "Increment" ]</span></span>
<span class="line"><span>    , button [ onClick Decrement ] [ text "Decrement" ]</span></span>
<span class="line"><span>    , div [] [ text ("Counter:" ++ (toString state)) ]</span></span>
<span class="line"><span>    ]</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>type Msg = Increment | Decrement</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>update msg state =</span></span>
<span class="line"><span>  case msg of</span></span>
<span class="line"><span>    Increment -></span></span>
<span class="line"><span>      state + 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Decrement -></span></span>
<span class="line"><span>      state - 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>main =</span></span>
<span class="line"><span>  beginnerProgram { model = initialState, view = view, update = update }</span></span>
<span class="line"><span>```</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;p></span></span>
<span class="line"><span>  &#x3C;a href="http://codepen.io/shybovycha/pen/egaLXv" target="_blank" class="btn btn-md">Compiled code&#x3C;/a></span></span>
<span class="line"><span>&#x3C;/p></span></span>
<span class="line"><span></span></span></code></pre>
  </div>
  <div class="col">
    <p><a href="http://mithril.js.org" target="_blank">Mithril</a></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>```js</span></span>
<span class="line"><span>var count$ = 0;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>var App = {</span></span>
<span class="line"><span>    view: function () {</span></span>
<span class="line"><span>      return m('main', [</span></span>
<span class="line"><span>        m('button', { class: 'decrement', onclick: function () { count$--; } }, 'Decrement'),</span></span>
<span class="line"><span>        m('button', { class: 'increment', onclick: function () { count$++; } }, 'Increment'),</span></span>
<span class="line"><span>        m('p', {}, 'Counter: ' + count$),</span></span>
<span class="line"><span>      ]);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>m.mount(document.body, App);</span></span>
<span class="line"><span>```</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;p></span></span>
<span class="line"><span>  &#x3C;a href="http://codepen.io/shybovycha/pen/WRBgWv" target="_blank" class="btn btn-small">Code&#x3C;/a></span></span>
<span class="line"><span>&#x3C;/p></span></span>
<span class="line"><span></span></span></code></pre>
  </div>
  <div class="col">
    <p><a href="https://cycle.js.org" target="_blank">Cycle</a></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>```js</span></span>
<span class="line"><span>var xs = xstream.default;</span></span>
<span class="line"><span>var { div, p, button, makeDOMDriver } = CycleDOM;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function App(sources) {</span></span>
<span class="line"><span>  var decrement$ = sources.DOM</span></span>
<span class="line"><span>    .select('.decrement')</span></span>
<span class="line"><span>    .events('click')</span></span>
<span class="line"><span>    .mapTo(-1);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  var increment$ = sources.DOM</span></span>
<span class="line"><span>    .select('.increment')</span></span>
<span class="line"><span>    .events('click')</span></span>
<span class="line"><span>    .mapTo(+1);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  var action$ = xs.merge(decrement$, increment$);</span></span>
<span class="line"><span>  var count$ = action$.fold(function (acc, v) { return acc + v; }, 0);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  var vtree$ = count$.map(function (count) {</span></span>
<span class="line"><span>    return div([</span></span>
<span class="line"><span>      button('.decrement', 'Decrement'),</span></span>
<span class="line"><span>      button('.increment', 'Increment'),</span></span>
<span class="line"><span>      p('Counter: ' + count)</span></span>
<span class="line"><span>    ])</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  return { DOM: vtree$ };</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Cycle.run(App, { DOM: makeDOMDriver('body') });</span></span>
<span class="line"><span>```</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;p></span></span>
<span class="line"><span>  &#x3C;a href="http://codepen.io/shybovycha/pen/XpOQvx" target="_blank" class="btn btn-small">Code&#x3C;/a></span></span>
<span class="line"><span>&#x3C;/p></span></span>
<span class="line"><span></span></span></code></pre>
  </div>
  <div class="col">
    <p><a href="https://github.com/shybovycha/libc.js" target="_blank">libc</a></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>```js</span></span>
<span class="line"><span>var initialState = 0;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function update(state, message) {</span></span>
<span class="line"><span>  if (message == 'INCREMENT')</span></span>
<span class="line"><span>    return state + 1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  if (message == 'DECREMENT')</span></span>
<span class="line"><span>    return state - 1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  return state;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>function view(state, dispatch) {</span></span>
<span class="line"><span>  return ['div', [</span></span>
<span class="line"><span>    ['button', { click: () => dispatch('INCREMENT') }, 'Increment'],</span></span>
<span class="line"><span>    ['button', { click: () => dispatch('DECREMENT') }, 'Decrement'],</span></span>
<span class="line"><span>    ['div', `Count: ${ state }`]</span></span>
<span class="line"><span>  ]];</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>var app = createApplication(initialState, update, view);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.mount(document.body);</span></span>
<span class="line"><span>```</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;p></span></span>
<span class="line"><span>  &#x3C;a href="http://codepen.io/shybovycha/pen/dNEgNa" target="_blank" class="btn btn-md">Code&#x3C;/a></span></span>
<span class="line"><span>&#x3C;/p></span></span>
<span class="line"><span></span></span></code></pre>
  </div>
</div>
<h2 id="react--redux">React + Redux</h2>
<p>Let’s start-off by writing a simple “counter” application with the well-known React + Redux bundle.</p>
<h3 id="react">React</h3>
<p>The purpose of Facebook’s React is to provide an interface to a virtual DOM, which allows users to track updates to the <em>application views</em> and perform DOM operations to update views <strong>with a minimal operation overhead</strong>. In other words, we do not need to remove all the DOM nodes and create new ones from scratch when we can update a single property in a single DOM node. It might look like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="color:#D73A49;--shiki-dark:#F97583"> extends</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> React</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Component</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">props</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    super</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(props);</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  increment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.state </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  decrement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.state </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#E36209;--shiki-dark:#FFAB70">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#E36209;--shiki-dark:#FFAB70">button</span><span style="color:#E36209;--shiki-dark:#FFAB70"> onClick</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{increment}</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8">Increment</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#E36209;--shiki-dark:#FFAB70">button</span><span style="color:#E36209;--shiki-dark:#FFAB70"> onClick</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{decrement}</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8">Decrement</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;/</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#E36209;--shiki-dark:#FFAB70">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span><span style="color:#E36209;--shiki-dark:#FFAB70">Counter</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#6F42C1;--shiki-dark:#B392F0">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}&#x3C;/</span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ReactDOM.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">App</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> />, document.body);</span></span>
<span class="line"></span></code></pre>
<p><a href="http://codepen.io/shybovycha/pen/dNErOY" target="_blank" class="btn btn-md">Run this code</a></p>
<h3 id="redux">Redux</h3>
<p>Redux is an ancestor of Facebook’s Flux architecture and library. Flux’ main goal was to standardize the way application stores its state and handles state updates:</p>
<ul>
<li>application state is stored in stores</li>
<li>to update application state, we dispatch messages to corresponding stores</li>
<li>to reflect application state changes, we subscribe on the store state changes</li>
</ul>
<p>Than comes Redux and says <em>“hey! we probably can do that with just a single store!”</em>. And whilst Flux did not forbid state updates to modify the state objects themselves, Redux states clearly: <em>“you may not change state directly - rather you just calculate a new value for it and I take care of everything else”</em>.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">props</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> props.store;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> onClick</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ type: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'INCREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })}>Increment&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> onClick</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ type: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'DECREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })}>Decrement&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Counter: {store.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()}&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> update</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">action</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (action.type) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'INCREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'DECREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  default</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> store </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Redux.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createStore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(update);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ReactDOM.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">App</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> store</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{store} />, document.body);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">store.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">subscribe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(render);</span></span>
<span class="line"></span></code></pre>
<p><a href="http://codepen.io/shybovycha/pen/RKmYVy" target="_blank" class="btn btn-md">Run this code</a></p>
<h2 id="elm">Elm</h2>
<p>Elm is ML-like <em>(Haskell-like)</em> language, which compiles to JS, and provides developer with a runtime, allowing one to build web applications in a functional, strongly-typed language. Elm enforces its way of building web applications, where each web app is a combination of three entities:</p>
<ol>
<li><strong>model</strong>, which is basically just a structure of application state</li>
<li><strong>update function</strong>, which takes current state and an event <em>(<strong>action</strong> in terms of Redux; <strong>message</strong> in terms of Elm; an object, representing user action or any other event)</em> and provides the new value for app state <em>(model)</em></li>
<li><strong>view function</strong>, which converts current app state into a virtual DOM tree</li>
</ol>
<img src="/images/functional_web/elm_architecture.webp" alt="Elm workflow">
<p>Elm runtime handles everything else - passing messages to the <code>update</code> function, comparing the actual DOM tree with the one, provided by a <code>view</code> function and performing all DOM tree manipulations.</p>
<p>Elm can be compared to <code>React + Redux + ML-language</code> combination.</p>
<p>Let’s take a look at our sample application, written in Elm:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="haskell"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Html</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exposing (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">beginnerProgram</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">text</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Html.Events</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> exposing (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">onClick</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">initialState </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">view state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  div </span><span style="color:#005CC5;--shiki-dark:#79B8FF">[]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ button [ onClick </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Increment</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Increment"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , button [ onClick </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Decrement</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Decrement"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , div </span><span style="color:#005CC5;--shiki-dark:#79B8FF">[]</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ text (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Counter:"</span><span style="color:#D73A49;--shiki-dark:#F97583"> ++</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (toString state)) ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> Increment</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#D73A49;--shiki-dark:#F97583"> Decrement</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">update msg state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> msg </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    Increment</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      state </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    Decrement</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      state </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  beginnerProgram { model </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> initialState, view </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> view, update </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> update }</span></span>
<span class="line"></span></code></pre>
<p><a href="http://codepen.io/shybovycha/pen/egaLXv" target="_blank" class="btn btn-md">Run compiled version of this code</a></p>
<p>In this example, we first define initial application state, which is just integer number of zero.</p>
<p>Then we describe the view of our application, how the application will display the current state in HTML. This is the battle field of a <code>view</code> function.</p>
<p>After that we define possible actions <em>(or messages in terms of Elm)</em>. It would be either <code>Increment</code> or <code>Decrement</code> action with no additional parameters.</p>
<p>Right after that we define how each message will affect application state. Since our application’ state is only an integer number, the <code>update</code> function will return the new state given the current state value and an action.</p>
<p>Lastly we create our application, providing Elm with all the entities we defined above.</p>
<p>I found this code to be more clear, than in case with React + Redux, since in case we’d like to write something more complex, we don’t need to use tons of mapping/reducing/selecting functions, split into a huge bunch of files. I’ll cover more complex examples later on.</p>
<h2 id="mithril">Mithril</h2>
<p>Mithril is a tiny JS framework, whose main feature is virtual DOM. Just take a look at a sample application:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count$ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> App </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    view</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> m</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'main'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        m</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'decrement'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">onclick</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () { count$</span><span style="color:#D73A49;--shiki-dark:#F97583">--</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; } }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Decrement'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        m</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { class: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'increment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">onclick</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () { count$</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; } }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Increment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        m</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'p'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {}, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Counter: '</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count$),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">m.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">mount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(document.body, App);</span></span>
<span class="line"></span></code></pre>
<p><a href="http://codepen.io/shybovycha/pen/WRBgWv" target="_blank" class="btn btn-small">Run this code</a></p>
<p>This is much less code than in case with React + Redux, isn’t it?</p>
<h2 id="cycle">Cycle</h2>
<p>Cycle is a reactive framework; kind of React + Rx. This means an application is basically a view function, subscribed to all the events allowed in your application. An example straight from <a href="https://cycle.js.org/">cycle</a> website:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> xs </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> xstream.default;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { div, p, button, makeDOMDriver } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> CycleDOM;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">sources</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> decrement$ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sources.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DOM</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.decrement'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">events</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'click'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">mapTo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> increment$ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sources.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">DOM</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.increment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">events</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'click'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">mapTo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> action$ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> xs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">merge</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(decrement$, increment$);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count$ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> action$.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fold</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">acc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">v</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { </span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> acc </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v; }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> vtree$ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count$.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">count</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.decrement'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Decrement'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.increment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Increment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      p</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Counter: '</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { DOM: vtree$ };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Cycle.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(App, { DOM: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">makeDOMDriver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'body'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) });</span></span>
<span class="line"></span></code></pre>
<p><a href="http://codepen.io/shybovycha/pen/XpOQvx" target="_blank" class="btn btn-small">Run this code</a></p>
<p>Let me explain this source, since this might not be obvious.</p>
<p>First, Cycle <em>(or, actually, <strong>RxJS</strong>)</em> operates on <strong>event streams</strong>. In this particular application there are two event streams: clicks on the “Increment” button and clicks on the “Decrement” button. So we first make all “click” events on the “Decrement” button (expressed by <code>sources.DOM.select('.decrement').events('click')</code>) to become just <code>-1</code> number (which is made by mapping each event to a value <code>-1</code>, <code>eventStream.map(-1)</code>). Then we do the similar thing to the clicks on the “Increment” button, but transform each event to <code>1</code> (positive) number.</p>
<p>Now, we merge both streams into a single one (thus both “Increment” and “Decrement” clicks will come from a single event stream, namely <code>action$</code>).</p>
<p>Then we transform our unified event stream <code>action$</code> into a stream of a single value by adding all the events (values) from <code>action$</code> stream.</p>
<p>And lastly, we transform our single-value stream <code>count$</code> into a virtual DOM tree and update the real dom, if needed.</p>
<h3 id="event-streams">Event streams</h3>
<p>Here’s what should be explained regarding those event streams: a <strong>stream</strong> is a series of some values. That’s it. Nothing more. When a value is added to a stream <em>(an event is fired)</em>, all the transformations are run as they are nothing but observers to the “on value appeared” event. Ans since all those transformations can be chained, we can imagine each transforming function is just a new event listener for that “on value appeared” event. And each transformation will provide us with a new stream, what allows us to add many different listeners to the same stream.</p>
<p>Here’s a diagram, showing all the transformations:</p>
<img src="/images/functional_web/CycleJS_example-compressed.webp" alt="Event transformations diagram">
<p>So once a click event <em>(on one of two buttons, of course)</em> appears, it is transformed to either <code>-1</code> or <code>1</code>, depending on the button which fired that event; then this number is added to the existing <em>(which might appear to be empty)</em> event stream <code>action$</code>; then the sum is calculated over all the numbers in that stream; then the sum is transformed into a virtual DOM tree; and lastly, the virtual DOM tree is returned from a view function and Cycle does its job to update the actual DOM. And since there always will be a different value of sum in our example, the DOM will always be updated.</p>
<h2 id="libc">libc</h2>
<p>So far I’ve covered four different implementations of a very simple yet <em>interactive</em> web application. Some of them require a whole bunch of libraries to be injected into a page (in case with React+Redux+whatever, Cycle), some of them introduce a whole new approach to create interactive applications (Cycle, Elm, Mithril). Based on that, I created my own micro library, which inherits most interesting features of frameworks discussed above.</p>
<p>I called it <a href="https://github.com/shybovycha/libc.js">libc</a>.</p>
<p>The same “counter” application, written in libc looks like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> initialState </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> update</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (message </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'INCREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (message </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'DECREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> view</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">click</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'INCREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Increment'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'button'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">click</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'DECREMENT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Decrement'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'div'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">`Count: ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> }`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ]];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> app </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(initialState, update, view);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">app.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">mount</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(document.body);</span></span>
<span class="line"></span></code></pre>
<p><a href="http://codepen.io/shybovycha/pen/dNEgNa" target="_blank" class="btn btn-md">Run this code</a></p>
<p>All the DOM nodes are created using the array returned, which should match pattern <code>[tag, {attributes}, (text | [children]))</code> <em>(just like Mithril uses <code>m()</code> function or Elm uses <code>div</code> and other helper functions)</em>. Originally, <code>libc</code> used <code>c()</code> helper function to do that <em>(similar to Mithril’s <code>m()</code> function)</em>, and that’s why it was called <code>libC</code>.</p>
<p>The library makes use of a VirtualDOM approach to create a virtual DOM tree and chech which nodes/node properties need changes and reflect only the needed changes in a real DOM tree.</p>
<p><code>libc</code> uses the <code>message -> update -> view</code> chain, just like Elm does. The inner application state is handled similarly to Redux - application has only one store, which contains application state. And the <code>update()</code> function just calculates the new value for a state, without actually assigning it. Library then checks whether state needs to be updated or not <em>(using <code>Object.deepEqual</code> method, exposed by a library)</em>. If the new state value is different from the existing one - the state is replaced with a new value and the <code>view()</code> function is being called with a new state value. <code>view</code> function returns the new value of a virtual DOM tree. Library then checks whether it needs to update actual DOM tree or not.</p>
<p>There are however couple highlights regarding <code>libc</code>:</p>
<ul>
<li>it can create arbitrary tags <em>(DOM nodes)</em> within the <code>view()</code> function <em>(the first element in each array is tag name, which could be pretty much anything)</em>, so it’s quite easy to use it in couple with other libraries <em>(such as Angular-material, React or Polymer, for instance)</em></li>
<li>properties, whose value is a function are automatically mapped to event listeners; taking into account that property names could be arbitrary as well, you may add event listeners to your custom events</li>
<li>again, property names could be arbitrary, so you can use even angular ones if you want: <code>['div', { 'ng-repeat': 'item in items' }, '{{item.name}}']</code></li>
<li>both <code>properties</code> and <code>children or text</code> arguments are optional; thus you can create empty DOM elements: <code>['hr']</code></li>
<li>to enable communication with your applications from the outside, application instance, returned by the <code>createApplication()</code> function, has the <code>dispatch(message)</code> method</li>
</ul>
<p>In later posts I’ll provide more examples of using <code>libc</code>.</p> </div>  </article><article> <h1> <a href="/2016/12/21/2016-12-21-clojure-guards.html">Clojure guards</a> </h1> <time datetime="2016-12-21T01:54:00.000Z"> Dec 21, 2016 </time> <div class="content"> <p>Once I wanted to have something like a pretty “match” operator from Scala (or Rust, or C# 7), but in Clojure.
In this blog I explore some solutions for that available in Clojure world.</p>
<h2 id="use-case">Use case</h2>
<p>Generally, you would use pattern matching as a neat syntax for multiple <code>if..else</code> or <code>switch..case</code> statements.
Consider this example of transforming values between two enums:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (entityType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISSUE) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISSUE;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (entityType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SUBTASK) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SUBTASK;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::UNKNOWN;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This could be written neatly with a <code>switch..case</code> statement:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (entityType) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISSUE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISSUE;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SUBTASK</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SUBTASK;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    default</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::UNKNOWN;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>In C# starting with version 7 you could write this using switch expression:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entityType </span><span style="color:#D73A49;--shiki-dark:#F97583">switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISSUE</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIEntityType.ISSUE,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SUBTASK</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIEntityType.SUBTASK,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIEntityType.UNKNOWN</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>But what if you have multiple conditions to check?</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (entityType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISSUE </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">canEdit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(user, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISSUE)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::ISSUE;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (entityType </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SUBTASK </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">canEdit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(user, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SUBTASK)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::SUBTASK;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> UIEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::UNKNOWN;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This can not be converted to <code>switch..case</code> nicely. But with switch expressions (or rather, pattern matching, in general) you can do something like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entityType </span><span style="color:#D73A49;--shiki-dark:#F97583">switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ISSUE</span><span style="color:#D73A49;--shiki-dark:#F97583"> when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">canEdit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(user, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ISSUE) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIEntityType</span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ISSUE,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::</span><span style="color:#6F42C1;--shiki-dark:#B392F0">SUBTASK</span><span style="color:#D73A49;--shiki-dark:#F97583"> when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">canEdit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(user, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">DBEntityType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">SUBTASK) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIEntityType</span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8">SUBTASK,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> UIEntityType</span><span style="color:#D73A49;--shiki-dark:#F97583">::</span><span style="color:#24292E;--shiki-dark:#E1E4E8">UNKNOWN,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<h2 id="using-cond">Using <code>cond</code></h2>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; Note how this method does not check the `n > 3` case</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> testFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [n]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">cond</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"You entered 1!"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"You entered two!"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"You entered three!"</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        :else</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "You entered a big number!"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> complexFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [entityType user permissions]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">cond</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">and</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entityType </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-issue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">can-edit?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions user </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-issue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:ui-issue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">and</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> entityType </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-subtask</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">can-edit?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions user </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-subtask</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:ui-subtask</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        :else</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :ui-unknown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span></code></pre>
<h2 id="using-condp">Using <code>condp</code></h2>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; Note how this method does not check the `n > 3` case</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> testFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [n]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">condp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = n</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        1</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "You entered 1!"</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        2</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "You entered two!"</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        3</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "You entered three!"</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "You entered a big number!"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> complexFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [entityType user permissions]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">condp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> = [ entityType </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-issue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">can-edit?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions user </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-issue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:ui-issue</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-subtask</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">can-edit?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> permissions user </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:db-subtask</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:ui-subtask</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        :ui-unknown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span></code></pre>
<h2 id="using-guard-macro">Using <code>guard</code> macro</h2>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> generateGuardBody</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Generates the function body required to support the guard macro"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [[thisBranch remainingBranches] (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">split-at</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> args)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            testCond (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">first</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> thisBranch)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            testResult (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">second</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> thisBranch)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            elseFunc (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">empty?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> remainingBranches)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                false</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                (</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">  1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">count</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> remainingBranches))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">first</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> remainingBranches)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">generateGuardBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> remainingBranches)))]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        `(</span><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ~testCond</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ~testResult</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ~elseFunc)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defmacro</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> defguardfn</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Creates a haskell-style guarded function"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [fnName args &#x26; body]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    `(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ~fnName ~args</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ~(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">generateGuardBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> body)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defmacro</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> guard</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Allows inline guard syntax without surrounding defn"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [&#x26; body]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    `~(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">generateGuardBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> body))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defguardfn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> testFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [n]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"You entered 1!"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"You entered two!"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"You entered three!"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"You entered a big number!"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">testFn</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defguardfn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fib</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [n]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#6F42C1;--shiki-dark:#B392F0">n</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">+</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fib</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fib</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> testFn-2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [x]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">guard</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"One!"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Two!"</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        true</span><span style="color:#032F62;--shiki-dark:#9ECBFF">  "Something Else!"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fib (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">range</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">testFn-2</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="color:#6A737D;--shiki-dark:#6A737D">; "Something else!"</span></span>
<span class="line"></span></code></pre>
<h2 id="using-multimethods">Using multimethods</h2>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; Implementing factorial using multimethods Note that factorial-like function</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; is best implemented using `recur` which enables tail-call optimization to avoid</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; a stack overflow error. This is a only a demonstration of clojure's multimethod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;; identity form returns the same value passed</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defmulti</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> factorial</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> identity</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defmethod</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> factorial</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [_]  </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defmethod</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> factorial</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :default</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [num]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> num (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factorial</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dec</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> num))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factorial</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#6A737D;--shiki-dark:#6A737D">; => 1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factorial</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#6A737D;--shiki-dark:#6A737D">; => 1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factorial</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#6A737D;--shiki-dark:#6A737D">; => 6</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factorial</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#6A737D;--shiki-dark:#6A737D">; => 5040</span></span>
<span class="line"></span></code></pre>
<h2 id="using-corematch">Using <code>core.match</code></h2>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> div3?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [x] (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">zero?</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [y [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [y]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[_ (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">a</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :guard</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> even?) _ _]] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[_ (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">b</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :guard</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [odd? div3?]) _ _]] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [x [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [x]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:or</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:or</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;=> :a1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [x {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [x]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:or</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:or</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;=> :a1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [v [[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">match</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [v]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [[([</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b)]] [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:a1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a b]))</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">;=> [:a1 2 [1 2]]</span></span>
<span class="line"></span></code></pre> </div>  </article><article> <h1> <a href="/2016/08/25/2016-08-25-big-o-notation.html">Big O notation</a> </h1> <time datetime="2016-08-25T03:00:00.000Z"> Aug 25, 2016 </time> <div class="content"> <p>The best big O notation explanation I’ve ever saw I’ve found on… Google Play Market! I was
hanging around, looking for the suggested software and, for some reason, I’ve decided to
install some educational application for programmers. And here’s what I’ve found…</p>
<!--more-->
<p>Big O notation shows, how many steps or memory units will the algorithm use to complete,
at its maximum. Here’s an example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> someAlgorithm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 1</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  doSomething</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 2</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    doSomething</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    doSomething</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; t </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      doSomething</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Let’s take a look at each of four algorithm parts. Part 1 just calls some function, <code>doSomething()</code>.
Let’s assume it takes some constant amount of time to complete, <code>C</code>. The time complexity of calling
a function, which uses constant time to complete is <code>O(1)</code>. So part 1 will take <code>O(1)</code> time to complete.</p>
<p>Part 2 has a loop, which has exactly 10 iterations, calling <code>doSomething()</code> at each iteration. As we’ve
discussed above, this part takes <code>10 * C</code> (ten calls of <code>doSomething()</code> function, which takes <code>C</code> steps to
complete) steps. This is a constant value too, so part 2 of the function <code>myAlgorithm()</code> will have the
complexity of <code>O(1)</code>.</p>
<p>Part 3 has a loop, whose number of iterations relies on the input parameter of <code>myAlgorithm()</code>, namely <code>n</code>.
We do not know, what value the <code>n</code> will take. But as it increases, the steps, needed for this part to complete
increases too. So the complexity of this part will be <code>O(n)</code>.</p>
<p>Part 4 has two nested loops. As in the previous case, when <code>n</code> increases, the steps needed by this part to
complete will increase even faster: for <code>n = 1</code> it will take exactly <code>C</code> steps to complete (recall:
the complexity of <code>doSomething()</code> is <code>C</code>); for <code>n = 2</code> it will take <code>2 * 2 * C = 4 * C</code> steps to complete;
for <code>n = 10</code> the amount of steps would be <code>10 * 10 * C = 100 * C</code>. One can notice that the complexity
equals to <code>n * n * C</code>. This is quadratical complexity, denoted as <code>O(n^2)</code>.</p>
<p>The final complexity of an algorithm could be calculated by easily adding all those parts’ complexities:
<code>O(1) + O(1) + O(n) + O(n^2)</code>. But here’s the trick: if the <code>n</code> is relatively small (like, <code>10</code> or <code>100</code>),
the difference between <code>O(1)</code> and <code>O(n)</code> is huge (noticeable, at least). But if we say the value of <code>n</code>
is insanely large (like, billiards), we may not notice the <code>O(1)</code> is just nothing, compared to <code>O(n)</code>. And
<code>O(n)</code> is just nothing, when compared to <code>O(n^2)</code>. And here comes the rule: total complexity of an algorithm is
the maximum needed amount of steps to complete. Just as follows:</p>
<ul>
<li><code>O(C) = O(1)</code></li>
<li><code>O(1) + O(n) = O(n)</code></li>
<li><code>O(n) + O(n^2) = O(n^2)</code></li>
</ul>
<p>Here comes the comparison of the known complexities: <code>O(1) &#x3C; O(log n) &#x3C; O(n) &#x3C; O(n*log n) &#x3C; O(n^m)</code>.</p>
<p>But we can measure not time consumption only, using the big O notation. It is also handy for memory
complexity measurements.</p>
<p>Here the same rules apply, except of <em>“steps to complete”</em> we use
<em>“memory cells allocated”</em>. So we will count the amount of allocated memory. This is mostly used
by lists, not by objects and structures (as they always use the same memory amount). Check this out:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">struct</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Moo</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a, b, c;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> d;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Foo</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a, b, c;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#24292E;--shiki-dark:#E1E4E8">d;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>Both <code>Moo</code> and <code>Foo</code> will use the same amount of memory initially (since pointers in C++ are just
integer memory addresses’ values and floats use same 4 bytes - just as integers do). But depending on
how many memory we will allocate for <code>Foo.d</code> we will get the different values. Consider the continuation
of this example below:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> myAlgorithm</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Foo </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">foo </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Foo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 2</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  foo->d </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  int</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[n];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // part 4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  int</span><span style="color:#D73A49;--shiki-dark:#F97583"> **</span><span style="color:#24292E;--shiki-dark:#E1E4E8">b </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> int*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[n];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    b[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Here, in part 1, we have just an instance of <code>Foo</code> class, which uses
<code>3 * int + float* = 3 * 1 + 1 = 4</code> memory cells. As in case with time complexity, this amount is constant,
thus it has <code>O(1)</code> memory consumption.</p>
<p>In part 2, however, we extend this amount by placing 10 memory cells into
<code>foo.d</code> field, but this does not change much, as <code>foo</code> will use constant memory cells anyway. So, part 2 has
memory complexity of <code>O(1)</code> too.</p>
<p>In part 3 we create a new array, and its size depends on function’s argument <code>n</code>, so its memory consumption
is <code>O(n)</code>.</p>
<p>In part 4 we create a two-dimensional array, whose size is <code>n * 15</code>. We can split its size into two components:
<code>O(n) * O(15) = O(n)</code>, because <code>15</code> is <code>15</code> no matter what.</p>
<p>And the total memory complexity of the algorithm is <code>O(1) + O(1) + O(n) + O(n) = O(n)</code>.</p>
<p>For even more simple <code>O(*)</code> calculus, replace the <code>+</code> operator with the <code>min</code> operator:
memory complexity of <code>myAlgorithm()</code> is <code>max(O(1), O(1), O(n), O(n)) = O(n)</code>.</p> </div>  </article><article> <h1> <a href="/2016/03/06/2016-03-05-chicken-in-blender.html">Chicken in Blender</a> </h1> <time datetime="2016-03-05T22:24:39.000Z"> Mar 6, 2016 </time> <div class="content"> <p>This is a chicken. This 3D model I’ve made in 3.5 hrs in Blender <em>(with texturing)</em>.</p>
<div class="text-center">
    <img src="/images/shootthem/chicken_render1-compressed.webp" loading="lazy" alt="" class="img-responsive">
</div>
<div class="vspace"></div>
<p>Taking into account the fact I’ve started learning <em>Unity 3D</em>, I will possibly use this
in the remake of my old <a href="/tumblr/2015/04/06/shootthem.html">Shoot Them!</a> game.
Like this <em>(early preview, made with Unity 3D in ~3 hrs)</em>:</p>
<div class="text-center">
    <img src="/images/shootthem/ShootThem1.2-screen1-compressed.webp" loading="lazy" alt="" class="img-responsive">
</div> </div>  </article><article> <h1> <a href="/2016/02/12/2016-02-11-two-sides-of-web-application-part-3.html">Two sides of web application. Part 3: Communication Layer</a> </h1> <time datetime="2016-02-11T13:47:39.000Z"> Feb 12, 2016 </time> <div class="content"> <div class="row" style="justify-content: space-between">
    <div class="col-md-6 col-xs-12">
        <div class="card">
            <div class="card-header">
                Article series
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <a href="/2015/09/20/two-sides-of-web-application-part-1.html">
                        Part 1: The Tools
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/2016/02/11/two-sides-of-web-application-part-2.html">
                        Part 2: Sketching
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/2016/02/11/two-sides-of-web-application-part-3.html">
                        Part 3: Communication Layer
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-md-6 col-xs-12 text-xs-center text-md-right">
        <img src="/images/two-sides-of-web-application/a305-1-compressed.webp" class="img-responsive" style="max-height: 150px" alt="Funny image">
    </div>
</div>
<h2 id="foreword">Foreword</h2>
<p>In this section we will implement the communication layer for our application. It’ll handle
all the requests to/from our web server. Have no worries - we will create server application
in the next section!</p>
<h2 id="first-resource">First resource</h2>
<p>Let’s create a <code>Session</code> resource. Since we have no backend part, we should stub
the data. We’ll use Angular <strong>Services</strong>. That’s easy: a service defines a
function, returning, say, an object. That object will be used every time you
call a service. And you may use not only objects - you may return functions,
constants or literally anything from your services.</p>
<!--more-->
<p>We’ll return an object with two methods: <code>get(account)</code> and <code>create(account)</code>.
Both methods will take an object, containing user account details - <code>email</code>,
<code>password</code>, and, in case of <code>create()</code>, <code>name</code> and <code>password_confirmation</code>, additionally.
You might’ve guessed already: the <code>get(account)</code> method will log the user in and
<code>create(account)</code> will register a new account for the user.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> testAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Artem'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'artem@ourstats.com'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> params </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: account.email,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    password: account.password</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> params </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    name: account.name,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: account.email,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    password: account.password</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>When you inject it into your controller, you may use it via</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ email: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">''</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, password: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">''</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"></span></code></pre>
<p>The thing here is that we want to keep user data somewhere to simulate a
database work. So when user <em>“signs up”</em>, he will have his data saved in the memory
not to loose it when changing a page. We’ll use another service for that purpose.
But contrary to our <code>sessions</code> service, this one will be used in the future and even
barely changed.</p>
<p>Now, here’s one more trick: we defined our <code>Session</code> factory in the <code>ourStatsControllers</code> module.
Why did we do this? Why not just use <code>ourStatsApp</code> module? This is done mostly to keep things
in one place, so everything related to controllers and UI processing is kept inside one module.
Doing so we can later separate our modules into separate files and keep our main application
module clean from unnecessary code <em>(in terms of the whole application)</em>.</p>
<p>To store user account data we’ll use cookies. And there is a plugin for this
already! It is called <code>ngCookies</code>. And we’ll install it right now:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">bower</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> angular-cookies</span></span>
<span class="line"></span></code></pre>
<p>This one’s configuration is a bit more complicated. But just a bit: it needs
to be added to application dependency list:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStatsApp </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> angular.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsApp'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ngRoute'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ngCookies'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsControllers'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]);</span></span>
<span class="line"></span></code></pre>
<p>But since we use cookies directly in controllers only, we may move the <code>ngCookies</code> dependency to
the <code>ourStatsControllers</code> module:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStatsControllers </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> angular.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsControllers'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ngCookies'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStatsApp </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> angular.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsApp'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ngRoute'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsControllers'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]);</span></span>
<span class="line"></span></code></pre>
<p>Now we need to define our <code>AccountData</code> service. It’ll also require a <code>ngCookies</code> dependency:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'AccountData'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$cookies'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$cookies</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> $cookies.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getObject</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'account'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                $cookies.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">putObject</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'account'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, account);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            reset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                $cookies.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">remove</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'account'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>And we need to modify our <code>Session</code> service a bit:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$http'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'AccountData'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$http</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">AccountData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> testAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Artem'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'artem@ourstats.com'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> params </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: account.email,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    password: account.password</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(testAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> params </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    name: account.name,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: account.email,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    password: account.password</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(testAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>And now we can implement the controller to pick up the newly added service:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewSessionCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$scope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'AccountData'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$scope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Session</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.newAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.existingAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signIn</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.existingAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signUp</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.newAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signOut</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>But here’s just one small detail: we need both <code>Session</code> and <code>AccountData</code> services to perform
similar actions - managing session. We can refactor our code to keep all the session management
tasks in one place - <code>Session</code> service:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$http'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'AccountData'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$http</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">AccountData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> testAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Artem'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'artem@ourstats.com'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> params </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: account.email,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    password: account.password</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(testAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> params </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    name: account.name,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    email: account.email,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    password: account.password</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(testAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            reset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>Now our <code>NewSessionCtrl</code> could be refactored too:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewSessionCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$scope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$scope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Session</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.newAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.existingAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signIn</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.existingAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signUp</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.newAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signOut</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>Looks better, huh?</p>
<p>So now we have our first member of our <strong>Model</strong> layer. It works with stubbed data right now,
but we’ll be changing that later. It is not bound to the <strong>ViewModel</strong>, because the values
of our <code>$scope.newAccount</code> and <code>$scope.existingAccount</code> are constant and don’t depend on
the template. To change this, we need to modify our <code>new_session.jade</code> template:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.row</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .col-xs-12.col-md-4.col-md-offset-1.well</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign up</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        form</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ng-submit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"signUp()"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Your name"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ng-model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"newAccount.name"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"email"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Email"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ng-model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"newAccount.email"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ng-model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"newAccount.password"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password confirmation"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                button</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-primary</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"submit"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign up</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .col-md-2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .col-xs-12.col-md-4.well</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign in</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        form</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ng-submit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"signIn()"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"email"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Email"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ng-model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"existingAccount.name"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ng-model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"existingAccount.password"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                button</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-success</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"submit"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign in</span></span>
<span class="line"></span></code></pre>
<p>Note the <code>ng-model</code> directive: it performs two-way data binding. It means, when user changes the
value of our, say, <code>name</code> input, the corresponding value inside controller, namely <code>$scope.newAccount.name</code>,
will also change. What’s more, when the value of <code>$scope.newAccount.name</code> will be changed from
the JavaScript (or, from the controller itself), the value within the input in a user’s browser,
will also be changed.</p>
<p>Now, what’s about the <code>ng-submit</code> directive. It is added to form tags only. And it works exactly as
you might’ve guessed: when form is submitted, the corresponding expression within that directive is called.</p>
<h2 id="making-fake-calls">Making fake calls</h2>
<p>Now that we have our stubbed signing in and up routines, we may redirect user to the right page
when he signed in or up successfully. This is the job for <code>$location</code> service. It’s available
in Angular core module, <code>ng</code>, so we don’t need to add any new module-wise dependencies.
Just use it in our <code>NewSessionCtrl</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewSessionCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$scope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$location'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$scope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">$location</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Session</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.newAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.existingAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signIn</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.existingAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signUp</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.newAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signOut</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>Here comes new refactoring-able piece of code: we now have our routes declared in both
<code>ourStatsApp</code> module and <code>ourStatsControllers</code>. So if we decide to change, let’s say,
route <code>/new-session</code> to <code>/login</code>, we will need to change it in both modules. We can easily
extract those URLs into a single service and use it in both <code>ourStatsControllers</code>
and <code>ourStatsApp</code> modules, because everything we define in <code>ourStatsControllers</code> will be
available in the <code>ourStatsApp</code> thanks to dependency injection. And since our URLs will
always be the same <em>(except, maybe, the parametrised ones)</em>, we may define a constant
instead of factory:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">constant</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Url'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        landing: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        newSession: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/new-session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        editAccount: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/edit-account'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        listApplications: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        newApplication: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications/new'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        showApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ':id'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `/applications/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        editApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ':id'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `/applications/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}/edit`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"></span></code></pre>
<h2 id="application-startup-phases">Application startup phases</h2>
<p>As you can see, there are a couple of entities you can create with Angular - we’ve already
dealt with <strong>controllers</strong>, <strong>factories</strong>, <strong>modules</strong> and <strong>constants</strong>. They all are slighty
different from each other and the difference lies under Angular startup process.</p>
<p>When your application <em>“starts up”</em> or initializes, there are two kingds of methods, which are
ran first: <code>config</code> and <code>run</code>. They are user-defined and your application can have more than just
one of those. Those methods define the initialization behaviour of your application. They both
can deal with dependency injection. But their run order is different: <code>config</code> blocks are executed
first, at the very beginning of the whole application initialization process. Thus you can inject
only <strong>providers</strong> <em>(<code>$routeProvider</code> for instance)</em> and <strong>constants</strong> into <code>config</code> blocks.
Whilst <code>run</code> blocks can only handle <strong>instances</strong> <em>(for example, <code>$scope</code>)</em> and <strong>constants</strong>.</p>
<p>Since we have our routes defined at the <code>config</code> stage, we need to use <strong>constant</strong> to name our
routes. And then use them like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsApp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">config</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$routeProvider'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Url'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$routeProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $routeProvider</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.landing, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'landing-page.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.newSession, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'new-session.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewSessionCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.editAccount, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'edit-account.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'EditAccountCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.listApplications, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'list-applications.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ListApplicationsCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.newApplication, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'new-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewApplicationCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">editApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(), {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'edit-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'EditApplicationCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">showApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(), {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'show-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ShowApplicationCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">otherwise</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    redirectTo: Url.landing</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewSessionCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$scope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$location'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Url'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$scope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">$location</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Session</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $scope.newAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $scope.existingAccount </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signIn</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.existingAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                $location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.listApplications);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signUp</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($scope.newAccount);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                $location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.listApplications);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $scope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">signOut</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                $location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.landing);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ])</span></span>
<span class="line"></span></code></pre>
<p>To show the difference in practice, let’s add the authentication verification. We now have our
stubbed account and session management service, so why not? Angular provides us with two options:</p>
<ol>
<li>the <code>resolve</code> attribute for the <code>$routeProvider.when()</code> method</li>
<li>the <code>$routeChangeStart</code> event</li>
</ol>
<p>The first approach is nice, but since we set up routes in the <code>config</code> section, we are not allowed
to use services. And that is the problem, because we’ve got our <code>Session</code> service, handling the
tasks we need. And one more drawback of this method: one should set it for each route, which requires
verification:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> verifyAuthentication</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsApp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">config</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$routeProvider'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Url'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$routeProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $routeProvider</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.landing, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'landing-page.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.newSession, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'new-session.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewSessionCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.editAccount, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'edit-account.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'EditAccountCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    resolve: verifyAuthentication</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.listApplications, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'list-applications.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ListApplicationsCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    resolve: verifyAuthentication</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.newApplication, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'new-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewApplicationCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    resolve: verifyAuthentication</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">editApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(), {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'edit-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'EditApplicationCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    resolve: verifyAuthentication</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">showApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(), {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'show-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ShowApplicationCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    resolve: verifyAuthentication</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">otherwise</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    redirectTo: Url.landing</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }]);</span></span>
<span class="line"></span></code></pre>
<p>Handling <code>$routeChangeStart</code> event suits us, and what’s more interesting: it shows the use of <code>run</code>
section. But as a drawback to this, we’ll need the list of routes, which need to be checked. So
I modified the definition of <code>Url</code> constant like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsApp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">constant</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Url'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, (() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> urls </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            landing: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            newSession: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/new-session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            editAccount: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/edit-account'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            listApplications: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            newApplication: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications/new'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            showApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ':id'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `/applications/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            editApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ':id'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `/applications/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}/edit`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        urls.authRequired </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            urls.editAccount,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            urls.listApplications,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            urls.newApplication,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            urls.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">showApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            urls.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">editApplication</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> urls;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })());</span></span>
<span class="line"></span></code></pre>
<p>A bit tricky, does not it? And here’s the handler for the <code>$routeChangeStart</code> event:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsApp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">run</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$rootScope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$location'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'AccountData'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Url'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$rootScope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">$location</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Session</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">AccountData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">Url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            $rootScope.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">$on</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$routeChangeStart'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, (</span><span style="color:#E36209;--shiki-dark:#FFAB70">event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">current</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">next</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // check if user is authenticated for selected URLs only</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // first, try to restore his session</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // if this failed because user has no AccountData cookie - redirect him to newSession page</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (Url.authRequired.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">indexOf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">($location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Session.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">AccountData.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    $location.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Url.newSession);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }]);</span></span>
<span class="line"></span></code></pre>
<h2 id="rocking-on">Rocking on</h2>
<p>Other services and controllers are much like those we already have, so I’ll just put in the code
in the end of the page. The interesting thing here is the <code>MockData</code> service that I’ve used to keep
data, used while we have no server side.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsApp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">constant</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'MockData'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        account: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Artem'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            email: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'artem@ourstats.com'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            password: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'abc123'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        applications: [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'App #1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                token: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'APP1TOK'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                stats: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    byCountry: [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        {country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Poland'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, amount: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        {country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'USA'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, amount: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">190</span><span style="color:#24292E;--shiki-dark:#E1E4E8">},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        {country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Algeria'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, amount: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'App #2'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                token: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'APP2TOK'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                stats: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    byCountry: [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        {country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Vietnam'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, amount: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        {country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'New Zeland'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, amount: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">19</span><span style="color:#24292E;--shiki-dark:#E1E4E8">},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        {country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'USA'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, amount: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'App #3'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                token: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'APP3TOK'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                stats: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    byCountry: [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        {country: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'USA'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, amount: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">95</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsApp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">factory</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Application'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$http'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'MockData'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$http</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">MockData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // send data to the server and check if response status == 200; return application (arg)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> application;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">fromDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">toDate</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // fromDate and toDate are used for stats filtering</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // send data to the server and return response</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> MockData.applications[id];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            update</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // send data to the server and check if response status == 200; return application (arg)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> application;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">                // send request to the server and return the response</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> MockData.applications;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }]);</span></span>
<span class="line"></span></code></pre>
<p>And here’s the demo of what we’ve done up until now:</p>
<p data-height="494" data-theme-id="0" data-slug-hash="vLMZmd" data-default-tab="result" data-user="shybovycha" class="codepen">See the Pen <a href="http://codepen.io/shybovycha/pen/vLMZmd/">Simple web analytics. Communication layer. v2</a> by Artem Shoobovych (<a href="http://codepen.io/shybovycha">@shybovycha</a>) on <a href="http://codepen.io">CodePen</a>.</p>
<script async src="/assets.codepen.io/assets/embed/ei.js"></script> </div>  </article><article> <h1> <a href="/2016/02/11/2016-02-11-two-sides-of-web-application-part-2.html">Two sides of web application. Part 2: sketching</a> </h1> <time datetime="2016-02-11T12:47:39.000Z"> Feb 11, 2016 </time> <div class="content"> <div class="row" style="justify-content: space-between">
    <div class="col-md-6 col-xs-12">
        <div class="card">
            <div class="card-header">
                Article series
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <a href="/2015/09/20/two-sides-of-web-application-part-1.html">
                        Part 1: The Tools
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/2016/02/11/two-sides-of-web-application-part-2.html">
                        Part 2: Sketching
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/2016/02/11/two-sides-of-web-application-part-3.html">
                        Part 3: Communication Layer
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-md-6 col-xs-12 text-xs-center text-md-right">
        <img src="/images/two-sides-of-web-application/Gyroscopic-Navigational-Footwear-compressed.webp" class="img-responsive" style="max-height: 150px" alt="Funny image">
    </div>
</div>
<h2 id="general-architecture">General architecture</h2>
<p>The first thing we need to think of is how we’ll be gathering the information about users.
It’s quite easy - we just need to get a request from a visitor. Of any kind -
it may be a request to get an image, a file, a stylesheet or a script.</p>
<p>Then we’ll just parse headers from that request and save the extracted data in the
database. The only problem here is: <em>how to get unique key from each request?</em>. We may use
visitor’s IP address. It’s the easiest way.</p>
<!--more-->
<p>Now, let’s decide what pages will our application have and what will they look like:</p>
<div class="row">
    <div class="col-xs-12 col-md-3">
        <a href="/images/two-sides-of-web-application/part1/screen1.webp">
            <img src="/images/two-sides-of-web-application/part1/screen1.webp" loading="lazy" alt="page 1" class="image-responsive">
        </a>
    </div>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;div class="col-xs-12 col-md-3"></span></span>
<span class="line"><span>    &#x3C;a href="/images/two-sides-of-web-application/part1/screen2.webp"></span></span>
<span class="line"><span>        &#x3C;img src="/images/two-sides-of-web-application/part1/screen2.webp" loading="lazy" alt="page 2" class="image-responsive"></span></span>
<span class="line"><span>    &#x3C;/a></span></span>
<span class="line"><span>&#x3C;/div></span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;div class="col-xs-12 col-md-3"></span></span>
<span class="line"><span>    &#x3C;a href="/images/two-sides-of-web-application/part1/screen3.webp"></span></span>
<span class="line"><span>        &#x3C;img src="/images/two-sides-of-web-application/part1/screen3.webp" loading="lazy" alt="page 3" class="image-responsive"></span></span>
<span class="line"><span>    &#x3C;/a></span></span>
<span class="line"><span>&#x3C;/div></span></span>
<span class="line"><span></span></span>
<span class="line"><span>&#x3C;div class="col-xs-12 col-md-3"></span></span>
<span class="line"><span>    &#x3C;a href="/images/two-sides-of-web-application/part1/screen4.webp"></span></span>
<span class="line"><span>        &#x3C;img src="/images/two-sides-of-web-application/part1/screen4.webp" loading="lazy" alt="page 4" class="image-responsive"></span></span>
<span class="line"><span>    &#x3C;/a></span></span>
<span class="line"><span>&#x3C;/div></span></span>
<span class="line"><span></span></span></code></pre>
</div>
<h2 id="templates">Templates</h2>
<p>Let’s create a set of pages, we described above. They will be used later to display real data, but for now
we’ll stub the real data with constants.</p>
<p>To make our prototyping smooth and fast, we’ll use <em>Twitter Bootstrap</em>. We’ve installed it already with
<em>Bower</em>, so we’ll be just using it. We need to implement these pages only:</p>
<ul>
<li>landing page</li>
<li>sign up / sign in page</li>
<li>account settings page</li>
<li>apps list page</li>
<li>application page</li>
<li>application create / edit page</li>
</ul>
<p>Six pages, huh? Let’s do it quick:</p>
<p><em><code>src/views/layouts/default.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">doctype html</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">lang</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"en"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    head</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> head</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            title</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStats</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            link</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"stylesheet"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bootstrap/dist/css/bootstrap.css"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            link</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"stylesheet"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bootstrap/dist/css/bootstrap-theme.css"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            script</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bootstrap/dist/js/bootstrap.js"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    body</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> body</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/views/index.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#E36209;--shiki-dark:#FFAB70"> layouts/default.jade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> content</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .jumbotron</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        h1</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.display-3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Welcome to ourStats!</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        p</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.lead</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> This is a simple stats application</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        hr</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.m-y-md</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        p</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.lead</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            .row</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                .col-xs-12.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    a</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-primary.btn-lg</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"#"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> role</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"button"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign in</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/views/new-session.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#E36209;--shiki-dark:#FFAB70"> layouts/default.jade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> content</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-4.col-md-offset-1.well</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign up</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            form</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Your name"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"email"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Email"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password confirmation"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    button</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-primary</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"submit"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign up</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-md-2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-4.well</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign in</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            form</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"email"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Email"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    button</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-success</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"submit"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign in</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/views/edit_account.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#E36209;--shiki-dark:#FFAB70"> layouts/default.jade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> content</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row.m-t-md</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-4</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Account settings</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            form</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Your name"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"password"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Password confirmation"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    button</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-success</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"submit"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Save</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/views/application_list.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#E36209;--shiki-dark:#FFAB70"> layouts/default.jade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> content</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row.m-t-md</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-4</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Your applications</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            ul</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                li</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    a</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/application_details.html"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test application #1</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                li</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    a</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/application_details.html"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test application #2</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                li</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    a</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/application_details.html"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test application #3</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                li</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    a</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/application_details.html"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test application #4</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                li</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    a</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/application_details.html"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test application #5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-md-offset-2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-6</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Application stats</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h4</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> New users:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            .progress</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                progress</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.progress-bar.progress-bar-success</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">role</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"progress"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"width:30%"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/views/application_details.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#E36209;--shiki-dark:#FFAB70"> layouts/default.jade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> content</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-6.col-md-offset-6</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            form</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-inline</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                .form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"From date"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                .form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"To date"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                .form-group</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    .btn.btn-primary</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            .well</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                | You can track your application visitors with this URL:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                br</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                | http://localhost:3000/track/APP1TOKN</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row.m-t-md</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Visitors</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            .well</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                | Chart goes here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-6</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Visitors by country</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            table</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.table.table-bordered</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                thead</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    tr</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        th</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Country</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        th</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Visitors</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                tbody</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    tr</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> USA</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 100</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    tr</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Germany</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 50</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    tr</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> North Korea</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 42</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    tr</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Greenland</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 39</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    tr</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Spain</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                        td</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 2</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/views/edit_application.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#E36209;--shiki-dark:#FFAB70"> layouts/default.jade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> content</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row.m-t-md</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-6</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Application settings</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            form</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Name"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                    .btn.btn-danger</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Reset stats</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    button</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-success</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"submit"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Save</span></span>
<span class="line"></span></code></pre>
<p><em><code>src/views/new_application.jade</code>:</em></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extends</span><span style="color:#E36209;--shiki-dark:#FFAB70"> layouts/default.jade</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> content</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    .row.m-t-md</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .col-xs-12.col-md-6</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            h3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> New application</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">            form</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    input</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-control</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> placeholder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Name"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                fieldset</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.form-group.text-center</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">                    button</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-success</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"submit"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Create</span></span>
<span class="line"></span></code></pre>
<p>And to make Bower-managed libraries available in our views, we need to add one more path to
the server configuration:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'bower_components/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        port: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        livereload: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        directoryListing: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        open: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }));</span></span>
<span class="line"></span></code></pre>
<p>As you can see, we used Jade’s block extending and split our templates into one layout and many partials, so
our file tree is clean and changing any of the pages will not be a hard task.</p>
<p><a href="https://github.com/shybovycha/two-sides-of-web-application/tree/628f216b8e7d904e040035b31c3d0c546d8f1e5e" class="btn btn-info">Full code of these steps</a></p>
<h2 id="architecture-details">Architecture details</h2>
<p>In our frontend application we’ll use something called <em>MVVM</em>. That is a design pattern, kindly provided
by Angular. So our <em>views</em> will be displaying data and transferring it to controllers <em>(or ViewModels)</em>, and
all the logic, handling that data will be defined in <em>controllers</em> and <em>services</em>, representing <em>Models</em>.
Actually, our models will be handled on a server-side, and services will only provide an interface to them.
But that is totally another story and will be described later.</p>
<p>For now let’s integrate Angular in our application. And we’ll start, deciding how we’ll split our
application on the Angular layer. Pages we described above are used for these actions:</p>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Action</th>
            <th>Resource <em>(model)</em></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>sign in</td>
            <td rowspan="2">Session</td>
        </tr>
        <tr>
            <td>sign out</td>
        </tr>
        <tr>
            <td>sign up</td>
            <td rowspan="3">User</td>
        </tr>
        <tr>
            <td>edit profile</td>
        </tr>
        <tr>
            <td>update profile</td>
        </tr>
        <tr>
            <td>add application</td>
            <td rowspan="5">Application</td>
        </tr>
        <tr>
            <td>edit application</td>
        </tr>
        <tr>
            <td>update application</td>
        </tr>
        <tr>
            <td>remove application</td>
        </tr>
        <tr>
            <td>show application</td>
        </tr>
        <tr>
            <td>track visitor</td>
            <td>Visitor</td>
        </tr>
    </tbody>
</table>
<p>And so we can define corresponding Angular controllers:</p>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Url</th>
            <th>Controller</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>/</td>
            <td>LandingPage</td>
        </tr>
        <tr>
            <td>/new-session</td>
            <td>Session</td>
        </tr>
        <tr>
            <td>/applications</td>
            <td>ListApplications</td>
        </tr>
        <tr>
            <td>/applications/new</td>
            <td>NewApplication</td>
        </tr>
        <tr>
            <td>/applications/:id</td>
            <td>ShowApplication</td>
        </tr>
        <tr>
            <td>/applications/:id/edit</td>
            <td>EditApplication</td>
        </tr>
        <tr>
            <td>/edit-account</td>
            <td>EditAccount</td>
        </tr>
    </tbody>
</table>
<h2 id="angular">Angular</h2>
<p><em>Angular.js</em> is a framework by Google for making <strong>SPA</strong>s (<em>Single-Page Application</em>).
SPA is a great architecture, where you have a thin backend server, providing an API
to your slim frontend application. And the most interesting part here, is that you have
all your application’ pages in a one place, loaded once. And they are switched by a router
in a user’s web-browser. So all the communication with server is stripped to data
manipulation requests (<em>creation, updating and reading data from server</em>) and first-time
request, sending the HTML, CSS and JavaScripts to user’s browser. And then, all the
interactions are performed in a browser. At maximum, frontend application can request
a partial or some assets (<em>like images</em>) from a web-server.</p>
<p>Basically, here’s how SPA works:</p>
<ol>
<li>user enters a website</li>
<li>server sends application’ code (implemented in JavaScript) and HTML to user</li>
<li>user, say, clicks on a link to change the page</li>
<li>if application needs partial, it requests server for a HTML partial</li>
<li>application renders a retrieved (or cached) partial in a browser</li>
</ol>
<p>Let’s start and you will see how easy it is!</p>
<h2 id="kickstarting">Kickstarting</h2>
<p>We’ll start, adding Angular to our <code>bower.json</code> dependencies:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">bower</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> angular</span></span>
<span class="line"></span></code></pre>
<p>Now when we have Angular inside the <code>bower_components</code> directory, let’s add its references to
our layout:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">head</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    script</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"angular/angular.js"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"></span></code></pre>
<p>Now, the only two things we need to start using Angular right away are:</p>
<ol>
<li>Angular application, defined in the JavaScript and referenced in the <code>&#x3C;html></code>
tag with <code>ng-app</code> <strong>directive</strong></li>
<li>Angular controller, which will contain <strong>scope</strong> with variables and functions for
the page’ portion</li>
</ol>
<p>Yeah, we definitely need some clarifications about those two new words.</p>
<h2 id="theory-bits">Theory bits</h2>
<p>Angular defines a few kind of bricks, you may use to build an entire application:</p>
<ol>
<li><strong>templates</strong> - dynamically changed HTML files</li>
<li><strong>two-way data binding</strong>, used mostly within <strong>interpolations</strong> - a mechanism
for sharing dynamically changed <em>(by either user of javascript)</em> data between
views and code</li>
<li><strong>controllers</strong>, holding <strong>scope</strong> - are JavaScript objects, containing variables and
functions to be used in templates <em>(functions and variables are put inside a scope, which
is an argument to corresponding controller; I’ll describe it later)</em></li>
<li><strong>factories</strong> (or <strong>services</strong>) - helper objects, containing logic which is not
<em>directly</em> related to views <em>(displaying and retrieving data)</em></li>
<li><strong>directive</strong> - is a place, where HTML-related code is placed</li>
</ol>
<p>On the other hand, in MVVM architecture we have three layers:</p>
<ol>
<li><strong>Model</strong> - layer, performing manipulations on data; kind of <em>database layer</em></li>
<li><strong>View</strong> - user interface layer</li>
<li><strong>ViewModel</strong> - stores data to be shown on UI or which was retrieved from UI</li>
</ol>
<p>Accordingly to this scheme, in Angular we have the next logic structure:</p>
<ol>
<li><strong>Model</strong> - <strong>Services</strong></li>
<li><strong>Views</strong> - <strong>Templates</strong>, <strong>Directives</strong></li>
<li><strong>ViewModel</strong> - <strong>Controllers</strong></li>
</ol>
<p>Here I did not mention <em>two-way data binding</em> and <em>scopes</em>, because first one is a part of <em>templates</em> and the second one is a part of <em>controllers</em>. And they may not be separated one from another.</p>
<h2 id="kickstarting-for-real">Kickstarting. For real</h2>
<p>Let’s add some Angular logic into our project. We’ll split our app into all those
controllers and services very soon. But first, we need our application in Angular to be
registered. Create a file <code>config.js</code> inside the <code>src/javascripts/</code> directory
with the following content:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStatsApp </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> angular.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsApp'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [  ]);</span></span>
<span class="line"></span></code></pre>
<p>And point the whole layout to use that application with the <code>ng-app</code> directive on <code>&#x3C;html></code> tag:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">doctype html</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(lang</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"en"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ng</span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8">app</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"ourStatsApp"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    head</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        block head</span></span>
<span class="line"></span></code></pre>
<p>Now when we have our app accessible by all our pages, let’s create our first controller,
which will handle exactly one page, the landing page. To expose our controllers,
we need to make a module, consisting of controllers and add it as a dependency
to our application. If you take a look at the application definition, it is also
a module. The first parameter to <code>angular.module()</code> function is a module name,
the second one is a list of dependencies.</p>
<p>Controllers are defined in a same way, but the dependency list for them contains
module definition as the last element as well. Let’s define a <code>LandingPageCtrl</code> controller
in a <code>src/javascripts/controllers.js</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStatsControllers </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> angular.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsControllers'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$scope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$scope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $scope.apps </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 142</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>Here we defined a module <code>ourStatsControllers</code>, which will contain all the controllers
and a <code>LandingPageCtrl</code> controller, which is a module of the same name, with a single
dependency - <code>$scope</code> and its implementation. As you can see, the <code>$scope</code> appears
here twice - first time as a dependency name and second time as an argument
to controller’ definition function. That’s exactly how <strong>dependency injection</strong> is made
with Angular. Here we defined a scope variable for our controller too, called <code>apps</code>.
We’ll use it in just a moment.</p>
<p>Note the second argument: it’s not required to be a list with dependencies’ names first and
controller implementation function, taking all those dependencies as arguments last. This
is done only for the sake of minification. That’s it, if you decide to minify your javascript
files, you’ll get a lot of errors if you will not specify dependencies’ names as first list
items, because most of javascript minifiers shorten your variables’ names to just a few
symbols, while keeping strings all the same. So if you are not minifying your javascript files,
this code will work perfectly:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$scope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"></span></code></pre>
<p>Instead, when minified, this controller will be transformed into something like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<p>And Angular will try to find a controller, factory or a service, named <code>b</code>. And will probably fail.
But if you use <em>“explicit”</em> dependency injection, like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsControllers.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$scope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$scope</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) { </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } ])</span></span>
<span class="line"></span></code></pre>
<p>then this code will be minified to something like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">controller</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$scope'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}])</span></span>
<span class="line"></span></code></pre>
<p>And then Angular will try to inject the <code>$scope</code> service and will succeed.
Just keep this small trick in mind, when developing a real-world Angular applications.</p>
<p>Now we need to inject our controllers module into our application. So we just add a
dependency entry inside our application declaration:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStatsApp </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> angular.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsApp'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsControllers'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]);</span></span>
<span class="line"></span></code></pre>
<p>As we already defined the <code>ourStatsControllers</code> module, we don’t need to provide
an implementation for it.</p>
<p>But to make our controller work properly, we need either to declare it on frontend,
making it handle static piece of a page, or make our application use different
controller and view, depending on a route in a browser’s address line.</p>
<p>The first approach is good when you use Angular for complex widgets on a page. But
we need something more from our application, so we’ll set up router. It’ll
parse URL from browser and run the corresponding controller.</p>
<p>Router we’ll be using is <code>ngRoute</code>. This is a third-party plugin for Angular.
And in order to use it, we need to add a Bower dependency to our project:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">bower</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save-dev</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> angular-route</span></span>
<span class="line"></span></code></pre>
<p>Now we only need to reference it in our app definition:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ourStatsApp </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> angular.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsApp'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ngRoute'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ourStatsControllers'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]);</span></span>
<span class="line"></span></code></pre>
<p>The next step is configuring our application routes, making application to
“understand”, which controller and which template it should run. This may
be done in the same file, as the application definition:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ourStatsApp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">config</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'$routeProvider'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    function</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">$routeProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        $routeProvider.</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/home'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'partials/landing-page.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }).</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">            otherwise</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                redirectTo: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/home'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>This configuration makes our application run <code>LandingPageCtrl</code> when the <code>/home</code> page is
entered. And if the URL entered is not known, application will redirect user to the
<code>/home</code> page. All Angular routes are passed as an anchor, so saying <em>the <code>/home</code> page</em>
we actually mean <code>http://your.host/#/home</code>. This makes browser not send requests
to the server, requesting non-existent pages.</p>
<p>Also, note we point our application to use the <code>partials/home.html</code> template.
But we did not tell the Angular where to render it. To fix that, we’ll
add a <code>ng-view</code> directive to the <code>.container-fluid</code> element of our <code>&#x3C;body></code> tag,
right in our layout:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">body</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    block</span><span style="color:#E36209;--shiki-dark:#FFAB70"> body</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .container-fluid</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">ng-view</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span></span>
<span class="line"></span></code></pre>
<p>Currently, when the project is built with the Gulp’ <code>build</code> task,
we have a <code>public/home.html</code> page, but it is not a partial - it is a standalone
page, extending the layout. But what we need is to compile all our Jade templates
into a <code>public/partials</code> directory, making them available through the
<code>/partials/partial_name.html</code> URL. And they should not extend the layout, because
then we’ll end up with an incorrect HTML code.</p>
<p>To make the magic happen, we only need to change our <code>build</code> task for Gulp
to build views directly to the <code>public</code> directory. So the <code>src/views/index.jade</code>
file will be the main HTML page of our application, available through
<code>/index.html</code> URL. And all the partials would be our Angular controllers’ templates,
available through <code>/partials/template_name.html</code> URLs.</p>
<p>Now the views part of Gulp <code>build</code> task should look like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/views/**/*.jade'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">jade</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dest</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span></code></pre>
<p>And let’s just extract the content of <code>index.jade</code> partial as it is now, all the
content into a separate Angular partial, <code>src/views/partials/home.jade</code>.</p>
<p>And let’s add only one small change - add only one line there:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">h1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Currently running {{ apps }} apps&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">h1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>Remember, we have the <code>$scope</code> parameter for our <code>LandingPageCtrl</code> controller?
And that there we set the <code>apps</code> variable? That is it, displaying on our home page.
All the other parameters, added to the <code>$scope</code> are available on the corresponding
template, by default. You may display them with some formatting, looping through the list
with <code>ng-repeat</code> and using them as conditionals with <code>ng-if</code> or <code>ng-show</code>.
But let’s go step-by-step.</p>
<p><a class="btn btn-primary btn-lg" href="https://github.com/shybovycha/two-sides-of-web-application/commit/b443618ca13179cc33b7ff2e08d0d6209b323113">Code goes here</a></p>
<h2 id="populating-our-app-with-stuff">Populating our app with stuff</h2>
<p>For now, let’s add all the other controllers to our app. Just create empty
controllers according to the table from <strong>part one</strong>, using the same approach as
described right above.</p>
<p>We’ll define each controller in its own file, but all of them will be concatenated
into one big application javacript file. We’ll use Gulp for this purpose with
its <code>gulp-concat</code> plugin.</p>
<p>Let’s install it:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">npm</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> gulp-concat</span></span>
<span class="line"></span></code></pre>
<p>Its usage is super-easy: you just redirect the output of our CSS and JS files compiler
to the <code>concat(filename)</code> function, providing it with a resulting filename. Like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> concat </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> require</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'gulp-concat'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/javascripts/**/*.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">babel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">concat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'all.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dest</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/javascripts'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'src/stylesheets/**/*.scss'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">sass</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ style: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'expanded'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">concat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'all.css'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pipe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(gulp.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dest</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'public/stylesheets'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span></code></pre>
<p>Now, the controllers. First we need to set the routes.
The router configuration for our application will look just like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">$routeProvider</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'landing-page.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'LandingPageCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/new-session'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'new-session.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewSessionCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/edit-account'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'edit-account.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'EditAccountCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications/:id'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'show-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ShowApplicationCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'list-applications.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ListApplicationsCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications/:id/edit'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'edit-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'EditApplicationCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">when</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/applications/new'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        templateUrl: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'new-application.html'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        controller: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'NewApplicationCtrl'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">otherwise</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        redirectTo: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    });</span></span>
<span class="line"></span></code></pre>
<p>And we currently have a lot of pages with broken links. We should fix that,
providing URLs to our <em>(empty for now)</em> controllers. Like this one:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">a</span><span style="color:#6F42C1;--shiki-dark:#B392F0">.btn.btn-primary.btn-lg</span><span style="color:#005CC5;--shiki-dark:#79B8FF">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"#/sign-in"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> role</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"button"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">)</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Sign in</span></span>
<span class="line"></span></code></pre>
<p>Fix those links for all the views by yourself - that is not a complex task.
All the routes are described both in the app configuration and in a table
above.</p>
<h2 id="demo">Demo</h2>
<p data-height="268" data-theme-id="0" data-slug-hash="obQbvX" data-default-tab="result" data-user="shybovycha" class="codepen">See the Pen <a href="http://codepen.io/shybovycha/pen/obQbvX/">Simple web analytics. Angular injection. v1</a> by Artem Shoobovych (<a href="http://codepen.io/shybovycha">@shybovycha</a>) on <a href="http://codepen.io">CodePen</a>.</p>
<script async src="/assets.codepen.io/assets/embed/ei.js"></script> </div>  </article> </section> </main> <footer> <nav> <div class="prev"> <a href="/page5.html" class="next">&larr; Previous page</a> </div> <div class="current">Page #6 of 11</div> <div class="next"> <a href="/page7.html" class="next">Next page &rarr;</a> </div> </nav> </footer> </body></html>