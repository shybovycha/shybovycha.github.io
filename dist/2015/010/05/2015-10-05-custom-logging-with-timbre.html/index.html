<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/2015/010/05/2015-10-05-custom-logging-with-timbre.html/"><!-- Primary Meta Tags --><title>Custom logging with timbre</title><meta name="title" content="Custom logging with timbre"><meta name="description"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body data-astro-cid-bvzihdzo> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo>  </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2015-10-04T14:00:00.000Z"> Oct 5, 2015 </time>  </div> <h1 data-astro-cid-bvzihdzo>Custom logging with timbre</h1> <hr data-astro-cid-bvzihdzo> </div>  <h2 id="timbre">Timbre?</h2>
<p>At my job we recently started researching logging tools to make our RESTful API, written in Clojure,
writing logs in JSON format. We were using <strong>Log4j</strong> already, but decided to use another tool for
this task, making it less painful. So we felt into <strong>timbre</strong>. Is seemed so easy to use, but it is
really undocumented.</p>
<p>According to timbre’s API, we needed to define our own <strong>appender</strong> for writing to a custom JSON file.
And we found the <code>output-fn</code> option to configure this behaviour. But it is not documented at all,
so we started looking for repositories, using timbre, examples and all the stuff. And finally,
we ended up with our own solution.</p>
<p>Underneath you will find description of our way to use timbre from scratch.</p>
<!--more-->
<h2 id="getting-started">Getting started</h2>
<p>First of all, you will need a <strong>Leiningen</strong> project. We already have one, but you may want to create
a blank one for the test purpose. But beware, you’d better generate it from an <code>app</code> template, so
when you run it with <code>lein run</code>, you face not the problem I faced. The problem was an error I could
not get rid of, saying <code>Cannot find anything to run for: my-ns</code>. So I just re-generated project from
scratch and the problem gone. <em>I did no research deeper, but if I will, I’ll write about it for sure</em>.</p>
<p>Generating project from an <code>app</code> template is done really easily:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">lein</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> new</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> app</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> your-app-name</span></span>
<span class="line"></span></code></pre>
<p>The process will be finished in seconds. Then you’ll need to add a few dependencies in your <code>project.clj</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defproject</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> your-app-name</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; ...</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    :dependencies</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [[org.clojure/clojure </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"1.6.0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 [com.taoensso/timbre </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"4.1.4"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 [org.clojure/data.json </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"0.2.6"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]]</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>To install dependencies for your project, simply run <code>lein deps</code>.</p>
<h2 id="configuring-timbre">Configuring timbre</h2>
<p>To use timbre in your project all you need is to require it:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">ns</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timbre-test1.core</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:require</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [taoensso.timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:refer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info warn debug error)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [clojure.data.json </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json]))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:some-complicated-hash</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:inner-hash</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:more-inner</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"value1"</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "value2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]}}})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Hello, World!"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">error</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "SOMETHING WENT WELL"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"></span></code></pre>
<p>This example shows one very important feature of timbre: <strong>it can log objects, other than strings and
exceptions</strong>. This is really handy! Doing so, timbre is able to log a JSON object simply, almost
out-of-the-box.</p>
<h2 id="custom-configuration">Custom configuration</h2>
<p>Now the time has come for something non-trivial. We need to set up our own appender to force timbre
log everything in JSON.</p>
<p>There is a set of default appenders in timbre already. For instance, there is a <code>spit</code> appender,
writing logs to a file. And the default timbre’s appender, writing logs to <code>stdout</code>, is called
<code>sample</code>. But there’s a trick: each appender in timbre should be configured by its <strong>id</strong>, not
by its <strong>type</strong>. So you may have two different <code>spit</code> appenders, for example, writing to different
files.</p>
<p>Timbre provides two methods of configuration:</p>
<ul>
<li><strong>merging</strong>, when you can override only some options of default config</li>
<li><strong>setting</strong>, when you override all the default options at once</li>
</ul>
<p>We used the first way, because some of timbre’s options were mystical to us - if we do not set them,
we will get no output at all. And we have not researched which ones we need to set.</p>
<p>At first, we wrote a simple config, forcing logging to be printed onto a screen with some JSON
formatting:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">ns</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timbre-test1.core</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:require</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [taoensso.timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:refer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info warn debug error)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [clojure.data.json </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json]))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> json-output-fn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:keys</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [vargs_ hostname_ timestamp_ level] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> args}]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [msg] { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:timestamp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> @timestamp_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :level</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     level</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :hostname</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  @hostname_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">   msg })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                   @vargs_)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        json-messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">json/write-str</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> %) messages)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">clojure.string/join</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-messages)))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timbre/merge-config!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:appenders</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                    :output-fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-output-fn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 }}})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Note the appender id: <code>println</code>. This code overrides <code>output-fn</code> for <code>println</code> appender <em>(e. g. the
default one)</em>. The parameter for <code>output-fn</code> is a function, receiving a map with different keys. The
most important ones are <code>vargs_</code>, <code>hostname_</code>, <code>timestamp_</code> and <code>level</code>. Those are enough to format
the correct and full message with any format you might want.</p>
<p>The <code>vargs_</code> variable contains all the arguments, passed to a logging call <em>(<code>info</code>, <code>warn</code>, <code>error</code> -
any function from <code>timbre</code> namespace, which performs logging)</em>. And the <code>clojure.data.json/write-str</code>
function converts its params to JSON and stringifies it, returning valid JSON as a string.</p>
<p>A function should return a string, representing a message, which will be written to a screen or a file,
depending on appender.</p>
<p><code>level</code> argument is set by a macro, you are logging with. For example, <code>timbre/info</code> will set
<code>level</code> to <code>"info"</code>, <code>timbre/error</code> - to <code>"error"</code> and so on.</p>
<p><code>hostname_</code> and <code>timestamp_</code> are helper arguments, you might not need them in all the use cases.
But the <code>timestamp_</code> one is really helpful. Always.</p>
<p>Then we overrided the default file appender, extending it with our <code>json-output-fn</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">ns</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> timbre-test1.core</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:require</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [taoensso.timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> timbre </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:refer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info warn debug error)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [taoensso.timbre.appenders.core </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> appenders]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [clojure.data.json </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json]))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> json-output-fn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:keys</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [vargs_ hostname_ timestamp_ level] </span><span style="color:#005CC5;--shiki-dark:#79B8FF">:as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> args}]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [msg] {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:timestamp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> @timestamp_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :level</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     level</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :hostname</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  @hostname_</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                                  :message</span><span style="color:#24292E;--shiki-dark:#E1E4E8">   msg})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                   @vargs_)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        json-messages (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">json/write-str</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> %) messages)]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">clojure.string/join</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-messages)))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timbre/merge-config!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:appenders</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :spit</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">merge</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">appenders/spit-appender</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:fname</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "timbre.log"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}) {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:output-fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-output-fn})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 }})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Nothing new here, except of the appender used - now the application will log to both file and screen.
To prevent logging to <code>stdout</code>, we disabled the <code>println</code> appender:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">defn</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> -main</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [&#x26; args]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timbre/merge-config!</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:appenders</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :println</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:enabled?</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                 :spit</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">merge</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">appenders/spit-appender</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:fname</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "timbre.log"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}) {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:output-fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json-output-fn})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 }})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:moo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">:foo</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> :bar</span><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>Here I should mention that we were not made to call our JSON appender <code>spit</code> - it was used for convention
reasons only.</p>
<p>And that’s basically it - we made our logging to be written to a JSON file only.</p>  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2024 Your name here. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://m.webtoo.ls/@astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Mastodon</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/mastodon" data-astro-cid-sz7xmlte><path fill="currentColor" d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://twitter.com/astrodotbuild" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/withastro/astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Astro's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>