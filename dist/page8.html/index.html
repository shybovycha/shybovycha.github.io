<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/page8.html/"><!-- Primary Meta Tags --><title>moofoo blog</title><meta name="title" content="moofoo blog"><meta name="description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main> <section> <article> <h1> <a href="/2015/08/27/2015-08-26-application-architecture.html">Irrlicht Newton GD tutorial: application architecture</a> </h1> <time datetime="2015-08-26T20:50:00.000Z"> Aug 27, 2015 </time> <div class="content"> <h2 id="basic-terms">Basic terms</h2>
<p>Let’s talk a bit about our application before we create it. In order to make the development process sequential
and least painful, we need to design the application well. The design of an application or the <strong>application architecture</strong>
is the hardest thing to change on later stages of development. Thus it must be well-thought at the very beginning to
prevent suffering in the future.</p>
<p>Well, there are number of application architecture’ levels:</p>
<div class="row">
    <div class="col" style="margin-right: 1em;">
        <img src="/images/irrlicht-newton-tutorials/japan_feudal_system.webp" loading="lazy">
    </div>
    <div class="col">
        <p>
            The highest level defines which modules will the whole
            application consist of and what functionality will each of those modules have.
        </p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>    &#x3C;p></span></span>
<span class="line"><span>        The next level is how the modules communicate to each other, how they work together.</span></span>
<span class="line"><span>    &#x3C;/p></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &#x3C;p></span></span>
<span class="line"><span>        The lower level is the structure of each module - what classes, entities, data structures and similar things will</span></span>
<span class="line"><span>        the module consist of.</span></span>
<span class="line"><span>    &#x3C;/p></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &#x3C;p></span></span>
<span class="line"><span>        One of the lowest, yet still very important architecture levels is how files are organized.</span></span>
<span class="line"><span>    &#x3C;/p></span></span>
<span class="line"><span>&#x3C;/div></span></span>
<span class="line"><span></span></span></code></pre>
</div>
<p>From the highest architecture layer point of view, I can advice a very simple architecture:</p>
<ul>
<li>a stable, rarely changed <strong>core</strong></li>
<li>a set of <strong>assets</strong> (models, textures, sounds - any content, made by artists and used to be presented to the player)</li>
<li>a bunch of <strong>scripts</strong>, defining all the logic of a game (how character looks like, how the menus are shown and how they react to player’s actions)</li>
</ul>
<p>The main benefits of such an approach are:</p>
<ol>
<li>scripts and assets may be changed at any time</li>
<li>scripts and assets define what we show to the user and how the application behaves, so we can changes them without the need to re-compile the core</li>
<li>we can modify the core (for example - optimize some features) without changing the application behaviour</li>
</ol>
<p>We can make the core so flexible that we may re-use it in the future projects.</p>
<h2 id="the-tools">The tools</h2>
<p>We will use <strong>Irrlicht</strong> engine because of its simplicity. And it satisfies all our needs - it
does not need much content preparation; it provides GUI; extending it with <strong>IrrKlang</strong> will give
us very simple interface to sound and music playback.</p>
<p><strong>Newton Game Dynamics</strong> engine we will use to simulate physics. It is easy to use and is really powerful -
you would be impressed!</p>
<p>The last, not the least, we will use <strong>Lua</strong> scripting language to write scripts. Lua is a lightweight
programming language and perfectly suits that goal.</p>
<p>One of the most beautiful parts of this tutorial, will be the part on making of <strong>assets</strong>. We will use
<strong>Blender 3D</strong> to create a couple of 3D models.</p>
<p>I also found <strong>CMake</strong> kind of user-friendly. It is not that handy as any of dependency managers for all
those languages, supporting them <em>(<code>npm</code> for JavaScript, <code>go get</code> for Go, <code>RubyGems</code> for Ruby, <code>leiningen</code>
for Clojure and many others)</em>. Yet it makes your project a little more portable, helps to handle your
dependencies, totally eliminates the need of all those <em>How to configure VisualStudio for OGRE</em> tutorials.
Just try it!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Remember all the three rules for our architecture. And keeping them in mind, let’s get to some coding already!</p>
<p><a href="/irrlicht-newton-tutorials/2015/08/27/first-application.html" class="btn btn-success">Next chapter</a></p></div> </div>  </article><article> <h1> <a href="/2015/08/26/2015-08-25-introduction.html">Irrlicht Newton GD tutorial: introduction</a> </h1> <time datetime="2015-08-25T17:01:00.000Z"> Aug 26, 2015 </time> <div class="content"> <h2 id="what-will-you-learn">What will you learn?</h2>
<p>This tutorial covers the development of a game from a very beginning. This includes:</p>
<ul>
<li>planning the <strong>architecture</strong> for a game</li>
<li>developing the <strong>game engine</strong></li>
<li>defining game logic with <strong>scripts</strong></li>
<li>creating <strong>3d models</strong></li>
<li>and <strong>distributing the application</strong></li>
</ul>
<p>And of course, the whole tutorial is built around <strong>Irrlicht</strong> and <strong>Newton Game Dynamics</strong> libraries.</p>
<p>As for <em>{{ site.time | date: ‘%d %b %Y’ }}</em>, the tutorial covers:</p>
<ul>
<li>an introduction to NewtonGD</li>
<li>creating Irrlicht-powered application</li>
<li>controlling the application logic with Lua scripts</li>
<li>building application with CMake</li>
</ul>
<h2 id="why-writing-everything-from-scratch-why-not-use-unity--unreal-engine--you-name-it">Why writing everything from scratch? Why not use Unity / Unreal Engine / <em>you-name-it</em>?</h2>
<p>There are some well-known and used game engines like <strong>Unreal Engine 4</strong>, <strong>Unity 3D</strong> and others. They all come with enormous amount of learning materials. So why this tutorial might be interesting for you? You might want to know how things work and thus get most flexibility out of your tools. Or even start working on building your own tools.</p>
<h2 id="what-should-i-know-to-proceed">What should I know to proceed?</h2>
<p>I expect you to have at least some experience with these three things:</p>
<ul>
<li>C++</li>
<li>computer graphics</li>
<li>game development</li>
</ul>
<p>The latter - to make sure, you will not call 3d models “textures” or miss the “script” word’ meaning.</p>
<h2 id="why-these-libraries">Why these libraries?</h2>
<p>Irrlicht is easy to use and contains all the features you will need to build a game - resource management, support for majority of asset formats out-of-the-box, user input (keyboard, mouse and joystick events handling), GUI (Graphical User Interface - buttons, text inputs, etc.).</p>
<p>Irrlicht is easy to use and contains all the features you will need to build a game - resource management, support for majority of
asset formats out-of-the-box, user input <em>(keyboard, mouse and joystick events handling)</em>, GUI
<em>(Graphical User Interface - buttons, text inputs, etc.)</em>.</p>
<p>Newton Game Dynamics is also very easy to use; it is constantly developed; and it is darn powerful!</p>
<p>If you are still interested - please proceed to
<a href="/irrlicht-newton-tutorials/2015/08/26/application-architecture.html" class="btn btn-success">the first chapter</a>.</p> </div>  </article><article> <h1> <a href="/2015/07/12/2015-07-12-reactjs-introduction.html">ReactJS introduction</a> </h1> <time datetime="2015-07-11T22:20:05.000Z"> Jul 12, 2015 </time> <div class="content"> <h2 id="foreword">Foreword</h2>
<p>Last time I wrote an article on how one can encapsulate both HTML and CSS in one
entity, called WebComponent. This time I want to tell a bit about how to encapsulate
JavaScript and HTML.</p>
<p>When I see an article on <a href="http://habrahabr.ru">Habrahabr</a> titled <em>React something</em>,
I think <em>Omg, React again?..</em>. But React, just as Ember was always a mystery for me.</p>
<p>Until today.</p>
<!--more-->
<p>I’ve read an awesome article, <a href="http://reactfordesigners.com/labs/reactjs-introduction-for-people-who-know-just-enough-jquery-to-get-by/?utm_source=javascriptweekly&#x26;utm_medium=email"><em>React.js Introduction For People Who Know Just Enough jQuery To Get By</em></a>.
And now I really see the power of React. Though, I am still planning to play with Angular 2.0 and
still remain a fan of Angular, I can tell you for sure, React may help you to raise your level
if you are still writing your web-sites with jQuery.</p>
<p>React is a way to make your project consist of a components. So, for example, you have a complex webpage.
You may then have a layout, styled in a way to support different themes. Then you may split all its partials
into components, so you do not need your layout to hardly rely on its partials.</p>
<p>Although building components with react may seem polluting your code with HTML, it is really great concept to
keep your HTML code near the JS code handling it. React has its own restrictions for the components.
For example, you can not use two tags alongside inside your component. It is required to use
<strong>exactly</strong> one top-level tag. And all the variables are stored in the <code>state</code> variable.
But I will tell you how to overcome that restriction later.</p>
<h2 id="the-architecture">The architecture</h2>
<p>This article relies on JavaScript, so let’s be kind and create an initial project structure for
a typical JS project. Just like this:</p>
<img src="/images/tumblr/reactjs-introduction/tumblr_inline_nrcgsc8eei1qh5oee_540.webp" alt="Project structure">
<p>This is always great to have a typical structure for a project so anyone new to the project will
not get lost.</p>
<p>So, we can assume we will always have a set of javascripts and stylesheets, used on a front-end.
We also may need some third-party libraries, managed by NPM or Bower. And this is <strong>always</strong>
<em>(I mean not javascript projects only)</em> a great idea to have your changes being tracked by some
version control system. I like Git the most.</p>
<p>Based on those few assumptions, we will need a folder with <code>javascripts</code> and <code>stylesheets</code> sub-dirs;
<code>.gitignore</code>, <code>package.json</code> and <code>bower.json</code> files <em>(select those you need)</em>.</p>
<p>In some cases, like with this article, we may need to compile some of resources. For that purpose we
may create something like <code>build</code> directory. And define the build command in <code>package.json</code> file, within
the <code>scripts</code> section.</p>
<h2 id="a-very-simple-introduction">A very simple introduction</h2>
<h3 id="preparing-layout-template">Preparing layout template</h3>
<p>So, let’s start writing a layout for our sample webpage. This may be done with <a href="http://emmet.io/"><strong>Emmet</strong></a>.
Just type <code>html:5</code> and press <code>Tab</code> within your favorite text editor <em>(I feel comfortable with both
Sublime and Atom, yet you may run Emacs and still use Emmet)</em>.</p>
<h3 id="front-end-dependencies">Front-end dependencies</h3>
<p>Now, let’s add <code>bootstrap</code> and <code>react</code> scripts. The good way of doing it is using <a href="http://bower.io/"><strong>bower</strong></a>.
Now there are two ways of adding dependencies with bower: manually editing <code>bower.json</code> or using command-line.</p>
<p>If you decided to add dependencies into <code>bower.json</code> file, remember to set the concrete versions for each dependency.
Or you may face situations, when someone installs your project and uses the newer versions of libraries, which are
incompatible with the code, which uses them.</p>
<p>Here are the lines you will need to add to your <code>bower.json</code> file to proceed:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">  "dependencies"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "react"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"0.13.3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "bootstrap"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"3.3.5"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span></code></pre>
<p>If you have chosen the CLI way, consider this command:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  bower</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --save</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bootstrap</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> react</span></span>
<span class="line"></span></code></pre>
<p>I preferred the CLI way as it chooses the correct libraries’ versions automatically.</p>
<p>Now you may add React’s javascript and Bootstrap’s CSS into the layout:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;!</span><span style="color:#22863A;--shiki-dark:#85E89D">DOCTYPE</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">head</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">meta</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> charset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"utf-8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">title</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Introduction to ReactJS&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">title</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bower_components/react/react.min.js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">link</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bower_components/bootstrap/dist/css/bootstrap.min.css"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"stylesheet"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text/css"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">head</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<h3 id="first-npm-task">First NPM task</h3>
<p>You may want to add a task to your <code>package.json</code> to install bower dependencies automatically:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "dependencies"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      "bower"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"1.4.1"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "scripts"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      "bower"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./node_modules/bower/bin/bower install"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span></code></pre>
<p>This may be useful later, when building a project. Here I used the local version of bower in the script
to not make another project requirement of globally installed bower.
This approach is used lately in this article for building task.</p>
<h3 id="jsx-vs-javascript">JSX vs JavaScript</h3>
<p>React uses <strong>JSX</strong>. JSX has two meanings. Accordingly to <a href="https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS#static-typing"><em>List of languages that compile to JS</em></a>, JSX
is an extension of JavaScript with human-friendly OOP and type safety support. In the universe of React,
JSX is an extension of JavaScript too. But in this case, JSX only allows to create DOM elements from within the
code in a DSL-style.</p>
<p>To explain what is DSL-style, I shall show you two examples:</p>
<p><strong>non-DSL way:</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"div"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {className: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"well clearfix"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"textarea"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {className: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form-control"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, onChange: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.handleChange}),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"br"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createElement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"button"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {className: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"btn btn-primary pull-right"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Tweet"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  )</span></span>
<span class="line"></span></code></pre>
<p><strong>DSL way:</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"well clearfix"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form-control"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> onChange</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.handleChange}>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">br</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"btn btn-primary pull-right"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Tweet&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"></span></code></pre>
<p>Both of JSX branches are, again, extensions to JavaScript, thus they need to be compiled to ES5 <em>(also known as
“usual javascript”)</em> to make the code understood by browser. For this purpose we need a compiler.
For React this is called <code>react-tools</code>. So let’s add it as a dependency inside our project’s <code>package.json</code> file.
This will add the <code>jsx</code> utility to the <code>node_modules</code> sub-dir. So we may define another build task within
the <code>package.json</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    "scripts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      "build"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"./node_modules/react-tools/bin/jsx src/javascripts/ build/"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span></code></pre>
<p>This task compiles all the scripts from the <code>src/javascripts/</code> directory and stores the compiled javascripts in
<code>build/</code> directory.</p>
<h3 id="first-component">First component</h3>
<p>All components are made simply calling <code>React.createClass()</code> method and providing it with a component’s rendering
method <em>(a method that returns component’s HTML)</em>, its initial <strong>state</strong> <em>(something like Angular’s <code>$scope</code>)</em> and
event handlers. Just check it out:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> TweetBox </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createClass</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"well clearfix"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form-control"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">br</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"btn btn-primary pull-right"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Tweet&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span></code></pre>
<p>Here you may see a few restricts, done by React:</p>
<ol><li>you need **exactly** one top-level tag for your component
</li><li>you may not use <code>class</code> attribute within elements, use <code>className</code> instead
</li></ol>And this is how this component is used:
<pre><code>
  React.render(
    &#x3C;TweetBox />,
    document.body
  );
</code></pre>
<p>Note: you may not use the <code>&#x3C;TweetBox /></code> tag from within the HTML.</p>
<p>Now let’s write that component within the <code>javascripts/app.js</code> file and reference it in the layout,
at the end of <code>&#x3C;body></code> tag; to make it loaded when all the document is done loading:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;!</span><span style="color:#22863A;--shiki-dark:#85E89D">DOCTYPE</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">head</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">meta</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> charset</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"utf-8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">title</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Introduction to ReactJS&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">title</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bower_components/react/react.min.js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">link</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bower_components/bootstrap/dist/css/bootstrap.min.css"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"stylesheet"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text/css"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">head</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> src</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"build/app.js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">html</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>To see the page we’ve written in action, first compile the sources with <code>npm run build</code> to compile
the JSX code to javascript and use it in the layout template.</p>
<h3 id="state">State</h3>
<p>The component’s internals are stored within the <code>state</code> variable. This is something like Angular’s <code>$scope</code>.
React adds a method to initialize your component’s state, called <code>getInitialState()</code>. It should return object,
representing the initial state. State variables may be accessed via <code>this.state.myVar</code> and interpolated
in template with curly-braces syntax, <code>{this.state.myVar}</code>. So you may do something like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> TweetBox </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createClass</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    getInitialState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        text: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        maxLength: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">140</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"well clearfix"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form-control"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">br</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>{ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.state.maxLength </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.state.text.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"btn btn-primary pull-right"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Tweet&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span></code></pre>
<p>State may be changed with the <code>setState()</code> method, receiving… object! But this time, the object for <code>setState()</code>
represents a set of new field values. So, for example, using syntax</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ text: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"newValue"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"></span></code></pre>
<p>will not replace the whole state with <code>text</code> field only. Instead, it will modify <code>text</code> field only and will left
<code>maxLength</code> unchanged.</p>
<p>But when can we call the <code>changeState()</code>? In Angular it is done with <strong>data binding</strong>. But in React we have
events. Yes-yes, simple DOM events!</p>
<p>So, for example, we may set the <code>onChange</code> event in the <code>&#x3C;textarea rows=“10” cols=“50”></code> and just handle it:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>  var TweetBox = React.createClass({</span></span>
<span class="line"><span>    ...</span></span>
<span class="line"><span>    handleChange: function(evt) {</span></span>
<span class="line"><span>      this.setState({ text: evt.target.value });</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    render: function() {</span></span>
<span class="line"><span>      ...</span></span>
<span class="line"><span>      &#x26;lt;textarea className="form-control" onChange={ this.handleChange }&#x26;gt;</span></span>
<span class="line"><span>      ...</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span></code></pre>
<p>Yeah, looks not so pretty as with Angular…</p>
<h3 id="react-conclusion">React: conclusion</h3>
<p>I assume React’s way of doing websites is nice until you learn something better. At least,
when switching from jQuery, you can make your webpage’s code look much better with React!</p>
<h2 id="alternatives">Alternatives</h2>
<h3 id="riot">Riot</h3>
<p>But wait! There are alternatives! <a href="https://muut.com/riotjs/"><strong>Riot</strong></a> continues React experience of state. But makes
it with a much more pretty code. But the main advantage of Riot is ES6. Yeah, when both of libraries
use compilation, why reject the future and invent a wheel? Thus Riot makes your code much more clear. Check this out:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">tweet-box</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"well clearfix"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form-control"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> onkeyup</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">{</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> handleChange</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> }</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">br</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>{ maxLength - text.length }&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"btn btn-primary pull-right"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Tweet&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.text </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxLength </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 140</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      handleChange</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(evt) {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.text </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> evt.target.value;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">tweet-box</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>Everything looks great with Riot: its size is much more lower than React’s; it has ES6 and nice syntax; it does not
turn your JS code into substance on the edge of two worlds - <strong>views layer</strong> and <strong>logic layer</strong>; it has even
<a href="https://muut.com/riotjs/guide/#scoped-css"><strong>scoped css</strong></a>!..</p>
<p>But Riot has one huge drawback. That drawback is <code>XHTTPRequest</code>. By default, you <strong>may</strong> define your components
inline, just within your layout page. But as long as it is a mix of HTML and JS, browser will not correctly
respond to your page, throwing you strange exceptions. So, you may decide to extract your components into separate files.
But here you may face the fact that most of modern browsers do not allow for asynchronous requests to the files
without protocol being provided <em>(so you can not load project files via AJAX while testing project locally)</em>.
And that’s how Riot loads your components - via AJAX. So you need either to pre-compile your components or
run your project on a web server.</p>
<h3 id="angular-20">Angular 2.0</h3>
<p>Great news for each and every AngularJS fan; the essence of future of web development, <a href="https://angular.io"><strong>Angular.js 2.0</strong></a>.
It is made with <a href="http://www.typescriptlang.org/"><strong>TypeScript</strong></a>, which is even more powerful than ES6. It
provides developers with component architecture - HTML and JS encapsulation, but in even more sophisticated form.</p>
<p>So, for example, our &#x3C;tweet-box> component in Angular 2.0 may look like this:</p>
<p><strong>tweet-box.ts:</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="csharp"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  /// &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">reference</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> path</span><span style="color:#6A737D;--shiki-dark:#6A737D">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"../typings/angular2/angular2.d.ts"</span><span style="color:#6A737D;--shiki-dark:#6A737D"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  import {Component, View, bootstrap, formDirectives} from </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'angular2/angular2'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  @Component</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    selector</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'tweet-box'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  })</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  @View</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    directives</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [formDirectives],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    templateUrl</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'src/tweet-box.html'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  })</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TweetBox</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    text: string;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    maxLength: integer;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.maxLength </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 140</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.text </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ''</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  bootstrap</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(TweetBox);</span></span>
<span class="line"></span></code></pre>
<p><strong>tweet-box.html:</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="handlebars"><code><span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"well clearfix"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"form-control"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [(ng-model)]=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">textarea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">br</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span><span style="color:#005CC5;--shiki-dark:#79B8FF">{{</span><span style="color:#E36209;--shiki-dark:#FFAB70"> maxLength</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> - </span><span style="color:#E36209;--shiki-dark:#FFAB70">text.length</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> }}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"btn btn-primary pull-right"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Tweet&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">button</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Here, as you can see, data binding is used, so there is no more need in event handling. And you can use
all the power of TypeScript. But still, the great Angular 2.0 drawbacks are:</p>
<ul>
<li>Angular 2.0 is still on the <strong>alpha</strong> stage <em>(at least, while I am writing this post, it is)</em></li>
<li>too much effort is needed to get it working <em>(because of p. 1; still, THREE dependency managers to get it work is way too much…)</em></li>
<li>it still needs the server to serve templates or using templates inline</li>
<li>there are some major differences with all of the other libs referenced here, which may be hard to get used to <em>(for ex., using formDirectories like <code>[(ng-model)]=“modelName”</code>)</em></li>
</ul>
<h2 id="fin">Fin</h2>
<p>Looking at those three libraries, I can tell that Riot made my day. It is as simple as powerful and small. It lacks for two-way
data binding, but makes much more sense than React. And yet does not require you to get mad installing all those
dependencies to make it work.</p>
<p>All the examples, mentioned in the article are on my GitHub account:</p>
<ul>
<li><a href="https://github.com/shybovycha/intro-to-react">React example</a></li>
<li><a href="https://github.com/shybovycha/intro-to-riot">Riot example</a></li>
<li><a href="https://github.com/shybovycha/intro-to-angular2">Angular 2.0 example</a></li>
</ul> </div>  </article><article> <h1> <a href="/2015/06/22/2015-06-22-about-bower-webcomponents-and-the-all-the-good.html">About Bower, WebComponents and the all the good</a> </h1> <time datetime="2015-06-22T12:23:43.000Z"> Jun 22, 2015 </time> <div class="content"> <img src="/images/Pg-02-shakespeare-getty.webp" class="img-responsive img-sm img-rounded pull-right">
<h2 id="bem">BEM</h2>
<p>These days, many web developers use different methodologies to make their web page source look structured and clean. But all those methodologies only work well until you use third-party libraries or involve a new person in your project.</p>
<!--more-->
<p>BEM <em>(Block Element Modifier)</em> is a convention for naming CSS classes in a such way so they do not overlap.
Doing so you may turn your page into a set of independent blocks, or <em>components</em>. According to BEM,
you name your CSS classes as follows: <code>BlockName__ElementName__ElementModifier</code>.</p>
<p><code>BlockName</code> is a name of a <em>component</em>, your element belongs to. This may be a menu, a gallery or a widget,
for example.</p>
<p><code>ElementName</code> is a name of element of the block. Good examples of elements are label, title, avatar, menu_item,
etc.</p>
<p><code>ElementModifier</code> is a more complex thing. This is a state of element, which defines how element may look
like in a certain conditions. This may be a checkbox’ <code>checked</code> status, <code>focus</code> property or <code>is_menu_opened</code>
flag. Modifier may have one of two types:</p>
<ul>
<li><code>boolean</code>, where modifier is just a flag, showing if element’s property is active or not</li>
<li><code>key-value</code>, where modifier points to one of many possible property values</li>
</ul>
<p>For example, boolean modifiers are: <code>checked</code>, <code>big</code> (is element big or not), <code>hovered</code>, <code>opened</code>, etc.
Key-value modifiers may be, for instance, <code>menu_type_bullet</code> or <code>menu_type_numbers</code>, <code>menu_top</code>, <code>menu_left</code>
or <code>menu_right</code> (representing menu’ position).</p>
<p>Combining those three you may determine the look of any element and its state:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.navigation__menu__position_left</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {...}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.navigation__menu__position_right</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.top_menu__avatar__small</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.top_menu__avatar__medium</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">/* more meaningful */</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.user_widget__avatar__menu_position_top</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.user_widget__avatar__menu_position_left</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.user_widget__avatar__menu_position_right</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">/* more simple */</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.button__big</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.button__red</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ... }</span></span>
<span class="line"></span></code></pre>
<p>The aim of BEM is great - to make the web page use independent blocks with some structured <strong>CSS class names</strong> and have them all described in a nice way in the CSS files. Whilst it may sound like a Holy Grail for the Web, let’s take a look at a real-world example of how BEM is used.</p>
<p>There are, in fact, two approaches of BEM.</p>
<p><strong>The old approach</strong></p>
<p>Below is an example of vanilla BEM:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.bwelcome__message.hidden</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">none</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.bwelcome__message</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    color</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">yellow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    border-radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    text-align</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.bwelcome__label</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    font-size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#D73A49;--shiki-dark:#F97583">pt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.bwelcome__input</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">block</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">100</span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>And the HTML:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bwelcome"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bwelcome__message hiddent"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Hello, username!&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bwelcome__label"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Enter your name:&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bwelcome__input"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>So, here we can see that any styles should not overlap with the defined ones unless they are written in a BEM-way for the same element. Nice idea,implementation not so nice… All these <code>b#{block}__#{element}</code> classes are way too long, don’t you think? Writing them everywhere - HTML, CSS and JavaScript - is really painful.</p>
<p><strong>The new approach</strong></p>
<p>But what about the newer version of BEM? Its authors developed a toolbox with their own framework,
containing many tools to help you use BEM methodology. It contains two interesting tools - <strong>BEMJSON</strong>
and <strong>BEMHTML</strong>. Those two allow you to define your views with JavaScript and JSON.</p>
<p>To use them, just install <code>bem</code> with <code>npm</code>: <code>npm install bem</code>. Then you will be able to create your pages
with either BEM, BEMTREE, BEMHTML and BEMJSON. This has two advantages to writing pages by your own:</p>
<ol>
<li>they come with plugins, so you may have some parts of CSS ready to use out-of-the-box</li>
<li>it replaces writing all the selectors manually with writing them via commands of the <code>bem</code> utility</li>
</ol>
<p>For instance, here’s how your page may look like when being made with BEMHTML:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     block: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'page'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     title: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'hello'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     head: [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">         { elem: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'css'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, url: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'_hello.css'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     ],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     scripts: [{ elem: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, url: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'_hello.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     mods: { theme: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'islands'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     content: [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">         {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">             block: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'hello'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">             content: [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                 {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                     elem: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'greeting'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                     content: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Hello, %username%!'</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">             ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">         }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">     ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"></span></code></pre>
<p>And here’s how it may look like when made with BEMJSON:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">exports</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.deps </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "block"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"page"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "elem"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"css"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "attrs"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"src"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"_hello.css"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "block"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"page"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "elem"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "attrs"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: { </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"src"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"_hello.js"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "block"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"page"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "elem"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"meta"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "block"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"header"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "block"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"content"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "block"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"footer"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span></code></pre>
<p>Those two may work both together, when you define general page structure with BEMJSON and each block you
define with BEMHTML, or separatedly, when you define all your page in either BEMJSON or BEMHTML.</p>
<p>But anyway, in BEMJSON or BEMHTML or whatever, the whole page is described in one JS file, which will then be compiled into an HTML page. Using this approach allows you not only to pack the blocks and elements into one structure, but also to spice it up with some JavaScript, which handles those components.</p>
<p>Sounds great and may be somewhat helpful for new projects. But I believe there’s a better solution.</p>
<h2 id="introducing-webcomponents">Introducing WebComponents</h2>
<p>Although the implementation of BEM is clumsy, the idea is really great! This is just like encapsulation in OOP - one of the mightiest principles in programming. But what better options are there than BEM?</p>
<p>Recently we have all seen great changes to the Web. We now have ES6, CSS3, HTML5 and all of them give us ultimate power! Support for old browsers is now provided with hacks called <em>polyfills</em>. But why should we stop ourselves using the best of what we have in the name of <a href="http://gs.statcounter.com/#browser_version-ww-monthly-201405-201505">3% of Internet users</a>? Well, if you really do have to continue supporting all of those, you could just stop reading now. Or you could concentrate all your will and try out all these brand-new features in your pet project.</p>
<p>So, the new approach in web design encapsulation uses WebComponents. This is a technology, which does not
works everywhere. This is contraversary to a BEM methodology, where you only define a CSS classes, which
are supported since very early CSS versions.</p>
<p>So, welcome the WebComponents’ example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="handlebars"><code><span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">template</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"welcome-component"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .message</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          background-color</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#fea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 20</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          text-align</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">left</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          border-radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          font-family</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Arial</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"message"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Hello, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">{{</span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#005CC5;--shiki-dark:#79B8FF">}}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">!&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"shadow-host"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"message"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Non-component message&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> type=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text/javascript"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> host </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> document.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">querySelector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.shadow-host'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        template </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> document.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">querySelector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'#welcome-component'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        shadow </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> host.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createShadowRoot</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    shadow.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">appendChild</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(template.content);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>This code may not look so good, as it might, but it works like a charm!</p>
<p><a href="http://codepen.io/shybovycha/pen/gpGJOV"></a></p><figure data-orig-width="660" data-orig-height="79" class="tmblr-full"><a href="http://codepen.io/shybovycha/pen/gpGJOV"><img src="/images/tumblr/about-bower-webcomponents-and-all-the-good/tumblr_inline_nqciwfuAqT1qh5oee_500.webp" alt="image" data-orig-width="660" data-orig-height="79"></a></figure><p></p>
<p>This example is a bit ugly - it has both CSS, HTML and JavaScript mixed in a single file, but we’ll deal with it for a short time. Just think of the power you’ve got! You can define your own… well, it’s certainly kinda components! It is a bit uncomfortable to paste onto a page… and they are hardly ready to be used with something like Angular.</p>
<p>Well, yeah, this is as ugly as BEM.</p>
<p>But now you defined a component of your web-page, which you can then reuse with copying just one portion
of XHTML in place. And placing it inside a totally different web page will not break it down - both
HTML and CSS are separated and isolated and will not overlap with any other style or martkup. But
let’s try out our web component!</p>
<h2 id="bower">Bower</h2>
<p>Earlier I did not need to use any package managers except <code>gem</code> and <code>apt-get</code>. Yet, I was not so stupid as to install all the javascript libraries my project needs with RubyGems. On my projects I had to download the necessary library versions and store them in the <code>assets/javascripts</code> directory. Forever. Or at the very least an upgrade was needed.</p>
<p>But then I tried Bower. It was so easy to manage my assets! So I highly recommend this way to you, dear Reader!</p>
<p>To use Bower from scratch on a brand new project, you need to</p>
<ol>
<li>install Bower with <code>npm</code></li>
<li>ininitialize your project with <code>bower init</code></li>
<li>define dependencies in the <code>dependencies</code> object in your new <code>bower.json</code> file</li>
<li>install them with <code>bower install</code></li>
</ol>
<p>Then you should end up with all your libraries in the <code>bower_components</code> directory. And that’s it! Every package has its own dir. So you can keep track of all the versions etc.</p>
<h2 id="polymer">Polymer</h2>
<p>Let’s start cooking our demo with <a href="https://www.polymer-project.org/">Polymer</a>. First, initialize the Bower project and add this section to your fresh <code>bower.json</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">"dependencies"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "polymer"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Polymer/polymer#^1.0.0"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Then run <code>bower install</code>. This will provide you with all the stuff you need.</p>
<p>Now we will move our pretty <code>welcome-component</code> to a new place. Create two files:<code>welcome-component.html</code> and <code>index.html</code>. Fill the last one with <a href="http://docs.emmet.io/">Emmet</a>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="pug"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">html:5</span></span>
<span class="line"></span></code></pre>
<p><em>(you need to hit the “Expand” key, formerly Tab, at the end of this single line while editing the<code>index.html</code></em> <em>file in an Emmet-powered editor)</em>. And add just a single line within the HTML’ <code>&#x3C;body></code> tag:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">welcome-component</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">welcome-component</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span></code></pre>
<p>Now let’s define our new component in <code>welcome-component.html</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="handlebars"><code><span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">dom-module</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"welcome-component"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        .message</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          background-color</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#fea</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 20</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          text-align</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">left</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          border-radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">          font-family</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Arial</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"message"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>Hello, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">{{</span><span style="color:#E36209;--shiki-dark:#FFAB70"> name</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> }}</span><span style="color:#24292E;--shiki-dark:#E1E4E8">!&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      Polymer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        is: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"welcome-component"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">script</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">dom-module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>Now, add our new component importing to the <code>&#x3C;head></code> tag of the <code>index.html</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">link</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"import"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"bower_components/polymer/polymer.html"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /> </span><span style="color:#6A737D;--shiki-dark:#6A737D">&#x3C;!-- imports Polymer --></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">link</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> rel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"import"</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> href</span><span style="color:#24292E;--shiki-dark:#E1E4E8">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"welcome-component.html"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /> </span><span style="color:#6A737D;--shiki-dark:#6A737D">&#x3C;!-- imports our component --></span></span>
<span class="line"></span></code></pre>
<p>To run this quickly, you might want to use <code>http-server</code> from <code>npm</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">http-server</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --cors</span></span>
<span class="line"></span></code></pre>
<p>And voila! We’ve just made a nice web component, which could be used really simply. And the code is totally clean!</p>
<p>If you look at the HTML source, you’d see a beautiful DOM structure: we’ve got our <code>&#x3C;div class="message"></code> within the <code>&#x3C;welcome-component></code> tag. And its style will never affect any other elements, even when you create another <code>&#x3C;div></code> outside the <code>&#x3C;welcome-component></code>. Seriously, you can try it!</p>
<p>Yeah, I know we’ve used Polymer and that’s cheating. But think of it as of a temporary hack you will remove when your browser starts supporting custom tags.</p>
<h2 id="custom-attributes-for-custom-tags">Custom attributes for custom tags</h2>
<p>Now, the last thing I’d like to show is the attributes for our custom components. We’d like to pass some data to our brand new components easily, right? So, let’s define a <code>name</code> attribute, which we’ll show instead of it!</p>
<p>To do this, we shall use two Polymer features. First of all, let’s define our attribute, adding this section to our <code>Polymer()</code> call:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">Polymer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    properties: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      name: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        type: String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>Now that we’ve defined our attribute THAT simply, we should use it somehow. Polymer allows us to define a method, which will be called once the component gets inserted into a webpage:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">Polymer</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ready: </span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">querySelector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'.message'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).innerHTML </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `Hello, ${</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">name</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}!`</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span></code></pre>
<p>As long as you’re riding <s>IOJS</s> NodeJS 5.0+, you can use the ES6 string interpolation feature, as in the example above =) Here, the <code>this</code> variable is bound to the <code>&#x3C;welcome-component></code> tag. So in order to change the <code>.message</code> tag’s HTML, we need to find it first. For this purpose I’ve used the HTML5 <code>querySelector</code> method.</p>
<p>Cool enough, right?</p>
<h2 id="conclusion-goes-here">Conclusion goes here</h2>
<p>To end-up this short tutorial on WebComponents, I would like to suggest you to read some other tutorials, especially the <a href="http://webcomponents.org/articles">WebComponents website</a>. And never stop trying something new!</p> </div>  </article><article> <h1> <a href="/2015/05/06/2015-05-06-memory-allocation-in-asm.html">Memory allocation in ASM</a> </h1> <time datetime="2015-05-06T10:20:04.000Z"> May 6, 2015 </time> <div class="content"> <p>Currently I am working on a long arithmetic problem at the university. This problem is much more complicated than I described or than a task I shall be describing now, but here’s the thing: I needed some part of memory to be allocated from within my function. And I needed this to be done in assembly.</p>
<!--more-->
<p>Thus, I created this piece of snippet code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">; void addition(int* x, int x_len, int* y, int y_len, int* &#x26;z, int* z_len);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">global</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _Z8additionPiiS_iRS_S_</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z8additionPiiS_iRS_S_:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p_x [ebp + 8]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x_len [ebp + 12]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p_y [ebp + 16]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y_len [ebp + 20]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p_z [ebp + 24]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p_z_len [ebp + 28]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">addition_allocate_mem:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; push x_len * 4 ; bytes to allocate</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    push</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> * </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; bytes to allocate</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    call</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> malloc </span><span style="color:#6A737D;--shiki-dark:#6A737D">; call malloc()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> esp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; undo push</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; save returned address from malloc</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, p_z</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">edx</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; z = malloc(...)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, p_z_len</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#D73A49;--shiki-dark:#F97583">dword</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; *z_len = elements</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">addition_fill_mem:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; fill with sample values</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, p_z</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> * </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#D73A49;--shiki-dark:#F97583">dword</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; mov eax, p_z</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> * </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#D73A49;--shiki-dark:#F97583">dword</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; mov eax, p_z</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; add eax, 2 * 4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> * </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#D73A49;--shiki-dark:#F97583">dword</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>There are, however, a few really interesting things in this code:</p>
<ul>
<li>naming of C++ functions, generated from assembly <em>(name mangling)</em></li>
<li>memory allocation itself</li>
<li>returning data from function via pointers… <strong>in assembly!</strong></li>
</ul>
<p>To demonstrate how this stuff works, we need some C++ code which uses our assembly function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;stdio.h></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;stdlib.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// our addition function for BIG integers</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// arguments are as follows: number and its length; two first pairs are the operands</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// and the last two arguments describe the returned big integer</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// thus, the result is z = x + y</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extern</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "C"</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> addition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x_len, </span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> y_len, </span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">z, </span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> z_len);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// helper function to convert BIG integers to strings</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">char*</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> bigint2str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> len</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    char</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#24292E;--shiki-dark:#E1E4E8">res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">char*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#6F42C1;--shiki-dark:#B392F0">malloc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((len </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#D73A49;--shiki-dark:#F97583"> sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> len; i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        res[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x[i] </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '0'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    res[len] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\0</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a_len </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // here we add nothing with nothing</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // and storing the result in a big integer `a`</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    addition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, a, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a_len);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"a = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%s\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">bigint2str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(a, a_len));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Comments in the code describe those moments which are important.</p>
<p>To compile these codes and link them into one executable, use these:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> nasm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -felf32</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test.asm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_asm.o</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test.cpp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -c</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_c.o</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_asm.o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_c.o</span></span>
<span class="line"></span></code></pre>
<p>Now, let’s talk about name mangling. It is really important. I shall not cover all the depths of this, only the parts, related to this article.</p>
<p>We see that our function,</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> addition</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x_len</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> y</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> y_len</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x26;</span><span style="color:#E36209;--shiki-dark:#FFAB70">z</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#E36209;--shiki-dark:#FFAB70"> z_len</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>is known as <code>_Z8additionPiiS_iRS_S_</code> in the assembly code.</p>
<p><em>What’s the..? What are all these strange prefixes?</em>  - you might ask.</p>
<p>Here’s the convention:</p>
<ol>
<li>functions are named with the underscore and an uppercase letter</li>
<li>function name’ length and the name itself follows that prefix</li>
<li>arguments are stored as their types only</li>
</ol>
<p>Argument type is encoded as well. For our example, we see these:</p>
<ol>
<li><code>Pi</code> - that means, literally, <code>pointer to integer</code></li>
<li><code>i</code> - that stands for <code>integer</code></li>
<li><code>S_</code> - that is the same as <code>Pi</code>, equal to <code>signed integer</code>, <strong>but</strong> for some reason <em>(yes, I do not know why this happens)</em> if you try to replace it with <code>Pi</code>, your function will not be found by a linker</li>
<li><code>RS_</code> - this is <code>a reference to a pointer to integer</code></li>
</ol>
<p>To get know those conventions better, you might refer to <a href="http://www.ofb.net/gnu/gcc/gxxint_15.html">g++ internals reference</a>.</p>
<p>You can decode demangled <em>(encoded)</em> function names as well. Just use <code>c++filt</code> utility:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> c++filt</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -n</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> _Z8divisionPiiS_iRS_S_</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">division(int*,</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> int,</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> int</span><span style="color:#005CC5;--shiki-dark:#79B8FF">*</span><span style="color:#032F62;--shiki-dark:#9ECBFF">,</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> int,</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> int</span><span style="color:#005CC5;--shiki-dark:#79B8FF">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x26;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">,</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> int</span><span style="color:#005CC5;--shiki-dark:#79B8FF">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>‘til next time!</p>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2015/04/23/2015-04-23-assembly-in-c-programs.html">Assembly in C++ programs</a> </h1> <time datetime="2015-04-23T11:18:11.000Z"> Apr 23, 2015 </time> <div class="content"> <h2 id="foreword">Foreword</h2>
<p>Writing code in assembly language in 2015 seems stupid and meaningless. Yet, it has a few huge benefits:</p>
<ol>
<li>understanding how computers / compilers / programs work</li>
<li>hardcore optimizations for performance-critical applications</li>
<li>just for fun!</li>
</ol>
<p>Well, in real life, I’ve never met conditions of such performance requirements when I should be writing some parts of application in ASM. Except, maybe, a handful of ACM ICPC problems.</p>
<p>Those are two merely big benefits to write in assembly. Thus, if you are not getting fun out of coding, you may not be interested in this blog.</p>
<p>This blog is mostly for academical purposes. People who study something like <em>low-level programming</em> at the university may be interested.</p>
<!--more-->
<h2 id="simplest-function-in-nasm">Simplest function in NASM</h2>
<p>And to start off, we will write a very simple program in assembly language. I shall be covering NASM language and compiler under Linux. MASM for Windows is much like that, but you should find your own way of compiling, linking and debugging all this code.</p>
<p>Our first program will do nothing. It will just contain globally available function, named <code>myfunc</code>.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    BITS </span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    section .text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        global myfunc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    myfunc:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        ret</span></span>
<span class="line"></span></code></pre>
<p>This is barely a something useful, but that’s how it looks like. A simple function, which does nothing, has no arguments and returns nothing.</p>
<p>Note these instructions: <code>enter 0, 0</code> and <code>leave</code>. These are dedicated to create a <strong>stack frame</strong>. Stack frame is a part of stack, where we can store variables. This part of stack is isolated, so we barely may hurt system when using stack operations (<code>push</code> and <code>pop</code>).</p>
<p>Actually, you may create the stack frame yourself, pushing <code>ESP</code> and <code>EBP</code> to a stack manually, then shifting <code>ESP</code> and rolling all this back at function’s end. But these instructions are simpler.</p>
<p><strong>NOTE:</strong> never forget the <code>leave</code> operation when using <code>enter</code> one! This may cause a <code>SEGFAULT</code> exceptions and you may spend hours searching for an error <em>(just as I did this night…)</em>.</p>
<p>To use our function in a C++ program, we need to perform three steps:</p>
<ol>
<li>add en external declaration for our function in C++</li>
<li>compile our C++ and NASM programs to object files <em>(</em>.o or <em>.obj)</em></li>
<li>link our object files into a single binary one</li>
</ol>
<p>So, we need to interference with assembly from within our C++ code. And declare an external function. Here’s how our dummy program may look like:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;stdio.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extern</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "C"</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> myfunc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    myfunc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Compiling this contains three steps, as I mentioned above:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -c</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test.cpp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_c.o</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> nasm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -felf32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test.asm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_asm.o</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_c.o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_asm.o</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test</span></span>
<span class="line"></span></code></pre>
<p>Let’s take a look over each of these closely.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -c</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test.cpp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_c.o</span></span>
<span class="line"></span></code></pre>
<p>This tells compiler a few things:</p>
<ol>
<li><code>-c</code>: only compile the code, do not link it (do not search for referenced functions)</li>
<li><code>-m32</code>: compile code in a 32-bit mode</li>
<li><code>-g</code>: add a debugger information</li>
<li><code>-o test_c.o</code>: write output to a <code>test_c.o</code> file</li>
</ol>
<p><em>Why 32-bit mode? Why not 64-bit?</em> - you may ask. Because some conventions of 64-bit mode are harder to understand and should be compared to 32-bit ones.</p>
<p>Now, compiling assembly code command:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> nasm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -felf32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test.asm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test_asm.o</span></span>
<span class="line"></span></code></pre>
<p>This provides compiler with these options:</p>
<ol>
<li><code>-felf32</code>: compile in a 32-bit mode</li>
<li><code>-g</code>: add a debugginng info</li>
<li><code>-o test_asm.o</code>: write output to an object file <code>test_asm.o</code></li>
</ol>
<p>Note the difference between <code>-m32</code> and <code>-felf32</code>. They mean the same, but are spelled differently.</p>
<h2 id="passing-arguments-and-returning-values">Passing arguments and returning values</h2>
<p>Now let’s make our function do something for a great good. For example, sum-up two numbers. We will end-up with this function declaration:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extern</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "C"</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum_two_numbers</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>The values <code>a</code> and <code>b</code> are integer. This means, each of them is <strong>4-byte wide</strong>. You can find sizes of different C types writing a very simple program:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;stdio.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(char) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(short) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">short</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(int) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(long) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(long long) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(float) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(double) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">double</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(long double) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(char*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">char*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(short*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">short*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(int*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(long*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(long long*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(float*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(double*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">double*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"size(long double*) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> bytes</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">sizeof</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>On my laptop this code printed this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>size(char) = 1 bytes</span></span>
<span class="line"><span>size(short) = 2 bytes</span></span>
<span class="line"><span>size(int) = 4 bytes</span></span>
<span class="line"><span>size(long) = 8 bytes</span></span>
<span class="line"><span>size(long long) = 8 bytes</span></span>
<span class="line"><span>size(float) = 4 bytes</span></span>
<span class="line"><span>size(double) = 8 bytes</span></span>
<span class="line"><span>size(long double) = 16 bytes</span></span>
<span class="line"><span>size(char*) = 8 bytes</span></span>
<span class="line"><span>size(short*) = 8 bytes</span></span>
<span class="line"><span>size(int*) = 8 bytes</span></span>
<span class="line"><span>size(long*) = 8 bytes</span></span>
<span class="line"><span>size(long long*) = 8 bytes</span></span>
<span class="line"><span>size(float*) = 8 bytes</span></span>
<span class="line"><span>size(double*) = 8 bytes</span></span>
<span class="line"><span>size(long double*) = 8 bytes</span></span>
<span class="line"><span></span></span></code></pre>
<div class="content-read-marker" data-fraction="25"></div>
<p>But when run in <strong>32-bit</strong> mode, these numbers are different:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>size(char) = 1 bytes</span></span>
<span class="line"><span>size(short) = 2 bytes</span></span>
<span class="line"><span>size(int) = 4 bytes</span></span>
<span class="line"><span>size(long) = 4 bytes</span></span>
<span class="line"><span>size(long long) = 8 bytes</span></span>
<span class="line"><span>size(float) = 4 bytes</span></span>
<span class="line"><span>size(double) = 8 bytes</span></span>
<span class="line"><span>size(long double) = 12 bytes</span></span>
<span class="line"><span>size(char*) = 4 bytes</span></span>
<span class="line"><span>size(short*) = 4 bytes</span></span>
<span class="line"><span>size(int*) = 4 bytes</span></span>
<span class="line"><span>size(long*) = 4 bytes</span></span>
<span class="line"><span>size(long long*) = 4 bytes</span></span>
<span class="line"><span>size(float*) = 4 bytes</span></span>
<span class="line"><span>size(double*) = 4 bytes</span></span>
<span class="line"><span>size(long double*) = 4 bytes</span></span>
<span class="line"><span></span></span></code></pre>
<p>The difference in atomic types seems really negligible, namely <code>long</code> and <code>long double</code> are <strong>4-byte longer</strong> in 64-bit mode. But when it comes to pointer types, we have twice longer variables.</p>
<p>That is the first, may be not so notable, but really important difference between <em>32-bit</em> and <em>64-bit</em> modes. This will be handy when it comes to <strong>arrays</strong>. But that will be covered later.</p>
<p>Now, the more notable difference hides in how arguments are passed to a function and how the function returns its result.</p>
<p>To show this difference, we will write a few short functions and look at their assembly code. Here they are:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'x'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">short</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">short</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">short</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2147483647</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3.14</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">double</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func11</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3.15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">double</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">double</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func13</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 3.16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#E36209;--shiki-dark:#FFAB70"> x</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'x'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.14</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func11</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func13</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    func14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Compile it with <code>g++</code> using this command:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -S</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -c</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -masm=intel</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test1.cpp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test1.asm</span></span>
<span class="line"></span></code></pre>
<p>I’ll explain this line’s options:</p>
<ol>
<li><code>-S</code>: generate assembly output</li>
<li><code>-m32</code>: generate 32-bit code</li>
<li><code>-c</code>: stop after compiling</li>
<li><code>-masm=intel</code>: use Intel’ assembly syntax; it is NASM’ syntax and thus more readable then GASM’ one</li>
<li><code>-o test1.asm</code>: write output to a <code>test1.asm</code> file</li>
</ol>
<p>I shall not show the full output of this program, because it’s huge. It takes almost 400 lines of assembly code (370, actually)! Yet, in 64-bit mode it is just a bit more than 300 lines of code (precisely, 318). 60 LOC difference, but still…</p>
<p>These 60 lines of code is caused by a C type sizes. See, in 32-bit mode we have registers of a size <code>32 / 8 = 4</code> bytes. This is enough to store <code>int</code> or <code>float</code> value. Byt when it comes to <code>long double</code> or even just <code>double</code>, we have 4 bytes more. In 64-bit mode we have 8-byte wide registers. So, even a <code>long double</code> variable may be stored in a single register.</p>
<p>But let’s go back and take a look at, let’s say, <code>func1</code> function assembly:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z5func1v:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">LFB0:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .cfi_startproc</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    push</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    ebp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .cfi_def_cfa_offset </span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .cfi_offset </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">esp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .cfi_def_cfa_register </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">120</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    pop</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ebp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .cfi_restore </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .cfi_def_cfa </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .cfi_endproc</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">LFE0:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .size   _Z5func1v, .-_Z5func1v</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .globl  _Z5func2c</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .type   _Z5func2c, @function</span></span>
<span class="line"></span></code></pre>
<p>Yeah, monstrous… Cleaning it up and using <code>enter</code> and <code>leave</code>, we have only this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z5func1v:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">120</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>See, the return value is stored in a <code>EAX</code> register. That’s how we should return values from our functions. When it comes to a larger data types, we may return values via <code>EDX:EAX</code> registers’ pair. Yeah, strange, but that is a <strong>convention</strong>.</p>
<p>Let’s take a look at the assembly code for a <code>func7</code> function and compare its variations for 32-bit mode vs 64-bit mode:</p>
<p><strong>32-bit func7:</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z5func7v:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2147483647</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p><strong>64-bit func7:</strong></p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z5func8l:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#D73A49;--shiki-dark:#F97583"> QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdi</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>See, there are two registers used in a 32-bit mode, <code>EAX = 2147483647</code> and <code>EDX = 0</code>. The second register is used for a sign value. If we’d change the return value for our C++ function to return a negative value:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> func7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#D73A49;--shiki-dark:#F97583"> -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2147483647</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>We will end-up with this code in a 32-bit mode:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2147483647</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"></span></code></pre>
<p>And in 64-bit mode it will have only one operation:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, -</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2147483647</span></span>
<span class="line"></span></code></pre>
<p>Now let’s take a look over the <code>func8</code> function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z5func8x:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    sub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> esp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#D73A49;--shiki-dark:#F97583"> DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#D73A49;--shiki-dark:#F97583"> DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<div class="content-read-marker" data-fraction="50"></div>
<p>We may clean it up removing all those <code>DWORD PTR</code> type hints:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z5func8x:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    sub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> esp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>All the memory “by the negative side” of <code>EBP</code> is dedicated to local variables. All the memory “by the positive side” of <code>EBP</code> is the one with arguments, passed to our function.</p>
<p>Taking that into account, we may rewrite our assembly function as this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">_Z5func8x:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x1 dword[ebp+8]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x2 dword[ebp+12]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmp1 dword[ebp-8]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmp2 dword[ebp-4]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    sub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> esp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, x1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmp1, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, x2</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmp2, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, tmp1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, tmp2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>Now it became more readable.</p>
<p>Here we have a few really important things:</p>
<ol>
<li><code>sub esp, 8</code> - this allocates 8 bytes of stack memory for our local variables</li>
<li><code>[ebp+8]</code> and <code>[ebp+12]</code> are two parts, each 4-byte long, of our argument of type <code>long long</code></li>
<li><code>[ebp-8]</code> and <code>[ebp-4]</code> are two parts of our return value; each 4-byte long; of type <code>long long</code></li>
<li>return value is split into two registers, namely, <code>EAX</code> (high-order bytes) and <code>EDX</code> (low-order bytes)</li>
</ol>
<p>That is how C passes arguments to a function in 32-bit mode. Arguments here are passed via stack. In 64-bit mode it’s a bit complicated: arguments are passed via registers and if they are not enough - through the stack. Registers are the following (ordered): <code>RDI</code>, RSI<code>, RDX</code>, RCX<code>, R8</code>, <code>R9</code>.</p>
<p>And the return values are stored in registers. Always. In both 32-bit and 64-bit modes.</p>
<h2 id="working-wit-arrays">Working wit arrays</h2>
<p>I shall not cover working with arrays in NASM itself, but rather working with already allocated memory in C.</p>
<p>Arrays are transfered to a function as pointers in C and C++. Under the hood, pointer is just an address to a memory block. To its beginning, actually. Knowing the <strong>size of each array element</strong> and <strong>elements count</strong>, we may perform any kind of operations simply iterating through a set of memory addresses.</p>
<p>Let’s for example calculate a sum of an array elements:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;stdio.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extern</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "C"</span><span style="color:#D73A49;--shiki-dark:#F97583"> int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sum</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, a</span><span style="color:#D73A49;--shiki-dark:#F97583">[]</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // 1 + 2 + 7 + 9 - 4 = 15</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"sum(a) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%d\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">sum</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n, a));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>And let’s create the function <code>sum</code> in NASM. To start off, we’ll use a function, receiving two arguments, <code>int</code> and <code>int*</code> and returning a zero.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">BITS </span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">section .text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">global</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sum</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">sum:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n dword [ebp + 8]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a dword [ebp + 12]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>Now what we would like to do is to add each element of array to our <code>result</code> variable <em>(oh, we do not have one yet!)</em>. To do this, we will use two registers: <code>ECX</code> to count how many elements we have added and <code>EAX</code> to store the sum. Each element’s address is <code>*a + 4 * i</code> or address of <code>a[0]</code> plus <code>4 bytes</code> times <code>i</code>, our element number.</p>
<p>The loop we would use is a reverse one: first we assign <code>ECX = n</code> and then decrement our <code>ECX</code> by one each loop iteration. We are decrementing <code>ECX</code> by one because it contains a number of elements at the beginning of our function. We may use even reverse approach (or a straight one in the meanings of C, when we count from the first element to the last): first, we assign <code>ECX = 0</code> and before going to the end of a loop we will compare <code>ECX</code> to <code>n</code> instead of zero.</p>
<p>In NASM we may calculate the address of each array element in the operand itself: <code>[ebx + 4 * ecx]</code>.</p>
<p>Now everything what we need is to add all those hints into a single program:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">BITS </span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">section .text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">global</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sum</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">sum:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n dword [ebp + 8]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a dword [ebp + 12]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; EAX = sum = 0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ebx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, a </span><span style="color:#6A737D;--shiki-dark:#6A737D">; EBX = *a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, n </span><span style="color:#6A737D;--shiki-dark:#6A737D">; ECX = i = n</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">add_loop:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebx</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> + </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> * </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ecx</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> - </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; EAX += a[i]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    dec</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; ECX --</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    cmp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    jg</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> add_loop </span><span style="color:#6A737D;--shiki-dark:#6A737D">; if ECX &#x26;gt; 0 then goto add_loop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; EAX contains the sum here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>Note that I subtract four bytes in an element address: <code>[ebx + 4 * ecx - 4]</code>. That’s because our i’th element starts at <code>*a + (i * 4)</code> byte, but we have <code>i = n</code> on the beginning. Thus, first iteration will try to add element, starting at <code>*a + (n * 4)</code> byte, which does not exist in our array <em>(the 5th element)</em>. So, we need to subtract one element’ size from our <code>[ebx + 4 * ecx]</code> address.</p>
<p>Now, if we would like to shorten our source a bit, we may use the <code>loop</code> operation. What it does, is compares <code>ECX</code> with zero and if it is greater than zero - it jumps to a label specified.</p>
<p>These two codes are completely identical for processor:</p>
<p><strong>manual loop</strong>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, n</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">add_loop:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; do something</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    dec</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    cmp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    jg</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> add_loop</span></span>
<span class="line"></span></code></pre>
<p><strong>with <code>loop</code> instruction</strong>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, n</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">add_loop:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; do something</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> add_loop</span></span>
<span class="line"></span></code></pre>
<p>We’ve just saved two lines of code!</p>
<div class="content-read-marker" data-fraction="75"></div>
<h2 id="floating-point-operations">Floating-point operations</h2>
<p>When working with floating-point data, we have <strong>seven</strong> registers, which could be used to perform operations on a floating-point arguments. We may <strong>store</strong> float data in a <strong>memory</strong> <em>(but never in registers!)</em>, but we may not perform operations on a float data contained in a memory. Just as we may not operate on a usual data, stored in a memory - we need to store it in registers first. Same thing here - store data on a <strong>floating-point stack</strong> and perform operations there. Then move results to the memory.</p>
<p>When writing a C++ functions working with floats, arguments are stored on a float stack and results are stored on a top of that stack. Yet, the other six cells of a float stack <strong>should</strong> be cleared when returning a value. Otherwise it may cause hard-to-find errors.</p>
<p>So, the basic operations we may run on a floats are:</p>
<ol>
<li>pushing to stack (<code>FLD</code>, <code>FLDZ</code>, <code>FLD1</code>, etc.)</li>
<li>floating-point arithmetics (<code>FADD</code>, <code>FMUL</code>, <code>FDIV</code>, <code>FSUB</code>, etc.)</li>
<li>arithmetics with popping from a stack into the top stack cell (<code>ST0</code>)</li>
<li>popping from a stack to a memory (<code>FST</code> operations)</li>
</ol>
<p>Yeah, these are a hell-yeah mix of both arithmetic operations and stack operations!</p>
<p>Let’s write a very short example, showing how to work with floats. Let it be a two-vector dot product function.</p>
<p>We shall write a function of this declaration:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;stdio.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extern</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "C"</span><span style="color:#D73A49;--shiki-dark:#F97583"> long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dot_product</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#E36209;--shiki-dark:#FFAB70"> n</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">v1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">v2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v1</span><span style="color:#D73A49;--shiki-dark:#F97583">[]</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#D73A49;--shiki-dark:#F97583"> double</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v2</span><span style="color:#D73A49;--shiki-dark:#F97583">[]</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // 3*4 + 5*2 = 12 + 10 = 22</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"dot_product(v1, v2) = </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%0.4f\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">dot_product</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n, v1, v2));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This one will calculate a dot product of two <em>n-element</em> vectors.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">BITS </span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">section .text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    global dot_product</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">dot_product:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n dword[ebp + 8]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v1 dword[ebp + 12]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> v2 dword[ebp + 16]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ecx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, n</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ebx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, v2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fldz</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; stack: 0 ( = tail)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">add_loop:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fld</span><span style="color:#D73A49;--shiki-dark:#F97583"> tword</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; stack: v1, tail</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fld</span><span style="color:#D73A49;--shiki-dark:#F97583"> tword</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#6A737D;--shiki-dark:#6A737D">; stack: v2, v1, tail</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fmulp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; stack: v2 * v1, tail</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    faddp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; stack: v2 * v1 + tail</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> edx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    add</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ebx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> add_loop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">just_exit:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    leave</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>The algorithm of a code above may be written as follows:</p>
<ol>
<li>load zero to a floating stack <em>(ST: <code>[0 nan nan nan nan nan nan]</code>)</em></li>
<li><em>in a loop</em> load _i_th element of <code>v1</code> to a floating stack <em>(ST: <code>[3 0 nan nan nan nan nan]</code>)</em></li>
<li><em>in a loop</em> load _i_th element of <code>v2</code> to a floating stack <em>(ST: <code>[4 3 0 nan nan nan nan]</code>)</em></li>
<li><em>in a loop</em> multiply first two elements of a floating stack, write the result to <code>ST1</code> and pop stack head <em>(ST: <code>[12 0 nan nan nan nan nan]</code>)</em></li>
<li><em>in a loop</em> add first two elements of a stack, write the result to <code>ST1</code> and pop stack head <em>(ST: <code>[12 nan nan nan nan nan nan]</code>)</em></li>
<li><em>in a loop</em> add 12 bytes to our <code>i</code></li>
<li><em>in a loop</em> add 12 bytes to our <code>t</code></li>
</ol>
<p>At the end of our loop, precisely, at our <code>just_exit</code> label, we will have floating stack with the only element on its top, the dot product of our vectors <code>v1</code> and <code>v2</code>. This value will be returned to our C++ program.</p>
<h2 id="a-few-words-on-debugging">A few words on debugging</h2>
<p>As you remember <em>(if not - just look above)</em> we added a <em>debugger info</em> option when compiling our programs. Now let’s use it.</p>
<p>Let’s have some buggy program. For example, the one which calculates a rectangular parallelepiped’s surface area and volume:</p>
<p><strong>C program</strong>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="c"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">#include</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> &#x3C;stdio.h></span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">extern</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> surface_and_volume</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> a</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> b</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#E36209;--shiki-dark:#FFAB70"> c</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">v</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">float</span><span style="color:#D73A49;--shiki-dark:#F97583"> *</span><span style="color:#E36209;--shiki-dark:#FFAB70">s</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  float</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> surface </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, volume </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  surface_and_volume</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">volume, </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">surface);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  printf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"volume: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%0.3f</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> surface: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%0.3f\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, volume, surface);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><strong>NASM program</strong>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">BITS </span><span style="color:#005CC5;--shiki-dark:#79B8FF">32</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">section .text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    global surface_and_volume</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">surface_and_volume:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    enter</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a dword[ebp+8]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b dword[ebp+12]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c dword[ebp+16]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> vol_ptr dword [ebp+20] ; a*b*c</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    %</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> surf_ptr dword [ebp+24] ; a*a*2 + b*b*2 + c*c*2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, vol_ptr</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ebx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, surf_ptr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fldz</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st6</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fldz</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st5</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fldz</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fld</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c </span><span style="color:#6A737D;--shiki-dark:#6A737D">; st3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fld</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b </span><span style="color:#6A737D;--shiki-dark:#6A737D">; st2</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fld</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="color:#6A737D;--shiki-dark:#6A737D">; st1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fldz</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; calculate volume</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fsub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = 0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st1</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fmul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st2</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 *= b</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fmul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st3</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 *= c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fst</span><span style="color:#D73A49;--shiki-dark:#F97583"> dword</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; calculate surface</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fsub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = 0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st1</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fmul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st2</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 *= b</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st4 = a*b</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fsub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = 0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st1</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fmul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st3</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 *= c</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st5 = a*c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fsub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = 0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st2</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = b</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fmul</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st6 = b*c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fsub</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = 0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st5</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st6</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = a*b + a*c + b*c</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fadd</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> st0</span><span style="color:#6A737D;--shiki-dark:#6A737D"> ; st0 = 2*(a*b + a*c + b*c)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">just_exit:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fst</span><span style="color:#D73A49;--shiki-dark:#F97583"> dword</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ebx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    ; free float stack</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fstp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fstp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fstp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fstp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fstp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    fstp</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ret</span></span>
<span class="line"></span></code></pre>
<p>Compile it as usual and run with GDB:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -c</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3.c</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3_c.o</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> nasm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -felf32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3.asm</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3_asm.o</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> g++</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -m32</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -g</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3_asm.o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3_c.o</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -o</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> gdb</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> test3</span></span>
<span class="line"></span></code></pre>
<p>Now, when you’re in a debugger’ console, you may run debugging commands. Here are a few of them:</p>
<ul>
<li><code>r</code> or <code>run</code> will run your program, stopping at first breakpoint</li>
<li><code>b func_name</code> or <code>break func_name</code> will set a breakpoint at the first line of <code>func_name</code></li>
<li><code>p var</code> or <code>print var</code> will show the <code>var</code> variable contents in decimal format. For registers its <code>$eax</code> and so on</li>
<li><code>p /x var</code> or <code>print /x var</code> will show the <code>var</code> variable contents in hexadecimal format</li>
<li><code>x mem_addr</code> will show the contents of memory at <code>mem_addr</code></li>
<li><code>x/4 mem_addr</code> will show <strong>four</strong> 4-byte pieces of memory at <code>mem_addr</code></li>
<li><code>disassemble</code> will print out the assembly code for current function</li>
<li><em>(from breakpoint)</em> <code>c</code> or <code>continue</code> will run program until it hits end or breakpoint</li>
<li><em>(from breakpoint)</em> <code>ni</code> will step one instruction</li>
<li><em>(from breakpoint)</em> <code>n</code> or <code>next</code> will step over the next function <em>(in C)</em>; for ASM it’s same as <code>ni</code></li>
<li><em>(from breakpoint)</em> <code>s</code> or <code>step</code> will step in the next function <em>(in C)</em>; for ASM it’s same as <code>ni</code></li>
<li><code>info r</code> shows current registers’ state</li>
<li><code>info float</code> shows current co-processor state</li>
<li><kbd>Ctrl+D</kbd> stands for <code>quit</code></li>
</ul>
<p>Now, using GDB, try to find out what’s wrong with the program I’ve suggested!</p>
<h2 id="afterword">Afterword</h2>
<p>This is currently most of important things I’ve learnt at the university. This is pretty much for a beginner. And this information is really for those who have fun writing code or those who are made to write some excercises at university.</p>
<p>As for me, now ASM does not look so scary now =) But I like writing more high-level code <em>(in C at least!)</em> because it takes less time to do more.</p>
<div class="content-read-marker" data-fraction="100"></div> </div>  </article><article> <h1> <a href="/2015/04/07/2015-04-06-shootthem.html">ShootThem!</a> </h1> <time datetime="2015-04-06T17:12:11.000Z"> Apr 7, 2015 </time> <div class="content"> <p>A few days ago I’ve found my old game, <em>ShootThem!</em> sources.</p>
<p>Half of hour being trying to run it, and viola!</p>
<p>I have hosted sources with all the dependencies <a href="https://github.com/shybovycha/shoot-them">on GitHub</a>.</p>
<p>One has no story (in-game, but has one written before the game presentation on a programming competition for students in Dnepropetrovsk). It has <em>(almost)</em> no colors. No code structure or architecture. No animations. </p>
<p>It is really plain.</p>
<p>Yet, it was and still it <strong>is</strong> a starting point for me 😁</p>
<p>Here are some of game screenshots:</p>
<div style="display:flex; flex-direction:column; align-content:center;">
<div><img src="/images/tumblr/shootthem/tumblr_inline_nmea8sxPPW1qh5oee_640.png" loading="lazy" data-orig-height="768" data-orig-width="1366"></div>
<div><img src="/images/tumblr/shootthem/tumblr_inline_nmea966kmi1qh5oee_640.png" loading="lazy" data-orig-height="768" data-orig-width="1366"></div>
<div><img src="/images/tumblr/shootthem/tumblr_inline_nmea9pD5Nj1qh5oee_640.png" loading="lazy" data-orig-height="768" data-orig-width="1366"></div>
<div><img src="/images/tumblr/shootthem/tumblr_inline_nmeaa4oVAD1qh5oee_640.png" loading="lazy" data-orig-height="768" data-orig-width="1366"></div>
<div><img src="/images/tumblr/shootthem/tumblr_inline_nmeaaiOKq51qh5oee_640.png" loading="lazy" data-orig-height="768" data-orig-width="1366"></div>
</div> </div>  </article><article> <h1> <a href="/2015/03/29/2015-03-29-running-qt-mysql-application.html">Running Qt + MySQL application</a> </h1> <time datetime="2015-03-29T08:47:22.000Z"> Mar 29, 2015 </time> <div class="content"> <p>Yesterday I tried to run my university project made with Qt and MySQL. But all I got was strange error message, saying <code>QMYSQL driver is not loaded</code> whilst loaded driver list actually included that one.</p>
<p>Searching all over the internet up ‘til 2 AM and recompiling the whole Qt gave no result except time being wasted. Yeah, and 90% of search results were tutorials on how to recompile Qt MySQL plugin under Windows.</p>
<p>Yet in the morning I found solution and it was beautifully simple! I just performed one step from <a href="http://doc.qt.io/qt-5/deployment.html">Deploying Qt applications</a>, actually just copied the <code>plugins/</code> directory to the dir where the application executable lives (<code>build-debug/</code> or <code>build-release/</code> for my project; I hate the default <code>build-#{ProjectName}-Desktop_5_4_1-Debug/</code> paths); included the <code>sqldrivers/</code> directory there (just copied) and created (a bit tuned although) the <code>qt.conf</code> file. That file just pointed the plugins path to the custom one:</p>
<pre><code>[Paths]
Prefix=.
Plugins=./plugins
</code></pre>
<p>To sum everything up:</p>
<ol><li>create a <code>plugins/</code> directory in your build directory</li>
<li>copy <code>Qt/5.4/Src/qtbase/plugins/platforms/</code> there</li>
<li>copy <code>Qt/5.4/gcc_64/plugins/sqldrivers/</code> there too</li>
<li>create <code>qt.conf</code> file in build directory and fill it as mentioned above</li>
</ol><p>And one more hint before the end: to debug why your Qt plugins fail use this application startup switch: <code>QT_DEBUG_PLUGINS=1 ./app_name</code> - this will display plugins debug information.</p> </div>  </article><article> <h1> <a href="/2015/03/27/2015-03-27-tinyjavacode-this-one-was-super-easy-so-i-did-a.html">Tiny java code...</a> </h1> <time datetime="2015-03-27T07:10:28.000Z"> Mar 27, 2015 </time> <div class="content"> <blockquote><p><a href="http://www.reddit.com/r/dailyprogrammer/comments/qlwrc/372012_challenge_19_easy/" rel="noreferrer">This one</a> was super easy so I did a quick comparison of a couple of ways you can do it; the goal is to count all the alphanumeric (a-zA-Z0-9) characters in the text of a Sherlock Holmes book. There’s probably other ways do do it because there’s lots of ways to do literally anything, but the fastest one here is stripping out all non-alphanumeric characters (\W).</p></blockquote>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//*********************************************//</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//                                             //</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//        EASY DAILY PROGRAMMING TASK #19      //</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//        ALPHANUMERIC CHARACTER COUNTING      //</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//                                             //</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">//*********************************************//</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> count1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(String text) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> System.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">currentTimeMillis</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">char</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> c </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toCharArray</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((c </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">matches</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"[a-zA-Z0-9]"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            count</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> end </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> System.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">currentTimeMillis</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    System.out.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Count 1: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> " Time taken: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (end </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> count2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(String text) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> System.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">currentTimeMillis</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    int</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> count1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    text </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">replaceAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">w"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> end </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> System.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">currentTimeMillis</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    System.out.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Count 2: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (count1 </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()) </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> " Time taken: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (end </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#D73A49;--shiki-dark:#F97583"> void</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> count3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(String text) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> System.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">currentTimeMillis</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    text </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">replaceAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\\</span><span style="color:#032F62;--shiki-dark:#9ECBFF">W"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    long</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> end </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> System.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">currentTimeMillis</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    System.out.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">println</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Count 3: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> text.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> " Time taken: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> +</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (end </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Countiung all alphanumeric characters in Sherlock.txt:</span></span>
<span class="line"><span>Count 1: 432188 Time taken: 269</span></span>
<span class="line"><span>Count 2: 432188 Time taken: 53</span></span>
<span class="line"><span>Count 3: 432188 Time taken: 22</span></span>
<span class="line"><span></span></span></code></pre>
<p><a href="http://tinyjavacode.tumblr.com/post/114715031583/this-one-was-super-easy-so-i-did-a-quick" class="tumblr_blog">tinyjavacode</a>:</p> </div>  </article><article> <h1> <a href="/2015/03/26/2015-03-25-the-new-hardcore.html">The new hardcore</a> </h1> <time datetime="2015-03-25T18:07:45.000Z"> Mar 26, 2015 </time> <div class="content"> <img src="/tumblr_files/tumblr_nls50x91hr1qio88bo1_1280.png">
<p>Trying some new hardcore - Assembly in Emacs 😁</p> </div>  </article> </section> </main> <footer> <nav> <div class="prev"> <a href="/page7.html" class="next">&larr; Previous page</a> </div> <div class="current">Page #8 of 11</div> <div class="next"> <a href="/page9.html" class="next">Next page &rarr;</a> </div> </nav> </footer> </body></html>