<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/2020/11/07/2020-11-07-erlang-example-2.html/"><!-- Primary Meta Tags --><title>Erlang example 2.0</title><meta name="title" content="Erlang example 2.0"><meta name="description"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;background:linear-gradient(var(--gray-gradient)) no-repeat;color:rgb(var(--gray));text-align:center}.social-links[data-astro-cid-sz7xmlte]{display:flex;justify-content:center;gap:1em;margin-top:1em}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]{text-decoration:none;color:rgb(var(--gray))}.social-links[data-astro-cid-sz7xmlte] a[data-astro-cid-sz7xmlte]:hover{color:rgb(var(--gray-dark))}main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body data-astro-cid-bvzihdzo> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="hero-image" data-astro-cid-bvzihdzo>  </div> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2020-11-07T02:42:24.000Z"> Nov 7, 2020 </time>  </div> <h1 data-astro-cid-bvzihdzo>Erlang example 2.0</h1> <hr data-astro-cid-bvzihdzo> </div>  <p>Quite some time ago I’ve published a <a href="/tumblr/2015/01/28/erlang-practice.html">blogpost about Erlang</a>. It claimed to present a <em>short intro to distributed programming in Erlang</em>. But it turned to be a very simple communication application, nothing super-exciting.</p>
<p>In this post I would like to elaborate more on the topic of Erlang, for a number of reasons:</p>
<ul>
<li>it is a pretty simple language itself</li>
<li>the distributed systems topic gets more and more of my attention these days</li>
<li>when I was looking at Erlang, I would love to see a more advanced tutorial myself <em>(more practical things and more Erlang platform features showcased)</em></li>
</ul>
<!--more-->
<h2 id="language-features">Language features</h2>
<p>Kicking off with the language features, let’s discover few data structures available out of the box.</p>
<p>I was thinking for few a while about what could be showcased in Erlang. I think the system we’ll develop closer to the end of this blog
is quite nice.</p>
<h3 id="tuples">Tuples</h3>
<p>As you might remember from the <a href="/2020/01/10/erlang-in-5-minutes.html">quick introduction to Erlang</a>, tuples are defined like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">X </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">elt1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">elt2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">elt3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">elt5</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }.</span></span>
<span class="line"></span></code></pre>
<p>Now, since there are no datatypes or alike in Erlang, we can use tuples to denote complex data structures, like trees, for example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Tree </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, Right }.</span></span>
<span class="line"></span></code></pre>
<p>With this, let us create a module to work with binary trees:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">binary_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(N) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, N, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewNode </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Value),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, NewNode };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewNode </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Value),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, NewNode, Right };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Right, Value) };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Left, Value), Right }.</span></span>
<span class="line"></span></code></pre>
<p>The idea behind <code>insert_into_tree/2</code> is that every call has to return the copy of a current tree with a recursively modified leaf.</p>
<p>Now, to test the binary tree, we can define a function that checks if a node is in tree or not:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Left, Right }, Value) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">=:=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Right, Value);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Parent, Left, Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Left, Value).</span></span>
<span class="line"></span></code></pre>
<p>You might want to compile the module now, by running</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">$erlc binary_tree.erl</span></span>
<span class="line"></span></code></pre>
<p>We can run the program to construct a tree and check if some element is in there:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">binary_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Tree </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">22</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  X1 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  X2 </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  X1Present </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  X2Present </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fwrite</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Tree: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">~p~n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [Tree]),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fwrite</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~p</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> in tree (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~p</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [X1, X1Present]),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fwrite</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~p</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> in tree (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~p</span><span style="color:#032F62;--shiki-dark:#9ECBFF">)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [X2, X2Present]).</span></span>
<span class="line"></span></code></pre>
<p>This is a bit cumbersome, so let’s use the <code>lists:foldl/3</code> function together with a list of values to construct the tree in a more convenient way:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foldl</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Values </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">22</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Tree </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foldl</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Elt, Acc) -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Acc, Elt) </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), Values)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  % ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  .</span></span>
<span class="line"></span></code></pre>
<h3 id="records">Records</h3>
<p>There is a mechanism in Erlang called <em>records</em>. It is basically a syntactic sugar around tuples, just as we have used them above, but it gives a little bit more clarity for pattern matching when writing code:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { value, left, right }).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(N) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> #</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Left, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewNode </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Value),</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    #</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Left, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NewNode };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewNode </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Value),</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    #</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NewNode, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Right };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Left, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    #</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Left, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Right, Value) };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Left, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    #</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Left, Value), right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Right }.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">=:=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Right }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Right, Value);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Left, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Parent </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Left, Value).</span></span>
<span class="line"></span></code></pre>
<div class="content-read-marker" data-fraction="25"></div>
<p>Well, it does make pattern matching more explicit, but the code has just blown up!
Luckily, Erlang does provide a syntactic sugar to read a specific field of a record and to update specific record’ fields:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.right </span><span style="color:#D73A49;--shiki-dark:#F97583">=:=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6A737D;--shiki-dark:#6A737D"> % read specific fields from Tree, namely - right and value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewNode </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Value),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NewNode }; </span><span style="color:#6A737D;--shiki-dark:#6A737D">% update only the tree.right value, leave the rest values of Tree unchanged</span></span>
<span class="line"></span></code></pre>
<p>This makes a module a bit shorter again:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { value, left, right }).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(N) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> #</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> N, left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.right </span><span style="color:#D73A49;--shiki-dark:#F97583">=:=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewNode </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Value),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NewNode };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.left </span><span style="color:#D73A49;--shiki-dark:#F97583">=:=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    NewNode </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> create_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Value),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NewNode };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ right </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.right, Value) };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ left </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> insert_into_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.left, Value) }.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">nil</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">=:=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.right, Value);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree, Value)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  when</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    is_in_tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Tree</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">tree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.left, Value).</span></span>
<span class="line"></span></code></pre>
<h3 id="maps">Maps</h3>
<p>Well, having records is good and nice. But what if we want a hashmap?
Consider a trie data structure, where it has a value and a map of characters to nodes.
Technically, we could have a list of nodes and iterate over them whenever we need to access a specific child.
But that would be a waste of time.</p>
<p>Luckily, Erlang does provide the <code>maps</code> module:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#6F42C1;--shiki-dark:#B392F0">foldl</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#6F42C1;--shiki-dark:#B392F0">is_key</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">put</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">insert</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">contains</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { stop, children }).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> #</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ stop </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, children </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> #{} }.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Trie, []) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Trie</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { stop </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">insert</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Trie, [Char|Chars]) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Children </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Trie</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.children,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  IsChild </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">is_key</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Char, Children),</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    IsChild </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      SubTrie </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Char, Children),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      NewSubTrie </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> insert</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SubTrie, Chars),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      NewChildren </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">put</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Char, NewSubTrie, Children),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      Trie</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { children </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NewChildren };</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      SubTrie </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      NewSubTrie </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> insert</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SubTrie, Chars),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      NewChildren </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">put</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Char, NewSubTrie, Children),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      Trie</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { children </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> NewChildren }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">contains</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Trie, []) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Trie</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.stop;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">contains</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Trie, [Char|Chars]) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Children </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Trie</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">trie</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.children,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  IsChild </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">is_key</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Char, Children),</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    IsChild </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      SubTrie </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Char, Children),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      contains</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SubTrie, Chars);</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      false</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>Quite unfortunately, pretty much none of the handy maps syntax is implemented yet.</p>
<h2 id="platform-features">Platform features</h2>
<p>Let’s start with few simple but practical examples.</p>
<h3 id="web-server">Web-server</h3>
<p>Erlang comes packed with a lot of features. One of them is bundled web-server. Some time ago I’ve published a post about a very simple Tetris game, which I’ve crafted one evening. The thing is: that game is nothing more than a single HTML page. What we can do now is start a web server, which will listen for connections on <code>8080</code> port and serve them a static file with the game.</p>
<p>The code is pretty simple:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">simple_web_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">run_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">run_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  inets</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  inets</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">httpd</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [{ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">port</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">8080</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">server_name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"httpd_test"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">server_root</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"."</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">document_root</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"."</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">bind_address</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">any</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">stop_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Pid) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  inets</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">httpd</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid).</span></span>
<span class="line"></span></code></pre>
<p>But modern web applications require a server that will have some sort of an API. Take REST for example - when a URL of a specific format with specific HTTP method (<code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>, etc.) is hit on the server, some behaviour is expected. For instance, <code>curl -X GET http://server.address/posts</code> request is expected to return a list of all <code>Post</code> entities (whatever that means in the context of an application), whereas <code>curl -X PUT http://server.address/posts -d '{ "title": "post #1", "content": "blah" }' -H "Content-Type: application/json"</code> is expected to create a <code>Post</code> entity with fields <code>title</code> and <code>content</code> from the request.</p>
<p>The bundled Erlang HTTP server, <code>httpd</code> kind of allows for that, except the URLs will be in a format <code>cgi-bin/erl/mymodule:mymethod</code>, which is not exactly what we want.
But just for the sake of example, here’s how it would look like implemented with httpd:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">posts</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, Env, Input) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mod_esi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">deliver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Content-Type:application/json</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mod_esi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">deliver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">do_get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Input)).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">do_get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Input) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  QueryParams </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> uri_string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">dissect_query</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Input),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { _IdParamName, Id } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> lists</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">search</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ Key, _Value }) -> Key </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "id"</span><span style="color:#D73A49;--shiki-dark:#F97583"> end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">id</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">:1,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">title</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">post 1</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">content</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">blah</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, Env, Input) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mod_esi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">deliver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Content-Type:application/json</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mod_esi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">deliver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">do_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">do_all</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"[{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">title</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">post 1</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">content</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">blah</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\"</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}]"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, Env, Input) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mod_esi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">deliver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Content-Type:application/json</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mod_esi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">deliver</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(SessionID, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">do_create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Input)).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">do_create</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Input) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  % here the Input variable will contain the POST request' body, which will most likely be a JSON, which we also will need to parse</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Status: 204 No Content"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].</span></span>
<span class="line"></span></code></pre>
<p>As you can see, this is a pretty complex example, since the API of <code>httpd</code> module is rather low-level - we have to explicitly form a HTTP response and send it back to clients.
Although not impossible, it is just not so pleasant development experience as it could be. Read on to see how it could be significantly improved.</p>
<div class="content-read-marker" data-fraction="50"></div>
<h3 id="mnesia">Mnesia</h3>
<p>Erlang is bundled with a distributed real-time database called Mnesia!</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">visit_tracker</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  create_schema</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  create_account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  find_account_by_email</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { site_id, ip, browser, location }).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">site</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { id, account_id, name, visits }).</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">record</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, { id, email, sites }).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">init</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create_schema</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span><span style="color:#6F42C1;--shiki-dark:#B392F0">node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()]),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">().</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_schema</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create_table</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">visits</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">attributes</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">record_info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">fields</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">record_name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } ]),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create_table</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">sites</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">bag</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">attributes</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">record_info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">fields</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">site</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">record_name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">site</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } ]),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">create_table</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">accounts</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">bag</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">attributes</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">record_info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">fields</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) }, { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">record_name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } ]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">%% temporarily forcing to put ID by hand</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Id, Email) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Txn </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %% record creation syntax is similar to dictionary / map creation syntax: `#record_name{ key = Value }`</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">write</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">accounts</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Id, email </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Email, sites </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [] }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">write</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">transaction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Txn).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_site</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Account, Id, Name) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  AccId </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Account</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.id,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Txn </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">read</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">accounts</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, AccId),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %% mnesia:write(Account),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">write</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">sites</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">site</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ account_id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> AccId, id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Id, name </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Name, visits </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [] }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">write</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">transaction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Txn).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Site, Ip) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  create_visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Site, Ip, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">unknown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">unknown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Site, Ip, Browser) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  create_visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Site, Ip, Browser, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">unknown</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_visit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Site, Ip, Browser, Location) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  %% retrieving ID field from the Site parameter</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  SiteId </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Site</span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">site</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.id,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Txn </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">read</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">sites</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, SiteId),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %% since table name is different to record name, we have to pass table name as the first argument</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">transaction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Txn).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">find_account_by_email</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Email) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Txn </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %% select semantics:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %%</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %%   mnesia:select(Table_name, [ Query, Conditions, ResultMapping ])</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %%</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %% here,</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %%  * Query defines the generic pattern to match agains</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %%  * Conditions or Guard is a list of tuples defining the clauses: { operator, field, value }: { '>', 'id', 10 }</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %%  * ResultMapping is what will be returned; you can use the pattern matching from the Query param here</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %%</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    %% map / dictionary creation: #{ key => value }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ Acc ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">select</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">accounts</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ { </span><span style="color:#D73A49;--shiki-dark:#F97583">#</span><span style="color:#6F42C1;--shiki-dark:#B392F0">account</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{ id</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">'$1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, email</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Email, sites</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">'$2'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, [], [ #{ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">id</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> '$1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">email</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Email, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">sites</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> '$2'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } ] } ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    Acc</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mnesia</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">transaction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Txn).</span></span>
<span class="line"></span></code></pre>
<h2 id="ecosystem">Ecosystem</h2>
<p>Using <a href="https://hex.pm/">Rebar 3</a> (or <code>Hex</code> for Elixir) is relatively easy. Yet it opens access to thousands of packages available out there.</p>
<h3 id="creating-a-project">Creating a project</h3>
<p>To create a project with rebar3 support, you can now use <code>rebar3 new &#x3C;template> &#x3C;app-name></code>. For just an application, you can use <code>app</code> template name.
For libraries - use <code>lib</code>. Simple!</p>
<p>To add a dependency, edit the <code>rebar.config</code> file in the application directory and change the <code>deps</code> dictionary:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">deps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">epsql</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">~></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 4.6.0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#6A737D;--shiki-dark:#6A737D">% PostgreSQL package</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]}.</span></span>
<span class="line"></span></code></pre>
<p>Then, since a single project can have multiple applications, one needs to add the dependency to each application which requires that dependency. This
is done in the <code>*.app.src</code> file in the <em>application</em> root directory (for instance, <code>myapp/appname/appname.app.src</code>):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">application</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">appname</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> [{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">description</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">registered</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, []},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">modules</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, []},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">applications</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">kernel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                  stdlib</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                  epsql</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">mod</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">appname_app</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, []}},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">env</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, []}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]}.</span></span>
<span class="line"></span></code></pre>
<p>Building the project with dependencies is then done using the <code>rebar3 compile</code> command from the <em>project</em> root directory (following the example above, <code>myapp/</code>).</p>
<p>To run an application, use the <code>rebar3 shell --apps &#x3C;comma-separated-app-names></code> from the <em>project</em> root directory (e.g. <code>rebar3 shell --apps appname</code>).</p>
<h3 id="postgresql">PostgreSQL</h3>
<p>Working with PostgreSQL in Erlang is possible through one of many libraries available in <a href="https://hex.pm/packages">rebar3 repository</a>.
In this blog I will use <a href="https://github.com/epgsql/epgsql"><code>epsql</code></a> library.</p>
<p>For the most part, when working with the database, you only need a handful of features from the database library:</p>
<ul>
<li>connecting to the database with specific parameters (connection pool size, security options, timeouts, etc.)</li>
<li>executing prepared statements (allowing the DB communication layer - the library - to safely inject query parameters, preventing the SQL injection)</li>
<li>support for <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> statements (with very few exceptions, these form 95% of all the use cases, in my experience)</li>
<li>retrieve query results (as list of dictionaries of sorts)</li>
</ul>
<div class="content-read-marker" data-fraction="75"></div>
<p>epsql library provides all of these with the following functions:</p>
<ul>
<li><code>epgsql:connect/1</code> (and its variations) in combination with <code>epgsql:close/1</code> to close the connection, if ever needed; <code>epgsql:connect/1</code> takes a dictionary of options, including
<ul>
<li><code>host</code></li>
<li><code>username</code> and <code>password</code>; optionally - <code>ssl</code> and <code>ssl_opts</code> for secure connections</li>
<li><code>database</code></li>
<li><code>timeout</code> - for limiting the connection time</li>
</ul>
</li>
<li><code>epgsql:squery/2</code> and <code>epgsql:equery/3</code> to query the database
<ul>
<li><code>epgsql:squery/2</code> will execute a simple query (takes connection and a query string as parameters, returns a tuple of status - <code>ok</code> or <code>error</code>, list of columns and list of rows)</li>
<li><code>epgsql:equery/3</code> will create an unnamed prepared statement (yes, you can have named prepared statements for future reuse), safely inject the query parameters (specified as <code>$1</code>, <code>$2</code>, <code>$3</code> and so on in query string, the second argument) passed as the third argument (a list of parameters) and execute the statement on a database connection (passed as the first argument)</li>
</ul>
</li>
</ul>
<p>Here are few simple examples of the above functions:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">connect_to_blog_db</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, C } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> epsql</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">connect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(#{ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">host</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "localhost"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">username</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "root"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">password</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "****"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">database</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "blog"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  C.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">create_blog</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Title, Content) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  C </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> connect_to_blog_db</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Count } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> epsql</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">equery</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(C, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"INSERT INTO posts (title, content) VALUES ($1, $2)"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Title, Content ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Count </span><span style="color:#D73A49;--shiki-dark:#F97583">==</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">get_blogs</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  C </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> connect_to_blog_db</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Columns, Rows } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> epsql</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">squery</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(C, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"SELECT title, content FROM posts"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Rows.</span></span>
<span class="line"></span></code></pre>
<h3 id="mochi-http-server">Mochi HTTP server</h3>
<p>As shown above, the default HTTP server bundled with Erlang standard library (OTP) is rather low-level.
There are few options in rebar3 package repository which significantly improve the situation. One of them is <a href="https://github.com/mochi/mochiweb/"><code>mochiweb</code></a>.</p>
<p>The web server with Mochi could look like this (slightly more complex than the one described above with <code>httpd</code>):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">http_sample</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#D73A49;--shiki-dark:#F97583">define</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">HTTP_OPTS</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  [ { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, {</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#6F42C1;--shiki-dark:#B392F0">MODULE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">port</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4000</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">http_4000</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } ]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Http } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_http</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#6F42C1;--shiki-dark:#B392F0">HTTP_OPTS</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Pid </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> spawn_link</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">fun</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Http) </span><span style="color:#D73A49;--shiki-dark:#F97583">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  register</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">http_sample</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Pid),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  http_sample</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">method</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Req) </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    'GET'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_resource</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    'PUT'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">put_resource</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">method_not_allowed</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">get_resource</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Path </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Req),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  % note: io:format(FmtString, Params) would print to STDOUT</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  % whereas io_lib:format(FmtString, Params) will return a formatted string</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Body </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> io_lib</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">format</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, Resource '</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~s</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Path ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Headers </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [{ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Content-Type"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"text/plain"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">respond</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">200</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Headers, Body }, Req),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">put_resource</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ContentType </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get_header_value</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Content-Type"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Req),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ReqBody </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">recv_body</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">respond</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">201</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [], </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"201 Created</span><span style="color:#005CC5;--shiki-dark:#79B8FF">\r\n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, Req),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">method_not_allowed</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Req) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Path </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">path</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Req),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Method </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">get</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">method</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, Req),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  Body </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> io_lib</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">format</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Method </span><span style="color:#005CC5;--shiki-dark:#79B8FF">~s</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> on path </span><span style="color:#005CC5;--shiki-dark:#79B8FF">~s</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> is not supported"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [ Method, Path ]),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  mochiweb_request</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">respond</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">405</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [], Body }, Req),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Http) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  receive</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -></span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">      ok</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mochiweb_http</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Http),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      exit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">normal</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    _</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#005CC5;--shiki-dark:#79B8FF">ignore</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#6F42C1;--shiki-dark:#B392F0">MODULE</span><span style="color:#24292E;--shiki-dark:#E1E4E8">):</span><span style="color:#6F42C1;--shiki-dark:#B392F0">loop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Http).</span></span>
<span class="line"></span></code></pre>
<p>For this code to run, you should do few little extra steps. First, creating the new application with <code>rebar3</code> - I prefer <code>escript</code> template for something this simple.</p>
<p>Then, add a new dependency to the <code>rebar.config</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">erl_opts</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">debug_info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]}.</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">deps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">mochiweb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"2.22.0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#6A737D;--shiki-dark:#6A737D">% &#x3C;---- here</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]}.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">shell</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  % {config, "config/sys.config"},</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    {</span><span style="color:#005CC5;--shiki-dark:#79B8FF">apps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">http_sample</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]}.</span></span>
<span class="line"></span></code></pre>
<p>Then, put the code from above under <code>src/http_server.erl</code> file.</p>
<p>Finally, run the interactive shell in the context of the application: <code>rebar3 shell</code> and start server by calling <code>http_server:start().</code>.</p>
<p>Alternatively, you can compile the program to a binary file using <code>rebar3 compile</code> and then run the program using <code>erl</code> command:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">erl</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -pa</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> _build/default/lib/http_sample3/ebin/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -pa</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> _build/default/lib/mochiweb/ebin/</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -noshell</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -s</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> http_sample3</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> main</span></span>
<span class="line"></span></code></pre>
<p>This, however, will immediately stop the execution of a program once the <code>http_sample3:main/0</code> finishes, so you might want to change the source a bit:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="erlang"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([]).</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Args) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    io</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">format</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Hello, server!</span><span style="color:#005CC5;--shiki-dark:#79B8FF">~n</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, []),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    http_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    receive</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> -> </span><span style="color:#6F42C1;--shiki-dark:#B392F0">http_server</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0">stop</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    done</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span></span>
<span class="line"></span></code></pre>
<p>This way, the <code>http_sample3:main/1</code> will be called and will wait for the <code>stop</code> signal to be sent to the process.
Or until the main <code>erl</code> process is terminated.</p>
<p>Finally you should be able to communicate with this rather simple server by using <code>curl</code>, for example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">curl</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> http://localhost:4000/my/resource</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -X</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> PUT</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -d</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '{ "name": "message", "value": "my message" }'</span></span>
<span class="line"></span></code></pre>
<h2 id="summary">Summary</h2>
<p>This blog was supposed to show Erlang from a slighly different perspective, as opposed to how it was presented to me
in uni. I guess you could treat this as a “Practical Erlang” blog.</p>
<p>This post was supposed to be released in mid-2020, but it took me quite a while to polish it. In the next blog I will
build this on to provide a much more exciting application sample with Erlang.</p>
<div class="content-read-marker" data-fraction="100"></div>  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2024 Your name here. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://m.webtoo.ls/@astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Mastodon</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/mastodon" data-astro-cid-sz7xmlte><path fill="currentColor" d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://twitter.com/astrodotbuild" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Follow Astro on Twitter</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/twitter" data-astro-cid-sz7xmlte><path fill="currentColor" d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" data-astro-cid-sz7xmlte></path></svg> </a> <a href="https://github.com/withastro/astro" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>Go to Astro's GitHub repo</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>