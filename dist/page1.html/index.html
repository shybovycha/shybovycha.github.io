<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.3"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://shybovycha.github.io/page1.html/"><!-- Primary Meta Tags --><title>moofoo blog</title><meta name="title" content="moofoo blog"><meta name="description" content="Welcome to my website!"><link rel="stylesheet" href="/_astro/index.BvFNhZYw.css">
<style>[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <nav class="top"> <div class="links"> <a class="nav-link nav-item" href="/">Home</a> <a class="nav-link nav-item" href="/about.html">About</a> </div> </nav> <main> <section> <article> <h1> <a href="/2024/010/31/2024-10-31-iterating-over-vector-in-cpp.html">Iterating a vector in C++</a> </h1> <time datetime="2024-10-30T14:00:00.000Z"> Oct 31, 2024 </time> <div class="content"> <p>Such a simple topic - iterating over a vector, is it even worth discussing?</p>
<p>Interestingly enough, there <strong>is</strong> a difference in <strong>how exactly</strong> you iterate - be it using iterators, <code>for(:)</code> sugar or plain old <code>for(i=0; i&#x3C;vec.size(); ++i)</code>.</p>
<p>Let us see what output does a compiler produce in each of these cases.</p>
<p><code>sample1</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;int></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data{ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(); </span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">i) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  moo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L4:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movsx</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rsi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#D73A49;--shiki-dark:#F97583">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> >::operator[](unsigned long)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">    moo(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        add</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L3:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        movsx</span><span style="color:#005CC5;--shiki-dark:#79B8FF">   rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#D73A49;--shiki-dark:#F97583">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> >::size() const</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cmp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        setb</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    al</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        test</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    al</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">al</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jne</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L4</span></span>
<span class="line"></span></code></pre>
<p>but</p>
<p><code>sample2</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> data.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">size</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="color:#D73A49;--shiki-dark:#F97583">>=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#D73A49;--shiki-dark:#F97583">--</span><span style="color:#24292E;--shiki-dark:#E1E4E8">i) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  moo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(data[i]);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#D73A49;--shiki-dark:#F97583">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> >::size() const</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        sub</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L3:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">64</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rsi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#D73A49;--shiki-dark:#F97583">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> >::operator[](unsigned long)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">    moo(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        sub</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L3</span></span>
<span class="line"></span></code></pre>
<p>also</p>
<p><code>sample3</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i : data) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  moo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(i)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">80</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#D73A49;--shiki-dark:#F97583">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> >::begin()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">88</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">24</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#D73A49;--shiki-dark:#F97583">    std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> >::end()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">96</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L3</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L4:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">88</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#6F42C1;--shiki-dark:#B392F0">    __gnu_cxx:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:__normal_iterator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">*, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> > >::operator*() const</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">28</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     eax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">28</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">eax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">    moo(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">88</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#6F42C1;--shiki-dark:#B392F0">    __gnu_cxx:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:__normal_iterator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">*, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> > >::operator++()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L3:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">96</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">88</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rsi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rdi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">    bool </span><span style="color:#6F42C1;--shiki-dark:#B392F0">__gnu_cxx:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:operator!=&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">*, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> > >(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">__gnu_cxx:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:__normal_iterator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">*, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> > > const&#x26;, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">__gnu_cxx:</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:__normal_iterator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">*, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::vector&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">std</span><span style="color:#24292E;--shiki-dark:#E1E4E8">::allocator&#x3C;</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> > > const&#x26;)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        test</span><span style="color:#005CC5;--shiki-dark:#79B8FF">    al</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">al</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jne</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L4</span></span>
<span class="line"></span></code></pre>
<p>but with <code>-O1</code></p>
<p><code>sample1</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        movabs  </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12884901893</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        movabs  </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4294967298</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rsp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L10</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L20:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        add</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cmp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        je</span><span style="color:#24292E;--shiki-dark:#E1E4E8">      .L19</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L10:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">    moo(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L20</span></span>
<span class="line"></span></code></pre>
<p><code>sample2</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        movabs  </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12884901893</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        movabs  </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4294967298</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L8:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        sub</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L4:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">    moo(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L8</span></span>
<span class="line"></span></code></pre>
<p><code>sample3</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="asm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     r12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        lea</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rsp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        movabs  </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12884901893</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        movabs  </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4294967298</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rax</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rdx</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">16</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#D73A49;--shiki-dark:#F97583">     QWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rsp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">], </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">r12</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L10</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L20:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        add</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        cmp</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbp</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        je</span><span style="color:#24292E;--shiki-dark:#E1E4E8">      .L19</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">L10:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        mov</span><span style="color:#005CC5;--shiki-dark:#79B8FF">     edi</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">DWORD</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PTR [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">rbx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">    moo(</span><span style="color:#D73A49;--shiki-dark:#F97583">int</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        jmp</span><span style="color:#24292E;--shiki-dark:#E1E4E8">     .L20</span></span>
<span class="line"></span></code></pre>
<p>Interesting how iterating forwards adds an extra boundary check and a jump (<code>cmd rbx, rbp</code> and <code>je .L19</code> in samples #1 and #3),
whereas iterating backwards does not.</p>
<p>In reality, this is such a fine-grained micro-optimization, which would only benefit on an incredibly large scale.
Think of this as just an interesting find.</p> </div>  </article><article> <h1> <a href="/2024/06/27/2024-06-27-gantt-chart-part4.html">Gantt chart. Part 4</a> </h1> <time datetime="2024-06-27T12:54:24.000Z"> Jun 27, 2024 </time> <div class="content"> <h2 id="contents">Contents</h2>
<ul>
<li><a href="/2017/04/09/gantt-chart-with-d3.html">Gantt chart with D3</a></li>
<li><a href="/2020/08/02/gantt-chart-part2.html">Gantt chart with D3. Part 2</a></li>
<li><a href="/2021/03/04/gantt-chart-part3.html">Gantt chart with Canvas</a></li>
<li><a href="/2024/06/26/gantt-chart-part4.html"><strong>Gantt chart with CSS Grids (you are here)</strong></a></li>
</ul>
<p>Seems like every two years or so I hop on my <a href="https://github.com/shybovycha/gantt-chart/">Gantt chart implementation</a> and rework it completely.</p>
<p>Last few attempts (<a href="/2017/04/09/gantt-chart-with-d3.html">rev. 1</a>, <a href="/2020/08/02/gantt-chart-part2.html">rev. 2</a>, <a href="/2021/03/04/gantt-chart-part3.html">rev. 3</a>) were alright, but I was never quite satisfied with the implementation - be it SVG, which has a toll on a browser and has quite limited customization functionality or Canvas API, with same limited customization but being fast.</p>
<p>With the recent introduction of grid layouts in CSS, now supported <a href="https://caniuse.com/css-grid">in all browsers</a>, now seems like a perfect time to revisit the old implementations once again:</p>
<img src="/images/gantt_chart_part4/rework10.png" loading="lazy" alt="Gantt chart, revision 4">
<iframe src="https://codesandbox.io/embed/89mcty?view=preview&#x26;module=%2Fsrc%2FGanttChart%2FRightPane%2FRightPane.tsx&#x26;hidenavigation=1" style="width:100%; height: 500px; border:0; border-radius: 4px; overflow:hidden;" title="gantt-chart" allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"></iframe>
<p><a href="https://codesandbox.io/p/sandbox/cocky-panka-89mcty">CodeSandbox / live demo</a></p>
<p>This revision now has a proper horizontal scrolling on the panel with bars - meaning the labels on the left panel stay in place whilst the left panel is scrollable.
Moreover, the chart is now relies on pure HTML and CSS (being rendered with React though), making it is possible to use rich markup inside the bars and labels.</p>
<h2 id="implementation-steps">Implementation steps</h2>
<p>The data for the tests is going to look like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"epic 1"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"epic 2"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"epic 3"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"story 1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"story 2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"story 3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"story 4"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">8</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"story 5"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"lorem ipsum dolor atata"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"task 2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span></code></pre>
<p>The main component, <code>&#x3C;Gantt></code>, initially was implementated as follows:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> React, { useMemo } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "react"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> style </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "./gantt.module.css"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> LeftPaneRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.row}>{name}&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> LeftPane</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.left_pane}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.left_pane_header}>/&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.left_pane_rows}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">LeftPaneRow</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> key</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{item.id} {</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">item} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ))}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPaneRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.row}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.entry} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{ left: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {id}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPane</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane_header}>...scale...&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane_rows}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRow</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> key</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{item.id} {</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">item} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ))}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> flattenTree</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> queue</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">parent</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">parent).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> result</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> visited</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (queue.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> item</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">shift</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (visited.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">has</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item.id)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      continue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    visited.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item.id);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    items</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">child</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> child.parent </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> item.id)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">child</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">unshift</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(child));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Gantt</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> itemList</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useMemo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> flattenTree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(items), [items]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.gantt}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">LeftPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>The core of the proper representation of this diagram is the CSS:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">auto</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template-areas</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"left right"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">100</span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .left_pane</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">left</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  border-right</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> solid</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> #bbb</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">auto</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template-areas</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"corner"</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "rows"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .left_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .left_pane_rows</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: rows;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .left_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .left_pane_header</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: corner;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">auto</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template-areas</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"scale"</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "rows"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">right</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  overflow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_rows</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10000</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#6A737D;--shiki-dark:#6A737D">/*temp*/</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: rows;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_header</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">flex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: scale;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  height</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">40</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  align-items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">flex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  position</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">relative</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .entry</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  position</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">absolute</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  background</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#eeeeee</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  border-radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.4</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<img src="/images/gantt_chart_part4/rework2.png" loading="lazy" alt="Split into two panels, right is scrollable">
<p>Good, we now have two panels with items aligned in rows and the right panel being scrollable if it gets really long.
Next thing, <code>position: absolute</code> is absolutely disgusting - we use grid layout already!
Instead, split each row into the same number of columns using grid and position the elements in there:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPaneRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> gridTemplate</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `auto / repeat(${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">columns</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}, 1fr)`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> gridArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `1 / ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">start</span><span style="color:#032F62;--shiki-dark:#9ECBFF">} / 1 / ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">end</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.row}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        gridTemplate,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.entry}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          gridArea,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {id}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>and clean up the CSS a bit (like removing the <code>position: absolute</code> and reducing the width from <code>10000px</code> down to <code>1000px</code>):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_rows</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1000</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#6A737D;--shiki-dark:#6A737D">/*temp*/</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: rows;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  height</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">40</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  align-items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  position</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">relative</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .entry</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  background</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#eeeeee</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  border-radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.4</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>Now, lets position the elements in each row using the column index:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPanelRowEntry</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> gridArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `1 / ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">start</span><span style="color:#032F62;--shiki-dark:#9ECBFF">} / 1 / ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">end</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.entry}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        gridArea,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      {children}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPaneRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> gridTemplate</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `auto / repeat(${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">columns</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}, 1fr)`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> gridArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `1 / ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">start</span><span style="color:#032F62;--shiki-dark:#9ECBFF">} / 1 / ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">end</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.row}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        gridTemplate,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.entry}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          gridArea,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        {id}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPaneHeaderRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> gridTemplate</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `auto / repeat(${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">columns</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}, 1fr)`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane_header_row}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        gridTemplate,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      {children}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPaneHeader</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane_header}>{children}&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPane</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> columnHeaders</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(columns)].</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">idx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeader</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>{idx </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeader</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rows</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRow</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> key</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{item.id} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPanelRowEntry</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">item}>{item.id}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPanelRowEntry</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeaderRow</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns}>{columnHeaders}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeaderRow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane_rows}>{rows}&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>And add corresponding new CSS styles:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_header_row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: scale;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_header_row</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_header</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  align-items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  text-align</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This requires <code>start</code> and <code>end</code> defined for each entry:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> data</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"epic 1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    start: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    end: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"epic 2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    start: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    end: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">3</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"epic 3"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    start: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    end: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">11</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"story 1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    parent: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    start: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    end: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<img src="/images/gantt_chart_part4/rework3.png" loading="lazy" alt="Aligning items in a grid">
<p>And, to make it not repeat a dozen of inline CSS styles, we can utilize CSS variables:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPaneRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.row}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      {children}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPanelRowEntry</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.entry}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "--col-start"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: start,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "--col-end"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: end,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      {children}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPane</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> columnHeaders</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(columns)].</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">idx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeader</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>{idx </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeader</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rows</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRow</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> key</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{item.id} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPanelRowEntry</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">item}>{item.id}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPanelRowEntry</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"--columns"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: columns }}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeaderRow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>{columnHeaders}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeaderRow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane_rows}>{rows}&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>We can also re-use the same <code>row</code> for header:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPaneHeaderRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">children</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.right_pane_header_row}>{children}&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>And corresponding CSS:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_header_row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  display</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">grid</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: scale;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">repeat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">--columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  position</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">relative</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-template</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">repeat</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">--columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">fr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .entry</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  background</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#eeeeee</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  border-radius</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  align-items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  text-align</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">center</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  grid-area</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">--col-start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="color:#005CC5;--shiki-dark:#79B8FF">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">--col-end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>I like to also change the fonts, since the default <code>sans-serif</code> just looks terrible:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">@import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> url</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"https://fonts.googleapis.com/css2?family=Assistant:wght@200..800&#x26;display=swap"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">:root</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  font-family</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Assistant"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">sans-serif</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  font-optical-sizing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">auto</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  font-weight</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">300</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  font-style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">normal</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  font-variation-settings</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"wdth"</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 100</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<img src="/images/gantt_chart_part4/rework4.png" loading="lazy" alt="Changing the font">
<p>And maybe add some grid lines for the rows:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row:first-child</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  border-top</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> solid</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> var</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">--border-color</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#eee</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0.75</span><span style="color:#D73A49;--shiki-dark:#F97583">rem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  border-bottom</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> solid</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> var</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">--border-color</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">#eee</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<img src="/images/gantt_chart_part4/rework5.png" loading="lazy" alt="Adding grid lines">
<p>Now lets add some padding to separate parent and child items of a chart:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> LeftPaneRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">level</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nestingPadding</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">level</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}rem`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.row} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"--label-padding"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: nestingPadding }}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      {name}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .left_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  padding-left</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">--label-padding</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>and fill out the <code>level</code> property when flattening the item tree:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> flattenTree</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> queue</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  items</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">parent</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">parent)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ level: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, item }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> result</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> visited</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Set</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  while</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (queue.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> ></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">level</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">shift</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (visited.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">has</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item.id)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      continue</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    result.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">item, level });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    visited.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">add</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item.id);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    items</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">child</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> child.parent </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> item.id)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">child</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> queue.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">unshift</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ item: child, level: level </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<img src="/images/gantt_chart_part4/rework6.png" loading="lazy" alt="Shrinking right panel">
<p>And automate the number of columns calculation:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Gantt</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> itemList</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> flattenTree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(items);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> startsAndEnds</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">flatMap</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [start, end]);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> columns</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">max</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">startsAndEnds) </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">min</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">startsAndEnds);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.gantt}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">LeftPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>In order to make chart panel scrollable, one can set a <code>width</code> CSS property for the <code>.right_pane_rows</code> and <code>.right_pane_header_row</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="css"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_rows</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2000</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">.gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> .right_pane_header_row</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  width</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2000</span><span style="color:#D73A49;--shiki-dark:#F97583">px</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>The last bit for a this prototype would be to have a scale for the columns.</p>
<p>Assume a chart item has an abstract start and end fields - these could be dates or some domain-specific numbers (like a week in a quarter or a sprint, etc.).
Those will then need to be mapped onto column index. Then the chart width (in columns) would be the difference between the smallest <code>start</code> value and the biggest <code>end</code> value:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Gantt</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">scale</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> itemList</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> flattenTree</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(items).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">item,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    ...</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item), </span><span style="color:#6A737D;--shiki-dark:#6A737D">// assuming `scale` function returns an object { start: number; end: number }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> minStartItem</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> minBy</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(itemList, (</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> item.start);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> maxEndItem</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> maxBy</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(itemList, (</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> item.end);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> columns</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> maxEndItem.end </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> minStartItem.start;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.gantt}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">LeftPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>The <code>minBy</code> and <code>maxBy</code> helper functions could be either taken from <code>lodash</code> or manually defined like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> minBy</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">selector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (items.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> ===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> minIndex </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEach</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">index</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">selector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> selector</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(items[minIndex])) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      minIndex </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> index;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> items[minIndex];</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>For better navigation around this code we can add some types:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  id</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  name</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartProps</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  items</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[];</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  scale</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> minBy</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[], </span><span style="color:#6F42C1;--shiki-dark:#B392F0">selector</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> T</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Gantt</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">scale</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartProps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> default</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> scale</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { start: start </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, end: end </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">={</span><span style="color:#E36209;--shiki-dark:#FFAB70">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">={</span><span style="color:#E36209;--shiki-dark:#FFAB70">scale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">} />;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>We can extend this even further by adding an API to provide labels for columns:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartProps</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">column</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> React</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Gantt</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">scale</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">scaleLabel</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartProps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.gantt}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">LeftPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scaleLabel} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPane</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">scaleLabel</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> columnHeaders</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(columns)].</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">idx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeader</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>{</span><span style="color:#6F42C1;--shiki-dark:#B392F0">scaleLabel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(idx)}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneHeader</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> default</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> scale</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ start, end });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">col</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">col</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{data} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scale</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scale} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scaleLabel} />;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This new API can then be utilized to show month names, for instance:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> default</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> scale</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { start, end };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> months</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Jan"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Feb"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Mar"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Apr"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "May"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Jun"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Jul"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Aug"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Sep"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Oct"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Nov"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "Dec"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">col</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> months[col </span><span style="color:#D73A49;--shiki-dark:#F97583">%</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Gantt</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{data} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scale</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scale} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scaleLabel} />;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<img src="/images/gantt_chart_part4/rework8.png" loading="lazy" alt="Adding scale with labels">
<p>Moreover, it is now possible to inline HTML and CSS in the <code>name</code> of each chart item:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> LeftPaneRow</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">level</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">name</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> nestingPadding</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> `${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">level</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}rem`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.row} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"--label-padding"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: nestingPadding }}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dangerouslySetInnerHTML</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{{__html: name}}>&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">span</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>And then in <code>data.json</code> (note that FontAwesome requires its CSS on a page in order to work):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">7</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">'&#x3C;i</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> style=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"font-family: </span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">\'</span><span style="color:#032F62;--shiki-dark:#9ECBFF">FontAwesome</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">\'</span><span style="color:#032F62;--shiki-dark:#9ECBFF">;"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> class=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"fa fa-car"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">>&#x3C;/i>&#x26;nbsp;story</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> with</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> FontAwesome'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    parent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">4</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    name</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">'inline</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> &#x3C;em>&#x3C;b</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> style=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"color: #5ebebe"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">>CSS&#x3C;/b></span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> color&#x3C;/em></span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> &#x3C;u</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic"> style=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"border: 1px dashed #bebefe; padding: 2px; border-radius: 2px"</span><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">>works&#x3C;/u>'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    parent</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">5</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B31D28;font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">    end</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">6</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"></span></code></pre>
<p>The API can be further improved by providing the render function for the bars labels:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> RightPane</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">items</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">columns</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">scaleLabel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">barLabel</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rows</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> items.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">((</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRow</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> key</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{item.id} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRowEntry</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">item}>{barLabel </span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> barLabel</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(item) </span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> &#x3C;>{item.id}&#x3C;/>}&#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRowEntry</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPaneRow</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartProps</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">  items</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[];</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  scale</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">; </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> };</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">column</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> React</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  barLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">item</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> React</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Element</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Chart</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  items,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  barLabel,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  scale,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  scaleLabel,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> GanttChartProps</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> className</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{style.gantt}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">LeftPane</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList} /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">RightPane</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{itemList}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        columns</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{columns}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scaleLabel}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        barLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{barLabel}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>and then in <code>App</code> component:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pluralize </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "pluralize"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> default</span><span style="color:#D73A49;--shiki-dark:#F97583"> function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> barLabel</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">start</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      {end </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start} {</span><span style="color:#6F42C1;--shiki-dark:#B392F0">pluralize</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"month"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, end </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> start)}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Chart</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      items</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{data}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      scale</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scale}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      scaleLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{scaleLabel}</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      barLabel</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{barLabel}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<img src="/images/gantt_chart_part4/rework10.png" loading="lazy" alt="More customized labels"> </div>  </article><article> <h1> <a href="/2024/06/26/2024-06-26-so-why-redux-is-bad.html">So why Redux is bad?</a> </h1> <time datetime="2024-06-26T11:15:24.000Z"> Jun 26, 2024 </time> <div class="content"> <p>Redux is generally considered a bad choice for state management on front-end.
But check out an average application React application (or a few fragments of it):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { Provider, useAtom } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'jotai'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { useQuery } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'react-query'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useInfo</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">data</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">error</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">isLoading</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useQuery</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    queryKey: [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'info'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    queryFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fetch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/info'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">r</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">json</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    staleTime: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Infinity</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    info: data,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    isLoading,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    error,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> HomeWithoutProvider</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">raiseToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">initialRender</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">setInitialRender</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useState</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">pageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">setPageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useAtom</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(pageTypeAtom);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  useEffect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (info.isNewVersionAvailable) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      raiseToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, [info]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>...&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Home</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Provider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">HomeWithoutProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Provider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Routes</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BrowserRouter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Suspense</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fallback</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Loader</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> />}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Route</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> element</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Home</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> />} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Suspense</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BrowserRouter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> root</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createRoot</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(document.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getElementById</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'root'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">root.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">StrictMode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">StyleThemeProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ToastProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">GlobalErrorHandler</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ReactQueryProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Routes</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ReactQueryProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">GlobalErrorHandler</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ToastProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">StyleThemeProvider</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">StrictMode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>Usually most of the components (<code>Home</code>, <code>Routes</code>) and hooks (<code>useInfo</code>) are in separate files,
but for the sake of simplicity I combined them all into one code block.</p>
<p>What I find suboptimal with this code is that it has at least three obvious different state management systems:</p>
<ul>
<li><code>jotai</code> for shared atoms (pieces of global state)</li>
<li><code>React.useState</code> for internal component state</li>
<li>various <code>React.Context</code>s (<code>StyleThemeProvider</code>, <code>ToastProvider</code>, <code>GlobalErrorHandler</code>, etc.)</li>
</ul>
<p>On top of those, there are less obvious state management systems:</p>
<ul>
<li><code>react-router</code> uses internal router state, which could be treated as global application state</li>
<li><code>react-query</code> uses its internal cache for each query</li>
<li><code>react-hook-form</code> uses the form state of a component ancestor (which could be declared on any level above the current component)</li>
</ul>
<p>In the pursuit of encapsulation and reducing the boilerplate, front-end developers came up with all of these solutions aiming to solve the problem of managing application state.</p>
<p>So what exactly is this problem? And what are the issues all of the aforementioned solutions try to address?</p>
<p>As I see it, there are two competing camps:</p>
<ul>
<li>containing the logic in small reusable chunks (hooks, components)</li>
<li>sharing chunks of state between different parts of the application</li>
</ul>
<p>There are some side-tracks like dealing with asynchronous actions (like fetching the data from server),
changing the state of external components (like showing a toast message), reducing the unnecessary re-renders.</p>
<p>Back in the day, Redux seemingly addressed these areas to a degree. Redux implements Flux architecture, which was
compared to MVC (Model-View-Controller) architecture back in the day:</p>
<img src="/images/why-redux-is-bad/mvc-architecture.webp" loading="lazy" alt="Data flow in MVC architecture">
<img src="/images/why-redux-is-bad/flux-architecture.webp" loading="lazy" alt="Data flow in Flux architecture">
<p>It became especially popular after Angular.JS MVVM (Model-View-ViewModel) architecture implementation was considered slow with its
dirty checks and constant re-rendering.</p>
<p>It could be said that Redux is being shipped in recent versions of React itself - with the use of <a href="https://react.dev/reference/react/useReducer"><code>useReducer()</code></a> hook. One would rarely use Redux on its own, often sticking to a somewhat opinionated stack of reselect (for derived state), react-redux (to <code>connect()</code> components to the store) and redux-thunk or redux-sagas (for asynchronous <code>dispatch()</code> calls).</p>
<p>The aforementioned component could be implemented with the conventional (old) Redux approach like so:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="jsx"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { createStore, combineReducers, applyMiddleware } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'redux'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { connect } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'react-redux'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { createSelector } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'reselect'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { thunk } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'redux-thunk'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> infoReducer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { isNewVersionAvailable: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#E36209;--shiki-dark:#FFAB70">action</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (action.type) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'INFO_LOADED'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state, </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">action.payload };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    default</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> pageDataReducer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { pageType: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#E36209;--shiki-dark:#FFAB70">action</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (action.type) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'SET_PAGE_TYPE'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state, pageType: action.pageType };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    default</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> toastReducer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">state</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { isOpen: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, content: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, </span><span style="color:#E36209;--shiki-dark:#FFAB70">action</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  switch</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (action.type) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'SHOW_TOAST'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state, isOpen: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, content: action.payload };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    default</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> rootReducer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> combineReducers</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  info: infoReducer,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  pageData: pageDataReducer,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  toast: toastReducer,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> store</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> createStore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(rootReducer, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">applyMiddleware</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(thunk));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// Meet thunks.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// A thunk in this context is a function that can be dispatched to perform async</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// activity and can dispatch actions and read state.</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">// This is an action creator that returns a thunk:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loadInfoAction</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#E36209;--shiki-dark:#FFAB70">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    fetch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'/info'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">r</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r.json)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">then</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">payload</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ type: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'INFO_LOADED'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, payload }));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> raiseToastAction</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">content</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#E36209;--shiki-dark:#FFAB70">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ type: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'SHOW_TOAST'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, payload: content });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setPageTypeAction</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">pageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  (</span><span style="color:#E36209;--shiki-dark:#FFAB70">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ type: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'SET_PAGE_TYPE'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, pageType });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Home</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">pageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">loadInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">raiseToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">setPageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  useEffect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    loadInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  useEffect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (info.isNewVersionAvailable) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      raiseToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        // ...</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }, [info]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>...&#x3C;/</span><span style="color:#22863A;--shiki-dark:#85E89D">div</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mapStateToProps</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">pageData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: { </span><span style="color:#E36209;--shiki-dark:#FFAB70">pageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({ info, pageType });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> mapDispatchToProps</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ({</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  raiseToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">content</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">raiseToastAction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(content)),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  setPageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: (</span><span style="color:#E36209;--shiki-dark:#FFAB70">pageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setPageTypeAction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(content)),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  loadInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> dispatch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">loadInfoAction</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HomeContainer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> connect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(mapStateToProps, mapDispatchToProps)(Home);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Routes</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BrowserRouter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Suspense</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fallback</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Loader</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> />}></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Route</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> element</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">{&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">HomeContainer</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> />} </span><span style="color:#6F42C1;--shiki-dark:#B392F0">path</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"/"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Suspense</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;/</span><span style="color:#005CC5;--shiki-dark:#79B8FF">BrowserRouter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> root</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> React.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createRoot</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(document.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getElementById</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'root'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">root.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  &#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Routes</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>In my opinion, Redux is not suitable for complex projects for a few reasons:</p>
<ul>
<li>it combines all states (both local and global) in one big messy furball; managing it is quite a hurdle
<ul>
<li>as the project complexity grows, one can not just change a piece of state or selectors without affecting the entirety of the project (and teams)</li>
<li>combining reducers into one supermassive function makes any state update unreasonably long and complex process (remember: each reducer returns a new state instance; now imagine having even a hundred of reducers, each of which returns a new state)</li>
</ul>
</li>
<li>it is easy for a component to be re-rendered on any change to the state; a lot of effort goes into making sure selectors are well memoized and not re-calculated</li>
<li>asynchronous actions are a big unsolved mystery (are you going to use thunks, flux, sagas or something else?)</li>
</ul>
<p>On a flip side, the idea itself could actually bring a lot of positives if cooked properly:</p>
<ul>
<li>there is only one possible flow of data: via <code>dispatch()</code> call, through the reducers and back to the components connected to the store via component props
<ul>
<li>this is supposed to make following the data (e.g. debugging the application) easy</li>
</ul>
</li>
<li>components are pretty much stateless at this point, encapsulated and not having side effects leaking everywhere</li>
<li>logic is nicely separated from the representation and is encapsulated in the reducers (and maybe, to a small extent, in selectors)</li>
</ul>
<p><a href="https://elm-lang.org/">Elm</a> utilizes the language features and its own runtime combined with Redux-like architecture to improve some aspects of the more traditional pure JS way of things, where there are only opinionated libraries and no one way of doing things.</p>
<p>Consider Elm architecture and how it compares to Redux:</p>
<ul>
<li>all the states are still combined into one big cauldron of chaos</li>
<li>by default, any component is just a function returning an array; the entire application will be rerendered on each state change, which is still suboptimal, since literally all components are connected to the store</li>
<li>asynchronous actions are handled separately by the runtime in a similar way to synchronous actions; each action returns a new state and a command (triggering the asynchronous processing)
<ul>
<li>since commands are handled by the runtime and theres a handful of commands, all of them will (eventually) circle back to dispatching messages just like components do, following the same one-way data flow</li>
</ul>
</li>
<li>reducers are a lot faster, since they are essentially a big <code>switch..case</code> statement (which is cheap)</li>
</ul>
<p>The above component could be re-implemented in Elm as follows:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="elm"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Browser</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Html</span><span style="color:#D73A49;--shiki-dark:#F97583"> exposing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (..)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Html</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Attributes</span><span style="color:#D73A49;--shiki-dark:#F97583"> exposing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">style</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Html</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Events</span><span style="color:#D73A49;--shiki-dark:#F97583"> exposing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (..)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Http</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Json</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Decode</span><span style="color:#D73A49;--shiki-dark:#F97583"> exposing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Decoder</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">field</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">bool</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  Browser</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">element</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">init</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> init</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">update</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> update</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">subscriptions</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> subscriptions</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">view</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> view</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type alias Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Result</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Http</span><span style="color:#D73A49;--shiki-dark:#F97583">.Error</span><span style="color:#D73A49;--shiki-dark:#F97583"> Info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">toast</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Maybe</span><span style="color:#D73A49;--shiki-dark:#F97583"> Toast</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">pageType</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> PageType</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type alias Info</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">quote</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">source</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">author</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">year</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Int</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type alias Toast</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">content</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> String</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type PageType</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Page1</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Page2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">init</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ()</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">Cmd</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">init</span><span style="color:#D73A49;--shiki-dark:#F97583"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ({ </span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">toast</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">pageType</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Page1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }, loadInfo)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type Msg</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> GotInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Result</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Http</span><span style="color:#D73A49;--shiki-dark:#F97583">.Error</span><span style="color:#D73A49;--shiki-dark:#F97583"> Info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ShowToast</span><span style="color:#D73A49;--shiki-dark:#F97583"> Toast</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> SetPageType</span><span style="color:#D73A49;--shiki-dark:#F97583"> PageType</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">update</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#D73A49;--shiki-dark:#F97583"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Model</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">Cmd</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">update</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> msg model </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case </span><span style="color:#24292E;--shiki-dark:#E1E4E8">msg </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    GotInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case </span><span style="color:#24292E;--shiki-dark:#E1E4E8">result </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        Ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          ({ model </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> info</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info) }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Cmd</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">none)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        Err</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          ({ model </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> info</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Err</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e) }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Cmd</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">none)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    ShowToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ({ model </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> toast</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Cmd</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">none)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    SetPageType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ({ model </span><span style="color:#D73A49;--shiki-dark:#F97583">|</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> pageType</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p }, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Cmd</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">none)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">subscriptions</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#D73A49;--shiki-dark:#F97583"> Sub</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">subscriptions</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  Sub</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">view</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Model</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#D73A49;--shiki-dark:#F97583"> Html</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">view</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> model </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  div []</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ h2 [] [ text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Demo App"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , viewInfo model</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , viewToast model</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toast</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">viewInfo</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">Result</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Http</span><span style="color:#D73A49;--shiki-dark:#F97583">.Error</span><span style="color:#D73A49;--shiki-dark:#F97583"> Info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> Html</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">viewInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mbInfoResult </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case </span><span style="color:#24292E;--shiki-dark:#E1E4E8">mbInfoResult </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    Nothing</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Loading..."</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> infoResult </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      case </span><span style="color:#24292E;--shiki-dark:#E1E4E8">infoResult </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        Err</span><span style="color:#D73A49;--shiki-dark:#F97583"> _</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          div []</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Could not load info"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        Ok</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> info </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          div []</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"App loaded"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">viewToast</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Maybe</span><span style="color:#D73A49;--shiki-dark:#F97583"> Toast</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#D73A49;--shiki-dark:#F97583"> Html</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">viewToast</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mbToast </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case </span><span style="color:#24292E;--shiki-dark:#E1E4E8">mbToast </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    Nothing</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      div [] []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> toast </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      div [] [ text toast</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">content</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loadInfo</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Cmd</span><span style="color:#D73A49;--shiki-dark:#F97583"> Msg</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">loadInfo</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">  Http</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">get</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { </span><span style="color:#6F42C1;--shiki-dark:#B392F0">url</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "/info"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">expect</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Http</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">expectJson </span><span style="color:#005CC5;--shiki-dark:#79B8FF">GotInfo</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> infoDecoder</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">infoDecoder</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#D73A49;--shiki-dark:#F97583"> Decoder</span><span style="color:#D73A49;--shiki-dark:#F97583"> Info</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">infoDecoder</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  map </span><span style="color:#005CC5;--shiki-dark:#79B8FF">Info</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (field </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"isNewVersionAvailable"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> bool)</span></span>
<span class="line"></span></code></pre>
<p>The good bits are:</p>
<ul>
<li>forcing to handle all possible actions (messages) and results (HTTP success and error scenarios)</li>
<li>expressive language features (union types, strong typing, records, switch-case expressions) ensure robust code (as in this code does not leave room for mistakes like null/undefined/unhandled exceptions/unhandled code path/wrong value type)</li>
<li>no leeway for various ways to get things done (as in there is only one way to handle HTTP requests, only one way to handle asynchronous message dispatches, only one way to parse HTTP responses)</li>
</ul>
<p>But if Redux spreads things apart compared to modern React, Elm feels like it spreads things further apart by handling effect results separately (like sending HTTP request, parsing HTTP response and processing the result by dispatching another message).</p>
<p>One other example would be <a href="https://www.purescript.org/">PureScript</a> (or rather <a href="https://github.com/purescript-halogen/purescript-halogen">Halogen</a>). Purescript itself elevates the complexity to the skies and beyond, by making you run around with monads like a headless chicken. Consider simple example of sending a HTTP request:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Affjax.Web</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> AX</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Affjax.ResponseFormat</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> AXRF</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Either</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hush</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect.Aff.Class</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MonadAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> H</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.Aff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">awaitBody</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">runHalogenAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Events</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HE</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Properties</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HP</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.VDom.Driver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">runUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.Event.Event</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.Event.Event</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Event</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runHalogenAff </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  body </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> awaitBody</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  runUI component unit body</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  {</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loading</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Boolean</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">username</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">result</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  =</span><span style="color:#22863A;--shiki-dark:#85E89D"> SetUsername</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  | </span><span style="color:#22863A;--shiki-dark:#85E89D">MakeRequest</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Event</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">component</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> query input output m. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">MonadAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> H.Component</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> query input output m</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">component </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkComponent</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { initialState</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , render</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , eval</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkEval </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">defaultEval { handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handleAction }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">initialState</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input. input </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">initialState _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { loading</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, username</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, result</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">State</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> H.ComponentHTML</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () m</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">render st </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">form</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onSubmit </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ev </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> MakeRequest</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ev ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">h1_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Look up GitHub user"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">label_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Enter username:"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            , </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueInput </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">str </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> SetUsername</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">disabled st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">loading</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        , </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">type_ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP.ButtonSubmit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Fetch info"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">p_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">loading </span><span style="color:#D73A49;--shiki-dark:#F97583">then</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Working..."</span><span style="color:#D73A49;--shiki-dark:#F97583"> else</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          Nothing</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">h2_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Response:"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">pre_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">code_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text res ] ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">handleAction</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> output m. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">MonadAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> H.HalogenM</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () output m </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  SetUsername</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ _ { username </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username, result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  MakeRequest</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">liftEffect </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> Event</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">preventDefault event</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    username </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">gets _</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ _ { loading </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    response </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">liftAff </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> AX</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">get </span><span style="color:#22863A;--shiki-dark:#85E89D">AXRF</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"https://api.github.com/users/"</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username)</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ _ { loading </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> map _</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">body (hush response) }</span></span>
<span class="line"></span></code></pre>
<p>Now add the <a href="https://github.com/thomashoneyman/purescript-halogen-store/"><code>halogen-store</code></a> package to the mix to make use of Redux-like state management:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Affjax.Web</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> AX</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Affjax.ResponseFormat</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> AXRF</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Either</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">hush</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect.Aff.Class</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MonadAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> H</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.Aff</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HA</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Events</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HE</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Properties</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HP</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.VDom.Driver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">runUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.Event.Event</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Event</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Web.Event.Event</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Event</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.Store.Monad</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MonadStore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">updateStore</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">runStoreT</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.Store.Connect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Connected</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">connect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.Store.Select</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">selectAll</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect.Aff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">launchAff_</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> StoreAction</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  =</span><span style="color:#22863A;--shiki-dark:#85E89D"> StoreSetUsername</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  | </span><span style="color:#22863A;--shiki-dark:#85E89D">StoreMakeRequest</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  | </span><span style="color:#22863A;--shiki-dark:#85E89D">StoreReceiveResponse</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">reduce</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> StoreAction</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">reduce store </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  StoreSetUsername</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    store { username </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username, result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  StoreMakeRequest</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    store { loading </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  StoreReceiveResponse</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> response </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    store { loading </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> response }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">initialStore</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">initialStore </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { username</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, loading</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, result</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> launchAff_ </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  body </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> HA</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">awaitBody</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  root </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runStoreT initialStore reduce component</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  void </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runUI root unit body</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  {</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> loading</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Boolean</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">username</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , </span><span style="color:#6F42C1;--shiki-dark:#B392F0">result</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  =</span><span style="color:#22863A;--shiki-dark:#85E89D"> SetUsername</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  | </span><span style="color:#22863A;--shiki-dark:#85E89D">MakeRequest</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Event</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  | </span><span style="color:#22863A;--shiki-dark:#85E89D">ReceiveState</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Connected</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">deriveState</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Connected</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">deriveState { context</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { username, loading, result }, input</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  { username</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , loading</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> loading</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  , result</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">component</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> query output m. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">MonadAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MonadStore</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> StoreAction</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> H.Component</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> query </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Unit</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> output m</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">component </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  connect selectAll </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkComponent</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { initialState</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> deriveState</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , render</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , eval</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkEval </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">defaultEval</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      { handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handleAction</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      , receive </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;&#x3C;&#x3C;</span><span style="color:#22863A;--shiki-dark:#85E89D"> ReceiveState</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">render</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">State</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> H.ComponentHTML</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () m</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">render st </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">form</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onSubmit </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">ev </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> MakeRequest</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ev ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">h1_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Look up GitHub user"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">label_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Enter username:"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            , </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueInput </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">str </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> SetUsername</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> str</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">disabled st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">loading</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        , </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">type_ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP.ButtonSubmit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Fetch info"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">p_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">loading </span><span style="color:#D73A49;--shiki-dark:#F97583">then</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Working..."</span><span style="color:#D73A49;--shiki-dark:#F97583"> else</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> st</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          Nothing</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">h2_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Response:"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">pre_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">code_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text res ] ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">handleAction</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> output m. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">MonadAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MonadStore</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> StoreAction</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> H.HalogenM</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () output m </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  SetUsername</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    updateStore </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> StoreSetUsername</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  MakeRequest</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">liftEffect </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> Event</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">preventDefault event</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    username </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">gets _</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    updateStore </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> StoreMakeRequest</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    response </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">liftAff </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> AX</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">get </span><span style="color:#22863A;--shiki-dark:#85E89D">AXRF</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"https://api.github.com/users/"</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    updateStore </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> StoreReceiveResponse</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (map _</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">body (hush response))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  ReceiveState</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> input </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">put </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> deriveState input</span></span>
<span class="line"></span></code></pre>
<p>The really nice things about this approach are:</p>
<ul>
<li>components could be self-sufficient, as opposed to Elm:
<ul>
<li>they can have both internal state and communicate with the external application via <code>Aff</code></li>
<li>they can be extracted into separate modules, making them actually reusable components</li>
</ul>
</li>
<li>state selectors and connecting to a store are seamlessly implemented based on existing Halogen tools (subscriptions)</li>
<li>it feels like you do not have to worry about state growing big, since each component explicitly declares which parts of that messy furball it needs (derives)</li>
</ul>
<p>The bad news is that everything relies on monads and transformers - lifting, mapping, flat-mapping are just the very tip of the iceberg. Once you hit some mysterious error - it is quite tricky to understand what is going on. Unlike Elm, which has really nicely structured, formatted and presented both error message, its location and ways to fix it.</p>
<p>Just looking at the type definitions is nauseaing at best:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">handleAction</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#D73A49;--shiki-dark:#F97583"> forall</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> output m. </span><span style="color:#6F42C1;--shiki-dark:#B392F0">MonadAff</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MonadStore</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> StoreAction</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> H.HalogenM</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> State</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () output m </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Unit</span></span>
<span class="line"></span></code></pre>
<p>And then there is this bit, lifting everything to the same monad and then mapping and flat-mapping it to get the response body:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">MakeRequest</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> event </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">liftEffect </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> Event</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">preventDefault event</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  username </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">gets _</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">username</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  updateStore </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> StoreMakeRequest</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  response </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">liftAff </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> AX</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">get </span><span style="color:#22863A;--shiki-dark:#85E89D">AXRF</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">string (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"https://api.github.com/users/"</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  updateStore </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> StoreReceiveResponse</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (map _</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">body (hush response))</span></span>
<span class="line"></span></code></pre>
<p>And do not forget that this monad is merely describing the computation, you will have to run it at some point:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runHalogenAff </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  body </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> HA</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">awaitBody</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  root </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runStoreT initialStore reduce component</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ui </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runUI root unit body</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ui</span></span>
<span class="line"></span></code></pre>
<p>The example on <code>halogen-store</code> suggests using <code>launchAff_</code>, but then you will have to cast the return value type to match the monad of the <code>main</code> function (<code>Effect Unit</code>) or lift <code>runStoreT</code> to the <code>Effect Unit</code> monad - whichever you find suitable:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> launchAff_ </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  body </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> HA</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">awaitBody</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  root </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runStoreT initialStore reduce component</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ui </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> runUI root unit body</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  void ui</span></span>
<span class="line"></span></code></pre>
<p>But having to worry about all these intricacies actually strengthens the point that PureScript is not for the faint-harted - Elm prevails here.</p>
<p>The other drawback is that mixing logic in both component and the reducers is weird - it is not clear from the Flux architecture where the side-effects should live - like network calls, asynchronous actions, actions triggering other actions. Redux is known for suffering from all of these areas.</p>
<p>Elm solves this nicely with commands.</p>
<p>Halogen kind of takes a step backwards from Elm - it does have subscriptions, but it does not prevent you from issuing side effects from the <code>handleActions</code>. And <code>halogen-store</code> does not have a recipe for complex chained actions.</p>
<p>Ultimately, I dont think Redux is bad - the idea to have a full visibility into all possible application interactions is scary in a complex project and it is hard to come up with a clean way to work around it, but single-way data flow is actually nice.</p>
<p>Interesting how developers went from <em>we dont want Angular.js dirty checks - it is not clear where the data is flowing</em> to <em>we dont want a single point of contention for all application interactions</em>.</p>
<p>In my eyes, the four technologies (modern-day React, Redux, Elm and Purescript) all come with their own pros and massive cons and there is no good or one-size-fits-all solution among them. And none of them ultimately solves the problem of managing application state and interactions in a non-bloated way. Maybe Angular or React 19 have an answer?</p> </div>  </article><article> <h1> <a href="/2024/05/17/2024-05-17-bun-is-still-undercooked.html">Bun is still undercooked</a> </h1> <time datetime="2024-05-17T04:10:00.000Z"> May 17, 2024 </time> <div class="content"> <p>my Skunkworks project was trying out <a href="https://bun.sh/">Bun</a>. it was not a successful project, but there are some learnings:</p>
<p>TL;DR: I think Bun is still undercooked and despite being super cool and competitive on paper, it is a bit too early to use it in big projects. But hey, it works for my blog!</p>
<h2 id="what-is-bun">What is Bun</h2>
<p>Bun is a combined alternative for NodeJS, package manager (<code>npm</code> / <code>yarn</code> / <code>pnpm</code>), bundler (<code>vite</code> / <code>webpack</code> / <code>esbuild</code>) and test runner (<code>vite</code> / <code>jest</code>).</p>
<h2 id="bun-is-ridiculously-fast">Bun is ridiculously fast</h2>

























<table><thead><tr><th>Command</th><th>Yarn</th><th>Bun</th></tr></thead><tbody><tr><td><code>yarn install</code></td><td><code>49 sec</code></td><td><code>7.5 sec</code></td></tr><tr><td><code>vite build</code></td><td><code>14 sec</code></td><td><code>0.9 sec</code></td></tr><tr><td><code>vite test</code></td><td><code>forever</code></td><td><code>4.5 sec</code></td></tr></tbody></table>
<p>This most likely has to do with what happens in those tools - Bun went with parsing files as ASTs, applying transformations and running them in memory (to the best of my knowledge, digging through the Bun code)</p>
<h2 id="some-things-work-out-of-the-box">Some things work out of the box</h2>
<p>Dependency management works like a charm. No questions asked. Bun is just 7x faster.
Comparing the node_modules directories:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Only in node_modules_yarn:</span></span>
<span class="line"><span>    .yarn-state.yml</span></span>
<span class="line"><span>    @aashutoshrathi</span></span>
<span class="line"><span>    @isaacs</span></span>
<span class="line"><span>    @npmcli</span></span>
<span class="line"><span>    @pkgjs</span></span>
<span class="line"><span>    @tootallnate</span></span>
<span class="line"><span>    abbrev</span></span>
<span class="line"><span>    agentkeepalive</span></span>
<span class="line"><span>    aggregate-error</span></span>
<span class="line"><span>    aproba</span></span>
<span class="line"><span>    are-we-there-yet</span></span>
<span class="line"><span>    asynciterator.prototype</span></span>
<span class="line"><span>    cacache</span></span>
<span class="line"><span>    chownr</span></span>
<span class="line"><span>    clean-stack</span></span>
<span class="line"><span>    color-support</span></span>
<span class="line"><span>    console-control-strings</span></span>
<span class="line"><span>    deep-equal</span></span>
<span class="line"><span>    delegates</span></span>
<span class="line"><span>    depd</span></span>
<span class="line"><span>    eastasianwidth</span></span>
<span class="line"><span>    encoding</span></span>
<span class="line"><span>    env-paths</span></span>
<span class="line"><span>    err-code</span></span>
<span class="line"><span>    es-get-iterator</span></span>
<span class="line"><span>    exponential-backoff</span></span>
<span class="line"><span>    foreground-child</span></span>
<span class="line"><span>    fs-minipass</span></span>
<span class="line"><span>    gauge</span></span>
<span class="line"><span>    graceful-fs</span></span>
<span class="line"><span>    has</span></span>
<span class="line"><span>    has-unicode</span></span>
<span class="line"><span>    humanize-ms</span></span>
<span class="line"><span>    ip</span></span>
<span class="line"><span>    is-lambda</span></span>
<span class="line"><span>    jackspeak</span></span>
<span class="line"><span>    jsonc-parser</span></span>
<span class="line"><span>    make-fetch-happen</span></span>
<span class="line"><span>    minipass-collect</span></span>
<span class="line"><span>    minipass-fetch</span></span>
<span class="line"><span>    minipass-flush</span></span>
<span class="line"><span>    minipass-pipeline</span></span>
<span class="line"><span>    minipass-sized</span></span>
<span class="line"><span>    minizlib</span></span>
<span class="line"><span>    mkdirp</span></span>
<span class="line"><span>    negotiator</span></span>
<span class="line"><span>    node-gyp</span></span>
<span class="line"><span>    nopt</span></span>
<span class="line"><span>    npmlog</span></span>
<span class="line"><span>    object-is</span></span>
<span class="line"><span>    p-map</span></span>
<span class="line"><span>    promise-retry</span></span>
<span class="line"><span>    retry</span></span>
<span class="line"><span>    set-blocking</span></span>
<span class="line"><span>    smart-buffer</span></span>
<span class="line"><span>    socks</span></span>
<span class="line"><span>    socks-proxy-agent</span></span>
<span class="line"><span>    ssri</span></span>
<span class="line"><span>    stop-iteration-iterator</span></span>
<span class="line"><span>    string-width-cjs</span></span>
<span class="line"><span>    strip-ansi-cjs</span></span>
<span class="line"><span>    tar</span></span>
<span class="line"><span>    unique-filename</span></span>
<span class="line"><span>    unique-slug</span></span>
<span class="line"><span>    wide-align</span></span>
<span class="line"><span>    wrap-ansi-cjs</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Only in node_modules_bun:</span></span>
<span class="line"><span>    confbox</span></span>
<span class="line"><span>    es-object-atoms</span></span>
<span class="line"><span>    word-wrap</span></span>
<span class="line"><span></span></span></code></pre>
<p>Curious to see if those packages missing in buns <code>node_modules</code> are actually used anywhere.</p>
<h2 id="plugins">Plugins</h2>
<p>In Relational Migrator we use few plugins with vite, namely <code>svgr</code>, <code>vanilla-extract</code> and <code>sentry</code>. Bun only supports limited esbuild plugins and does not have the aforementioned plugins. Some of them work with minimal changes, some of them do not work entirely.</p>
<h3 id="svgr-plugin"><code>svgr</code> plugin</h3>
<p><code>svgr</code> worked with minimal alterations:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> svgrEsbuildPlugin </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'esbuild-plugin-svgr'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Bun.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">build</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    plugins: [</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        svgrEsbuildPlugin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> unknown</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> BunPlugin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<p>But required to change the imports from</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { ReactComponent </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DatabaseAccessImage } </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> './assets/database-access-image.svg'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span></code></pre>
<p>to</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> DatabaseAccessImage </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> './assets/database-access-image.svg'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span></code></pre>
<h3 id="vanilla-extract-plugin"><code>vanilla-extract</code> plugin</h3>
<p>This one loads vite server to compile the CSS and does not work no matter what I tried, throwing the following errors all over the place:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>error: Styles were unable to be assigned to a file. This is generally caused by one of the following:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- You may have created styles outside of a '.css.ts' context</span></span>
<span class="line"><span>- You may have incorrect configuration. See https://vanilla-extract.style/documentation/getting-started</span></span>
<span class="line"><span>      at getFileScope (.../frontend/node_modules/@vanilla-extract/css/fileScope/dist/vanilla-extract-css-fileScope.cjs.dev.js:35:11)</span></span>
<span class="line"><span>      at generateIdentifier (.../frontend/node_modules/@vanilla-extract/css/dist/vanilla-extract-css.cjs.dev.js:175:7)</span></span>
<span class="line"><span>      at style (.../frontend/node_modules/@vanilla-extract/css/dist/vanilla-extract-css.cjs.dev.js:374:19)</span></span>
<span class="line"><span>      at .../frontend/src/shared/leafygreen-ui/badge/badge.css.ts:4:28</span></span>
<span class="line"><span></span></span></code></pre>
<p>Followed by</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>error: Module._load is not a function. (In 'Module._load(file, parentModule)', 'Module._load' is undefined)</span></span>
<span class="line"><span>    at .../frontend/src/components/mapping-banner.css.ts:1:0</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="sentry-plugin"><code>sentry</code> plugin</h3>
<p>This one was trivial and did not complain (I did not check if it actually works):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Bun.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">build</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    plugins: [</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">        sentryEsbuildPlugin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                disable: </span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">process.env.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">SENTRY_AUTH_TOKEN</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                org: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'mongodb-org'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                project: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'relational-migrator-frontend'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                telemetry: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">false</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                sourcemaps: {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        filesToDeleteAfterUpload: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'**/*.map'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }) </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> unknown</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> BunPlugin</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<h2 id="bundling">Bundling</h2>
<p>Bun is great to run bundling, testing or manage packages from CLI when things are relatively simple. When you need plugins (for instance), the interactions become tricky. For specifying and configuring bundle-time plugins one needs to use Buns JS/TS API and make a custom build script:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">await</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Bun.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">build</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> });</span></span>
<span class="line"></span></code></pre>
<p>By default, Bun does not log anything, which is actually quite inconvenient - not even build failures are logged. One has to get the result of <code>Bun.build()</code> and manually process them, which is a bit of a bummer:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> result</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> await</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Bun.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">build</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result.success) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">error</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Build failed'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> message</span><span style="color:#D73A49;--shiki-dark:#F97583"> of</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result.logs) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">error</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(message);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">} </span><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">info</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'Build succeeded'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<h2 id="configuration">Configuration</h2>
<p>Another inconvenient interaction - some actions require entire scripts (like build configuration, serving files, etc.). Then there is a config file, <code>bunfig.toml</code> where users can specify some configurations for Bun.</p>
<h2 id="running-tests">Running tests</h2>
<p>This one had the most issues on my end.</p>
<h3 id="react-testing-library"><code>react-testing-library</code></h3>
<p>Bun declares support for <code>react-testing-library</code>, which worked as expected.</p>
<h3 id="browser-apis">Browser APIs</h3>
<p>Had to use <code>happy-dom</code> and configure it in the <code>bunfig.toml</code> to enable some of the UI testing features (such as access to the <code>window</code> object). Yet, <code>happy-dom</code> still <a href="https://github.com/capricorn86/happy-dom/issues/241">lacks support for Canvas API</a>, for instance.</p>
<h3 id="testeach"><code>test.each</code></h3>
<p>It is one example of Buns partial compatibility with Jest - with Jest one can use nice-ish string interpolation to generate test name:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">each</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    currentStep | lastCompletedStep | progressType</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    ${</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}        | ${</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}              | ${'active'}</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    ${</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}        | ${</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}              | ${'inactive'}</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    ${</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}        | ${</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}              | ${'checked'}</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">  `</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    'returns $progressType for $currentStep and $lastCompletedStep'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">currentStep</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">lastCompletedStep</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">progressType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>With <code>bun:test</code> it is slightly different - you cant use arguments out of order, nor do you have access to their names. Neither can you use this nice syntactic sugar for defining test cases in a table manner.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> cases</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    // currentStep | lastCompletedStep | progressType</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'active'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'inactive'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [ </span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'checked'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  ];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">each</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(cases)(</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    'For %p and %p returns %p'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    (</span><span style="color:#E36209;--shiki-dark:#FFAB70">currentStep</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">lastCompletedStep</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">progressType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">      expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getProgressType</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(currentStep, lastCompletedStep)).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toEqual</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        progressType</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      );</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span class="line"></span></code></pre>
<p>Oh, and there is no <code>describe.each()</code> functionality at all, which makes defining suites of tests more tedious.</p>
<h3 id="mocks">Mocks</h3>
<p>Mocks work as expected, out of the box. There are mocks for system clock, which is nice. Had to replace <code>vi.fn()</code> with <code>mock()</code> and a corresponding <code>import { mock } from 'bun:test';</code>.</p>
<h3 id="objectcontaining-matchers"><code>ObjectContaining</code> matchers</h3>
<p>When using nested matchers in the <code>ObjectContaining</code>, some of them are missing in Jest compatibility (like <code>expect.toBeNumber</code>):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(nodes).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toEqual</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        expect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">objectContaining</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          id: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'node-1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          position: { x: expect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toBeNumber</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(), y: expect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toBeNumber</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<p>Had to use <code>expect.any(Number)</code> instead:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">expect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(nodes).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">toEqual</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        expect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">objectContaining</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          id: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'node-1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">          position: { x: expect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Number), y: expect.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Number) },</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span></code></pre>
<h3 id="using-fragment-import-alongside">Using <code>Fragment</code> import alongside <code>&#x3C;></code></h3>
<p>If a component contains both <code>import { Fragment } from 'react'</code> and uses a shorthand <code>&#x3C;></code>, Bun will yell at test time (but not at build time, interestingly enough):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>SyntaxError: Cannot declare an imported binding name twice: 'Fragment'.</span></span>
<span class="line"><span></span></span></code></pre>
<p>If you specify a different <code>jsxFragmentFactory</code> in <code>tsconfig.json</code> <strong>and</strong> set <code>"jsx": "react"</code> (and <strong>not</strong> <code>"react-jsx"</code> or anything), you will get further.</p>
<p>After meddling with Bun source code itself, I figured something (like it parses files AST and modifies them to add missing imports, like <code>Fragment</code> but it ends up with duplicates), but even after applying some crude hacks to prevent it from adding those duplicate statements, I could not get to fix the issues. Left a comment on Buns <a href="https://github.com/oven-sh/bun/issues/7576">Github issue</a>, but from my experience developers do not pay enough attention to those.</p>
<p>Ended up manually changing sources for the libraries in question in <code>node_modules</code> folder directly (just for the test), which did actually help. Might be worth changing it in the libraries directly, but that wont work with everything.</p>
<h3 id="ace-editor">Ace editor</h3>
<p>It still is kinda impossible to use UMD/AMD modules in conjunction with TS in Bun tests - the nature of UMD is that once the file is imported, it uses IIF to define stuff, but Bun does not tolerate this (I presume it only parses the AST of the imported file but does not actually execute it in the right order).</p>
<p>Hence Ace editor, which uses UMDs, can not really be used as intended.</p>
<h2 id="buns-meat-and-potatoes">Buns meat and potatoes</h2>
<p>I did a bit of digging in Buns source code and it seems immature - commented out code, ignored tests, thousand-line-functions and files (<code>js_parser.zig</code> has <code>23.3k LOC</code>). And this is on top of using Zig, which is still at version <code>0.12</code> (as of writing of this post, <code>10 May 2024</code>) and has quite limited standard library (no <code>remove</code> and <code>find</code> methods in lists, no hash sets, etc.).</p>
<h2 id="bottom-line">Bottom line</h2>
<p>My experience shows that Bun might fine to be used in new and low-risk projects, but it is not ready for a drop-in replacement in existing or more or less complex projects.</p> </div>  </article><article> <h1> <a href="/2024/05/12/2024-05-12-more-than-typescript.html">More than TypeScript</a> </h1> <time datetime="2024-05-11T14:00:00.000Z"> May 12, 2024 </time> <div class="content"> <p>Back in 2011 frontend was a very different thing - JavaScript had no <code>class</code>, <code>Object.entries</code> / <code>Object.keys</code>, promises were a proof of concept idea (unless you used 3rd party library <a href="https://github.com/petkaantonov/bluebird">bluebird</a>) and Node was v0.10.</p>
<p>Then came <a href="https://coffeescript.org/">CoffeeScript</a>, which added nice helper features to JavaScript - list comprehensions, classes, string interpolation and if <em>statements</em> (meaning you could use them for variable assignment):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="coffeescript"><code><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># if statements</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">text</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> happy </span><span style="color:#D73A49;--shiki-dark:#F97583">and</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> knowsIt</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  chaChaCha</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sexy</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  knowsIt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#D73A49;--shiki-dark:#F97583"> if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tooSexy</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  removeShirt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  showIt</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># list comprehensions</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">courses</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'greens'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'caviar'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'truffles'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'roast'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'cake'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">menu</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (i, dish) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Menu Item #{i}: #{dish}"</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">menu</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, dish </span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dish, i </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> courses</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># ranges and list comprehensions</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">countdown</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (num </span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> num </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#D73A49;--shiki-dark:#F97583">..</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># iterating over object entries</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">yearsOld</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> max</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">ida</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">tim</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 11</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">ages</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> child, age </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> yearsOld</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">  "#{child} is #{age}"</span></span>
<span class="line"></span></code></pre>
<p>Whilst it was still compiled to an inferior ES5 JavaScript, it helped to organise the code and make it substantially cleaner.
The one drawback is that it did not provide any type safety <em>(only added recently, via <code>@flow</code> and you would still have to duplicate your classes if you wanted to use it - once in coffeescript and once in <code>@flow</code> annotations)</em>. Anyhow, CoffeeScript was a good tool for the task, if you ask me.</p>
<p>Then came <a href="https://dart.dev/">Dart</a>, <a href="https://flow.org/">Flow</a> and TypeScript, which were also compiled to ES5 JavaScript,
but instead of adding new syntax features, they aimed to solve a different problem - by introducing <em>types</em> they sought to
reduce the number of runtime errors with type checks at compile time.</p>
<p>This sounded so good that many developers and companies immediately got on board. Alas, the new tech still suffered from the same issue as JavaScript itself and most common cause of runtime errors - the <code>null</code> and <code>undefined</code> still was a thing, causing the exact same runtime errors.</p>
<p>The one true benefit offered by TypeScript over the others was that it allowed to seamlessly use existing JavaScript code. And, provided you have the type signatures for that JavaScript code, it could even perform type checking on it too, effectively reducing the requirements for using TypeScript in the existing codebase. No wonder it was an easy buy-in for many projects.</p>
<p>Fast-forward to 2024 (<strong>twelve</strong> years since its first release) and TypeScript dominates the frontend world. Over the years it seems to have been focused on improving the type system in terms of what can you do with types - union types, partial types, etc. It still suffers from the original issues though and there still are not too many new syntactic features to pair with its powerful type system (like pattern matching).</p>
<p>With the new EcmaScript standards, classes and promises becoming the first-class citizens in all browsers (even Internet Explorer / Edge, when it was still around), the APIs and syntax became more mature (<code>Object.entries</code>, <code>async / await</code> to reduce <a href="http://callbackhell.com/">callback hell</a>, <code>for .. of</code>, <code>const / let</code>, string interpolation and many others). There are still no list comprehensions or conditional expressions / pattern matching though.</p>
<p>TypeScript still does help in what I think is a small subset of highly-specific scenarios like navigating the code (jump to definition / declaration / find usages) in the IDE and refactoring the code. But IDEs matured as well, code navigation is not as much of a feature unique to TypeScript anymore as it used to be (in the era of Sublime Text). TypeScript can prevent some really naive errors at compile time like using a number instead of an object, but I dont think developers run into them these days - because, again, IDEs are really powerful these days, even VSCode and they help eliminate such mistakes to a large degree.</p>
<p>Lets consider a real-world scenario (from my work project): server returns a list of <code>LocationType</code> objects. Each one of the objects can be either a <code>Collection</code>, a <code>Document</code> (in a specific collection) or a <code>Table</code>, each with its own subset of fields, specific to the type. We need to handle each case differently (display them on the UI differently).</p>
<p>The OpenAPI spec:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">tableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">object</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="color:#032F62;--shiki-dark:#9ECBFF">table</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  properties</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    table</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">collectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">object</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="color:#032F62;--shiki-dark:#9ECBFF">collection</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  properties</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    collection</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">documentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">object</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  required</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="color:#032F62;--shiki-dark:#9ECBFF">collection</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="color:#032F62;--shiki-dark:#9ECBFF">document</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  properties</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    collection</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">string</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    document</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      type</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">string</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">location</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  oneOf</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="color:#22863A;--shiki-dark:#85E89D">$ref</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"#/components/tableLocation"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="color:#22863A;--shiki-dark:#85E89D">$ref</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"#/components/collectionLocation"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    - </span><span style="color:#22863A;--shiki-dark:#85E89D">$ref</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"#/components/documentLocation"</span></span>
<span class="line"></span></code></pre>
<p>And the TypeScript code generated by OpenAPI for the above spec looks like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    collection</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    collection</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    document</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    table</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> instanceOfCollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "collection"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> instanceOfDocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "collection"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "document"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> instanceOfTableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "table"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> isInstance;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">ignoreDiscriminator</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">ignoreDiscriminator</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'document'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'document'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">ignoreDiscriminator</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'table'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'table'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> JobLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> JobLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">ignoreDiscriminator</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> JobLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> json;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#6F42C1;--shiki-dark:#B392F0">CollectionLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#6F42C1;--shiki-dark:#B392F0">DocumentLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">), </span><span style="color:#D73A49;--shiki-dark:#F97583">...</span><span style="color:#6F42C1;--shiki-dark:#B392F0">TableLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This might be a bit too harsh on TypeScript as a language, considering this is not the best implementation (in my opinion), but this highlights one of the issues with TypeScript: this very same code caused a number of runtime errors caught by users - not exceptions, not compilation errors, but wrong UI behaviour - on the UI all locations were treated as a table location.</p>
<p>The reason why this was happening is the code itself - it does not really handle the choice type <code>JobUpdateLocation</code> correctly and instead of a choice type it returns a union type, to put it roughly - instead of <code>oneOf</code> it returns essentially <code>allOf</code> object.</p>
<p>Now, even if we were to rewrite it by hand (which would defeat the purpose of using OpenAPI and could be harder to keep in sync between client and server code), we would end up with something like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    collection</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    collection</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    document</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    table</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> instanceOfCollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"collection"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"document"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> instanceOfDocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"collection"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"document"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> instanceOfTableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> boolean</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"table"</span><span style="color:#D73A49;--shiki-dark:#F97583"> in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'collection'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'document'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'document'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        'table'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: json[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'table'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> JobLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> JobLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">json</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> any</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> JobLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> |</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ((json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">||</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (json </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfCollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfDocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfTableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfDocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfCollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfTableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfTableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfCollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#D73A49;--shiki-dark:#F97583"> !</span><span style="color:#6F42C1;--shiki-dark:#B392F0">instanceOfDocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      return</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocationFromJSONTyped</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(json);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>This is quite a verbose code, with few bad practices in place (the use of <code>any</code> and <code>object</code>, need to always be conscious of <code>undefined</code>), but this is literally what we ended up doing (the helpers, not redefining the types).</p>
<p>The types in TypeScript (or rather classes and interfaces) are also a point of a few confusing tricks you have to keep in mind - if we were to use <code>class</code> instead of <code>type</code>, as follows</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> collection</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> collection</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">document</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> table</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>we would eventually run into the similar bug at runtime, which is a perfectly valid behaviour from the perspective of TypeScript, because of <a href="https://www.typescriptlang.org/docs/handbook/type-compatibility.html">type compatibility</a>, meaning <code>DocumentLocation</code> and <code>CollectionLocation</code> could be used interchangeably, since they have a subset of compatible fields:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> a</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'col'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'doc'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">); </span><span style="color:#6A737D;--shiki-dark:#6A737D">// ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'col'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">); </span><span style="color:#6A737D;--shiki-dark:#6A737D">// also ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> c</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// not ok</span></span>
<span class="line"></span></code></pre>
<p>This would not work if <code>CollectionLocation</code>, <code>DocumentLocation</code> and <code>TableLocation</code> were <em>types</em> instead:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> a</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> CollectionLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { collection: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'col'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, document: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'doc'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// not ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DocumentLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { collection: </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'col'</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// not ok</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> c</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> TableLocation</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// not ok</span></span>
<span class="line"></span></code></pre>
<p>And the code to parse location from JSON is actually quite ugly. It would benefit so much from <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/switch-expression"><code>switch</code> expressions</a> or <a href="https://learn.microsoft.com/en-us/dotnet/fsharp/language-reference/pattern-matching">pattern matching</a>!</p>
<p>And we still have to remember to handle those potentially <code>undefined</code> values whenever we use the helper functions.
And heres an example from literally few days ago:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">interface</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Job</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">    projectId</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> jobsInProgress</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Job</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> message</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useProjectStatus</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    jobsInProgress[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]?.projectId </span><span style="color:#D73A49;--shiki-dark:#F97583">??</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ''</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useProjectStatus</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">projectId</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    const { data } = </span><span style="color:#6F42C1;--shiki-dark:#B392F0">useQuery</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">queryFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fetch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`/project/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">projectId</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    return data;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>The above code started throwing an error, since server responded with <code>500 Server Error</code>. Reason was quite simple - the <code>projectId</code>, which we recently started to validate on the server (expecting it to be a valid ID), was a blank string. Interesting thing: no one has questioned the very line causing the default value for <code>projectId</code> to become an empty string:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">jobsInProgress[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]?.projectId </span><span style="color:#D73A49;--shiki-dark:#F97583">??</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ''</span></span>
<span class="line"></span></code></pre>
<p>And issues like these are unbelievably common in front-end world, while being quite tricky to detect and resolve.
To fix this particular issue we added a client-side validation (to an extent) to run the query only when the <code>projectId</code> value is provided:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">useQuery</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  enabled: </span><span style="color:#D73A49;--shiki-dark:#F97583">!!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">projectId,</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  queryFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fetch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`/project/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">projectId</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<p>The problem remains: it is really easy to miss this rather small fallback to an empty string.</p>
<p>There is a solution in Scala world that somewhat addresses this issue - <a href="https://github.com/fthomas/refined">refined types</a>, which allows to have something along the lines of:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> eu</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timepit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">refined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">*</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> eu</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timepit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">refined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">api</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Refined</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> eu</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timepit</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">refined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NonBlankString</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MatchesRegex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".+"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> useProjectStatus</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">projectId</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Refined</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NonBlankString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> ???</span></span>
<span class="line"></span></code></pre>
<p>This would require wrapping all the values passed to <code>fetchData</code> in <code>refineV[NonBlankString]()</code> call and handling the case when the validation fails:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> generateId</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"some"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">).last</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fetchData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Refined</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NonBlankString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> println(</span><span style="color:#D73A49;--shiki-dark:#F97583">s</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"fetching '</span><span style="color:#24292E;--shiki-dark:#E1E4E8">$id</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'..."</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> main</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">args</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: </span><span style="color:#6F42C1;--shiki-dark:#B392F0">Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[</span><span style="color:#6F42C1;--shiki-dark:#B392F0">String</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    id </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> refineV[</span><span style="color:#6F42C1;--shiki-dark:#B392F0">NonBlankString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">](generateId())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  } </span><span style="color:#D73A49;--shiki-dark:#F97583">yield</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fetchData(id)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>But in the land of TypeScript, there is only so much you can do - TypeScript only works at compile time.</p>
<p>The above examples might sound like very far-fetched edge case scenarios, but keep in mind: this is the code generated automatically by one of the most popular tools from a trivial schema. This is not as far-fetched as it might seem.</p>
<p>Can we do better in TypeScript? Something like <code>refined</code> in Scala? What if we had a powerful type system and syntax to support it? And, if possible, get rid of the <code>null</code> and <code>undefined</code> along the way?</p>
<p>The problem of <code>null</code> and <code>undefined</code> can be mitigated to an extent by using some concepts of functional programming, similarly to how I <a href="/2022/08/11/jargon-free-functional-programming-introduction-tldr.html">showcased some time ago</a>. It would be quite hard to achieve, though, given the problem remains imbued in the language itself. Moreover, targeting the issues described above, it would take an entire standard library to really reduce the possibility of the issue:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> jobInProgressMaybe</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Job</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> List</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Job</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(jobsInProgress).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">first</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> projectIdMaybe</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> jobInProgress.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">map</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">j</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> j.projectId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">useQuery</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  enabled: projectIdMaybe.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isSome</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">  queryFn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    projectIdMaybe</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">flatMap</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">projectId</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fetch</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`/project/${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">projectId</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">orElse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Promise</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">reject</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'no projectId'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<p>We could <em>try</em> to address the empty string issue with the extensive type system:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NonEmptyString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">T</span><span style="color:#D73A49;--shiki-dark:#F97583"> extends</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ''</span><span style="color:#D73A49;--shiki-dark:#F97583"> extends</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> T</span><span style="color:#D73A49;--shiki-dark:#F97583"> ?</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> never</span><span style="color:#D73A49;--shiki-dark:#F97583"> :</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">type</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> MyString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">T</span><span style="color:#D73A49;--shiki-dark:#F97583"> extends</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> fetchData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">T</span><span style="color:#D73A49;--shiki-dark:#F97583"> extends</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>(</span><span style="color:#E36209;--shiki-dark:#FFAB70">id</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NonEmptyString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#6F42C1;--shiki-dark:#B392F0">T</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">`Fetching ${</span><span style="color:#24292E;--shiki-dark:#E1E4E8">id</span><span style="color:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>But it would <em>only</em> work if all the values are known at compile time, which is easily broken with the simplest test:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> generateId</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NonEmptyString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'moo'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">''</span><span style="color:#24292E;--shiki-dark:#E1E4E8">][</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> NonEmptyString</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">fetchData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">''</span><span style="color:#24292E;--shiki-dark:#E1E4E8">); </span><span style="color:#6A737D;--shiki-dark:#6A737D">// not ok</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">fetchData</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#6F42C1;--shiki-dark:#B392F0">generateId</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()); </span><span style="color:#6A737D;--shiki-dark:#6A737D">// ok, but guaranteed undefined behaviour at runtime</span></span>
<span class="line"></span></code></pre>
<p>And it would take even more effort to make <em>all</em> types uniquely identifiable (to solve the choice type problem).</p>
<p>The way most developers would approach solving similar issues in a real-world project would be (at best) adding some linters, checkers and relying on automated tests and high-quality code reviews. In my experience, this is a rather flimsy excuse rather than a real solution and it does not work most of the time - especially in edge case scenarios.</p>
<p>This is where Id suggest to use another language altogether, which, similarly to CoffeeScript and TypeScript back in the day, solved some problems at compile time. And suggest I will.</p>
<p>There is a big warning before I proceed though: another technology is a rather big decision, not to be taken lightly. Some might see it as an impossible switch, only few small or indie developers on rather unimportant projects would make. But remember it was the same story with ES6, TypeScript, bundlers and pretty much any significant upgrade in the past.</p>
<p>Balance bike is a good tool to get you going - it gets you from walking to moving fast. But if you want to get faster and further, you have to drop it at some stage in favour of a more advanced bike.</p>
<p>Similarly to how TypeScript and ESNext got you from plain callback-hell-infested JavaScript code to a better place - you can refactor code faster, it saves you from a few errors at compile time, the code is much cleaner and conscise now. But if you really want to get even further, you will have to make a leap of faith, make an investment into the future.</p>
<p>Here is my big controversial suggestion: a pure functional language, one with strong type system, which does not have a concept of null and undefined in the first place, with a nice sweet syntax.</p>
<p>Before landing on a specific choice, check out Elm (dead, but a good starting point) and PureScript, in that order. Let me explain.</p>
<p>Elm is like a very simplified Haskell - it is a pure functional language with a subset of Haskell syntax. It has a nice compiler with really good error messages. It enforces a structure for your application (redux-like). It gives you a gentle introduction to the functional programming concepts and it targets browsers (web applications). With its architecture, you can look at the message (action from redux) type and see exactly what are all possible operations in the application (which makes reading code and getting to know new codebases much easier).</p>
<p>On a bad note, it is not being developed since 2019, it comes with an entire runtime (saves you from runtime errors, but blows up the bundle size) and it is a all-or-nothing commitment for the project - it is an all-in-one platform and if you want to gradually update your application from React - sorry, you will have to rewrite entire parts of you application entirely in Elm. The good point turned bad, having all possible actions defined in one message type make complex applications <em>really</em> complex (with one massive type definition, an issue very familiar to developers who had to deal with Redux).</p>
<p><em>here could have been an Elm code sample</em></p>
<p>The next step on this journey would be PureScript. It is an actively developed language, it has a minimal footprint after compiled to JS (much smaller than Elm), it has a <em>very</em> rich ecosystem and, best of all, it has a very simple interop with JS and it can compile just one module. Top it up with Halogen framework and you effectively got yourself Elm on steroids. The downside is that it is slightly more complex platform (language and framework) compared to Elm, so the learning curve is a bit steeper.</p>
<p>The above example of CoffeeScript code could be written in plain PureScript like this:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> happy</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Boolean</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> knowsIt</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Boolean</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> sexy</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Boolean</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> tooSexy</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Boolean</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> chaChaCha</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> knowsItStr</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> removeShirt</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> showIt</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Array</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">mapWithIndex</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Map</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> M</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Tuple(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- if statements with multiple branches become pattern matching</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">text</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> happy </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> knowsIt </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> chaChaCha</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sexy </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> knowsItStr</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tooSexy </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> removeShirt</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> otherwise </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> showIt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- list comprehensions become function application</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">courses </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"greens"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"caviar"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"truffles"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"roast"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cake"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- string interpolation is possible via an external packages</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- https://pursuit.purescript.org/packages/purescript-interpolate</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Interpolate</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> I</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">menu' i dish </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> I</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">i </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Menu Item "</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="color:#032F62;--shiki-dark:#9ECBFF">": "</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dish</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- https://pursuit.purescript.org/packages/purescript-template-strings</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.TemplateString.Unsafe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">(&#x3C;~>)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">menu'</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i dish </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Menu Item ${i}: ${dish}"</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;~></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { i</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i, dish</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dish }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.TemplateString</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">(&#x3C;->)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Tuple.Nested</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">(/\)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">menu'</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i dish </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Menu Item ${i}: ${dish}"</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> [ </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"i"</span><span style="color:#D73A49;--shiki-dark:#F97583"> /\</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"dish"</span><span style="color:#D73A49;--shiki-dark:#F97583"> /\</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dish ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- pure PureScript string interpolation</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">menu i dish </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Menu Item "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show i) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ": "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> dish</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">x i dish </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> menu (i </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) dish</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- can not just call a function and ignore its result</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">x' </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> mapWithIndex x courses</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- ranges become Array monad</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- countdown :: Array Int</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">countdown </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  num </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#D73A49;--shiki-dark:#F97583"> ..</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  pure num</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- JavaScript objects exist in a separate package</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Foreign.Object</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> FO</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">yearsOld' </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> FO</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">fromHomogeneous { max</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, ida</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, tim</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 11</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- object as Map</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">yearsOld </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> M</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">fromFoldable [</span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "max"</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "ida"</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 9</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "tim"</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 11</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">y child age </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show child) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> " is "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show age)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ages </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> map y yearsOld</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">ages </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> map y yearsOld'</span></span>
<span class="line"></span></code></pre>
<p>The real deal with this approach is how to migrate from an existing (most likely) React/TypeScript/(webpack | vite) ecosystem to PureScript?</p>
<p>Expanding on Scott Wlaschins talk, you can (and probably should) separate the pure application logic from IO, potentially utilising the foreign imported functions to interact with the existing JS code (libraries). This way you keep your application logic error-free, and all the errors that can happen are shifted towards the presentation layer (MVC/MVP, remember this concept?).</p>
<p>This would be the best strategy for the most projects, migrating one bit at a time and making the application less and less error prone whilst not wreaking the havok by rewriting everything from scratch (very few businesses will buy into that).</p>
<p>The bigger issue is that most modern frontend apps I have seen are so mangled in mixing the business logic and the presentation layer, it would be challenging (to say the least) to unmangle it back to a reasonable code. Check how we handle UI action, triggering a HTTP request and updating both the UI (to display the request progress/status) and the application state (for other parts of the UI) at the same time.</p>
<p><em>here could have been a real-world application interaction handling code sample</em></p>
<p>Calling PureScript code from JavaScript (based on <a href="https://book.purescript.org/chapter10.html">FFI example in PureScript book</a>):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Test</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">gcd</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gcd </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gcd n </span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">gcd n m</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n </span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m     </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gcd (n </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> m) m</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  |</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> otherwise </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> gcd (m </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n) n</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ZeroOrOne</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Zero</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#22863A;--shiki-dark:#85E89D">One</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">inc</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ZeroOrOne</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ZeroOrOne</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Int</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">inc </span><span style="color:#22863A;--shiki-dark:#85E89D">Zero</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Zero</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">inc (</span><span style="color:#22863A;--shiki-dark:#85E89D">One</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n) </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> One</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (n </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">_zero </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Zero</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">_one </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> One</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">_two </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> One</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 2</span></span>
<span class="line"></span></code></pre>
<p>and then in JS:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> 'Test.js'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">gcd</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">15</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _zero</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Zero</span><span style="color:#24292E;--shiki-dark:#E1E4E8">();</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _one</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">One</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> _two</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">One</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">2</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">inc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(_zero));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">inc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(_one));</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">log</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Test.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">inc</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(_two));</span></span>
<span class="line"></span></code></pre>
<p>In the other direction (calling JS code from PureScript):</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setItem</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> key</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#E36209;--shiki-dark:#FFAB70"> value</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  window.localStorage.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">setItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(key, value);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">export</span><span style="color:#D73A49;--shiki-dark:#F97583"> const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getItem</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#E36209;--shiki-dark:#FFAB70"> key</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> () </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  window.localStorage.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">getItem</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(key);</span></span>
<span class="line"></span></code></pre>
<p>and then in PureScript:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> setItem</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">foreign</span><span style="color:#D73A49;--shiki-dark:#F97583"> import</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> getItem</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Argonaut</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DecodeJson</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> EncodeJson</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Argonaut.Decode.Generic</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">genericDecodeJson</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Argonaut.Encode.Generic</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">genericEncodeJson</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Generic.Rep</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Generic</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">-- define PhoneType</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">derive instance</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Generic</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> PhoneType</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">instance</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> EncodeJson</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> PhoneType</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> encodeJson </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> genericEncodeJson</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">instance</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> DecodeJson</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> PhoneType</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> decodeJson </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> genericDecodeJson</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">processItem</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Json</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Either</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Person</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">processItem item </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  jsonString </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> decodeJson item</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  j          </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> jsonParser jsonString</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  decodeJson j</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  item </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> getItem </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"person"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  initialPerson </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> processItem item </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Left</span><span style="color:#24292E;--shiki-dark:#E1E4E8">  err </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      log </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Error: "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> err </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ". Loading examplePerson"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      pure examplePerson</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Right</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> p   </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pure p</span></span>
<span class="line"></span></code></pre>
<p>Just to reiterate, I do understand that converting the application (and developers) to this new weird technology is an almost impossible task, especially in a large long-lived project. One way to reason about it and justify the transition is the resilience requirements of a project (the need for actually error-prone code) and the amount of time and effort spent to date on finding and fixing those nasty bugs and undefined behaviours in an application.</p> </div>  </article><article> <h1> <a href="/2024/05/10/2024-05-10-io-impact.html">IO impact</a> </h1> <time datetime="2024-05-10T04:01:24.000Z"> May 10, 2024 </time> <div class="content"> <p>At MongoDB I work on a <a href="https://www.mongodb.com/products/tools/relational-migrator">Relational Migrator</a> project - a tool which helps people migrate their relational database to MongoDB.
And recently we grew interested in the performance of our tool. Due to the nature of the migrations, they are usually extremely long
(potentially even never ending, for some scenarios). It is a rather valuable information to know where we can speed things up.</p>
<p>Hence we ran a profiler on a relatively big database of 1M rows. And this was what we saw:</p>
<img src="/images/io-impact/screenshot-1.webp" loading="lazy">
<p>The <code>handleBatch</code> method is where the meat and potatoes of our migration logic reside. It lasts for approx. <code>6.5 sec</code>.
We could have debated on which parts of this flame graph we could optimize (and we actually did), but we first decided to take a quick look
at the same graph from the higher level - not the CPU time (when CPU is actually doing the active work) but the <em>total</em> time:</p>
<img src="/images/io-impact/screenshot-2.webp" loading="lazy">
<p>The entire application run took <code>4,937 sec</code> (<code>1hr 22min 17sec</code>). Of which, the migration itself took only <code>130 sec</code>:</p>
<img src="/images/io-impact/screenshot-3.webp" loading="lazy">
<p>The biggest chunk of it was writing to MongoDB database at <code>120 sec</code>:</p>
<img src="/images/io-impact/screenshot-4.webp" loading="lazy">
<p>The actual migration logic is really just <code>3.5 sec</code>:</p>
<img src="/images/io-impact/screenshot-5.webp" loading="lazy">
<p>So out of <code>130 sec</code> of the actual migration run, the actual logic took <code>3.5 sec</code> or mere <code>2.69%</code>.
The rest was just IO (input/output). Which we also saw on the thread timeline:</p>
<img src="/images/io-impact/screenshot-6.webp" loading="lazy">
<p>Most time all the threads spent sleeping.</p>
<p>This is not new information, just a reminder that the slowest part of pretty much any application is input-output.</p> </div>  </article><article> <h1> <a href="/2024/04/19/2024-05-17-experiment-2-purescript-halogen.html">Strongly-typed front-end: experiment 2, simple application, in PureScript / Halogen</a> </h1> <time datetime="2024-04-19T00:47:48.000Z"> Apr 19, 2024 </time> <div class="content"> <h3 id="contents">Contents</h3>
<ol>
<li><a href="/strongly-typed-front-end/2021/04/19/introduction.html">Introduction</a></li>
<li><a href="/strongly-typed-front-end/experiment-1/2021/04/19/experiment-1.html">Experiment 1, darken_color</a></li>
<li>Experiment 2, simple application
<ul>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-elm.html">Elm</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-fsharp.html">F#</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-purescript.html">PureScript &#x26; purescript-react-dom</a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2024/05/17/experiment-2-purescript-halogen.html"><strong>PureScript &#x26; Halogen (you are here)</strong></a></li>
<li><a href="/strongly-typed-front-end/experiment-2/2021/04/19/experiment-2-reasonml.html">ReasonML</a></li>
</ul>
</li>
</ol>
<p>A more conventional way to implement the front-end application in PureScript would be using a framework called <a href="https://github.com/purescript-halogen/">Halogen</a>.</p>
<p>Starting off with a hello world example:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> H</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.Aff</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HA</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Events</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HE</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.VDom.Driver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">runUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> HA</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">runHalogenAff </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  body </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> HA</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">awaitBody</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  runUI component unit body</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Increment</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#22863A;--shiki-dark:#85E89D">Decrement</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">component </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkComponent</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { initialState</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , render</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , eval</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkEval </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">defaultEval { handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handleAction }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  initialState _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  render state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onClick </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">_ </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> Decrement</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"-"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> show state ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      , </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">button [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onClick </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">_ </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> Increment</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"+"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Increment</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">+</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Decrement</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"></span></code></pre>
<p>Adding the utility code akin to the other technologies:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Float</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Float</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pi </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea (</span><span style="color:#22863A;--shiki-dark:#85E89D">Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">getShape</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">getShape _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span></span>
<span class="line"></span></code></pre>
<p>This resurfaces few differences from Haskell, Elm and others:</p>
<ul>
<li>there is no <code>pi</code> constant in the <code>Prelude</code>, so need to import one of the <a href="https://pursuit.purescript.org/search?q=pi">available definitions</a>, I went with <code>Data.Number</code></li>
<li><code>Float</code> is not a type; there is <code>Number</code>, however</li>
<li><code>0</code> is not a <code>Number</code>, it is <code>Int</code>, confusing the audience</li>
</ul>
<p>These are all minor differences, however.
But this code is not a conventional PureScript either - it is working against the good practices of
functional programming and thus defeats the purpose of these experiments.
Examples of this are the heavy reliance on <code>String</code> instead of using the available type system.</p>
<p>Let us change that a bit:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.String.Read</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Read</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pi </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">instance</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Read</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  read </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    _ </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">instance</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Show</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  show </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Square</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "square"</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Circle</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "circle"</span></span>
<span class="line"></span></code></pre>
<p>Now, to the UI:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Properties</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HP</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">render state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select [] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input [],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"&#x3C;area>"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span></code></pre>
<p>In the application state we need to store the selected shape and the value, so we can utilize records for that:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">initialState _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span></code></pre>
<p>Then we need to modify the possible actions. Lets stick to the same approach of utilizing the type system:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) | </span><span style="color:#22863A;--shiki-dark:#85E89D">ChangeShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p>The thing glueing the two together is the <code>handleAction</code> function:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  ChangeValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state { value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value }</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  ChangeShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state { shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape }</span></span>
<span class="line"></span></code></pre>
<p>Here, unlike Haskell (to my best knowledge), the placeholder variable is being used
for pattern matching against the only function argument.
So instead of a little verbose</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">handleAction action </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> action </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  -- ...</span></span>
<span class="line"></span></code></pre>
<p>you can use this placeholder variable and just provide the branches for each of its possible values:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">  -- ...</span></span>
<span class="line"></span></code></pre>
<p>Modifying the state is done using the <a href="https://pursuit.purescript.org/packages/purescript-halogen-hooks/0.6.3/docs/Halogen.Hooks.HookM#v:modify_"><code>Halogen.Hooks.HookM.modify_</code></a> function, which allows us to only use the previous state value and provide a new state value, without the need to mess with monads.
In turn, we modify the state record using the record syntax:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">state { shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newShapeValue }</span></span>
<span class="line"></span></code></pre>
<p>Now the only bit left is tying the UI with the actions:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Events</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HE</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.String.Read</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">read</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Number</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> N</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Tuple(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">render state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChange onShapeChanged ] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChange onValueChanged ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_ [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"&#x3C;area>"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (read v)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChanged v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#22863A;--shiki-dark:#85E89D">N</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">fromString v)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">showArea state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Nothing</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Choose shape and provide its parameter"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape area) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Area of "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show shape) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> " is "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show area)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      shape </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">      let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      pure (</span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape area)</span></span>
<span class="line"></span></code></pre>
<p>Here is where most fun and benefit from using PureScript comes into play.</p>
<p>First of all, the <a href="https://pursuit.purescript.org/packages/purescript-halogen/7.0.0/docs/Halogen.HTML.Events#v:onValueChange"><code>HE.onValueChange</code></a>
event handler (the <code>onShapeChanged</code> and <code>onValueChanged</code> functions) - it will be called with the new value for the input instead of an entire
event object. This allows us to skip unpacking the raw value from that object.</p>
<p>Then, the action dispatchers take the value from the input and <em>try</em> to parse it, returning a <code>Maybe a</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">onShapeChanged</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onShapeChanged v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (read v)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">onValueChanged</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> String</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChanged v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#22863A;--shiki-dark:#85E89D">N</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">fromString v)</span></span>
<span class="line"></span></code></pre>
<p>It is actually a quite important part, since the shape might not be selected (making the <code>&#x3C;select></code> value an empty string) and the value might be either
a blank string or not a valid number string.
PureScript does not allow us to <em>not</em> handle these cases, so whenever we parse the user input, we get a <code>Maybe a</code> value and we <em>have to</em> handle both
scenarios when the value is valid and when it is not.</p>
<p>The function <code>showArea</code> is where this neatness comes together - we handle both values as one, using the <code>Data.Tuple</code> type to pair them together:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  shape </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape </span><span style="color:#6A737D;--shiki-dark:#6A737D">-- unpacks `Shape` from `Maybe Shape`</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#6A737D;--shiki-dark:#6A737D">-- unpacks `Number` from `Maybe Number`</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape value </span><span style="color:#6A737D;--shiki-dark:#6A737D">-- always returns a Number, since both `shape` and `value` are always provided</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  pure (</span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape area) </span><span style="color:#6A737D;--shiki-dark:#6A737D">-- returns a tuple of shape and area, packed in a `Maybe`</span></span>
<span class="line"></span></code></pre>
<p>The above code will shortcircuit whenever at any point it is trying to unpack a value from a <code>Nothing</code> and the whole <code>do</code> block will return <code>Nothing</code>.</p>
<p>Putting it all together:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="purescript"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">module</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Main</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Prelude</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Maybe</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Number</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> N</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.String.Read</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Read</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#6F42C1;--shiki-dark:#B392F0">read</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Data.Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Tuple(..)</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Effect</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> H</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.Aff</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HA</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HH</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Events</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HE</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.HTML.Properties</span><span style="color:#D73A49;--shiki-dark:#F97583"> as</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> HP</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> Halogen.VDom.Driver</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">runUI</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> | </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">calculateArea</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> N</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">pi </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">calculateArea </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">instance</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Read</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  read </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "square"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Square</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "circle"</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#22863A;--shiki-dark:#85E89D"> Just</span><span style="color:#22863A;--shiki-dark:#85E89D"> Circle</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    _ </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">instance</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Show</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#D73A49;--shiki-dark:#F97583"> where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  show </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Square</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "square"</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    Circle</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "circle"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">data</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Action</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) | </span><span style="color:#22863A;--shiki-dark:#85E89D">ChangeShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#6F42C1;--shiki-dark:#B392F0">Maybe</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Shape</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">component </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">  H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkComponent</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    { initialState</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , render</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    , eval</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">mkEval </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#22863A;--shiki-dark:#85E89D"> H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">defaultEval { handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> handleAction }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">  where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  initialState _ </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { shape</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, value</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#22863A;--shiki-dark:#85E89D"> Nothing</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  render state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">select [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChange onShapeChanged ] [</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value </span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape"</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Circle</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">          HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">option [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HP</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ] [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text (show </span><span style="color:#22863A;--shiki-dark:#85E89D">Square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">input [ </span><span style="color:#22863A;--shiki-dark:#85E89D">HE</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">onValueChange onValueChanged ],</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">div_ [ showArea state ]</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  onShapeChanged v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (read v)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  onValueChanged v </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> ChangeValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#22863A;--shiki-dark:#85E89D">N</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">fromString v)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  showArea state </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> res </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      Nothing</span><span style="color:#D73A49;--shiki-dark:#F97583"> -></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"Select shape and provide its value"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      Just</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape area) </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">        HH</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">text </span><span style="color:#D73A49;--shiki-dark:#F97583">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "Area of "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show shape) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;></span><span style="color:#032F62;--shiki-dark:#9ECBFF"> " is "</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (show area)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    where</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">      res </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        shape </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">shape</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        value </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">value</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> area </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> calculateArea shape value</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        pure (</span><span style="color:#22863A;--shiki-dark:#85E89D">Tuple</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape area)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  handleAction </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> case</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _ </span><span style="color:#D73A49;--shiki-dark:#F97583">of</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    ChangeValue</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state { value </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> value }</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">    ChangeShape</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">      H</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">modify_ </span><span style="color:#D73A49;--shiki-dark:#F97583">\</span><span style="color:#24292E;--shiki-dark:#E1E4E8">state </span><span style="color:#D73A49;--shiki-dark:#F97583">-></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> state { shape </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shape }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">main</span><span style="color:#D73A49;--shiki-dark:#F97583"> ::</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Effect</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> Unit</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">main </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#22863A;--shiki-dark:#85E89D"> HA</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">runHalogenAff </span><span style="color:#D73A49;--shiki-dark:#F97583">do</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  body </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;-</span><span style="color:#22863A;--shiki-dark:#85E89D"> HA</span><span style="color:#D73A49;--shiki-dark:#F97583">.</span><span style="color:#24292E;--shiki-dark:#E1E4E8">awaitBody</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">  runUI component unit body</span></span>
<span class="line"></span></code></pre> </div>  </article><article> <h1> <a href="/2024/02/08/2024-02-08-simulating-network-outage-in-docker.html">Simulating network outages in Docker</a> </h1> <time datetime="2024-02-08T04:01:24.000Z"> Feb 8, 2024 </time> <div class="content"> <p>Recently, for my work project I needed to simulate a system of ours going offline for a period of time (similar to having a network outage on a customer side).</p>
<p>I figured there are two ways to do it:</p>
<ul>
<li>using Docker networks</li>
<li>using host OS firewall</li>
</ul>
<p>With Docker network it is as easy as</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">docker</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> network</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> disconnect</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF">network-nam</span><span style="color:#24292E;--shiki-dark:#E1E4E8">e</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF">container-nam</span><span style="color:#24292E;--shiki-dark:#E1E4E8">e</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"></span></code></pre>
<p>This way you disconnect a container from a network (even if it is a bridge network, exposing the container to the host OS).</p>
<p>You can find a list of networks with <code>docker network ls</code> and list of containers with <code>docker ps</code>.</p>
<p>To roll it back (simulate recovery from an outage), simply</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> docker</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> network</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> connect</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF">network-nam</span><span style="color:#24292E;--shiki-dark:#E1E4E8">e</span><span style="color:#D73A49;--shiki-dark:#F97583">></span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x3C;</span><span style="color:#032F62;--shiki-dark:#9ECBFF">container-nam</span><span style="color:#24292E;--shiki-dark:#E1E4E8">e</span><span style="color:#D73A49;--shiki-dark:#F97583">></span></span>
<span class="line"></span></code></pre>
<p>Disconnecting a container from a network is okay, but sometimes you might want to have a fine-grain control over the outage,
like forbid a specific IP or port being accessed by your container.</p>
<p>With the firewall it is totally possible, but the steps differ for Linux and OSX.</p>
<p>In Linux you use <code>iptables</code> and control a rule group specific to Docker only:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> iptables</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -I</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DOCKER</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -p</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> tcp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --dport</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 27017</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -j</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DROP</span></span>
<span class="line"></span></code></pre>
<p>The above command will block all TCP traffic on port <code>27017</code> for all Docker containers.
To revert this, run</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> iptables</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -I</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DOCKER</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -p</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> tcp</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> dport</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 22</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ACCEPT</span></span>
<span class="line"></span></code></pre>
<p>To control a specific IP address use the <code>-s</code> parameter:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> iptables</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -I</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DOCKER</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -p</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> tcp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -s</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 192.168.0.10</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --dport</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 27017</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -j</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DROP</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> iptables</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -I</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> DOCKER</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -p</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> tcp</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -s</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 192.168.0.10</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> --dport</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 27017</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -j</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ACCEPT</span></span>
<span class="line"></span></code></pre>
<p>On the other hand, OSX uses a tool with BSD roots, <code>pf</code>.
You can use the <code>/etc/pf.conf</code> file to mess with firewall rules.</p>
<p>Blocking traffic is achieved by adding a rule like below to the <code>/etc/pf.conf</code> file:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>block drop out quick proto tcp from any to any port 27017</span></span>
<span class="line"><span></span></span></code></pre>
<p>followed by reloading the rule list with</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> pfctl</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -f</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> /etc/pf.conf</span></span>
<span class="line"></span></code></pre>
<p>In case <code>pf</code> is disabled, one is enabled running</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">$</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> pfctl</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> -e</span></span>
<span class="line"></span></code></pre>
<p>Re-enabling is as easy as removing (or commenting out) the rule line in the <code>/etc/pf.conf</code> file and reloading it with <code>pfctl -f /etc/pf.conf</code>.</p> </div>  </article><article> <h1> <a href="/2024/01/04/2024-01-04-how-unique-are-your-bundles.html">How unique are your bundles?</a> </h1> <time datetime="2024-01-04T04:01:24.000Z"> Jan 4, 2024 </time> <div class="content"> <p>In the modern front-end development we are all used to package managers, transpilation and bundling.
These concepts are the biproduct of the tools which we hoped would simplify developer burden and
speed up the development.</p>
<p>However, how confident are you these tools are actually doing good job?</p>
<p>Developers seem comfortable off-loading the processing power to users machine (browser, predominantly).
We are not surprised by seeing slow websites anymore. A simple blog is downloading 55MB of JavaScript?
Seems fine nowadays.</p>
<p>I currently work on a fairly small tool (<a href="https://www.mongodb.com/products/relational-migrator">MongoDB Relational Migrator</a>),
which also utilizes TypeScript, React and, of course, bundling.
We use Vite for that. Our bundles are split into chunks (but I have accounted for that, too).</p>
<p>I went ahead and wrote a rather <a href="https://github.com/shybovycha/js-unique-function-analyzer">simple script</a>
which parses the bundles (using TypeScript compiler API, because why not),
extracting the function definitions (both arrow functions and plain old <code>function</code>) and counts how many times they
occur in the file. For this last bit, to make sure I am not counting <code>a => true</code> and <code>x => true</code> as different occurrences,
I am minimizing the function definition with <code>uglifyjs</code> and counting the SHA256 hashes of the minimized functions
(just to have a reasonable key in my hashmap instead of entire function code).</p>
<p>These are my findings.</p>
<p>Out of 54 chunks, 47 are not css-in-js chunks. Out of 47 remaining, 7 have any significant duplication (over 5%).
But when they do, they do it hard: duplication varies between 18% and a whopping 42% of sheer file size.
Absolute numbers are also astonishing: 33% to 59% functions are duplicates.</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Found 15192 functions, 8963 are unique (59%)</span></span>
<span class="line"><span>Duplicates length: 1518418 bytes out of 3537579 bytes are duplicate code (42.92%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Found 1202 functions, 494 are unique (41.1%)</span></span>
<span class="line"><span>Duplicates length: 130649 bytes out of 340227 bytes are duplicate code (38.4%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Found 513 functions, 231 are unique (45.03%)</span></span>
<span class="line"><span>Duplicates length: 50160 bytes out of 136057 bytes are duplicate code (36.87%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Found 598 functions, 267 are unique (44.65%)</span></span>
<span class="line"><span>Duplicates length: 57607 bytes out of 164737 bytes are duplicate code (34.97%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Found 17 functions, 10 are unique (58.82%)</span></span>
<span class="line"><span>Duplicates length: 1932 bytes out of 6532 bytes are duplicate code (29.58%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Found 154 functions, 98 are unique (63.64%)</span></span>
<span class="line"><span>Duplicates length: 11140 bytes out of 45135 bytes are duplicate code (24.68%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Found 968 functions, 651 are unique (67.25%)</span></span>
<span class="line"><span>Duplicates length: 52616 bytes out of 281406 bytes are duplicate code (18.7%)</span></span>
<span class="line"><span></span></span></code></pre>
<p>I thought my code might be wrong, so I looked into the bundle code itself. Heres a short excerpt:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">bind</span><span style="color:#24292E;--shiki-dark:#E1E4E8">():</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[t];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n,r)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[r]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n[r])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e},yR.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Zce;</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> bR</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> bR</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">bind</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">:function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[t];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n,r)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[r]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n[r])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e},bR.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Wce;</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> wR</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> wR</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">bind</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">:function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[t];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n,r)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[r]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n[r])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e},wR.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Uce;</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> $R</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> $R</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">bind</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">:function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[t];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n,r)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[r]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n[r])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e},$R.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Gce;</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> OR</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> OR</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">bind</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">:function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[t];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n,r)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[r]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n[r])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e},</span><span style="color:#005CC5;--shiki-dark:#79B8FF">OR</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> Kce;</span><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> xR</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> xR</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign</span><span style="color:#D73A49;--shiki-dark:#F97583">?</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">bind</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">:function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[t];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n,r)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[r]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n[r])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e},xR.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}</span></span>
<span class="line"></span></code></pre>
<p>See how the following fragment of code repeats multiple times:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[t];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> n)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(n,r)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[r]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">n[r])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e}</span></span>
<span class="line"></span></code></pre>
<p>In fact, this exact same fragment of code repeats 137 times in the same piece of bundle chunk (same file):</p>
<img src="/images/how-unique-are-your-bundles/duplication1.webp" loading="lazy" alt="Repeated function definition in a single chunk of code">
<p>By the way, this is a production build of our front-end, built using Vite, with minification enabled.</p>
<p>The raw length of this function code is <code>146</code> characters. So in a single place, in a single file, you have <code>136 * 146 = 19_992</code> bytes of waste.
Meaning, browser has to load these 20KB of code, parse it and create 136 duplicating functions.</p>
<p>Looking at the overall size of 3.5MB of code in this chunk and its insane 41% duplicated code (in sheer bytes, not occurrences, so 1.5MB wasted),
imagine how much faster this single file <em>could</em> have been loaded in a browser.</p>
<p>I was keen on seeing what functions get duplicated most often and ran my script on an entire build output directory.
Here are top 80-ish offenders:</p>





















































































































































































































































































































































<table><thead><tr><th>Function code (minimized)</th><th>Copies</th></tr></thead><tbody><tr><td><code>function(r){for(var t=1;t&#x3C;arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&#x26;&#x26;(r[n]=o[n])}return r}</code></td><td>2205</td></tr><tr><td><code>function n(){return Object.assign&#x26;&#x26;Object.assign.bind(),n.apply(this,arguments)}</code></td><td>1197</td></tr><tr><td><code>function n(){return Object.assign,n.apply(this,arguments)}</code></td><td>1008</td></tr><tr><td><code>function(){}</code></td><td>753</td></tr><tr><td><code>function(i){this.a=i}</code></td><td>250</td></tr><tr><td><code>function(n,e){if(null==n)return{};for(var r,t={},f=Object.keys(n),u=0;u&#x3C;f.length;u++)r=f[u],0&#x3C;=e.indexOf(r)||(t[r]=n[r]);return t}</code></td><td>191</td></tr><tr><td><code>function(e,r){if(null==e)return{};var t,n=function(e,r){if(null==e)return{};for(var t,n={},l=Object.keys(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols)for(var l=Object.getOwnPropertySymbols(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&#x26;&#x26;(n[t]=e[t]);return n}</code></td><td>187</td></tr><tr><td><code>function(e,r){return r=r||e.slice(0),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}</code></td><td>159</td></tr><tr><td><code>function(n){return this===n}</code></td><td>119</td></tr><tr><td><code>function(r,t){if("object"!=typeof r||null===r)return r;var e=r[Symbol.toPrimitive];if(void 0===e)return("string"===t?String:Number)(r);e=e.call(r,t||"default");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}</code></td><td>113</td></tr><tr><td><code>function(r,e,t){return i=function(r,e){if("object"!=typeof r||null===r)return r;var t=r[Symbol.toPrimitive];if(void 0===t)return String(r);t=t.call(r,e);if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),(e="symbol"==typeof i?i:String(i))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r;var i}</code></td><td>111</td></tr><tr><td><code>function(t){t=function(t,r){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return String(t);i=i.call(t,r);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}</code></td><td>111</td></tr><tr><td><code>function(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}</code></td><td>104</td></tr><tr><td><code>function(c,i){He.call(this,c,i)}</code></td><td>94</td></tr><tr><td><code>function(n,r){(null==r||r&#x26;gt;n.length)&#x26;&#x26;(r=n.length);for(var e=0,l=new Array(r);e&#x3C;r;e++)l[e]=n[e];return l}</code></td><td>93</td></tr><tr><td><code>function(){return!0}</code></td><td>92</td></tr><tr><td><code>function(){return!1}</code></td><td>78</td></tr><tr><td><code>function(){return new gt(this)}</code></td><td>77</td></tr><tr><td><code>function(r){if(Array.isArray(r))return r}</code></td><td>77</td></tr><tr><td><code>function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}</code></td><td>77</td></tr><tr><td><code>function(t){return t&#x26;&#x26;"object"==typeof t&#x26;&#x26;"default"in t?t:{default:t}}</code></td><td>76</td></tr><tr><td><code>function(i,t){this.a=i,this.b=t}</code></td><td>58</td></tr><tr><td><code>function(){return this.a}</code></td><td>49</td></tr><tr><td><code>function(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&#x26;&#x26;(r=Object.getOwnPropertySymbols(t),e&#x26;&#x26;(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}</code></td><td>49</td></tr><tr><td><code>function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(c,e),Object.defineProperty(y,e,t.get?t:{enumerable:!0,get:function(){return c[e]}}))}</code></td><td>49</td></tr><tr><td><code>function(){return c[b]}</code></td><td>49</td></tr><tr><td><code>function(a,e,i){var r,t=i["aria-label"],n=i["aria-labelledby"],c=i.title;switch(a){case"img":return t||n||c?(l(r={},"aria-labelledby",n),l(r,"aria-label",t),l(r,"title",c),r):{"aria-label":"".concat(e.replace(/([a-z])([A-Z])/g,"$1 $2")," Icon")};case"presentation":return{"aria-hidden":!0,alt:""}}}</code></td><td>49</td></tr><tr><td><code>function(i){Di(this,i)}</code></td><td>48</td></tr><tr><td><code>function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}</code></td><td>48</td></tr><tr><td><code>function(){throw M(new De)}</code></td><td>46</td></tr><tr><td><code>function(l,r){var t=null==l?null:typeof Symbol&#x3C;"u"&#x26;&#x26;l[Symbol.iterator]||l["@@iterator"];if(null!=t){var n,u,e=[],a=!0,o=!1;try{for(t=t.call(l);!(a=(n=t.next()).done)&#x26;&#x26;(e.push(n.value),!r||e.length!==r);a=!0);}catch(l){o=!0,u=l}finally{try{a||null==t.return||t.return()}finally{if(o)throw u}}return e}}</code></td><td>44</td></tr><tr><td><code>function(n){throw M(new De)}</code></td><td>39</td></tr><tr><td><code>function(r){var n;return r&#x26;&#x26;"object"==typeof r&#x26;&#x26;"default"in r?r:(n=Object.create(null),r&#x26;&#x26;Object.keys(r).forEach(function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(r,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}}))}),n.default=r,Object.freeze(n))}</code></td><td>39</td></tr><tr><td><code>function n(r){return n(r)}</code></td><td>38</td></tr><tr><td><code>function(n){return typeof n}</code></td><td>38</td></tr><tr><td><code>function(o){return o&#x26;&#x26;"function"==typeof Symbol&#x26;&#x26;o.constructor===Symbol&#x26;&#x26;o!==Symbol.prototype?"symbol":typeof o}</code></td><td>38</td></tr><tr><td><code>function(r){var n;return r&#x26;&#x26;r.__esModule?r:(n=Object.create(null),r&#x26;&#x26;Object.keys(r).forEach(function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(r,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}}))}),n.default=r,Object.freeze(n))}</code></td><td>37</td></tr><tr><td><code>function(){return this.b}</code></td><td>33</td></tr><tr><td><code>function(l,r){var t=null==l?null:typeof Symbol&#x3C;"u"&#x26;&#x26;l[Symbol.iterator]||l["@@iterator"];if(null!=t){var e,n,u,a,f=[],i=!0,o=!1;try{if(u=(t=t.call(l)).next,0===r){if(Object(t)!==t)return;i=!1}else for(;!(i=(e=u.call(t)).done)&#x26;&#x26;(f.push(e.value),f.length!==r);i=!0);}catch(l){o=!0,n=l}finally{try{if(!i&#x26;&#x26;null!=t.return&#x26;&#x26;(a=t.return(),Object(a)!==a))return}finally{if(o)throw n}}return f}}</code></td><td>33</td></tr><tr><td><code>function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}</code></td><td>32</td></tr><tr><td><code>function(n){return Ei(n)}</code></td><td>30</td></tr><tr><td><code>function(n){return L(fn,X,2,n,6,1)}</code></td><td>30</td></tr><tr><td><code>function(n){}</code></td><td>29</td></tr><tr><td><code>function(r){if(typeof Symbol&#x3C;"u"&#x26;&#x26;null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}</code></td><td>28</td></tr><tr><td><code>function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}</code></td><td>28</td></tr><tr><td><code>()=>{}</code></td><td>27</td></tr><tr><td><code>function(){return null}</code></td><td>27</td></tr><tr><td><code>function(n,o){e.exports=o(m,on(),dn)}</code></td><td>27</td></tr><tr><td><code>function(i){Fi(this,i)}</code></td><td>23</td></tr><tr><td><code>function(n,o){e.exports=o(dn,on(),m)}</code></td><td>22</td></tr><tr><td><code>function(){throw M(new Fe(Re((xe(),Ds))))}</code></td><td>21</td></tr><tr><td><code>function(){return this}</code></td><td>20</td></tr><tr><td><code>function(i,t){this.b=i,this.a=t}</code></td><td>19</td></tr><tr><td><code>function(n,e){throw M(new De)}</code></td><td>18</td></tr><tr><td><code>function(){return 0}</code></td><td>17</td></tr><tr><td><code>function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}</code></td><td>16</td></tr><tr><td><code>()=>{var l;return null!=(l=e.options.debugAll)?l:e.options.debugHeaders}</code></td><td>16</td></tr><tr><td><code>function(n){return n}</code></td><td>15</td></tr><tr><td><code>function(c){Kr.call(this,c)}</code></td><td>15</td></tr><tr><td><code>function(){return this.c}</code></td><td>15</td></tr><tr><td><code>function(){return this.d}</code></td><td>15</td></tr><tr><td><code>function(n,r){return n}</code></td><td>14</td></tr><tr><td><code>d=>d.id</code></td><td>14</td></tr><tr><td><code>function(){var r=function(t,o){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,o){t.__proto__=o}:function(t,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&#x26;&#x26;(t[n]=o[n])}))(t,o)};return function(t,o){if("function"!=typeof o&#x26;&#x26;null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}</code></td><td>14</td></tr><tr><td><code>function(_,o){_.__proto__=o}</code></td><td>14</td></tr><tr><td><code>function(o,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&#x26;&#x26;(o[t]=r[t])}</code></td><td>14</td></tr><tr><td><code>function(n){return!1}</code></td><td>13</td></tr><tr><td><code>function(t){var l=-1,n=null==t?0:t.length;for(this.clear();++l&#x3C;n;){var r=t[l];this.set(r[0],r[1])}}</code></td><td>12</td></tr><tr><td><code>function(a,e,l){var i,r=l["aria-label"],t=l["aria-labelledby"],n=l.title;switch(a){case"img":return r||t||n?(f(i={},"aria-labelledby",t),f(i,"aria-label",r),f(i,"title",n),i):{"aria-label":"".concat(e.replace(/([a-z])([A-Z])/g,"$1 $2")," Icon")};case"presentation":return{"aria-hidden":!0,alt:""}}}</code></td><td>12</td></tr><tr><td><code>a=>a</code></td><td>12</td></tr><tr><td><code>a=>a()</code></td><td>12</td></tr><tr><td><code>function(n,a){n.a=a}</code></td><td>11</td></tr><tr><td><code>function(){ia.call(this)}</code></td><td>11</td></tr><tr><td><code>function(i,t,h){this.a=i,this.b=t,this.c=h}</code></td><td>11</td></tr><tr><td><code>function(n,r){return r}</code></td><td>11</td></tr><tr><td><code>function(){return this.a.gc()}</code></td><td>11</td></tr><tr><td><code>function(e){return e&#x26;&#x26;e.__esModule?e:{default:e}}</code></td><td>11</td></tr><tr><td><code>()=>n(!1)</code></td><td>11</td></tr><tr><td><code>function(i){this.b=i}</code></td><td>10</td></tr><tr><td><code>function(c){this.c=c}</code></td><td>10</td></tr><tr><td><code>function(){return this.f}</code></td><td>10</td></tr><tr><td><code>function(n){return n||"div"}</code></td><td>10</td></tr><tr><td><code>function(n,r,i){var l;return i=null!=(l=i)?l:"div",n||("string"==typeof(null==r?void 0:r.href)?"a":i)}</code></td><td>10</td></tr></tbody></table>
<p>Lets dive deeper, shall we?</p>
<p>Imagine for a second that we could define the duplicated functions once and then just reuse the short name instead
(sounds reasonable, does it not?).</p>
<p>But not all of those functions could be de-duplicated in such way (at least not so easily).
Some of these functions use the outer closure functions and variables (something defined outside of the function itself), so we can skip these.
For instance, <code>function(i){Di(this,i)}</code> and <code>function(){throw M(new De)}</code> can be ignored.</p>
<p>Then, there are function using <code>this</code>. These might be tricky (<code>this is not what you think</code> is a famous JavaScript mantra).</p>
<p>Lastly, some (if not most) of the functions could be either replaced with arrow functions or standard library function.
But that is uncertain - one must understand what a function does first.</p>
<p>With those points in mind, lets look at the offenders once again:</p>
















































































































































































































































<table><thead><tr><th>Function code (minimized)</th><th>Copies</th><th>Notes</th></tr></thead><tbody><tr><td><code>function(r){for(var t=1;t&#x3C;arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&#x26;&#x26;(r[n]=o[n])}return r}</code></td><td>2205</td><td>spread operator?</td></tr><tr><td><code>function n(){return Object.assign&#x26;&#x26;Object.assign.bind(),n.apply(this,arguments)}</code></td><td>1197</td><td><code>Object.assign</code> methods?</td></tr><tr><td><code>function n(){return Object.assign,n.apply(this,arguments)}</code></td><td>1008</td><td><code>Object.assign</code> properties?</td></tr><tr><td><code>function(){}</code></td><td>753</td><td>no-op</td></tr><tr><td><code>function(n,e){if(null==n)return{};for(var r,t={},f=Object.keys(n),u=0;u&#x3C;f.length;u++)r=f[u],0&#x3C;=e.indexOf(r)||(t[r]=n[r]);return t}</code></td><td>191</td><td>?</td></tr><tr><td><code>function(e,r){if(null==e)return{};var t,n=function(e,r){if(null==e)return{};for(var t,n={},l=Object.keys(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols)for(var l=Object.getOwnPropertySymbols(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&#x26;&#x26;(n[t]=e[t]);return n}</code></td><td>187</td><td>?</td></tr><tr><td><code>function(e,r){return r=r||e.slice(0),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}</code></td><td>159</td><td>?</td></tr><tr><td><code>function(r,t){if("object"!=typeof r||null===r)return r;var e=r[Symbol.toPrimitive];if(void 0===e)return("string"===t?String:Number)(r);e=e.call(r,t||"default");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}</code></td><td>113</td><td>?</td></tr><tr><td><code>function(r,e,t){return i=function(r,e){if("object"!=typeof r||null===r)return r;var t=r[Symbol.toPrimitive];if(void 0===t)return String(r);t=t.call(r,e);if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),(e="symbol"==typeof i?i:String(i))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r;var i}</code></td><td>111</td><td>?</td></tr><tr><td><code>function(t){t=function(t,r){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return String(t);i=i.call(t,r);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}</code></td><td>111</td><td>?</td></tr><tr><td><code>function(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}</code></td><td>104</td><td>?</td></tr><tr><td><code>function(n,r){(null==r||r>n.length)&#x26;&#x26;(r=n.length);for(var e=0,l=new Array(r);e&#x3C;r;e++)l[e]=n[e];return l}</code></td><td>93</td><td>array spread?</td></tr><tr><td><code>function(){return!0}</code></td><td>92</td><td>always-true</td></tr><tr><td><code>function(){return!1}</code></td><td>78</td><td>always-false</td></tr><tr><td><code>function(r){if(Array.isArray(r))return r}</code></td><td>77</td><td>self explanatory</td></tr><tr><td><code>function(){throw new TypeError('Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.')}</code></td><td>77</td><td><code>isSymbol</code>?</td></tr><tr><td><code>function(t){return t&#x26;&#x26;"object"==typeof t&#x26;&#x26;"default"in t?t:{default:t}}</code></td><td>76</td><td>?</td></tr><tr><td><code>function(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&#x26;&#x26;(r=Object.getOwnPropertySymbols(t),e&#x26;&#x26;(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}</code></td><td>49</td><td>?</td></tr><tr><td><code>function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(c,e),Object.defineProperty(y,e,t.get?t:{enumerable:!0,get:function(){return c[e]}}))}</code></td><td>49</td><td>?</td></tr><tr><td><code>function(l,r){var t=null==l?null:typeof Symbol&#x3C;"u"&#x26;&#x26;l[Symbol.iterator]||l["@@iterator"];if(null!=t){var n,u,e=[],a=!0,o=!1;try{for(t=t.call(l);!(a=(n=t.next()).done)&#x26;&#x26;(e.push(n.value),!r||e.length!==r);a=!0);}catch(l){o=!0,u=l}finally{try{a||null==t.return||t.return()}finally{if(o)throw u}}return e}}</code></td><td>44</td><td>?</td></tr><tr><td><code>function(r){var n;return r&#x26;&#x26;"object"==typeof r&#x26;&#x26;"default"in r?r:(n=Object.create(null),r&#x26;&#x26;Object.keys(r).forEach(function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(r,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}}))}),n.default=r,Object.freeze(n))}</code></td><td>39</td><td>?</td></tr><tr><td><code>function n(r){return n(r)}</code></td><td>38</td><td><code>Function.apply</code>?</td></tr><tr><td><code>function(n){return typeof n}</code></td><td>38</td><td><code>typeof</code></td></tr><tr><td><code>function(o){return o&#x26;&#x26;"function"==typeof Symbol&#x26;&#x26;o.constructor===Symbol&#x26;&#x26;o!==Symbol.prototype?"symbol":typeof o}</code></td><td>38</td><td>?</td></tr><tr><td><code>function(r){var n;return r&#x26;&#x26;r.__esModule?r:(n=Object.create(null),r&#x26;&#x26;Object.keys(r).forEach(function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(r,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}}))}),n.default=r,Object.freeze(n))}</code></td><td>37</td><td><code>import</code>?</td></tr><tr><td><code>function(l,r){var t=null==l?null:typeof Symbol&#x3C;"u"&#x26;&#x26;l[Symbol.iterator]||l["@@iterator"];if(null!=t){var e,n,u,a,f=[],i=!0,o=!1;try{if(u=(t=t.call(l)).next,0===r){if(Object(t)!==t)return;i=!1}else for(;!(i=(e=u.call(t)).done)&#x26;&#x26;(f.push(e.value),f.length!==r);i=!0);}catch(l){o=!0,n=l}finally{try{if(!i&#x26;&#x26;null!=t.return&#x26;&#x26;(a=t.return(),Object(a)!==a))return}finally{if(o)throw n}}return f}}</code></td><td>33</td><td>?</td></tr><tr><td><code>function(n){}</code></td><td>29</td><td>no-op</td></tr><tr><td><code>function(r){if(typeof Symbol&#x3C;"u"&#x26;&#x26;null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}</code></td><td>28</td><td>?</td></tr><tr><td><code>function(){throw new TypeError('Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.')}</code></td><td>28</td><td>?</td></tr><tr><td><code>()=>{}</code></td><td>27</td><td>no-op</td></tr><tr><td><code>function(){return null}</code></td><td>27</td><td>always-null</td></tr><tr><td><code>function(){return this}</code></td><td>20</td><td>always-this</td></tr><tr><td><code>function(){return 0}</code></td><td>17</td><td>always-zero</td></tr><tr><td><code>function(n){return n}</code></td><td>15</td><td>identity</td></tr><tr><td><code>function(n,r){return n}</code></td><td>14</td><td>always-first-argument</td></tr><tr><td><code>d=>d.id</code></td><td>14</td><td><code>.id</code></td></tr><tr><td><code>function(){var r=function(t,o){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,o){t.__proto__=o}:function(t,o){for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&#x26;&#x26;(t[n]=o[n])}))(t,o)};return function(t,o){if("function"!=typeof o&#x26;&#x26;null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}</code></td><td>14</td><td>?</td></tr><tr><td><code>function(_,o){_.__proto__=o}</code></td><td>14</td><td><code>Object.is_a</code>?</td></tr><tr><td><code>function(o,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&#x26;&#x26;(o[t]=r[t])}</code></td><td>14</td><td>?</td></tr><tr><td><code>function(n){return!1}</code></td><td>13</td><td>always-false</td></tr><tr><td><code>a=>a</code></td><td>12</td><td>identity</td></tr><tr><td><code>a=>a()</code></td><td>12</td><td>call first argument</td></tr><tr><td><code>function(n,a){n.a=a}</code></td><td>11</td><td>enum/const definition?</td></tr><tr><td><code>function(n,r){return r}</code></td><td>11</td><td>always-second-argument</td></tr><tr><td><code>function(e){return e&#x26;&#x26;e.__esModule?e:{default:e}}</code></td><td>11</td><td>import default</td></tr><tr><td><code>function(c){this.c=c}</code></td><td>10</td><td>enum/const definition?</td></tr></tbody></table>
<p>As a matter of fact, someone on the internet did a very similar research few years ago.
So I hoped to see the improvement in the build tools over the years.</p>
<p>As I mentioned above, our front-end is bundled with Vite. Lets see if using esbuild or bun
(since both are fairly new and stand out in terms of architecture and performance) do a better job.</p>
<p>With few small adjustments to make things fair (e.g. build the same thing in the same way),
like disabling the plugins for Vite, setting up svgr loader,
here are some build time stats:</p>
<p><code>yarn install</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span> YN0000: Done with warnings in 17s 798ms</span></span>
<span class="line"><span>yarn  12.11s user 19.69s system 175% cpu 18.122 total</span></span>
<span class="line"><span></span></span></code></pre>
<p><code>bun install</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>warn: esbuild's postinstall script took 748.9ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span> 1028 packages installed [1.82s]</span></span>
<span class="line"><span>  Removed: 2</span></span>
<span class="line"><span>bun install  0.22s user 0.65s system 47% cpu 1.849 total</span></span>
<span class="line"><span></span></span></code></pre>

























<table><thead><tr><th>Bundler</th><th>Build time</th></tr></thead><tbody><tr><td>bun</td><td>0.43s</td></tr><tr><td>esbuild</td><td>2.57s</td></tr><tr><td>vite</td><td>85.04s</td></tr><tr><td>webpack</td><td>138.64s</td></tr></tbody></table>
<p>And the analysis of the built bundles:</p>
<p><code>vite</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Found 968 functions, 651 are unique (67.25%)</span></span>
<span class="line"><span>Found 598 functions, 267 are unique (44.65%)</span></span>
<span class="line"><span>Found 154 functions, 98 are unique (63.64%)</span></span>
<span class="line"><span>Found 17 functions, 10 are unique (58.82%)</span></span>
<span class="line"><span>Found 15192 functions, 8963 are unique (59%)</span></span>
<span class="line"><span>Found 1202 functions, 494 are unique (41.1%)</span></span>
<span class="line"><span>Found 513 functions, 231 are unique (45.03%)</span></span>
<span class="line"><span>= Total 18644 functions, 10714 are unique (57.4%)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Duplicates length: 52616 bytes out of 281406 bytes are duplicate code (18.7%)</span></span>
<span class="line"><span>Duplicates length: 57607 bytes out of 164737 bytes are duplicate code (34.97%)</span></span>
<span class="line"><span>Duplicates length: 11140 bytes out of 45135 bytes are duplicate code (24.68%)</span></span>
<span class="line"><span>Duplicates length: 1932 bytes out of 6532 bytes are duplicate code (29.58%)</span></span>
<span class="line"><span>Duplicates length: 1518418 bytes out of 3537579 bytes are duplicate code (42.92%)</span></span>
<span class="line"><span>Duplicates length: 130649 bytes out of 340227 bytes are duplicate code (38.4%)</span></span>
<span class="line"><span>Duplicates length: 50160 bytes out of 136057 bytes are duplicate code (36.87%)</span></span>
<span class="line"><span>= Total 1822522 out of 4511673 bytes are duplicate code (40.3%)</span></span>
<span class="line"><span></span></span></code></pre>
<p><code>esbuild</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Found 46654 functions, 28952 are unique (62.06%)</span></span>
<span class="line"><span>Duplicates length: 6905599 bytes out of 9645594 bytes are duplicate code (71.59%)</span></span>
<span class="line"><span></span></span></code></pre>
<p><code>bun</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Found 31113 functions, 25755 are unique (82.78%)</span></span>
<span class="line"><span>Duplicates length: 446020 bytes out of 5696964 bytes are duplicate code (7.83%)</span></span>
<span class="line"><span></span></span></code></pre>
<p><code>webpack</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Found 2898 functions, 1434 are unique (49.48%)</span></span>
<span class="line"><span>Duplicates length: 320940 bytes out of 4645589 bytes are duplicate code (6.91%)</span></span>
<span class="line"><span></span></span></code></pre>
<p>And a deeper analysis of the duplicated functions:</p>
<p><code>esbuild</code>:</p>

































































































































































































































































<table><thead><tr><th>Function</th><th>Copies</th></tr></thead><tbody><tr><td><code>function(r){for(var t=1;t&#x3C;arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&#x26;&#x26;(r[n]=o[n])}return r}</code></td><td>2216</td></tr><tr><td><code>function n(){return Object.assign&#x26;&#x26;Object.assign.bind(),n.apply(this,arguments)}</code></td><td>1204</td></tr><tr><td><code>function n(){return Object.assign,n.apply(this,arguments)}</code></td><td>1010</td></tr><tr><td><code>function(){}</code></td><td>844</td></tr><tr><td><code>function(t){return t&#x26;&#x26;"object"==typeof t&#x26;&#x26;"default"in t?t:{default:t}}</code></td><td>260</td></tr><tr><td><code>function(i){this.a=i}</code></td><td>250</td></tr><tr><td><code>function(n,e){if(null==n)return{};for(var r,t={},f=Object.keys(n),u=0;u&#x3C;f.length;u++)r=f[u],0&#x3C;=e.indexOf(r)||(t[r]=n[r]);return t}</code></td><td>203</td></tr><tr><td><code>function(e,r){if(null==e)return{};var t,n=function(e,r){if(null==e)return{};for(var t,n={},l=Object.keys(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols)for(var l=Object.getOwnPropertySymbols(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&#x26;&#x26;(n[t]=e[t]);return n}</code></td><td>194</td></tr><tr><td><code>function(e,r){return r=r||e.slice(0),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}</code></td><td>160</td></tr><tr><td><code>function(r,t){if("object"!=typeof r||null===r)return r;var e=r[Symbol.toPrimitive];if(void 0===e)return("string"===t?String:Number)(r);e=e.call(r,t||"default");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}</code></td><td>137</td></tr><tr><td><code>function(r,e,t){return i=function(r,e){if("object"!=typeof r||null===r)return r;var t=r[Symbol.toPrimitive];if(void 0===t)return String(r);t=t.call(r,e);if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),(e="symbol"==typeof i?i:String(i))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r;var i}</code></td><td>134</td></tr><tr><td><code>function(t){t=function(t,r){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return String(t);i=i.call(t,r);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}</code></td><td>134</td></tr><tr><td><code>()=>{}</code></td><td>129</td></tr><tr><td><code>function(n){return this===n}</code></td><td>119</td></tr><tr><td><code>function(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}</code></td><td>115</td></tr><tr><td><code>function(n,r){(null==r||r>n.length)&#x26;&#x26;(r=n.length);for(var e=0,l=new Array(r);e&#x3C;r;e++)l[e]=n[e];return l}</code></td><td>106</td></tr><tr><td><code>function(c,i){Bs.call(this,c,i)}</code></td><td>94</td></tr><tr><td><code>function(){return!0}</code></td><td>93</td></tr><tr><td><code>function(r){if(Array.isArray(r))return r}</code></td><td>83</td></tr><tr><td><code>function(){throw new TypeError(</code>Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a <a href="">Symbol.iterator</a> method.<code>)}</code></td><td>83</td></tr><tr><td><code>function(){return!1}</code></td><td>79</td></tr><tr><td><code>function(){return new cu(this)}</code></td><td>77</td></tr><tr><td><code>function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(b,e),Object.defineProperty(E,e,t.get?t:{enumerable:!0,get:function(){return b[e]}}))}</code></td><td>76</td></tr><tr><td><code>function(){return b[P]}</code></td><td>76</td></tr><tr><td><code>function(a,e,l){var i,r=l["aria-label"],t=l["aria-labelledby"],n=l.title;switch(a){case"img":return r||t||n?(s(i={},"aria-labelledby",t),s(i,"aria-label",r),s(i,"title",n),i):{"aria-label":"".concat(e.replace(/([a-z])([A-Z])/g,"$1 $2")," Icon")};case"presentation":return{"aria-hidden":!0,alt:""}}}</code></td><td>76</td></tr><tr><td><code>function(r){var n;return r&#x26;&#x26;r.__esModule?r:(n=Object.create(null),r&#x26;&#x26;Object.keys(r).forEach(function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(r,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}}))}),n.default=r,Object.freeze(n))}</code></td><td>67</td></tr><tr><td><code>function(n){return typeof n}</code></td><td>64</td></tr><tr><td><code>function(o){return o&#x26;&#x26;"function"==typeof Symbol&#x26;&#x26;o.constructor===Symbol&#x26;&#x26;o!==Symbol.prototype?"symbol":typeof o}</code></td><td>64</td></tr><tr><td><code>function n(r){return n(r)}</code></td><td>63</td></tr><tr><td><code>function(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&#x26;&#x26;(r=Object.getOwnPropertySymbols(t),e&#x26;&#x26;(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}</code></td><td>61</td></tr><tr><td><code>function(i,t){this.a=i,this.b=t}</code></td><td>58</td></tr><tr><td><code>function(r){var n;return r&#x26;&#x26;"object"==typeof r&#x26;&#x26;"default"in r?r:(n=Object.create(null),r&#x26;&#x26;Object.keys(r).forEach(function(e){var t;"default"!==e&#x26;&#x26;(t=Object.getOwnPropertyDescriptor(r,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}}))}),n.default=r,Object.freeze(n))}</code></td><td>50</td></tr><tr><td><code>function(r){if(typeof Symbol&#x3C;"u"&#x26;&#x26;null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}</code></td><td>49</td></tr><tr><td><code>function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}</code></td><td>49</td></tr><tr><td><code>function(){return this.a}</code></td><td>49</td></tr><tr><td><code>function(i){p0(this,i)}</code></td><td>48</td></tr><tr><td><code>function(l,r){var t=null==l?null:typeof Symbol&#x3C;"u"&#x26;&#x26;l[Symbol.iterator]||l["@@iterator"];if(null!=t){var n,u,e=[],a=!0,o=!1;try{for(t=t.call(l);!(a=(n=t.next()).done)&#x26;&#x26;(e.push(n.value),!r||e.length!==r);a=!0);}catch(l){o=!0,u=l}finally{try{a||null==t.return||t.return()}finally{if(o)throw u}}return e}}</code></td><td>46</td></tr><tr><td><code>function(){throw St(new Ss)}</code></td><td>46</td></tr><tr><td><code>function(n){throw St(new Ss)}</code></td><td>39</td></tr><tr><td><code>()=>{"use strict";Vu(),Du()}</code></td><td>38</td></tr><tr><td><code>function(l,r){var t=null==l?null:typeof Symbol&#x3C;"u"&#x26;&#x26;l[Symbol.iterator]||l["@@iterator"];if(null!=t){var e,n,u,a,f=[],i=!0,o=!1;try{if(u=(t=t.call(l)).next,0===r){if(Object(t)!==t)return;i=!1}else for(;!(i=(e=u.call(t)).done)&#x26;&#x26;(f.push(e.value),f.length!==r);i=!0);}catch(l){o=!0,n=l}finally{try{if(!i&#x26;&#x26;null!=t.return&#x26;&#x26;(a=t.return(),Object(a)!==a))return}finally{if(o)throw n}}return f}}</code></td><td>37</td></tr><tr><td><code>function(){return this.b}</code></td><td>33</td></tr><tr><td><code>function(){X(x)}</code></td><td>32</td></tr><tr><td><code>function(n){}</code></td><td>31</td></tr><tr><td><code>a=>a()</code></td><td>30</td></tr><tr><td><code>function(n){return V1(n)}</code></td><td>30</td></tr><tr><td><code>function(n){return dn(oi,mr,2,n,6,1)}</code></td><td>30</td></tr><tr><td><code>function(){return null}</code></td><td>29</td></tr><tr><td><code>function(){return this}</code></td><td>24</td></tr><tr><td><code>()=>{"use strict";Du()}</code></td><td>23</td></tr><tr><td><code>function(i){g0(this,i)}</code></td><td>23</td></tr><tr><td><code>function(t,r){var e;if(t)return"string"==typeof t?k(t,r):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&#x26;&#x26;t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?k(t,r):void 0}</code></td><td>22</td></tr><tr><td><code>function(t,r){var e;if(t)return"string"==typeof t?P(t,r):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&#x26;&#x26;t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?P(t,r):void 0}</code></td><td>22</td></tr><tr><td><code>function(n){return null!=n&#x26;&#x26;n instanceof Array}</code></td><td>21</td></tr><tr><td><code>function(r){if(Array.isArray(r))return P(r)}</code></td><td>21</td></tr><tr><td><code>function(e){return e&#x26;&#x26;e.__esModule?e:{default:e}}</code></td><td>21</td></tr><tr><td><code>function(t,r){var e;if(t)return"string"==typeof t?Q(t,r):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&#x26;&#x26;t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Q(t,r):void 0}</code></td><td>21</td></tr><tr><td><code>function(){throw St(new Os(il((qs(),_g))))}</code></td><td>21</td></tr><tr><td><code>function(n){return n}</code></td><td>20</td></tr><tr><td><code>function(n){return null!=n&#x26;&#x26;n.nodeType===Node.ELEMENT_NODE}</code></td><td>20</td></tr><tr><td><code>function(e){throw Error("Received unhandled value: ".concat(e))}</code></td><td>20</td></tr><tr><td><code>function(r,n){return Array.isArray(r)?r.concat(n):"string"==typeof r?r:void 0}</code></td><td>19</td></tr></tbody></table>
<p><code>bun</code>:</p>

















































































































































































































































































<table><thead><tr><th>Function</th><th>Copies</th></tr></thead><tbody><tr><td><code>function(){}</code></td><td>739</td></tr><tr><td><code>function(i){this.a=i}</code></td><td>250</td></tr><tr><td><code>function(r){for(var t=1;t&#x3C;arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&#x26;&#x26;(r[n]=o[n])}return r}</code></td><td>197</td></tr><tr><td><code>()=>{}</code></td><td>141</td></tr><tr><td><code>function(n){return this===n}</code></td><td>119</td></tr><tr><td><code>function(c,f){f7.call(this,c,f)}</code></td><td>94</td></tr><tr><td><code>function(){return!0}</code></td><td>91</td></tr><tr><td><code>function(){return new p9(this)}</code></td><td>77</td></tr><tr><td><code>function(){return!1}</code></td><td>76</td></tr><tr><td><code>function(i,t){this.a=i,this.b=t}</code></td><td>58</td></tr><tr><td><code>function(n,e){if(null==n)return{};for(var r,t={},f=Object.keys(n),u=0;u&#x3C;f.length;u++)r=f[u],0&#x3C;=e.indexOf(r)||(t[r]=n[r]);return t}</code></td><td>53</td></tr><tr><td><code>function(r,t){if("object"!=typeof r||null===r)return r;var e=r[Symbol.toPrimitive];if(void 0===e)return("string"===t?String:Number)(r);e=e.call(r,t||"default");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}</code></td><td>51</td></tr><tr><td><code>function(){return this.a}</code></td><td>49</td></tr><tr><td><code>function(e,r){if(null==e)return{};var t,n=function(e,r){if(null==e)return{};for(var t,n={},l=Object.keys(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols)for(var l=Object.getOwnPropertySymbols(e),o=0;o&#x3C;l.length;o++)t=l[o],0&#x3C;=r.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&#x26;&#x26;(n[t]=e[t]);return n}</code></td><td>48</td></tr><tr><td><code>function(r,e,t){return i=function(r,e){if("object"!=typeof r||null===r)return r;var t=r[Symbol.toPrimitive];if(void 0===t)return String(r);t=t.call(r,e);if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string"),(e="symbol"==typeof i?i:String(i))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r;var i}</code></td><td>48</td></tr><tr><td><code>function(t){t=function(t,r){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return String(t);i=i.call(t,r);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}</code></td><td>48</td></tr><tr><td><code>function(i){T6(this,i)}</code></td><td>48</td></tr><tr><td><code>()=>{R3(),G3()}</code></td><td>46</td></tr><tr><td><code>function(){throw x0(new w7)}</code></td><td>46</td></tr><tr><td><code>function(e,r){return r=r||e.slice(0),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}</code></td><td>45</td></tr><tr><td><code>function(n,r){(null==r||r>n.length)&#x26;&#x26;(r=n.length);for(var e=0,l=new Array(r);e&#x3C;r;e++)l[e]=n[e];return l}</code></td><td>41</td></tr><tr><td><code>function(n){throw x0(new w7)}</code></td><td>39</td></tr><tr><td><code>function(r){if(Array.isArray(r))return r}</code></td><td>36</td></tr><tr><td><code>function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}</code></td><td>36</td></tr><tr><td><code>function(){return this.b}</code></td><td>33</td></tr><tr><td><code>function(n){return n2(n)}</code></td><td>30</td></tr><tr><td><code>function(n){return J1($5,p1,2,n,6,1)}</code></td><td>30</td></tr><tr><td><code>function(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&#x26;&#x26;(r=Object.getOwnPropertySymbols(t),e&#x26;&#x26;(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}</code></td><td>29</td></tr><tr><td><code>function(l,r){var t=null==l?null:"undefined"!=typeof Symbol&#x26;&#x26;l[Symbol.iterator]||l["@@iterator"];if(null!=t){var e,n,u,f,i=[],a=!0,o=!1;try{if(u=(t=t.call(l)).next,0===r){if(Object(t)!==t)return;a=!1}else for(;!(a=(e=u.call(t)).done)&#x26;&#x26;(i.push(e.value),i.length!==r);a=!0);}catch(l){o=!0,n=l}finally{try{if(!a&#x26;&#x26;null!=t.return&#x26;&#x26;(f=t.return(),Object(f)!==f))return}finally{if(o)throw n}}return i}}</code></td><td>29</td></tr><tr><td><code>function(n){}</code></td><td>29</td></tr><tr><td><code>function(){return null}</code></td><td>28</td></tr><tr><td><code>function(e){return Object.getOwnPropertyDescriptor(Z,e).enumerable}</code></td><td>25</td></tr><tr><td><code>function(e){Object.defineProperty(Z,e,Object.getOwnPropertyDescriptor(W,e))}</code></td><td>25</td></tr><tr><td><code>function(n){return n}</code></td><td>23</td></tr><tr><td><code>function(i){C6(this,i)}</code></td><td>23</td></tr><tr><td><code>()=>{G3()}</code></td><td>22</td></tr><tr><td><code>function(){throw x0(new C7(n7((y7(),KG))))}</code></td><td>21</td></tr><tr><td><code>function(){return this}</code></td><td>19</td></tr><tr><td><code>function(i,t){this.b=i,this.a=t}</code></td><td>19</td></tr><tr><td><code>function(n){return!1}</code></td><td>18</td></tr><tr><td><code>function(n,w){throw x0(new w7)}</code></td><td>18</td></tr><tr><td><code>function(){return 0}</code></td><td>17</td></tr><tr><td><code>function(n){return typeof n}</code></td><td>17</td></tr><tr><td><code>function(o){return o&#x26;&#x26;"function"==typeof Symbol&#x26;&#x26;o.constructor===Symbol&#x26;&#x26;o!==Symbol.prototype?"symbol":typeof o}</code></td><td>17</td></tr><tr><td><code>()=>{R3()}</code></td><td>16</td></tr><tr><td><code>()=>{var e;return null!=(e=Z.options.debugAll)?e:Z.options.debugHeaders}</code></td><td>16</td></tr><tr><td><code>function(n,r){return n}</code></td><td>15</td></tr><tr><td><code>function(c){hX.call(this,c)}</code></td><td>15</td></tr><tr><td><code>function(){return this.c}</code></td><td>15</td></tr><tr><td><code>function(){return this.d}</code></td><td>15</td></tr><tr><td><code>function(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}</code></td><td>14</td></tr><tr><td><code>function(r){if("undefined"!=typeof Symbol&#x26;&#x26;null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}</code></td><td>14</td></tr><tr><td><code>function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}</code></td><td>14</td></tr><tr><td><code>d=>d.id</code></td><td>14</td></tr><tr><td><code>()=>W(!1)</code></td><td>13</td></tr><tr><td><code>a=>a</code></td><td>12</td></tr><tr><td><code>function(t){var l=-1,n=null==t?0:t.length;for(this.clear();++l&#x3C;n;){var r=t[l];this.set(r[0],r[1])}}</code></td><td>12</td></tr><tr><td><code>function(n,c){}</code></td><td>12</td></tr><tr><td><code>function(n,r){return r}</code></td><td>11</td></tr><tr><td><code>function(n,a){n.a=a}</code></td><td>11</td></tr><tr><td><code>function(){_V.call(this)}</code></td><td>11</td></tr><tr><td><code>function(i,t,h){this.a=i,this.b=t,this.c=h}</code></td><td>11</td></tr><tr><td><code>function(){return this.a.gc()}</code></td><td>11</td></tr><tr><td><code>function(i){this.b=i}</code></td><td>10</td></tr><tr><td><code>function(c){this.c=c}</code></td><td>10</td></tr><tr><td><code>function(){return this.f}</code></td><td>10</td></tr></tbody></table>
<p>Interestingly enough, all three tools handled the job bad in different aspects:</p>
<ul>
<li>vite was the slowest and produced second biggest bundle</li>
<li>esbuild was the fastest and produced the largest bundle</li>
<li>bun was slower than esbuild by a split of hair, but produced smallest bundle with least duplicates</li>
</ul>
<p>Bonus points to bun for installing node modules in a link of an eye.</p>
<p>In terms of duplicates, however, all three failed miserably (in my opinion), with the best result being the bundle
produced by bun with 18% duplicates and the rest having almost half the bundle wasted.</p>
<p>For the most part, bundlers seem to be doing a pretty bad job at tree shaking and keep <em>a lot</em> of those utility functions duplicates.
One can estimate how much of a wasted space these use, by multiplying the function code length by the number of duplicates minus one (for one definition).</p>
<p>Lets imagine some of the above functions could be de-duplicated. What are the benefit of that?
For the most part, the front-end can load faster for users - simply because there is less bytes to transfer.
On top of that, there are less functions to be created in memory. So <em>technically</em>, the front-end can <em>act</em> faster.
Although, on the modern machines the difference between having one function and few thousand of the same function is negligible.</p>
<div class="content-read-marker" data-fraction="50"></div>
<p>Here is a shortened list of top abusers from different bundlers for our tool:</p>
<p>| Function | vite     || esbuild  || bun      ||</p>









































































































































































































































































































































<table><thead><tr><th>^</th><th>#</th><th>Bytes</th><th>#</th><th>Bytes</th><th>#</th><th>Bytes</th></tr></thead><tbody><tr><td><code>function(){}</code></td><td>753</td><td>9036</td><td>844</td><td>10128</td><td>739</td><td>8868</td></tr><tr><td><code>function(){return!0}</code></td><td>92</td><td>1840</td><td>93</td><td>1860</td><td>91</td><td>1820</td></tr><tr><td><code>function(){return!1}</code></td><td>78</td><td>1560</td><td>79</td><td>1580</td><td>76</td><td>1520</td></tr><tr><td><code>function(){return null}</code></td><td>27</td><td>621</td><td>29</td><td>667</td><td>28</td><td>644</td></tr><tr><td><code>function(){return this}</code></td><td>20</td><td>460</td><td>24</td><td>552</td><td>19</td><td>437</td></tr><tr><td><code>function(){return 0}</code></td><td>17</td><td>340</td><td>n/a</td><td>0</td><td>n/a</td><td>0</td></tr><tr><td><code>function(n){return!1}</code></td><td>13</td><td>273</td><td>n/a</td><td>0</td><td>18</td><td>378</td></tr><tr><td><code>function(n){}</code></td><td>29</td><td>377</td><td>31</td><td>403</td><td>29</td><td>377</td></tr><tr><td><code>function(n){return n}</code></td><td>15</td><td>315</td><td>20</td><td>420</td><td>23</td><td>483</td></tr><tr><td><code>function(n){return typeof n}</code></td><td>n/a</td><td>0</td><td>64</td><td>1792</td><td>17</td><td>476</td></tr><tr><td><code>function(n){return this===n}</code></td><td>n/a</td><td>0</td><td>119</td><td>3332</td><td>119</td><td>3332</td></tr><tr><td><code>function(n,r){return n}</code></td><td>14</td><td>322</td><td>n/a</td><td>0</td><td>15</td><td>345</td></tr><tr><td><code>function(n,r){return r}</code></td><td>11</td><td>253</td><td>n/a</td><td>0</td><td>11</td><td>253</td></tr><tr><td><code>function(n,c){}</code></td><td>n/a</td><td>0</td><td>n/a</td><td>0</td><td>12</td><td>180</td></tr><tr><td><code>()=>{}</code></td><td>27</td><td>162</td><td>129</td><td>774</td><td>141</td><td>846</td></tr><tr><td><code>a=>a</code></td><td>12</td><td>48</td><td>n/a</td><td>0</td><td>12</td><td>48</td></tr><tr><td><code>a=>a()</code></td><td>12</td><td>72</td><td>n/a</td><td>0</td><td>n/a</td><td>0</td></tr><tr><td><code>function(r){for(var t=1;t&#x3C;arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&#x26;&#x26;(r[n]=o[n])}return r}</code></td><td>2205</td><td>317520</td><td>2216</td><td>319104</td><td>197</td><td>28368</td></tr><tr><td><code>function n(){return Object.assign&#x26;&#x26;Object.assign.bind(),n.apply(this,arguments)}</code></td><td>1197</td><td>95760</td><td>1204</td><td>96320</td><td>n/a</td><td>0</td></tr><tr><td><code>function n(){return Object.assign,n.apply(this,arguments)}</code></td><td>1008</td><td>58464</td><td>1010</td><td>58580</td><td>n/a</td><td>0</td></tr><tr><td><code>function(n,r){(null==r||r>n.length)&#x26;&#x26;(r=n.length);for(var e=0,l=new Array(r);e&#x3C;r;e++)l[e]=n[e];return l}</code></td><td>93</td><td>9672</td><td>106</td><td>11024</td><td>n/a</td><td>0</td></tr><tr><td><code>function(r){if(Array.isArray(r))return r}</code></td><td>77</td><td>3157</td><td>83</td><td>3403</td><td>36</td><td>1476</td></tr><tr><td><code>function(){throw new TypeError(&#x26;#39;Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.&#x26;#39;)}</code></td><td>77</td><td>13244</td><td>83</td><td>14276</td><td>36</td><td>6192</td></tr><tr><td><code>function(t){return t&#x26;&#x26;"object"==typeof t&#x26;&#x26;"default"in t?t:{default:t}}</code></td><td>76</td><td>5624</td><td>260</td><td>19240</td><td>n/a</td><td>0</td></tr><tr><td><code>function(_,o){_.__proto__=o}</code></td><td>14</td><td>392</td><td>n/a</td><td>0</td><td>n/a</td><td>0</td></tr><tr><td><code>function(o,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&#x26;&#x26;(o[t]=r[t])}</code></td><td>14</td><td>1176</td><td>n/a</td><td>0</td><td>n/a</td><td>0</td></tr><tr><td><code>function(e){return e&#x26;&#x26;e.__esModule?e:{default:e}}</code></td><td>11</td><td>539</td><td>21</td><td>1029</td><td>n/a</td><td>0</td></tr><tr><td><code>function(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}</code></td><td>n/a</td><td>0</td><td>115</td><td>13570</td><td>n/a</td><td>0</td></tr><tr><td><code>function(r,n){return Array.isArray(r)?r.concat(n):"string"==typeof r?r:void 0}</code></td><td>n/a</td><td>0</td><td>19</td><td>1520</td><td>n/a</td><td>0</td></tr><tr><td><code>function(n){return null!=n&#x26;&#x26;n instanceof Array}</code></td><td>n/a</td><td>0</td><td>21</td><td>987</td><td>n/a</td><td>0</td></tr><tr><td><code>function(n,e){if(null==n)return{};for(var r,t={},f=Object.keys(n),u=0;u&#x3C;f.length;u++)r=f[u],0&#x3C;=e.indexOf(r)||(t[r]=n[r]);return t} </code></td><td>n/a</td><td>0</td><td>n/a</td><td>0</td><td>53</td><td>6890</td></tr><tr><td><code>function(r,t){if("object"!=typeof r||null===r)return r;var e=r[Symbol.toPrimitive];if(void 0===e)return("string"===t?String:Number)(r);e=e.call(r,t||"default");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")} </code></td><td>n/a</td><td>0</td><td>137</td><td>36853</td><td>51</td><td>13719</td></tr><tr><td><code>function(e,r){return r=r||e.slice(0),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}</code></td><td>n/a</td><td>0</td><td>160</td><td>17600</td><td>n/a</td><td>0</td></tr><tr><td><code>function(o){return o&#x26;&#x26;"function"==typeof Symbol&#x26;&#x26;o.constructor===Symbol&#x26;&#x26;o!==Symbol.prototype?"symbol":typeof o}</code></td><td>n/a</td><td>0</td><td>64</td><td>7424</td><td>n/a</td><td>0</td></tr><tr><td><code>function(r){if("undefined"!=typeof Symbol&#x26;&#x26;null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}</code></td><td>n/a</td><td>0</td><td>n/a</td><td>0</td><td>14</td><td>1624</td></tr></tbody></table>
<p>Interestingly enough, aside from a lot of <code>() => {}</code> and <code>(a, b) => a</code> and <code>() => true</code> (as I call them, utility) functions,
there are a lot of ES6 / TypeScript helpers such as class definition and spread operator variants, presumingly made to be compatible with ES5-only browsers.
Maybe if we had targeted only platforms supporting the latest ES features we would get better results?</p>
<p>Well, not quite much:</p>
<p>bundle sizes:</p>

































<table><thead><tr><th>Bundler</th><th>Bundle size</th></tr></thead><tbody><tr><td>bun</td><td>5.4M</td></tr><tr><td>esbuild</td><td>9.2M</td></tr><tr><td>esbuild (tuned)</td><td>8.0M</td></tr><tr><td>vite</td><td>7.1M</td></tr><tr><td>vite (tuned)</td><td>3.8M</td></tr><tr><td>webpack</td><td>4.4M</td></tr></tbody></table>
<p><code>vite</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Found 15983 functions, 9581 are unique (59.94%)</span></span>
<span class="line"><span>Duplicates length: 1495985 bytes out of 4019326 bytes are duplicate code (37.22%)</span></span>
<span class="line"><span></span></span></code></pre>
<p><code>esbuild</code>:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Found 41736 functions, 29224 are unique (70.02%)</span></span>
<span class="line"><span>Duplicates length: 3406606 bytes out of 8347230 bytes are duplicate code (40.81%)</span></span>
<span class="line"><span></span></span></code></pre>
<p>webpack is (should be) already using the <code>target</code> config option from <code>tsconfig.json</code> (which is set to <code>ESNext</code> in our case)
and bun does not really have a whole lot of customization in this regard.</p>
<p>One unlikely possibility when these duplicates can be faster than having just one function is that running the nearly-defined code
(in terms of a single block of code) might be slightly faster than making code jumps.
This is super far-fetched idea from low-level programming, when CPU does not have to jump thousands or millions of (assembly) instructions back and forth
but literally a few instead.
This wont justify using verbose ES5-compatible code on ESnext browser, however.
How about we run a very synthetic benchmark to check just this one theory?</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> f</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return!</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">time</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;i</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">100000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">random</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1000000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(f).</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timeEnd</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">time</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> i</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;i</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">100000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;i</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;t</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">push</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(Math.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">random</span><span style="color:#24292E;--shiki-dark:#E1E4E8">()</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1000000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> f</span><span style="color:#D73A49;--shiki-dark:#F97583">=function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return!</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">},x</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">a.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">filter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(f).</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">console.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">timeEnd</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'2'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span></code></pre>
<p>The results are actually quite stable:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>1: 17029ms</span></span>
<span class="line"><span>1: 16998ms</span></span>
<span class="line"><span>1: 16903ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2: 21877ms</span></span>
<span class="line"><span>2: 21811ms</span></span>
<span class="line"><span>2: 21821ms</span></span>
<span class="line"><span></span></span></code></pre>
<p>Having just one function instance is approx. <code>23%</code> faster. But what happens at consequitive runs?</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>1: 9194ms</span></span>
<span class="line"><span>1: 9159ms</span></span>
<span class="line"><span>1: 14044ms</span></span>
<span class="line"><span>1: 13882ms</span></span>
<span class="line"><span>1: 13975ms</span></span>
<span class="line"><span>1: 9205ms</span></span>
<span class="line"><span>1: 14026ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2: 21821ms</span></span>
<span class="line"><span>2: 13843ms</span></span>
<span class="line"><span>2: 13866ms</span></span>
<span class="line"><span>2: 13854ms</span></span>
<span class="line"><span>2: 13961ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2: 21718ms</span></span>
<span class="line"><span>2: 13952ms</span></span>
<span class="line"><span>2: 13925ms</span></span>
<span class="line"><span>2: 13923ms</span></span>
<span class="line"><span></span></span></code></pre>
<p>Seems like CPU does indeed do a little bit of instruction caching and branch prediction (first run is visibly slower than the subsequent runs).
But the observation still holds: having one function definition instead of many copies (even near copies) has a much bigger impact.</p>
<p>With that being said, there is one interesting thing to try here: what if we actually replace some of those bulky duplicates with one-time declarations, within the same bundle?</p>
<p>Without performing an in-depth code analysis and optimization, I came up with the following naive implementation:</p>
<ol>
<li>analyze the code and pick a few functions (biggest abusers) to fix them up</li>
<li>extract all function names, function parameter names (including potential destructuring objects in function params) and all variable and constant names</li>
<li>for each function to be de-duplicated, create a unique name (using the variable and function parameter and function names to avoid any clashes)</li>
<li>from the end of the file to the beginning, remove all occurrences of the function declaration and replace all function references with the unique name</li>
<li>add the function declarations to the beginning of the file</li>
</ol>
<p>This approach is rather naive, since it does not account for a number of edge cases. For instance, if there are two functions to be replaced:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;r</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;r</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t,l</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[r];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(t </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> l)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(l,t)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[t]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">l[t])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">function</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> p</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(){</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(p</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">Object.assign</span><span style="color:#D73A49;--shiki-dark:#F97583">||function</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#E36209;--shiki-dark:#FFAB70">e</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> r</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">1</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;r</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;r</span><span style="color:#D73A49;--shiki-dark:#F97583">++</span><span style="color:#24292E;--shiki-dark:#E1E4E8">){</span><span style="color:#D73A49;--shiki-dark:#F97583">var</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> t,l</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[r];</span><span style="color:#D73A49;--shiki-dark:#F97583">for</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(t </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> l)</span><span style="color:#005CC5;--shiki-dark:#79B8FF">Object</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">prototype</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.hasOwnProperty.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">call</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(l,t)</span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(e[t]</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">l[t])}</span><span style="color:#D73A49;--shiki-dark:#F97583">return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> e}).</span><span style="color:#6F42C1;--shiki-dark:#B392F0">apply</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span><span style="color:#005CC5;--shiki-dark:#79B8FF">arguments</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)}</span></span>
<span class="line"></span></code></pre>
<p>e.g. one includes the other, the algorithm could have potentially evicted cases like this.</p>
<p>Before proceeding further, it is a good idea to test if the cleaned up bundle can safely replace the original one.
Hence I just stuffed it in the static assets folder of our project and ran it with the modified bundle.</p>
<p>This way I figured few issues with the naive approach:</p>
<ul>
<li>two function definitions are causing stack overflow:
<ul>
<li><code>$z=function n(){return Object.assign,n.apply(this,arguments)}</code></li>
<li><code>$q=function n(){return n=Object.assign&#x26;&#x26;Object.assign.bind(),n.apply(this,arguments)}</code></li>
</ul>
</li>
<li>some of the empty functions are actually used as constructors (ES5-compatible OOP model) which is only discovered by finding the expressions like <code>$FnName.prototype.something = somethingElse;</code></li>
<li>some functions are named and then referenced later in the code</li>
<li>some functions are not used at all: <img src="/images/how-unique-are-your-bundles/unused-deduplicated-functions.webp" alt="Unused aliases"></li>
</ul>
<p>For the shorthand functions I first tried manually fixing them up - had to replace them with <code>$z=function(){return $z=Object.assign.bind(),$z.apply(this,arguments)}</code> alikes. This worked, so I created an AST transformer to handle these one-line return-only functions:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> simplifyFunction</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">code</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">fname</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> tmpFilename</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> '_tmp'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    fs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">writeFileSync</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tmpFilename, code, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'utf-8'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> root</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createSourceFile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        tmpFilename,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        code,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ts.ScriptTarget.ESNext,</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">        /* setParentNodes */</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> true</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    let</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rootFnName </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> parse</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isFunctionDeclaration</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isIdentifier</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node.name) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node.name.escapedText </span><span style="color:#D73A49;--shiki-dark:#F97583">!==</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> ''</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            rootFnName </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node.name.escapedText;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">forEachChild</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node, </span><span style="color:#E36209;--shiki-dark:#FFAB70">child</span><span style="color:#D73A49;--shiki-dark:#F97583"> =></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (child) {</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">                parse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(child);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    parse</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(root);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#D73A49;--shiki-dark:#F97583">!</span><span style="color:#24292E;--shiki-dark:#E1E4E8">rootFnName) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        fs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rmSync</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tmpFilename);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> code;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> transformer</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">ctx</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">sourceFile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        const</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> visit</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#E36209;--shiki-dark:#FFAB70">node</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isIdentifier</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> node.escapedText </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> rootFnName) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.factory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createIdentifier</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(fname);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isFunctionDeclaration</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isBlock</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node.body) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                node.body.statements.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">length</span><span style="color:#D73A49;--shiki-dark:#F97583"> ===</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="color:#D73A49;--shiki-dark:#F97583"> &#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isReturnStatement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node.body.statements[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]) </span><span style="color:#D73A49;--shiki-dark:#F97583">&#x26;&#x26;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">isBinaryExpression</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node.body.statements[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].expression)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            ) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> next</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.factory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createFunctionDeclaration</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    [],</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                    undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                    undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    [],</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    [],</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">                    undefined</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ts.factory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createBlock</span><span style="color:#24292E;--shiki-dark:#E1E4E8">([</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        ts.factory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createReturnStatement</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                            ts.factory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createComma</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                ts.factory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createAssignment</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                    ts.factory.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createIdentifier</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(fname),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                    node.body.statements[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].expression.left</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                ),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                                node.body.statements[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">].expression.right</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                            )</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                        )</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                    ])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">                );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">                return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">visitEachChild</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(next, visit, ctx);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">            return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">visitEachChild</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(node, visit, ctx);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">visitNode</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(sourceFile, visit);</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> s</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createSourceFile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tmpFilename, code, ts.ScriptTarget.ESNext);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="color:#005CC5;--shiki-dark:#79B8FF">transformed</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> } </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">transform</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(s, [ transformer ]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> newCode</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ts.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">createPrinter</span><span style="color:#24292E;--shiki-dark:#E1E4E8">({ omitTrailingSemicolon: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">true</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        .</span><span style="color:#6F42C1;--shiki-dark:#B392F0">printFile</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(transformed.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">find</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(({ </span><span style="color:#E36209;--shiki-dark:#FFAB70">fileName</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> }) </span><span style="color:#D73A49;--shiki-dark:#F97583">=></span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fileName </span><span style="color:#D73A49;--shiki-dark:#F97583">===</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tmpFilename));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    fs.</span><span style="color:#6F42C1;--shiki-dark:#B392F0">rmSync</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(tmpFilename);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> newCode;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"></span></code></pre>
<p>The transformer is essentially a two-pass processor: it first parses the <code>code</code> and identifies the first function declaration.
If none was found - it just returns the original code. If there was a so-called root function defined, it then replaces all
identifier with that root function name with the alias provided as <code>fname</code>.
It also replaces the return statements in form of a <code>return something &#x26;&#x26; something()</code> with <code>return alias = something, alias()</code>.</p>
<p>This approach is different from simply using <code>uglifyjs</code> to just try and minimize the code - it is way more complex (compared to just one function call). It results in few extra whitespaces being added. But using <code>uglifyjs</code> messes things up again and TypeScript compiler does not have an option for minimizing the output. But few extra whitespaces are totally acceptable given the much bigger savings from this transformation.</p>
<p>With the constructors I simply excluded them from being de-duplicated. This resulted in <code>155</code> fewer substitutions (in Vite mode), which is negligible on the overall scale of the problem.</p>
<p>As for the named functions which are in the global scope and are referenced later down the line, I had to create a list of backwards-compatible aliases, mapping those old function names onto the new unique names.</p>
<p>I ended up with a three-pass parser-transformer utility (not really simple script anymore). The passes being:</p>
<ol>
<li>figuring out the duplicate function declarations and replacing them from the end to the start of the code (to minimize the chance of writing over the just-changed code)</li>
<li>removing the duplicate global-scope named functions and replacing them with shorthand aliases to the de-duplicated declarations</li>
<li>replace the usages of all known aliases and shorthand-named de-duplicated functions with their corresponding new (generated) names</li>
</ol>
<p>Other than those, replacing the original bundle with the optimized one worked like a charm!</p>
<p>The results? With the threshold of <code>20</code> duplicates or more:</p>
<p>| Bundler | Before optimization |||||</p>





















































































<table><thead><tr><th>^</th><th>Bundle size</th><th>Total functions</th><th>Unique functions</th><th>Unique functions, %</th><th>Duplicate code, %</th></tr></thead><tbody><tr><td>bun</td><td>6.2M</td><td>8903</td><td>7443</td><td>83.6%</td><td>0.78%</td></tr><tr><td>esbuild</td><td>8.7M</td><td>13057</td><td>10250</td><td>78.5%</td><td>3.9%</td></tr><tr><td>vite</td><td>3.9M</td><td>3502</td><td>2365</td><td>67.53%</td><td>6.39%</td></tr><tr><td>webpack</td><td>4.4M</td><td>2898</td><td>1434</td><td>49.48%</td><td>6.91%</td></tr><tr><td><strong>After optimization</strong></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>bun</td><td>6.2M (same)</td><td>7865 (-1038)</td><td>7355 (-88)</td><td>93.52% (+9.92%)</td><td>0.51% (-0.27%)</td></tr><tr><td>esbuild</td><td>8.5M (-0.2M)</td><td>3265 (-9792)</td><td>2990 (-7260)</td><td>91.58% (+13.08%)</td><td>0.62% (-3.28%)</td></tr><tr><td>vite</td><td>3.6M (-0.3M)</td><td>2483 (-1019)</td><td>2277 (-88)</td><td>91.7% (+24.17%)</td><td>1.68% (-4.71%)</td></tr><tr><td>webpack</td><td>4.1M (-0.3M)</td><td>1484 (-1414)</td><td>1375 (-59)</td><td>92.65% (+43.17%)</td><td>0.43% (-6.48%)</td></tr></tbody></table>
<p>In conclusion, the bundlers do a pretty average job at optimizing the bundles, even in production mode with some extra tuning.
And if some brave soul is willing to invest even more time and effort than I did into developing a sophisticated solution
(potentially improving the existing tools, like uglifyjs or bundlers themselves), the numbers can be improved even further.
It would be really interesting to see what would the results be running this optimizer on a bigger bundle.</p>
<p>In my humble opinion, Bun does produce the cleanest bundle. It might be not the smallest one, but it has least unnecessary stuff.
On top of that, it is the fastest tool in JS world I have ever used.
By the way, this very blog is built using Bun and React SSR - on Github Actions it takes around a minute to build and publish:</p>
<img src="/images/how-unique-are-your-bundles/gh-pages-bun-build.webp" loading="lazy" alt="Github Actions build and publish with Bun">
<img src="/images/how-unique-are-your-bundles/gh-pages-action-breakdown.webp" loading="lazy" alt="Github Actions build breakdown">
<div class="content-read-marker" data-fraction="100"></div>
<style>
    .center {
        text-align: center;
    }
    .center:has(button) {
        margin-top: 0.5em;
    }
</style>
<script>
[...document.querySelectorAll('table')].forEach((table, idx) => {
    if (table.querySelectorAll('tbody tr').length < 10) {
        return;
    }
    table.id = `table-${idx}`;
    table.classList.add('expandable');
    const div = document.createElement('div');
    div.classList.add('center');
    const btn = document.createElement('button');
    btn.innerText = 'Show more';
    div.appendChild(btn);
    table.after(div);
    btn.onclick = () => {
        const tbl = document.querySelector(`table#${table.id}`);
        tbl.classList.toggle('expand');
        if (tbl.classList.contains('expand')) {
            btn.innerText = 'Show less';
        } else {
            btn.innerText = 'Show more';
        }
    };
});
</script> </div>  </article><article> <h1> <a href="/2023/06/05/2023-06-05-typescript-classes-are-not-what-you-think.html">TypeScript classes are not what you think</a> </h1> <time datetime="2023-06-05T05:15:00.000Z"> Jun 5, 2023 </time> <div class="content"> <p>There was a talk at CPPCon 2017 by Matt Goldbolt with an inspirational title, <a href="https://www.youtube.com/watch?v=bSkpMdDe4g4">What has my compiler done for me lately?</a>.
It actually resonates with me quite a bit, especially in the world where we try to push so hard for statically typed compiled languages on front-end.</p>
<p>Recently I recalled one of (many) aspects why I think TypeScript is useless (as a way to introduce strong type system to JavaScript world) in many cases.</p>
<p>To be realistic and not just throw bare accusations around, this was inspired by the work on contracts for a new microservice, specifically - the request &#x26; response types to be used in both client and the back-end of the microservice. The types were similar to the types used on a database layer and one of the developers just returned objects of that DB layer model type on a controller (endpoint) level, which confused me.</p>
<p>Consider the code below:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> A</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> moo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> foo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> moo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> foo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">public</span><span style="color:#E36209;--shiki-dark:#FFAB70"> zoo</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">[]) {}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ololo'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> a</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> A</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> c</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a;</span></span>
<span class="line"></span></code></pre>
<p>This works because of a (rather questionable) design decision by TypeScript team called <a href="https://www.typescriptlang.org/docs/handbook/type-compatibility.html">Type compatibility</a>, where any two classes or interfaces that have overlapping public fields are deemed compatible and can be mutually interplaceable.</p>
<p>However, in most languages with reasonable type system, you would expect two different classes to be just that - two different classes - in the case of a code above, an object of class <code>B</code> can never be assigned to a variable of type <code>A</code> and vice versa.</p>
<p>There is a way to achieve this in TypeScript, however (a bit cumbersome, though): by hiding the properties and only exposing them through non-getter/non-setter methods, when needed:</p>
<pre class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> A</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">private</span><span style="color:#E36209;--shiki-dark:#FFAB70"> moo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">private</span><span style="color:#E36209;--shiki-dark:#FFAB70"> foo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    getMoo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.moo;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    getFoo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.foo;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">class</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    constructor</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">private</span><span style="color:#E36209;--shiki-dark:#FFAB70"> moo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">private</span><span style="color:#E36209;--shiki-dark:#FFAB70"> foo</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> number</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">private</span><span style="color:#E36209;--shiki-dark:#FFAB70"> zoo</span><span style="color:#D73A49;--shiki-dark:#F97583">?:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> ReadonlyArray</span><span style="color:#24292E;--shiki-dark:#E1E4E8">&#x3C;</span><span style="color:#005CC5;--shiki-dark:#79B8FF">string</span><span style="color:#24292E;--shiki-dark:#E1E4E8">>) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    getMoo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.moo;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    getFoo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.foo;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">    getZoo</span><span style="color:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.zoo;</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> b</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#D73A49;--shiki-dark:#F97583"> new</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'ololo'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#D73A49;--shiki-dark:#F97583">-</span><span style="color:#005CC5;--shiki-dark:#79B8FF">3.14</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">'1'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> a</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> A</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> b; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// Type 'B' is not assignable to type 'A'. Types have separate declarations of a private property 'moo'.(2322)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">const</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> c</span><span style="color:#D73A49;--shiki-dark:#F97583">:</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> B</span><span style="color:#D73A49;--shiki-dark:#F97583"> =</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> a; </span><span style="color:#6A737D;--shiki-dark:#6A737D">// Property 'getZoo' is missing in type 'A' but required in type 'B'.(2741)</span></span>
<span class="line"></span></code></pre>
<p>Without knowing this feature beforehand, one might end up with an inconsistent code or errors down the line (when somebody decides to modify the DB layer model and gets errors on an API layer). And TypeScript does not really help here.</p> </div>  </article> </section> </main> <footer> <nav> <div class="prev">  </div> <div class="current">Page #1 of 11</div> <div class="next"> <a href="/page2.html" class="next">Next page &rarr;</a> </div> </nav> </footer> </body></html>