const __startRogueBomber=t=>{const e=t.getContext("2d");e.font="24px courier new";const o=e.measureText("X").width,i=30*o,n=Symbol(0),l=Symbol(1),s=Symbol(2),r=Symbol(3),a=Symbol(4),y=Symbol(5),c=Symbol(6),f=Symbol(7),x=Symbol(8),p=Symbol(9),b=Symbol("ò+1"),m=Symbol("ò+2"),h=Symbol("!+1"),d=Symbol("!+2"),u=Symbol("++1"),v=Symbol("++2"),S=[b,h,u],g=Symbol("l"),w=Symbol("b"),T=Symbol("B"),M=Symbol("i@i"),E=[g],I={[n]:[".","#b3b3b3"],[l]:["#","#a2a2a2"],[s]:["▒","#b76014"],[r]:["@","#000"],[a]:["ó","#000"],[y]:["Ó","#000"],[c]:["*","#ff8920"],[f]:[">","#bebebe"],[x]:[">","#0bacac"],[p]:[">","#2edfdf"],[g]:["l","#fbc546"],[w]:["b","#b05d13"],[T]:["B","#e8c129"],[M]:["@","#c7eeea"],[b]:["ò","#0bacac"],[m]:["ò","#2edfdf"],[h]:["!","#fbb40c"],[d]:["!","#f7c142"],[u]:["+","#307907"],[v]:["+","#52d508"]},_=[],k=11*(o+0)+i;t.style.width=`${k}px`,t.style.height="368px",t.style.overflow="hidden;",t.width=k,t.height=368;const A={position:{x:1,y:1},attributes:{hp:3,speed:1,bombs:10,fires:1,invincible:!1}},$={position:{x:-1,y:-1}};let R={timers:new Set,intervals:new Set,explosionTimers:new Set};const B=new Set,L=new Set,z={[g]:700,[w]:200,[T]:400},C=()=>{if(!0!==A.attributes.invincible&&(A.attributes.hp--,A.attributes.hp>0)){A.attributes.invincible=!0;const t=setInterval(()=>{H(A.position.x,A.position.y,M)},200);setTimeout(()=>{A.attributes.invincible=!1,clearInterval(t)},2e3)}},V={[g]:t=>{const{position:{x:e,y:o},destination:i,path:l}=t;if(i&&(e!==i.x||o!==i.y)&&l.length){const{x:i,y:s}=l.pop();if(A.position.x===e&&A.position.y===o&&C(),_[i][s]===n)return t.position={x:i,y:s},void J()}const s=[];for(let t of _)s.push(t.map(t=>t!==n?Number.MAX_VALUE:0));s[e][o]=1;const r=[],a=[{x:e,y:o}];let y=0;for(;a.length>0;){const{x:t,y:e}=a.pop();r.push({x:t,y:e}),y=Math.max(s[t][e],y),t-1>-1&&0===s[t-1][e]&&(s[t-1][e]=s[t][e]+1,a.unshift({x:t-1,y:e})),t+1<s.length&&0===s[t+1][e]&&(s[t+1][e]=s[t][e]+1,a.unshift({x:t+1,y:e})),e-1>-1&&0===s[t][e-1]&&(s[t][e-1]=s[t][e]+1,a.unshift({x:t,y:e-1})),e+1<s[0].length&&0===s[t][e+1]&&(s[t][e+1]=s[t][e]+1,a.unshift({x:t,y:e+1}))}const{x:c,y:f}=r.find(({x:t,y:e})=>s[t][e]===y),x=[{x:c,y:f}];let p={...x[x.length-1]};for(;s[p.x][p.y]>1;){const t=s[p.x][p.y]-1;if(p.x-1>-1&&s[p.x-1][p.y]===t)x.push({x:p.x-1,y:p.y});else if(p.x+1<s.length&&s[p.x+1][p.y]===t)x.push({x:p.x+1,y:p.y});else if(p.y-1>-1&&s[p.x][p.y-1]===t)x.push({x:p.x,y:p.y-1});else{if(!(p.y+1<s[0].length&&s[p.x][p.y+1]===t)){console.error("pathfinding error ¯\\_(ツ)_/¯");break}x.push({x:p.x,y:p.y+1})}p={...x[x.length-1]}}x.pop(),t.destination={x:c,y:f},t.path=x},[w]:t=>{},[T]:t=>{}},X=(t,e,o)=>{const i={position:{x:t,y:e},type:o},n=setInterval(V[o].bind(null,i),z[o]);i.interval=n,L.add(i)},j=(t,e,o)=>{const i={position:{x:t,y:e},type:o,revealed:!1};i.reveal=(()=>{const n=setTimeout(()=>{const n=setInterval(()=>{H(t,e,{[h]:d,[d]:h,[b]:m,[m]:h,[u]:v,[v]:u}[o])},200);i.interval=n},3e3),l=setTimeout(()=>{N(i)},5e3);i.timer1=n,i.timer2=l,i.revealed=!0}),B.add(i)},G=(t,e)=>{A.position={x:1,y:1},R.timers.forEach(t=>clearTimeout(t)),R.intervals.forEach(t=>clearInterval(t)),R.explosionTimers.forEach(t=>clearTimeout(t)),R.timers.clear(),R.intervals.clear(),R.explosionTimers.clear();let o=0;for(let i=0;i<t;++i){_[i]=[];for(let s=0;s<e;++s)0===i||0===s||i===t-1||s===e-1||i%2==0&&s%2==0?_[i][s]=l:(_[i][s]=n,++o)}$.position={x:-1,y:-1};const i=Math.floor(o/3)+Math.floor(100*Math.random())%(o/3),r=1+Math.floor(10*Math.random())%5;let a=0;for(;a<i;){const o=Math.floor(100*Math.random())%t,i=Math.floor(100*Math.random())%e;_[o][i]!=l&&(1==o&&1==i||2==o&&1==i||1==o&&2==i||(L.size<r?X(o,i,E[Math.floor(100*Math.random())%E.length]):Array.from(L).find(({position:{x:t,y:e}})=>o===t&&i===e)||(-1!==$.position.x&&-1!==$.position.y||($.position={x:o,y:i}),Math.floor(100*Math.random())%2!=0||Array.from(B).find(({position:{x:t,y:e}})=>o===t&&i===e)||j(o,i,S[Math.floor(100*Math.random())%S.length]),_[o][i]=s,++a)))}},N=t=>{const{timer1:e,timer2:o,interval:i,type:n}=t;clearTimeout(e),clearTimeout(o),clearInterval(i),B.delete(t)},O=(t,e)=>{let{position:{x:o,y:i}}=A;o+=t,i+=e,Array.from(L).find(({position:{x:t,y:e}})=>t===o&&e===i)&&C();const n=Array.from(B).find(({position:{x:t,y:e}})=>t===o&&e===i);n&&(t=>{N(t);const{type:e}=t;e===b||e===m?A.attributes.bombs++:e===h||e===d?A.attributes.fires++:e!==u&&e!==v||A.attributes.hp++})(n);const r=_[o][i];if(r===x||r===p)return G(15,11),void J();[s,l,a,y].includes(r)||(A.position={x:o,y:i})},U=(t,e)=>{const o=[s,a,y,c],{fires:i}=A.attributes,r=[{x:t,y:e}];for(let n=t-1;n>-1&&n>t-1-i&&_[n][e]!==l&&(r.push({x:n,y:e}),!o.includes(_[n][e]));--n);for(let n=t+1;n<_.length&&n<t+1+i&&_[n][e]!==l&&(r.push({x:n,y:e}),!o.includes(_[n][e]));++n);for(let n=e-1;n>-1&&n>e-1-i&&_[t][n]!==l&&(r.push({x:t,y:n}),!o.includes(_[t][n]));--n);for(let n=e+1;n<_[0].length&&n<e+1+i&&_[t][n]!==l&&(r.push({x:t,y:n}),!o.includes(_[t][n]));++n);for(let{x:t,y:e}of r){for(let o of L){const{position:{x:i,y:n},interval:l}=o;i===t&&n===e&&(clearInterval(o.interval),L.delete(o))}A.position.x===t&&A.position.y===e&&C();for(let o of B){const{position:{x:i,y:n},reveal:l}=o;i===t&&n===e&&(_[t][e]===s?l.call(null):N(o))}_[t][e]=c,_[t][e]!==a&&_[t][e]!==y||U(t,e)}J();const b=setTimeout(()=>{R.explosionTimers.delete(b);for(let{x:t,y:e}of r)if(t===$.position.x&&e===$.position.y){_[t][e]=f;setInterval(()=>{if(L.size>0)return;const t=_[$.position.x][$.position.y];_[$.position.x][$.position.y]=t===x?p:x},150)}else _[t][e]=n;J()},600);R.explosionTimers.add(b)},q=t=>{const e={72:()=>O(0,-1),74:()=>O(1,0),75:()=>O(-1,0),76:()=>O(0,1),66:()=>(()=>{const{position:{x:t,y:e},attributes:{bombs:o}}=A;if(R.timers.size>=o)return;_[t][e]=a;let i=a;const n=setInterval(()=>{i=i===a?y:a,_[t][e]=i,J()},700),l=setTimeout(()=>{U(t,e),clearInterval(n),R.intervals.delete(n),R.timers.delete(l)},4100);R.intervals.add(n),R.timers.add(l)})()}[t.keyCode];e&&(e.call(null),J())},D=()=>{A.attributes.hp<=0&&(F(),t.parentElement.removeChild(t))},F=()=>{document.removeEventListener("keydown",q)},H=(t,i,n)=>{const[l,s]=I[n];e.clearRect(i*(o+0),23*t,o+0,23),e.font="24px courier new",e.fillStyle=s,e.fillText(l,i*(o+0),23*(t+1))},J=()=>{if(e.clearRect(0,0,k,368),A.attributes.hp<1)(()=>{e.fillStyle="black",e.font="48px courier new";const t=["GAME OVER","---------","click to close"];for(let o=0;o<t.length;++o){const i=t[o],n=e.measureText(i).width;e.fillText(i,k/2-n/2,184+24*o)}})();else{for(let t=0;t<_.length;++t)for(let e=0;e<_[t].length;++e)H(t,e,_[t][e]);H(A.position.x,A.position.y,r);for(const{position:{x:t,y:e},type:o}of L)H(t,e,o);for(const{position:{x:t,y:e},type:o,revealed:i}of B)i&&H(t,e,o);(()=>{e.font="24px courier new",e.fillStyle="#000";const t=[`${I[b][0]} x ${A.attributes.bombs}`,`${I[h][0]} x ${A.attributes.fires}`,`${I[u][0]} x ${A.attributes.hp}`,"-----------","h/l - left/right","j/k - down/up","b - place bomb"];for(let i=0;i<t.length;++i)e.fillText(t[i],(_[0].length+3)*o,24*(2+i))})()}};G(15,11),document.addEventListener("keydown",q),t.addEventListener("click",D),J()};window.__startRogueBomber=__startRogueBomber;