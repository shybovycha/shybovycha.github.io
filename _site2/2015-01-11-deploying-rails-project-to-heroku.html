<meta name="layout" content="post">
<meta name="title" content="Deploying Rails project to Heroku">
<meta name="date" content="2015-01-11T15:45:52+01:00">
<meta name="tags" content="rtfm,rails,rails4,tutorials,heroku">
<meta name="tumblr_url" content="http://shybovycha.tumblr.com/post/107790765166/deploying-rails-project-to-heroku">
<p>First of all, set up the <strong>Heroku Toolbelt</strong>. It is required for all the communications with the server.</p>

<p>The first step of communication with the Heroku servers is logging in. Just run <code>heroku login</code> and provide your credentials when asked.</p>

<p>Then, you need to create your application or go to the folder where it is located and tune it a bit. Tuning is divided into the following steps:</p>

<ol>
<li>tuning the <code>Gemfile</code> to include the required gems</li>
<li>fixing the <code>database.yml</code> configurations</li>
<li>setting the server to handle static assets correctly</li>
</ol>

<p>But let&#39;s create out application on the Heroku servers first: <code>heroku create [app_name]</code>. If application name is not provided directly - it will be generated automatically.</p>

<p>Now, our application needs two gems to be included for the <code>production</code> gems&#39; group:</p>
<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
    <span class="n">gem</span> <span class="s1">'pg'</span>
    <span class="n">gem</span> <span class="s1">'rails_12factor'</span>
    <span class="n">gem</span> <span class="s1">'puma'</span>
<span class="k">end</span>

<p>The third gem is used as a webserver instead of WebRick, which is default <u>(puma is much, much faster!)</u>. The second one is required by Heroku. And the first one is used for PostgreSQL connectivity. If you do not wish to use database - skip it and a few next paragraphs.</p>

<p>Then, let&#39;s add the database support for our application. It&#39;s done simply, running</p>
heroku addons:add heroku-postgresql:hobby-dev

<p><strong>Note:</strong> Heroku does not support <code>sqlite</code> since some times. This means you are forced to use either PostgreSQL or no database at all <u>(yes, it&#39;s possible! Yet, it works for simple or static web applications only...)</u>. You may want to change this if you would pay for your account. But this tutorial covers only free side of the Heroku deployment.</p>

<p>Now, there are two ways to set database connection options in Rails:</p>

<ol>
<li>set them directly at <code>config/database.yml</code> file</li>
<li>set the environment variable <code>DATABASE_URL</code></li>
</ol>

<p>We will cover both cases. For the first one, you will need this section within your <code>database.yml</code> file:</p>
<span class="na">production</span><span class="pi">:</span>
    <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
    <span class="na">encoding</span><span class="pi">:</span> <span class="s">unicode</span>
    <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">URL_GOES_HERE</span>

<p>I will show how to get the <code>&lt;URL_GOES_HERE&gt;</code> value in a second. Just keep in mind to replace it with the correct value.</p>

<p>The second option, the environment variable, is set via the Heroku Toolbelt <u>(did I tell you, it is used for almost every deploy operation you will perform?)</u>.</p>

<p>First you take the database URL from Heroku server:</p>
heroku config | <span class="nb">grep </span>HEROKU_POSTGRESQL

<p>Then, you copy the value you got <u>(it starts with <code>postgres://</code>)</u> and run the following:</p>
heroku config:set <span class="nv">DATABASE_URL</span><span class="o">=</span>URL_GOES_HERE

<p>Now let&#39;s set our application to serve static assets. It is handy, because it is the easiest way to send images, stylesheets and javascripts to clients. Go to the <code>config/environments/production.rb</code> and change both <code>config.serve_static_assets</code> and <code>config.assets.compile</code> to <code>true</code>.</p>

<p><strong>But beware:</strong> if your <code>app/assets</code> files directory contains files of other extensions than Rails&#39; <strong>Sprockets</strong> understands - Rails (and Heroku, particularly) will try to precompile them. And that may cause many troubles. You are recommended either to &quot;teach&quot; Sprockets to skip or precompile those files, <strong>or</strong> you should exclude them from project before deploying to Heroku.</p>

<p>And the last two steps separate us from our goal: first, you should push your project to Heroku&#39; Git repository, it created for you with the application <u>(You do not use Git yet?! How dare you?!..)</u>.</p>

<p>Now, if you use database, run migrations with <code>heroku run rake db:migrate</code>.</p>

<p>And, finally, see your application running in the browser: <code>heroku open</code>.</p>

<p><strong>Note:</strong> if you are using some assets from the outer web (GoogleFonts, for example) and are seeing your website through the <code>https</code> protocol, you should replace all those assets&#39; URL protocols with <code>https</code> too.</p>
