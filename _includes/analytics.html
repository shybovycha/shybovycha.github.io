{% if jekyll.environment != 'development' %}
    {% include google_analytics_v4.html %}
{% endif %}

<script>
    window.addEventListener('load', () => {
        const onIntersect = (entries) => entries.forEach(entry => {
            if (!entry.isIntersecting) {
                return;
            }

            const elt = entry.target;
            const fraction = elt.dataset.fraction;

            gtag && gtag('event', `content_read_${fraction}`);
        });

        const observer = new IntersectionObserver(onIntersect, {
            margin: '40px 0',
            threshold: 0.01,
        });

        const markers = Array.from(document.querySelectorAll('.content-read-marker'));

        markers.forEach(marker => observer.observe(marker));
    });
</script>

<style>
    .content-read-marker { display: inline-block; width: 0; height: 0; }
</style>
